(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[9090,80717],{787703:(t,e,s)=>{"use strict";s.r(e),s.d(e,{isThemeExist:()=>d,loadTheme:()=>n,loadThemes:()=>a,removeTheme:()=>l,saveTheme:()=>h});var i=s(120780);const o=(0,s(201089).getLogger)("Themes.Provider");let r=null;function n(t){return(0,i.fetch)("/theme/?themeName="+encodeURIComponent(t),{credentials:"include",method:"GET"}).then((t=>t.json())).then((t=>{const e={};return t.content&&(e.content=JSON.parse(t.content)),e}))}function a(){return r||(0,i.fetch)("/themes/",{credentials:"include",method:"GET"}).then((t=>(r=t.json(),r)))}function h(t,e){const s=new FormData;return s.append("content",JSON.stringify(e)),s.append("name",t),r=null,(0,i.fetch)("/save-theme/",{credentials:"include",method:"POST",body:s}).then((t=>t.json()),(t=>o.logError(t)))}function l(t){const e=new FormData;return e.append("name",t),r=null,(0,i.fetch)("/remove-theme/",{credentials:"include",method:"POST",body:e}).then((t=>t.json()),(t=>o.logError(t)))}function d(t){return n(t).then((t=>Boolean(t.content)))}},278855:(t,e,s)=>{"use strict";function i(){return/(?:^|;)\s*theme=(dark|light)(?:;|$)|$/.exec(document.cookie)[1]}function o(t){const e=function(){const t=location.hostname.split(".").filter(Boolean);return t.every(isFinite)?location.host:t.slice(-2).join(".")}(),s=void 0===t?-1:3e8;document.cookie=`theme=${t};path=/;domain=${e};max-age=${s}`}s.d(e,{getThemeFromCookie:()=>i,setThemeToCookie:()=>o})},986738:(t,e,s)=>{"use strict";s.d(e,{ChartSession:()=>n});var i=s(707957),o=s(558603),r=s(389137);class n extends o.Session{constructor(t,e=!1){super(t,"cs",!1),this._sessionDisabled=!1,this._handler=null,this._criticalError=new i.Delegate,this._symbolResolveMap=new Map,this._disableStatistics=e}destroy(){this._criticalError.destroy(),this._handler=null,this._symbolResolveMap.clear(),super.destroy()}serverTimeOffset(){return this._getChartApi().serverTimeOffset()}serverTime(){return this._getChartApi().serverTime()}switchTimezone(t){return this._getChartApi().switchTimezone(this.sessionId(),t)}defaultResolutions(){return this._getChartApi().defaultResolutions()}availableCurrencies(){return this._getChartApi().availableCurrencies()}availableUnits(){return this._getChartApi().availableUnits()}availablePriceSources(t){return this._getChartApi().availablePriceSources(t)}resolveSymbol(t,e,s){if(this._symbolResolveMap.has(e)){const[t,i]=this._symbolResolveMap.get(e);return Array.isArray(i)?i.push(s):i.then(s),t}{const i=[s];return this._getChartApi().resolveSymbol(this.sessionId(),t,e,(s=>{"symbol_error"===s.method?this._symbolResolveMap.delete(e):this._symbolResolveMap.set(e,[t,Promise.resolve(s)]),i.forEach((t=>t(s)))})),this._symbolResolveMap.set(e,[t,i]),t}}requestFirstBarTime(t,e,s){return this._getChartApi().requestFirstBarTime(this.sessionId(),t,e,s)}createSeries(t,e,s,i,o,r,n){return this._getChartApi().createSeries(this.sessionId(),t,e,s,i,o,r,n)}modifySeries(t,e,s,i,o,r,n){return this._getChartApi().modifySeries(this.sessionId(),t,e,s,i,o,r,n)}removeSeries(t){
return!!this.isConnected().value()&&this._getChartApi().removeSeries(this.sessionId(),t)}requestMoreData(t,e,s){return"number"==typeof t?this._getChartApi().requestMoreData(this.sessionId(),t):this._getChartApi().requestMoreData(this.sessionId(),t,e,s)}requestMoreTickmarks(t,e,s){return(0,r.isNumber)(t)?this._getChartApi().requestMoreTickmarks(this.sessionId(),t):this._getChartApi().requestMoreTickmarks(this.sessionId(),t,e,s)}requestMetadata(t,e){this._getChartApi().requestMetadata(this.sessionId(),t,e)}canCreateStudy(t){return this._getChartApi().canCreateStudy(t)}getStudyCounter(){return this._getChartApi().getStudyCounter()}createStudy(t,e,s,i,o,r,n){return this._getChartApi().createStudy(this.sessionId(),t,e,s,i,o,r,n)}rebindStudy(t,e,s,i,o,r,n){return this._getChartApi().rebindStudy(this.sessionId(),t,e,s,i,o,r,n)}modifyStudy(t,e,s,i,o){return this._getChartApi().modifyStudy(this.sessionId(),t,e,s,i,o)}removeStudy(t,e){return this._getChartApi().removeStudy(this.sessionId(),t,e)}createPointset(t,e,s,i,o,r){return this._getChartApi().createPointset(this.sessionId(),t,e,s,i,o,r)}modifyPointset(t,e,s,i){return this._getChartApi().modifyPointset(this.sessionId(),t,e,s,i)}removePointset(t){return this._getChartApi().removePointset(this.sessionId(),t)}setVisibleTimeRange(t,e,s,i,o,r){0}criticalError(){return this._criticalError}connect(t=null){null!==t&&(this._handler=t),this._symbolResolveMap.clear(),super.connect()}setHandler(t){this._handler=t}connected(){return this.isConnected().value()&&!this._sessionDisabled}disable(){this._sessionDisabled=!0}chartApi(){return this._getChartApi()}_sendCreateSession(){Object.keys(this).forEach((t=>{/^(s|st|symbol_)\d+$/.test(t)&&delete this[t]})),this._getChartApi().chartCreateSession(this.sessionId(),this._disableStatistics)}_sendRemoveSession(){this._getChartApi().chartDeleteSession(this.sessionId())}_onMessage(t){this._handler&&this._handler(t)}_onCriticalError(t,e){this._criticalError.fire(t,e),super._onCriticalError(t,e)}}},245302:(t,e,s)=>{"use strict";s.d(e,{parseTzOffset:()=>o});var i=s(988124);function o(t,e=Date.now()){const s=(0,i.get_timezone)(t).offset_utc(e);let o="";const r=s/1e3/60/60;r%1&&(o=":"+Math.round(Math.abs(r%1*60)).toString().padStart(2,"0"));let n="";return n=r>0?"+"+(r-r%1)+o:0===r?"":String(r-r%1+o),{offset:s,string:"UTC"+n}}},228018:(t,e,s)=>{"use strict";s.d(e,{clientSnapshot:()=>M,widgetClientSnapshot:()=>D});var i,o,r=s(327714),n=s(650151),a=s(86441),h=s(724377),l=s(919346),d=s(674981),c=s(199471),u=s(422333),m=s(511131),_=s(429874),g=s(934976),p=(s(244842),s(776351));const f=Boolean(null===(o=null===(i=window.initData)||void 0===i?void 0:i.logo)||void 0===o?void 0:o.no_powered_by);function b(t,e=null,s=null){let i={};if("number"==typeof t)return{relativePositions:{[t]:{l:e,t:s}},nextElementLeft:t,nextElementTop:t};const[o,...r]=t;if("v"===o){let t=null;for(const o of r){const r=b(o,e,s);i={...i,...r.relativePositions},s=r.nextElementTop,t=r.nextElementLeft}e=t}if("h"===o){let t=null;for(const o of r){const r=b(o,e,s);i={...i,
...r.relativePositions},e=r.nextElementLeft,t=r.nextElementTop}s=t}return{relativePositions:i,nextElementTop:s,nextElementLeft:e}}const S=function(t){const e={};for(const s of Object.keys(t)){const i=b(t[s]).relativePositions;e[s]=i}return e}(g);function v(t,e,s,i){let o=Math.round(10*i),r=Math.round(10*i);const n=s[t];if(null!==n.l){const t=v(n.l,e,s,i);o=t.x+t.width+Math.round(5*i)}if(null!==n.t){const t=v(n.t,e,s,i);r=t.y+t.height+Math.round(5*i)}const a=e[t];return{x:o,y:r,width:a.width,height:a.height}}function y(t,e,s){var i;const o=(new DOMParser).parseFromString(p,"image/svg+xml");null===(i=null==o?void 0:o.firstElementChild)||void 0===i||i.setAttribute("color",s);const r=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(o)],{type:"image/svg+xml"}));return new Promise((s=>{const i=new Image;i.width=t,i.height=e,i.onload=()=>{s({image:i,width:t,height:e})},i.src=r}))}function C(t,e,s,i,o){t.save(),t.drawImage(i.image,e,s,i.width,i.height),t.textBaseline="bottom";const r=(e+i.width)/o+3,n=(s+i.height)/o;(0,c.drawScaled)(t,o,o,(()=>{t.fillText("TradingView",r,n)})),t.restore()}function w(t,e,s,i){return(0,c.drawScaled)(t,i,i,(()=>{t.fillText(s,e.x/i,e.y/i)})),t.measureText(s).width*i}function x(t,e,s,i,o,r){const n=o.map((t=>t.text)).join("");let h=s.x;const l=function(t,e,s,i){if(t.measureText(e).width*i<=s)return{text:e,elided:!1};const o=t.measureText("...").width*i,r=[];for(let t=0;t<e.length;++t)r.push(t);const n=(0,d.upperbound)(r,s,((r,n)=>t.measureText(e.slice(0,n+1)).width*i+o>s));return{text:(e=e.slice(0,n)).trim(),elided:!0}}(t,n,i-h,e);if(l.elided&&!r)return null;const c=[];let u=0;for(const t of o){if(u+t.text.length>l.text.length)break;c.push(t.text),u+=t.text.length}const m=c.join("").trim().length;u=0;for(const i of o){if(u+i.text.length>m)break;i.color&&(t.save(),t.fillStyle=i.color),h+=w(t,new a.Point(h,s.y),i.text,e),i.color&&t.restore(),u+=i.text.length}return l.elided&&(h+=w(t,new a.Point(h,s.y),"...",e)),h}function I(t){return t.map((t=>({...t,title:""})))}function T(t,e){const s=[{text:t.trim()}];for(const t of e)t.visible&&(""!==s[s.length-1].text&&s.push({text:"  "}),t.title&&s.push({text:t.title}),s.push({text:t.value,color:t.color}));return s}class A{constructor(t,e){this._logoTextColor=null,this._snapshotData=t,e=e||{},this._options={backgroundColor:_.themes[t.theme].getThemedColor("color-bg-primary"),borderColor:_.themes[t.theme].getThemedColor("color-border"),font:u.CHART_FONT_FAMILY,fontSize:12,legendMode:"vertical",hideResolution:!1,showHeaderPublishedBy:!1,showHeaderMainSymbol:!1,...e};const s=S[t.layout],i=t.charts.map((t=>function(t){const e=t.panes[0],s=e.canvas.width+e.leftAxis.canvas.width+e.rightAxis.canvas.width;let i=0;for(const e of t.panes)i+=e.canvas.height;return void 0!==t.timeAxis&&0!==t.timeAxis.contentHeight&&(i+=t.timeAxis.canvas.height),(0,r.size)({width:s,height:i})}(t)));if(this._pixelRatio=t.hidpiRatio,this._chartsGeometry=t.charts.map(((t,e)=>v(e,i,s,this._pixelRatio))),!f){let s=t.theme;void 0!==e.backgroundColor&&(s="black"===(0,
h.rgbToBlackWhiteString)((0,h.parseRgb)(e.backgroundColor),150)?l.StdTheme.Dark:l.StdTheme.Light),this._logoTextColor=_.themes[s].getThemedColor("color-text-primary")}this._headerDefaultTextColor=_.themes[t.theme].getThemedColor("color-text-primary")}async getImage(){const t=this._pixelRatio;let e=0,s=0,i=0;const o=this._headerItems();if(o.length>0){i=Math.ceil(1.4*this._options.fontSize*t)*o.length}s+=i;let n=0,h=0;for(const t of this._chartsGeometry)n=Math.max(n,t.x+t.width),h=Math.max(h,t.y+t.height);const l=s;e+=n,s+=h,e+=Math.round(10*t);const d=f?Math.round(10*t):Math.round(35*t),_=s;s+=d;const g=(0,c.createDisconnectedCanvas)(document,(0,r.size)({width:e,height:s}),1),p=(0,c.getContext2D)(g);p.font=(0,m.makeFont)(this._options.fontSize,this._options.font),p.textBaseline="top",p.fillStyle=this._options.backgroundColor,p.fillRect(0,0,e,s),o.length>0&&this._drawHeader(p,o,e,new a.Point(Math.round(10*t),Math.round(10*t)));for(let t=0;t<this._snapshotData.charts.length;++t){const e=this._snapshotData.charts[t],s=this._chartsGeometry[t];this._drawChart(e,s,p,new a.Point(0,l))}if(null!==this._logoTextColor){const e=await y(Math.round(20*t),Math.round(15*t),this._logoTextColor);p.fillStyle=this._logoTextColor,p.font=(0,m.makeFont)(13,u.CHART_FONT_FAMILY);const s=_+Math.round(d/2-e.height/2);C(p,Math.round(10*t),s,e,t)}return g}_drawChart(t,e,s,i){s.save(),s.translate(e.x+i.x,e.y+i.y);let o=0;for(const e of t.panes){let i=0;const r=e.leftAxis.canvas.width+Math.round(8*this._pixelRatio),n=o,h=o+Math.round(10*this._pixelRatio);e.leftAxis.contentWidth>0&&e.leftAxis.contentHeight>0&&(s.drawImage(e.leftAxis.canvas,i,o),i+=e.leftAxis.canvas.width),s.drawImage(e.canvas,i,o),i+=e.canvas.width,e.rightAxis.contentWidth>0&&e.rightAxis.contentHeight>0&&s.drawImage(e.rightAxis.canvas,i,o),"pane"===e.type&&(s.fillStyle=t.colors.text,this._drawLegend(e,s,new a.Point(r,h),n)),o+=e.canvas.height}if(void 0!==t.timeAxis&&0!==t.timeAxis.contentHeight){let e=0;t.timeAxis.lhsStub.contentWidth>0&&t.timeAxis.lhsStub.contentHeight>0&&(s.drawImage(t.timeAxis.lhsStub.canvas,e,o),e+=t.timeAxis.lhsStub.canvas.width),s.drawImage(t.timeAxis.canvas,e,o),e+=t.timeAxis.canvas.width,t.timeAxis.rhsStub.contentWidth>0&&t.timeAxis.rhsStub.contentHeight>0&&s.drawImage(t.timeAxis.rhsStub.canvas,e,o)}s.strokeStyle=this._options.borderColor,s.strokeRect(0,0,e.width,e.height),s.restore()}_headerItems(){var t,e,s,i;const o=[];if(this._options.showHeaderPublishedBy&&this._snapshotData.publishedBy)for(const t of this._snapshotData.publishedBy)o.push([{text:t}]);if(this._options.showHeaderMainSymbol){const r=this._snapshotData.charts[0],n=`${null===(t=r.meta)||void 0===t?void 0:t.symbol}, ${null===(e=r.meta)||void 0===e?void 0:e.resolution}`;o.push(T(n,null!==(i=null===(s=r.meta)||void 0===s?void 0:s.values)&&void 0!==i?i:[]))}return o}_drawHeader(t,e,s,i){t.save(),t.fillStyle=this._headerDefaultTextColor;const o=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);e.forEach(((e,r)=>{x(t,this._pixelRatio,new a.Point(i.x,i.y+o*r),s,e,!0)})),t.restore()}
_drawLegend(t,e,s,i){let o=!0;const r=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);let h=s.x,l=s.y;if(t.mainSeriesText&&l+r<i+t.canvas.height){const s=x(e,this._pixelRatio,new a.Point(h,l),t.contentWidth*this._pixelRatio,T(t.mainSeriesText,t.mainSeriesValues),!0);"horizontal"!==this._options.legendMode?l+=r:(h=(0,n.ensureNotNull)(s)+1.4*this._options.fontSize*this._pixelRatio,o=!1)}for(let n=0;n<t.studies.length;++n)if(l+r<i+t.canvas.height){const i=t.studies[n],d=t.studiesValues[n];let c=null;for(;null===c;)c=x(e,this._pixelRatio,new a.Point(h,l),t.contentWidth*this._pixelRatio,T(i,I(d)),o),"horizontal"!==this._options.legendMode?l+=r:null===c?(o=!0,h=s.x,l+=r):(h=c+1.4*this._options.fontSize*this._pixelRatio,o=!1)}}}async function M(t,e){return new A(t,e).getImage()}class F{constructor(t,e){if(this._logoTextColor=null,this._widgetSnapshot=t,e=e||{},this._options={backgroundColor:_.themes[t.theme].getThemedColor("color-bg-primary"),borderColor:_.themes[t.theme].getThemedColor("color-border"),font:u.CHART_FONT_FAMILY,fontSize:12,showHeaderPublishedBy:!0,...e},this._pixelRatio=t.hidpiRatio,!f){let s=t.theme;void 0!==e.backgroundColor&&(s="black"===(0,h.rgbToBlackWhiteString)((0,h.parseRgb)(e.backgroundColor),150)?l.StdTheme.Dark:l.StdTheme.Light),this._logoTextColor=_.themes[s].getThemedColor("color-text-primary")}this._headerDefaultTextColor=_.themes[t.theme].getThemedColor("color-text-primary")}async getImage(){const t=this._pixelRatio,e=Math.round(10*t);let s=0,i=0,o=0;const n=this._headerItems();if(n.length>0){o=Math.ceil(1.4*this._options.fontSize*t)*n.length}i+=o;const h=i,l=this._widgetSnapshot.canvas.width,d=this._widgetSnapshot.canvas.height;s+=l+2*e,i+=d+e;const _=Math.round(35*t),g=i;i+=_;const p=(0,c.createDisconnectedCanvas)(document,(0,r.size)({width:s,height:i}),1),f=(0,c.getContext2D)(p);if(f.font=(0,m.makeFont)(this._options.fontSize,this._options.font),f.textBaseline="top",f.fillStyle=this._options.backgroundColor,f.fillRect(0,0,s,i),n.length>0&&this._drawHeader(f,n,s,new a.Point(e,e)),f.drawImage(this._widgetSnapshot.canvas,e,e+h),f.strokeStyle=this._options.borderColor,f.strokeRect(e,e+h,l,d),null!==this._logoTextColor){const s=await y(Math.round(20*t),Math.round(15*t),this._logoTextColor);f.fillStyle=this._logoTextColor,f.font=(0,m.makeFont)(13,u.CHART_FONT_FAMILY);C(f,e,g+Math.round(_/2-s.height/2),s,t)}return p}_headerItems(){const t=[];if(this._options.showHeaderPublishedBy&&this._widgetSnapshot.publishedBy)for(const e of this._widgetSnapshot.publishedBy)t.push([{text:e}]);return t}_drawHeader(t,e,s,i){t.save(),t.fillStyle=this._headerDefaultTextColor;const o=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);e.forEach(((e,r)=>{x(t,this._pixelRatio,new a.Point(i.x,i.y+o*r),s,e,!0)})),t.restore()}}async function D(t,e){return new F(t,e).getImage()}},714688:(t,e,s)=>{"use strict";s.d(e,{DateTimeFormatter:()=>n});var i=s(716714),o=s(157954);const r={dateFormat:"yyyy-MM-dd",withWeekday:!1,timeFormat:i.hourMinuteSecondFormat,dateTimeSeparator:" "};class n{constructor(t={}){
const e=Object.assign({},r,t);this._dateFormatter=new o.DateFormatter(e.dateFormat,e.withWeekday),this._timeFormatter=new i.TimeFormatter(e.timeFormat),this._separator=e.dateTimeSeparator}format(t){return`${this._dateFormatter.format(t)}${this._separator}${this._timeFormatter.format(t)}`}formatLocal(t){return`${this._dateFormatter.formatLocal(t)}${this._separator}${this._timeFormatter.formatLocal(t)}`}}},743354:(t,e,s)=>{"use strict";s.d(e,{DateTimeWithTzFormatter:()=>l});var i=s(245302),o=s(988124),r=s(716714),n=s(714688),a=s(157954);const h={dateFormat:"MMM dd",timeFormat:r.hourMinuteFormat};class l{constructor(t={}){const{dateFormat:e,timeFormat:s,timezone:i}={...h,...t};e&&s?this._dateFormatter=new n.DateTimeFormatter({dateFormat:e,timeFormat:s}):e?this._dateFormatter=new a.DateFormatter(e):s&&(this._dateFormatter=new r.TimeFormatter(s)),this._timezone=(0,o.get_timezone)(null!=i?i:"Etc/UTC")}format(t){const e=1e3*t,s=(0,i.parseTzOffset)(this._timezone.name(),e).string;return void 0===this._dateFormatter?s:`${this._dateFormatter.format((0,o.utc_to_cal)(this._timezone,e))} ${s}`}setTimezone(t){this._timezone=(0,o.get_timezone)(t)}}},716714:(t,e,s)=>{"use strict";s.d(e,{TimeFormatter:()=>u,hourMinuteFormat:()=>h,hourMinuteNonZeroSecondFormat:()=>n,hourMinuteSecondFormat:()=>r,hourMinuteSecondMilisecFormat:()=>a,twelveHourMinuteFormat:()=>c,twelveHourMinuteNonZeroSecondFormat:()=>d,twelveHourMinuteSecondFormat:()=>l});var i=s(551775),o=s(702053);const r="%h:%m:%s",n="%h:%m:%s+",a="%h:%m:%s.%ss",h="%h:%m",l="%h:%m:%s %ampm",d="%h:%m:%s+ %ampm",c="%h:%m %ampm";class u{constructor(t){this._isTwelveHoursFormat=!1,this._valuesAndDelimeters=[];const e=t||r,s=new RegExp("%h|%m|%s\\+|%ss|%ampm|%s","g");let i=s.exec(e),o=0;for(;null!==i;){const t=i[0];"%ampm"===t&&(this._isTwelveHoursFormat=!0);const r=e.substring(o,i.index);""!==r&&this._valuesAndDelimeters.push(r),this._valuesAndDelimeters.push(t),o=i.index+t.length,i=s.exec(e)}}format(t){return i.customFormatters.timeFormatter?i.customFormatters.timeFormatter.format(t):this._formatTime(t,!1)}formatLocal(t){return i.customFormatters.timeFormatter?i.customFormatters.timeFormatter.formatLocal?i.customFormatters.timeFormatter.formatLocal(t):i.customFormatters.timeFormatter.format(t):this._formatTime(t,!0)}_formatTime(t,e){let s=e?t.getHours():t.getUTCHours();const i=e?t.getMinutes():t.getUTCMinutes(),r=e?t.getSeconds():t.getUTCSeconds(),n=e?t.getMilliseconds():t.getUTCMilliseconds();let a="";this._isTwelveHoursFormat&&(a=s>=12?"PM":"AM",s%=12,s=s||12);let h="",l=!1;for(let t=this._valuesAndDelimeters.length-1;t>=0;t--){const e=this._valuesAndDelimeters[t];let d;switch(e){case"%h":d=(0,o.numberToStringWithLeadingZero)(s,2);break;case"%m":d=(0,o.numberToStringWithLeadingZero)(i,2);break;case"%s+":0!==r?d=(0,o.numberToStringWithLeadingZero)(r,2):(d="",l=!0);break;case"%s":d=(0,o.numberToStringWithLeadingZero)(r,2);break;case"%ss":d=(0,o.numberToStringWithLeadingZero)(n,3);break;case"%ampm":d=a;break;default:if(l){l=!1;continue}d=e}h=d+h}return h}}},175878:(t,e,s)=>{"use strict"
;s.d(e,{SeriesDataSource:()=>b,initialRequestOptionsToNumBars:()=>f,parseJapaneseProjectionBars:()=>S});var i=s(650151),o=s(389137),r=s(919892),n=s(223699),a=s(544421),h=s(178389),l=s(826989),d=s(442410),c=s(201089),u=s(444331);const m=(0,c.getLogger)("Chart.SeriesDataSource");var _;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",t[t.Active=3]="Active"}(_||(_={}));let g=1;let p=1;function f(t){return t.startDate?t.endDate||t.count?t.endDate?["from_to",t.startDate,t.endDate]:["bar_count",t.startDate,(0,i.ensure)(t.count)]:["from_to",t.startDate]:t.count||300}class b{constructor(t,e,s,i){this._symbol=null,this._resolvedSymbolName=null,this._createSeriesOverriddenParams=0,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new a.SeriesData,this._dataEvents=new d.SeriesDataEvents,this._status=_.Idle,this._turnaroundCounter=1,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,this._turnaroundPrefix=e,this._createSeriesParams=f(null!=s?s:{count:300}),this._timeFrame=i||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged)}modifySeries(t,e,s=null,r=!1,a=null){r&&(m.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._symbol=null,this._resolution=null);const h=this._symbol,l=this._resolution;if(this._symbol=t,this._resolution=e,null===this._instanceId)return void(this._timeFrame=s);const d=!(0,o.deepEquals)(h,t)[0]||null!==this._resolvedSymbolName&&this._resolvedSymbolName!==this._getSymbolNameString(t),c=null===l||!n.Interval.isEqual(l,e);(d||c||null!==s)&&(this._timeFrame=null,(d||c)&&this._turnaroundCounter++,d&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),this._resolution,a,s,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(t){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,t,this._onMessage.bind(this))}requestMoreTickmarks(t){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,t,this._onMessage.bind(this))}isStarted(){return this._status!==_.Idle}isActive(){return this._status===_.Active}resolution(){return this._resolution}start(){this.isStarted()?m.logNormal("start: data source is already started, nothing to do"):((0,i.assert)(null!==this._symbol,"symbol must be set before start"),(0,i.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(_.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),
this._changeStatusTo(_.Idle)):m.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}clearData(){this.isStarted()?this._enqueueUpdate((()=>this._clearDataImpl())):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._symbol}moveData(t){this._enqueueUpdate((()=>this._data.moveData(t)))}setInitialRequestOptions(t){this._createSeriesOverriddenParams=f(t)}_resolveSymbol(){null!==this._symbol&&(this._symbolInstanceId=this._gateway.resolveSymbol("sds_sym_"+g++,(0,r.encodeExtendedSymbolOrGetSimpleSymbolString)(this._symbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(t){(0,i.assert)(this._status!==t,"Source and destination status should be distinct"),m.logNormal(`Status changed from ${_[this._status]} to ${_[t]}`),this._status=t}_createSeries(){(0,i.assert)(this._status!==_.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+p++,this._resolveSymbol();const t=this._createSeriesOverriddenParams||this._createSeriesParams;this._createSeriesOverriddenParams&&(this._createSeriesOverriddenParams=0),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),(0,i.ensureNotNull)(this._resolution),t,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(_.AwaitingFirstDataUpdate),this._dataEvents.fireCreated(this._instanceId)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===_.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==_.Idle&&this._status!==_.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(_.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(t){this._enqueueUpdate((()=>this._onMessageImpl(t)))}async _onMessageImpl(t){switch(t.method){case"symbol_resolved":{const[e,s]=t.params;if(e!==this._symbolInstanceId){m.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolResolved(s);break}case"symbol_error":if(t.params[0]!==this._symbolInstanceId){m.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolError(t);break;case"series_timeframe":{const[e,s,i,o,r,n,a]=t.params;if(!this._checkTurnaround(e,s)){m.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesTimeFrame(i,o,r,n,a);break}case"series_error":{const[e,s]=t.params;if(!this._checkTurnaround(e,s)){m.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesError(t.params[2]);break}case"series_loading":{const[e,s]=t.params;if(!this._checkTurnaround(e,s))break;this._onSeriesLoading(t.time);break}
case"series_completed":{const[e,s,i,o]=t.params;if(!this._checkTurnaround(e,i)){m.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${i})`);break}this._onSeriesCompleted(s,t.time,o);break}case"data_update":if(!this._checkTurnaround(t.params.customId,t.params.turnaround)){m.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t.params.customId} (${t.params.turnaround})`);break}await this._onDataUpdate(t.params.plots,t.params.nonseries,t.params.lastBar);break;case"clear_data":if(t.params.turnaround!==this.turnaround()){m.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${t.params.turnaround}`);break}this._clearDataImpl(),this._dataEvents.fireDataUpdated(void 0,!1,null)}}_onSeriesError(t){let e,s;if("string"==typeof t)s={error:t},e=t;else if(s=t,t.ctx){const s={};Object.entries(t.ctx).forEach((([t,e])=>{s[t]=e.toString()})),e=t.error.format(s)}else e=t.error;if(e.startsWith("study_not_auth:")){const t=e.split(":",2)[1].split("@",2)[0];if(["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(t))this._dataEvents.fireChartTypeNotPermitted(t);else if("BarSetSpread"===t)this._dataEvents.fireIntradaySpreadNotPermitted();else if("BarSetRange"===t){const t=`${(0,i.ensureNotNull)(this._symbol).inputs.range}R`;this._dataEvents.fireCustomIntervalNotPermitted(t)}}else"resolution_not_entitled"===e?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===e?this._dataEvents.fireCustomIntervalNotPermitted((0,i.ensureNotNull)(this._resolution)):"seconds_not_entitled"===e&&this._dataEvents.fireSecondsIntervalNotPermitted();this._dataEvents.fireSeriesError(s)}_onSeriesTimeFrame(t,e,s,i,o){this._dataEvents.fireSeriesTimeFrame(t,e,s,null==i||i,o)}_onSymbolError(t){if(t.params[1]===l.permissionDenied)switch(t.params[2]){case l.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(t.params[3]);break;case l.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(t.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(t.params[2])}else t.params[1]===l.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(t.params[1])}_onSymbolResolved(t){this._resolvedSymbolName=(0,u.symbolForApi)(t,this._getSymbolNameString((0,i.ensureNotNull)(this._symbol))),this._dataEvents.fireSymbolResolved(t)}_getSymbolNameString(t){return"string"==typeof t.symbol?t.symbol:t.symbol.symbol}async _onDataUpdate(t,e,s){this._onDataUnpacked(t,s,await S(e))}_enqueueUpdate(t){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(t,t),this._ongoingDataUpdate}_onDataUnpacked(t,e,s){if(this._status===_.Idle)return;this._status===_.AwaitingFirstDataUpdate&&(this._changeStatusTo(_.Active),this._clearDataImpl());const i=this._data.bars().size(),o=this._data.bars().firstIndex(),r=this._data.mergeRegularBars(t);null!==s&&(this._data.nsBars().clear(),this._data.nsBars().merge(s.projectionPlots),
this._data.lastProjectionPrice=s.lastPrice,null!==s.boxSize&&(this._data.boxSize=s.boxSize),this._data.reversalAmount=s.reversalAmount);const n=null===o||null!==r&&r.index<o;this._dataEvents.fireDataUpdated(e,n,r),i!==this._data.bars().size()&&null!==r&&this._dataEvents.fireBarReceived(r)}_onSeriesLoading(t){this._dataEvents.fireLoading(t)}_onSeriesCompleted(t,e,s){this._dataEvents.fireCompleted({updateMode:t,time:e,flags:s})}_checkTurnaround(t,e){return this._instanceId===t&&(void 0===e||e===this.turnaround())}}async function S(t){if(void 0===t)return{projectionPlots:[],boxSize:null};if(""===t.d||"nochange"===t.indexes)return null;const e=await(0,h.unpackNonSeriesData)(t.d);if(null===e||e.indexes_replace)return null;const s=t.indexes,{bars:i,price:o,boxSize:r,reversalAmount:n}=e.data;return{lastPrice:o,projectionPlots:(i||[]).map((t=>{let e;return"factor"in t?e=t.factor:"additionalPrice"in t&&(e=t.additionalPrice),{index:s[t.time],value:[0,t.open,t.high,t.low,t.close,t.volume,e]}})),reversalAmount:n,boxSize:r}}},558603:(t,e,s)=>{"use strict";s.d(e,{Session:()=>h});var i=s(650151),o=s(401580),r=s(707957),n=s(541558);const a=(0,s(201089).getLogger)("ChartApi.AbstractSession");class h{constructor(t,e,s){this._isConnected=new o.WatchedValue(!1),this._state=0,this._isConnectForbidden=!1,this._sessionId="",this._sessionIdChanged=new r.Delegate,this._chartApi=t,this._sessionPrefix=e,this._shouldReconnectAfterCriticalError=s}destroy(){this._logNormal("Destroying session"),this._isConnected.unsubscribe(),this.disconnect(),this._sessionIdChanged.destroy(),delete this._chartApi,this._logNormal("Session has been destroyed")}isConnected(){return this._isConnected}sessionId(){return this._sessionId}onSessionIdChanged(){return this._sessionIdChanged}connect(){0===this._state&&((0,i.assert)(!this._isConnectForbidden,"Cannot call connect because it is forbidden at this moment"),this._setSessionId(`${this._sessionPrefix}_${(0,n.randomHash)()}`),this._logNormal("Connecting session - wait until transport stay connected"),this._state=1,this._chartApi.createSession(this._sessionId,this))}disconnect(){0!==this._state&&((0,i.assert)(""!==this._sessionId,"sessionId must not be invalid"),this._logNormal("Disconnecting session..."),this._forbidConnectWhile((()=>{this._chartApi.connected()&&this._sendRemoveSession(),this._processDestroyingOnServer()})))}onMessage(t){switch(t.method){case"connected":return void this._onChartApiConnected();case"disconnected":return void this._onChartApiDisconnected();case"critical_error":const e=String(t.params[0]),s=String(t.params[1]);return void this._onCriticalError(e,s)}this._onMessage(t)}_getChartApi(){return this._chartApi}_generateLogMessage(t){return`[${this._sessionId}] ${t}`}_onCriticalError(t,e){this._logError(`Critical error. Reason=${t}, info=${e}.`),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this._shouldReconnectAfterCriticalError?(this._logNormal("Reconnecting after critical error..."),this.connect()):this._logNormal("Reconnecting after critical error skipped")}
_onChartApiConnected(){(0,i.assert)(1===this._state,"Session is not registered"),this._logNormal("Transport is connected. Creating session on the server"),this._sendCreateSession(),this._state=2,this._isConnected.setValue(!0)}_onChartApiDisconnected(){this._logNormal("Transport is disconnected. Reconnecting..."),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this.connect()}_setSessionId(t){const e=this._sessionId;this._logNormal(`Changing sessionId: old=${e}, new=${t}`),this._sessionId=t,this._sessionIdChanged.fire(t,e)}_logNormal(t){a.logNormal(this._generateLogMessage(t))}_logError(t){a.logError(this._generateLogMessage(t))}_processDestroyingOnServer(){this._state=0,this._isConnected.setValue(!1),this._chartApi.removeSession(this._sessionId),this._setSessionId("")}_forbidConnectWhile(t){this._isConnectForbidden=!0,t(),this._isConnectForbidden=!1}}},464539:(t,e,s)=>{"use strict";s.d(e,{getHourMinuteFormat:()=>o,getHourMinuteSecondFormat:()=>r,getTimeFormatForInterval:()=>n});var i=s(716714);function o(t){return"12-hours"===t?i.twelveHourMinuteFormat:i.hourMinuteFormat}function r(t){return"12-hours"===t?i.twelveHourMinuteSecondFormat:i.hourMinuteSecondFormat}function n(t,e){if(t.isRange())return function(t){return"12-hours"===t?i.twelveHourMinuteNonZeroSecondFormat:i.hourMinuteNonZeroSecondFormat}(e);return t.isSeconds()||t.isTicks()?r(e):o(e)}},776351:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 28" width="36" height="28"><path fill="currentColor" d="M14 22H7V11H0V4h14v18zM28 22h-8l7.5-18h8L28 22z"/><circle fill="currentColor" cx="20" cy="8" r="4"/></svg>'}}]);