"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[71],{846778:(e,t,i)=>{i.d(t,{showPasteLineToolHint:()=>c});var r=i(444372),s=i(62802),n=i(638456),o=i(470316),l=i(244842);const a=r.t(null,void 0,i(13262));function c(e,t){l.enabled("popup_hints")&&!n.CheckMobile.any()&&Promise.all([i.e(9817),i.e(93280),i.e(50690),i.e(26166)]).then(i.bind(i,410837)).then((i=>{const r=new i.ChartEventHintRenderer(e),n=a.format({shortcut:(0,o.humanReadableHash)(o.Modifiers.Mod+86)});let l=null;r.show(n,(()=>{null!==l&&(clearTimeout(l),l=null,s.setValue(t,!0,{forceFlush:!0}))})),l=setTimeout((()=>{l=null,r.hide()}),5e3)}))}},626333:(e,t,i)=>{function r(e,t=window){const i="theme-"+e,r=t.document.documentElement.classList;for(const e of Array.from(r))e.startsWith("theme-")&&e!==i&&r.remove(e);r.add(i)}i.d(t,{applyTheme:()=>r})},983898:(e,t,i)=>{function r(e,t,i){const r=e.get(t);return void 0!==r?r:(e.set(t,i),i)}function s(e,t,i){const r=e.get(t);if(void 0!==r)return r;const s=i();return e.set(t,s),s}function n(e,t,i,s){const n=r(e,t,new Map);return r(n,i,s)}function o(e,t,i,n){return s(r(e,t,new Map),i,n)}function l(e,t,i,s,n){const o=r(e,t,new Map),l=r(o,i,new Map);return r(l,s,n)}i.d(t,{AbstractMapContainer:()=>a,getDefault2:()=>n,getDefault2Lazy:()=>o,getDefault3:()=>l});class a{constructor(){this._map=new Map,this._size=0}size(){return this._size}clear(){this._map.clear(),this._size=0}}},407478:(e,t,i)=>{i.d(t,{CircularCacheBuffer:()=>n});var r=i(650151);function s(e){const{prevItem:t,nextItem:i}=e;null!==t&&(t.nextItem=i),null!==i&&(i.prevItem=t)}class n{constructor(e=0,t=1.3){this._cache=new Map,this._lastItem=null,this._firstItem=null,this._size=e,this._sizeLimited=e>0,this._capacityFactor=t}set(e,t){const i={key:e,value:t,prevItem:this._lastItem,nextItem:null};null!==this._lastItem&&(this._lastItem.nextItem=i);const r=this._cache.get(e);return void 0!==r&&(s(r),r===this._firstItem&&(this._firstItem=r.nextItem)),this._cache.set(e,i),this._lastItem=i,null===this._firstItem&&(this._firstItem=i),this._sizeLimited&&this._cache.size>this._size*this._capacityFactor&&this._removeExtraItems(),this}has(e){return this._cache.has(e)}get(e){var t;const i=this._cache.get(e);if(void 0===i)return i;if(i===this._firstItem&&(this._firstItem=null!==(t=i.nextItem)&&void 0!==t?t:i),i!==this._lastItem){s(i);const e=(0,r.ensureNotNull)(this._lastItem);e.nextItem=i,i.prevItem=e,i.nextItem=null,this._lastItem=i}return i.value}clear(){this._cache.clear(),this._firstItem=null,this._lastItem=null}delete(e){const t=this._cache.get(e);return void 0!==t&&(s(t),t===this._lastItem&&(this._lastItem=t.prevItem),t===this._firstItem&&(this._firstItem=t.nextItem)),this._cache.delete(e)}_removeExtraItems(){const e=this._cache.size-this._size;let t=(0,r.ensureNotNull)(this._firstItem);for(let i=0;i<e;i+=1)this._cache.delete(t.key),t=(0,r.ensureNotNull)(t.nextItem);t.prevItem=null,this._firstItem=t}}},809796:(e,t,i)=>{i.d(t,{TranslatedString:()=>r});class r{constructor(e,t){this._originalText=e,this._translatedText=t}originalText(){
return this._originalText}translatedText(){return this._translatedText}format(e){const t={},i={};for(const s of Object.keys(e)){const n=e[s];n instanceof r?(t[s]=n.originalText(),i[s]=n.translatedText()):(t[s]=n.toString(),i[s]=n.toString())}const s=this._originalText.format(t),n=this._translatedText.format(i);return new r(s,n)}}},938550:(e,t,i)=>{i.d(t,{WatchedObject:()=>o});var r=i(401580),s=i(389137);function n(e,t){return(0,s.deepEquals)(e,t)[0]}class o extends r.WatchedValue{constructor(e,t=n){super(e),this._comparator=t}setValue(e,t){!1===this._comparator(this.value(),e)&&super.setValue(e,t)}}},607509:(e,t,i)=>{var r;i.d(t,{ACTION_ID:()=>r}),function(e){e.TVActionId="TVActionId",e.ChartApplyIndicatorsToAllCharts="Chart.ApplyIndicatorsToAllCharts",e.ChartChangeTimeZone="Chart.ChangeTimeZone",e.ChartDialogsShowChangeInterval="Chart.Dialogs.ShowChangeInterval",e.ChartDialogsShowChangeSymbol="Chart.Dialogs.ShowChangeSymbol",e.ChartDialogsShowCompareOrAddSymbol="Chart.Dialogs.ShowCompareOrAddSymbol",e.ChartDialogsShowGeneralSettings="Chart.Dialogs.ShowGeneralSettings",e.ChartDialogsShowGeneralSettingsSymbolTab="Chart.Dialogs.ShowGeneralSettings.SymbolTab",e.ChartDialogsShowGeneralScalesTab="Chart.Dialogs.ShowGeneralSettings.SymbolTab",e.ChartDialogsShowGoToDate="Chart.Dialogs.ShowGoToDate",e.ChartDialogsShowInsertIndicators="Chart.Dialogs.ShowInsertIndicators",e.ChartDialogsShowSymbolInfo="Chart.Dialogs.ShowSymbolInfo",e.ChartDrawingToolbarToggleVisibility="Chart.DrawingToolbar.ToggleVisibility",e.ChartLinesToggleBidAskLinesVisibility="Chart.Lines.ToggleBidAskLinesVisibility",e.ChartLinesToggleHighLowLinesVisibility="Chart.Lines.ToggleHighLowLinesVisibility",e.ChartLinesToggleAverageLineVisibility="Chart.Lines.ToggleAverageLineVisibility",e.ChartLinesToggleSeriesPrevCloseLineVisibility="Chart.Lines.ToggleSeriesPrevCloseLineVisibility",e.ChartLinesToggleSeriesPriceLineVisibility="Chart.Lines.ToggleSeriesPriceLineVisibility",e.ChartLineToolPitchforkChangeTypeToInside="Chart.LineTool.Pitchfork.ChangeTypeToInside",e.ChartLineToolPitchforkChangeTypeToModifiedSchiff="Chart.LineTool.Pitchfork.ChangeTypeToModifiedSchiff",e.ChartLineToolPitchforkChangeTypeToOriginal="Chart.LineTool.Pitchfork.ChangeTypeToOriginal",e.ChartLineToolPitchforkChangeTypeToSchiff="Chart.LineTool.Pitchfork.ChangeTypeToSchiff",e.ChartMarksToggleVisibility="Chart.Marks.ToggleVisibility",e.ChartMoveChartInLayout="Chart.MoveChartInLayout",e.ChartMoveChartInLayoutBack="Chart.MoveChartInLayout.Back",e.ChartMoveChartInLayoutForward="Chart.MoveChartInLayout.Forward",e.ChartObjectTreeShow="Chart.ObjectTree.Show",e.ChartDataWindowShow="Chart.DataWindow.Show",e.ChartPriceScaleLabelsToggleBidAskLabelsVisibility="Chart.PriceScale.Labels.ToggleBidAskLabelsVisibility",e.ChartPriceScaleLabelsToggleHighLowPriceLabelsVisibility="Chart.PriceScale.Labels.ToggleHighLowPriceLabelsVisibility",e.ChartPriceScaleLabelsToggleAveragePriceLabelVisibility="Chart.PriceScale.Labels.ToggleAveragePriceLabelVisibility",
e.ChartPriceScaleLabelsToggleIndicatorsNameLabelsVisibility="Chart.PriceScale.Labels.ToggleIndicatorsNameLabelsVisibility",e.ChartPriceScaleLabelsToggleIndicatorsValueLabelsVisibility="Chart.PriceScale.Labels.ToggleIndicatorsValueLabelsVisibility",e.ChartPriceScaleLabelsToggleSeriesLastValueVisibility="Chart.PriceScale.Labels.ToggleSeriesLastValueVisibility",e.ChartPriceScaleLabelsToggleSymbolNameLabelsVisibility="Chart.PriceScale.Labels.ToggleSymbolNameLabelsVisibility",e.ChartPriceScaleLabelsToggleSymbolPrevCloseValueVisibility="Chart.PriceScale.Labels.ToggleSymbolPrevCloseValueVisibility",e.ChartPriceScaleMergeAllScalesToLeft="Chart.PriceScale.MergeAllScalesToLeft",e.ChartPriceScaleMergeAllScalesToRight="Chart.PriceScale.MergeAllScalesToRight",e.ChartPriceScaleMoveToLeft="Chart.PriceScale.MoveToLeft",e.ChartPriceScaleMoveToRight="Chart.PriceScale.MoveToRight",e.ChartPriceScaleToggleAddOrderPlusButtonVisibility="Chart.PriceScale.ToggleAddOrderPlusButtonVisibility",e.ChartPriceScaleToggleAutoScaleSeriesOnly="Chart.PriceScale.ToggleAutoScaleSeriesOnly",e.ChartPriceScaleToggleCountdownToBarCloseVisibility="Chart.PriceScale.ToggleCountdownToBarCloseVisibility",e.ChartRedo="Chart.Redo",e.ChartRemoveAllIndicators="Chart.RemoveAllIndicators",e.ChartRemoveAllIndicatorsAndLineTools="Chart.RemoveAllIndicatorsAndLineTools",e.ChartRemoveAllLineTools="Chart.RemoveAllLineTools",e.ChartScalesReset="Chart.Scales.Reset",e.ChartScalesToggleLockPriceToBarRatio="Chart.Scales.ToggleLockPriceToBarRatio",e.ChartSelectedObjectHide="Chart.SelectedObject.Hide",e.ChartSelectedObjectRemove="Chart.SelectedObject.Remove",e.ChartSelectedObjectShowSettingsDialog="Chart.SelectedObject.ShowSettingsDialog",e.ChartSelectedObjectToggleLocked="Chart.SelectedObject.ToggleLocked",e.ChartSeriesPriceScaleToggleAutoScale="Chart.Series.PriceScale.ToggleAutoScale",e.ChartSeriesPriceScaleToggleIndexedTo100="Chart.Series.PriceScale.ToggleIndexedTo100",e.ChartSeriesPriceScaleToggleInvertPriceScale="Chart.Series.PriceScale.ToggleInvertPriceScale",e.ChartSeriesPriceScaleToggleLogarithmic="Chart.Series.PriceScale.ToggleLogarithmic",e.ChartSeriesPriceScaleTogglePercentage="Chart.Series.PriceScale.TogglePercentage",e.ChartSeriesPriceScaleToggleRegular="Chart.Series.PriceScale.ToggleRegular",e.ChartSessionBreaksToggleVisibility="Chart.SessionBreaks.ToggleVisibility",e.ChartTimeScaleReset="Chart.TimeScale.Reset",e.ChartUndo="Chart.Undo",e.ChartSourceIntervalsVisibility="Chart.Source.IntervalsVisibility",e.ChartSourceIntervalsVisibilityCurrentAndAbove="Chart.Source.IntervalsVisibility.CurrentAndAbove",e.ChartSourceIntervalsVisibilityCurrentAndBelow="Chart.Source.IntervalsVisibility.CurrentAndBelow",e.ChartSourceIntervalsVisibilityOnlyCurrent="Chart.Source.IntervalsVisibility.Current",e.ChartSourceIntervalsVisibilityAll="Chart.Source.IntervalsVisibility.All"}(r||(r={}))},199471:(e,t,i)=>{i.d(t,{addExclusionArea:()=>C,addExclusionAreaByScope:()=>y,calcTextHorizontalShift:()=>v,clearRect:()=>u,createBoundCanvas:()=>f,createDisconnectedCanvas:()=>_,disableSelection:()=>m,
drawScaled:()=>p,fillRect:()=>d,getBindingPixelRatio:()=>a,getContext2D:()=>c,getPrescaledContext2D:()=>h,measureText:()=>w,tryApplySuggestedCanvasBitmapSize:()=>P});var r=i(327714),s=i(650151),n=i(109154),o=i(31341),l=i(638456);function a(e){return(0,n.getCanvasDevicePixelRatio)(e.canvasElement)}function c(e){const t=(0,s.ensureNotNull)(e.getContext("2d"));return t.setTransform(1,0,0,1,0,0),t}function h(e){const t=(0,s.ensureNotNull)(e.getContext("2d")),i=(0,n.getCanvasDevicePixelRatio)(e);return t.setTransform(i,0,0,i,0,0),t}function d(e,t,i,r,s,n){e.save(),e.translate(-.5,-.5),e.fillStyle=n,e.fillRect(t,i,r,s),e.restore()}function u(e,t,i,r,s,n){e.save(),e.translate(-.5,-.5),e.globalCompositeOperation="copy",e.fillStyle=n,e.fillRect(t,i,r,s),e.restore()}function p(e,t,i,r){e.save(),e.scale(t,i),r(),e.restore()}function _(e,t,i){const r=g(e);return void 0===i&&(i=(0,n.getCanvasDevicePixelRatio)(r)),r.width=t.width*i,r.height=t.height*i,r}function g(e){const t=e.createElement("canvas");return m(t),t}function f(e,t){const i=g((0,s.ensureNotNull)(e.ownerDocument));e.appendChild(i);const n=(0,r.bindCanvasElementBitmapSizeTo)(i,{type:"device-pixel-content-box",transform:(e,t)=>0===e.width||0===e.height?e:{width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)}});return n.resizeCanvasElement(t),n}function P(e){const t=e.suggestedBitmapSize;return null!==t&&t.width>0&&t.height>0&&(e.applySuggestedBitmapSize(),!0)}function v(e,t){return"center"===e.textAlign?0:(0,o.isRtl)()?"start"===e.textAlign||"right"===e.textAlign?t:0:"start"===e.textAlign||"left"===e.textAlign?0:t}function m(e){e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.msUserSelect="none",e.style.MozUserSelect="none",e.style.webkitTapHighlightColor="transparent"}function y(e,t){const{context:i,horizontalPixelRatio:r,verticalPixelRatio:s,bitmapSize:n}=e;i.beginPath(),i.rect(0,0,n.width,n.height);for(let e=0;e<t.length;e++){let{x:n,y:o}=t[e];n*=r,o*=s,0!==e?i.lineTo(n,o):i.moveTo(n,o)}i.closePath(),i.clip("evenodd")}function C(e,t,i){y({context:e,horizontalPixelRatio:t.pixelRatio,verticalPixelRatio:t.pixelRatio,bitmapSize:(0,r.size)({width:t.physicalWidth,height:t.physicalHeight}),mediaSize:(0,r.size)({width:t.cssWidth,height:t.cssHeight})},i)}let x;function w(e,t){return x||function(){const e=document.createElement("canvas");e.width=0,e.height=0,(0,l.isMac)()&&(e.style.display="none",document.body.append(e)),x=(0,s.ensureNotNull)(e.getContext("2d")),x.textBaseline="alphabetic",x.textAlign="center"}(),x.font=t,x.measureText(e)}},422333:(e,t,i)=>{i.r(t),i.d(t,{CHART_FONT_FAMILY:()=>l,CHART_MONOSPACE_FONT_FAMILY:()=>a,setChartFontFamily:()=>o});var r=i(314802);const s="'Trebuchet MS', Roboto, Ubuntu, sans-serif",n=`-apple-system, BlinkMacSystemFont, ${s}`;function o(e){l=e}let l=((0,r.isOnMobileAppPage)("old"),s);const a="monospace";{const e=["U+2E80-2FD5","U+3040-309F","U+1B100-1B12F","U+1AFF0-1AFFF","U+1B000-1B0FF","U+1B130-1B16F","U+3190-319F","U+30A0-30FF","U+31F0-31FF","U+3400-4DBF","U+4E00-9FFF","U+0E00-0E7F"],t=l;(async()=>{
if(!/iPhone OS 15_\d+?/.test(navigator.userAgent))return n;{if(["kr","zh_CN","zh_TW"].includes(window.locale))return l;const t=new FontFace("ChartIosFont","local(Helvetica), local(Arial)",{unicodeRange:e.join(", ")});try{return document.fonts.add(await t.load()),`ChartIosFont, ${n}`}catch(e){return l}}})().then((e=>{t===l&&o(e)}))}},543373:(e,t,i)=>{i.d(t,{showCustomUrlEventDialog:()=>l});var r=i(444372),s=i(779923);const n=r.t(null,void 0,i(468988)),o=r.t(null,void 0,i(620036));async function l(e){const{onConfirm:t,onClose:i,title:r,placeholderText:l}=e;return(0,s.showRename)({title:r,text:"",placeholder:l,mainButtonText:n,cancelButtonText:o,onRename:({newValue:e,dialogClose:i})=>{t(e),i()},onClose:i})}},109154:(e,t,i)=>{function r(e){var t,i;return Math.max(1,(null===(i=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i?void 0:i.devicePixelRatio)||1)}i.d(t,{getCanvasDevicePixelRatio:()=>r})},270294:(e,t,i)=>{i.d(t,{CHART_WIDGET_COLLECTION_SERVICE:()=>s,CollectionViewMode:()=>o,chartWidgetCollectionService:()=>n});var r=i(564894);const s={id:"ChartWidgetCollectionService"};function n(){return(0,r.hasService)(s)?(0,r.service)(s):null}var o;!function(e){e.Multichart="multichart",e.ForceFullscreen="force-fullscreen"}(o||(o={}))},86121:(e,t,i)=>{i.d(t,{lastMouseOrTouchEventInfo:()=>s,setLastMouseOrTouchEventInfo:()=>n});let r=(0,i(638456).supportTouch)()?{isTouch:!0,stylus:!1}:{isTouch:!1};function s(){return r}function n(e){r=e.isTouch?{isTouch:!0,stylus:e.stylus}:{isTouch:!1}}},522991:(e,t,i)=>{i.d(t,{PaneInvalidationMask:()=>s});var r=i(877009);class s{constructor(e=r.defaultInvalidationLevel){this._paneInvalidationLevel=r.defaultInvalidationLevel,this._leftPriceScalesInvalidationMap=new Map,this._rightPriceScalesInvalidationMap=new Map,this._legendWidgetInvalidated=!1,this._invalidationLevel=e}fullInvalidation(){return this._invalidationLevel}invalidateAll(e){this._invalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePane(e){this._paneInvalidationLevel=Math.max(this._invalidationLevel,e)}invalidateLegendWidgetLayout(){this._legendWidgetInvalidated=!0}invalidatePriceScale(e,t,i){const s="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap,n=s.get(t)||r.defaultInvalidationLevel;s.set(t,Math.max(n,i))}invalidationLevelForPane(){return Math.max(this._paneInvalidationLevel,this._invalidationLevel)}legendWidgetLayoutInvalidated(){return this._legendWidgetInvalidated||this._invalidationLevel===r.InvalidationLevel.Full}getterForPriceScaleInvalidationLevelBySide(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;return e=>Math.max(t.get(e)||r.defaultInvalidationLevel,this._invalidationLevel)}priceScaleSideMaxLevel(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;let i=this._invalidationLevel;return t.size>0&&t.forEach((e=>{e>i&&(i=e)})),i}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),
this._paneInvalidationLevel=Math.max(this._paneInvalidationLevel,e._paneInvalidationLevel),e._leftPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._leftPriceScalesInvalidationMap.get(t)||r.defaultInvalidationLevel;this._leftPriceScalesInvalidationMap.set(t,Math.max(i,e))})),e._rightPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._rightPriceScalesInvalidationMap.get(t)||r.defaultInvalidationLevel;this._rightPriceScalesInvalidationMap.set(t,Math.max(i,e))})),this._legendWidgetInvalidated=this._legendWidgetInvalidated||e._legendWidgetInvalidated}}},318041:(e,t,i)=>{i.d(t,{TextImageCachesContainer:()=>l});var r=i(650151),s=i(983898),n=i(511131),o=i(600642);class l extends s.AbstractMapContainer{constructor(e){super(),this._maxSize=e,this._keysQueue=[]}get(e){const{fontSize:t,text:i,align:r,font:l,lineSpacing:a=0}=e;if(!i||!t||!r)return null;const c=(0,n.makeFont)(t,l),h=(0,s.getDefault3)(this._map,a,r,c,new Map);let d=h.get(i);return void 0!==d||(this._size>=this._maxSize?this._deleteFirstKey():++this._size,this._keysQueue.push([c,r,a,i]),d=new o.TextImageCache(i,e.bold,e.italic,l,t,r,a),h.set(i,d)),d}_deleteFirstKey(){const e=this._keysQueue.shift(),[t,i,s,n]=e,o=(0,r.ensureDefined)(this._map.get(s)),l=(0,r.ensureDefined)(o.get(i)),a=(0,r.ensureDefined)(l.get(t));a.delete(n),0===a.size&&l.delete(t),0===l.size&&o.delete(i),0===o.size&&this._map.delete(s)}}},600642:(e,t,i)=>{i.d(t,{HorizontalAlign:()=>r,TextImageCache:()=>h,VerticalAlign:()=>s});var r,s,n=i(327714),o=i(650151),l=i(511131),a=i(199471);!function(e){e.Left="left",e.Right="right",e.Center="center"}(r||(r={})),function(e){e.Top="top",e.Bottom="bottom",e.Middle="middle"}(s||(s={}));const c=(0,a.createDisconnectedCanvas)(document,(0,n.size)({width:0,height:0}),1);class h{constructor(e,t,i,r,s,n="center",a=0){this._lines=e.split(/[^\S\r\n]*(?:\r\n|\r|\n)/),this._font=function(e,t,i,r){return(0,l.makeFont)(r,i,`${e?"bold ":""}${t?"italic ":""}`)}(t,i,r,s),this._fontSize=s,this._verticalPadding=~~(s/6),this._textAlign=n,this._lineSpacing=a;const h=(0,o.ensureNotNull)(c.getContext("2d"));h.font=this._font,h.textBaseline="top";let d=0;for(let e=0;e<this._lines.length;++e){const t=this._lines[e],i=h.measureText(t).width;d=Math.max(d,i)}this.textImageWidth=d+1,this.textImageHeight=this._lines.length*s+(this._lines.length-1)*this._lineSpacing+this._verticalPadding}paintTo(e,t,i){e.save();const r=t.pixelRatio,s=i.location;e.translate(Math.round(function(e,t,i){let r=e;switch(t){case"left":break;case"right":r-=i;break;case"center":r-=i/2}return Math.round(r)}(s.x,s.horzAlign,this.textImageWidth)*r),Math.round(function(e,t,i){let r=e;switch(t){case"top":break;case"bottom":r-=i;break;case"middle":r-=i/2}return Math.round(r)}(s.y,s.vertAlign,this.textImageHeight)*r));const n=i.style;let o;switch(e.textBaseline="top",e.font=this._font,e.lineJoin="round",e.fillStyle=n.fillStyle,n.strokeStyle&&(e.strokeStyle=n.strokeStyle),n.lineWidth&&(e.lineWidth=n.lineWidth),this._textAlign){case"left":o=0,e.textAlign="left";break;case"right":o=this.textImageWidth-1,
e.textAlign="right";break;default:o=this.textImageWidth/2,e.textAlign="center"}let l=this._verticalPadding;(0,a.drawScaled)(e,r,r,(()=>{for(const t of this._lines)n.strokeStyle&&e.strokeText(t,o,l),e.fillText(t,o,l),l+=this._fontSize,l+=this._lineSpacing})),e.restore()}}},593804:(e,t,i)=>{i.d(t,{alignToStep:()=>n});var r=i(960521),s=i.n(r);function n(e,t){return s()(e).div(t).round(0,s().roundHalfUp).mul(t).toNumber()}},586784:(e,t,i)=>{var r=i(511131).makeFont,s=i(511131).parseFont,n=i(201089).getLogger;const{drawPoly:o}=i(787123);var l=n("Model.ChartTradingUtils"),a={_fontHeightCache:{},_parsedColorCache:{},_parseColor:function(e){if(this._parsedColorCache[e])return this._parsedColorCache[e];var t=document.createElement("div");t.style.color=e;var i=t.style.color.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i)||t.style.color.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/i),r={r:i[1],g:i[2],b:i[3],a:i[4]||"1"};return this._parsedColorCache[e]=r,r},getColorFromProperties:function(e,t){var i=1-t.value()/100,r=this._parseColor(e.value());return"rgba("+r.r+","+r.g+","+r.b+","+i+")"},setColorToProperties:function(e,t,i){var r=this._parseColor(e);t.setValue("rgb("+r.r+","+r.g+","+r.b+")");var s=100*(1-r.a);i.setValue(Math.max(0,Math.min(s,100)))},getFontFromProperties:function(e,t,i,s){return r(t.value(),e.value(),s.value()?"italic":"",i.value()?"bold":"")},setFontToProperties:function(e,t,i,r,n){var o=s(e);null!==o?(o.family.length>0&&t.setValue(o.family),i.setValue(o.size),r.setValue(o.bold),n.setValue(o.italic)):l.logError("Invalid font: "+e)},fontHeight:function(e){if(!this._fontHeightCache[e]){var t=document.createElement("span");t.appendChild(document.createTextNode("height")),document.body.appendChild(t),t.style.cssText="font: "+e+"; white-space: nowrap; display: inline;";var i=t.offsetHeight;document.body.removeChild(t),this._fontHeightCache[e]=Math.ceil(i)}return this._fontHeightCache[e]},drawPolyHoverOrPress:function(e,t,i,r){r?(e.save(),e.fillStyle="rgba(0, 0, 0, 0.15)",o(e,t,!0),e.restore()):i&&(e.save(),e.fillStyle="rgba(0, 0, 0, 0.1)",o(e,t,!0),e.restore())},repaint:function(e){e.lightUpdate()},roundToMinTick:function(e,t){var i=1/e.mainSource().base();return i*Math.round(t/i)}};e.exports=a},261066:(e,t,i)=>{i.d(t,{currencyUnitVisibilityOptions:()=>l,currencyUnitVisibilityProperty:()=>o,migrateShowCurrencyAndShowUnitProperties:()=>h,restoreCurrencyUnitVisibilitySettingsValue:()=>a});var r=i(87053),s=i(62802),n=i.n(s);const{property:o,availableValues:l,restoreDefaultValue:a}=(0,r.createVisibilityController)("PriceAxisCurrencyAndUnit.visibility");let c=!1;function h(e,t){c||(c=!0,void 0===n().getValue("PriceAxisCurrencyAndUnit.visibility")&&o().setValue(e||t?"alwaysOn":"alwaysOff"))}},996986:(e,t,i)=>{i.d(t,{DataSource:()=>c,getTranslatedStringForSource:()=>a});var r=i(244842),s=i(809796),n=i(401580),o=i(541558),l=i(707957);function a(e,t){return new s.TranslatedString(t.name(),t.title(e))}class c{constructor(e){this.hasAlert=new n.WatchedValue(!1),this._zorder=0,
this._priceScale=null,this._ownerSource=null,this._userEditEnabled=!0,this._priceScaleChanged=new l.Delegate,this._isSelectionEnabled=!0,this._instanceId=(0,o.randomHashN)(6),this._ownerSourceChanged=new l.Delegate,this._zOrderChanged=new l.Delegate,this._id=null!=e?e:(0,o.randomHashN)(6)}id(){return this._id}instanceId(){return this._instanceId}preferNoScale(){return!1}setId(e){this._id=e}zorder(){return this._zorder}setZorder(e){"number"==typeof e&&this._zorder!==e&&(this._zorder=e,this._zOrderChanged.fire(e))}preferredZOrder(){return null}isSpeciallyZOrderedSource(){return!1}title(e){return this.name()}priceScale(){return this._priceScale}setPriceScale(e){this._priceScale=e,this._priceScaleChanged.fire(e)}priceScaleChanged(){return this._priceScaleChanged}ownerSource(){return this._ownerSource}setOwnerSource(e){const t=this._ownerSource;this._ownerSource=e,this._ownerSourceChanged.fire(t,e)}ownerSourceChanged(){return this._ownerSourceChanged}zOrderChanged(){return this._zOrderChanged}isSavedInChart(e){return!0}isSavedInStudyTemplates(){return!0}isRemovedByStudyTemplates(){return!0}hasContextMenu(){return!0}showInObjectTree(){return!0}setUserEditEnabled(e){this._userEditEnabled=e}userEditEnabled(){return this._userEditEnabled}canBeHidden(){return this.userEditEnabled()}isUserDeletable(){return this.userEditEnabled()}properties(){return null}isVisible(){return this.properties().visible.value()}dataWindowView(){return null}priceAxisViews(e,t){return null}timeAxisViews(){return null}updateAllViews(e){}paneViews(e){return null}labelPaneViews(){return null}isFailed(){return!1}isLoading(){return!1}isPhantom(){return!1}isChildStudy(){return!1}hasChildren(){return!1}canHaveChildren(){return!1}onClickOutside(e){}getSourceIcon(){return null}state(e){return null}doesMovingAffectsUndo(){return!0}isMultiPaneAvailable(){return!1}isMultiPaneEnabled(){return!1}copiable(){return!1}cloneable(){return!1}movable(){return!1}isIncludedInAutoScale(){return!1}isHoveredEnabled(){return this.isSelectionEnabled()}showOnTopOnHovering(){return!0}isSelectionEnabled(){return this._isSelectionEnabled}setSelectionEnabled(e){this._isSelectionEnabled=e}firstValue(){return null}priceRange(e,t){return null}autoScaleInfo(e,t){return{range:this.priceRange(e,t)}}stateForAlert(){return null}canHasAlert(){return!1}alertCreationAvailable(){return new n.WatchedValue(this.hasStateForAlert()).readonly()}hasStateForAlert(){return r.enabled("alerts")}idForAlert(){return this._id}}},782086:(e,t,i)=>{i.d(t,{DataWindowItem:()=>r,DataWindowView:()=>s});class r{constructor(e,t,i,r=!1){this._visible=!0,this._id=e,this._title=t,this._value=i,this._unimportant=r}id(){return this._id}title(){return this._title}setTitle(e){this._title=e}text(){return this._value}value(){return this._value}setValue(e){this._value=e}visible(){return this._visible}setVisible(e){this._visible=e}color(){return this._color}setColor(e){this._color=e}unimportant(){return this._unimportant}}class s{constructor(){this._items=[],this._header="",this._title=""}header(){return this._header}title(){
return this._title}items(){return this._items}update(){}}},327453:(e,t,i)=>{i.d(t,{LimitedPrecisionNumericFormatter:()=>s});var r=i(389137);class s{constructor(e=1){this._precision=e}format(e){(0,r.isNumber)(e)||(e=parseFloat(e));const t=e.toFixed(this._precision),i=Math.pow(10,-this._precision);return Math.max(parseFloat(t),i)+""}parse(e){const t=parseFloat(e);return isNaN(t)?{res:!1}:{res:!0,value:t,suggest:this.format(t)}}}},315801:(e,t,i)=>{function r(e,t,i){if(e.isTouch){if(void 0!==i)return i(e),!0}else if(void 0!==t)return t(e),!0;return!1}function s(e,t,i,r){return void 0!==t.executeDefaultAction&&(e.isTouch?Boolean(t.executeDefaultAction[r]):Boolean(t.executeDefaultAction[i]))}var n,o;i.d(t,{AreaName:()=>n,HitTarget:()=>o,HitTestResult:()=>l,shouldDefaultActionBeExecuted:()=>s,tryCallHandler:()=>r}),function(e){e.Style="Style",e.Text="Text",e.Line="Line",e.Tooltip="Tooltip",e.Button="Button",e.SourceItemMove="SourceItemMove"}(n||(n={})),function(e){e[e.MovePointBackground=1]="MovePointBackground",e[e.Regular=2]="Regular",e[e.MovePoint=3]="MovePoint",e[e.ChangePoint=4]="ChangePoint",e[e.Custom=5]="Custom"}(o||(o={}));class l{constructor(e,t,i){this._target=e,this._data=t||null,this._eraseMarker=i}target(){return this._target}data(){return this._data}hasPressedMoveHandler(e){return null!==this._data&&function(e,t,i){if(e.isTouch){if(void 0!==i)return!0}else if(void 0!==t)return!0;return!1}(e,this._data.pressedMouseMoveHandler,this._data.touchMoveHandler)}tryCallMouseDownOrTouchStartHandler(e){return null!==this._data&&r(e,this._data.mouseDownHandler,this._data.touchStartHandler)}tryCallMouseUpOrTouchEndHandler(e){return null!==this._data&&r(e,this._data.mouseUpHandler,this._data.touchEndHandler)}tryCallMouseEnterHandler(e){return null!==this._data&&r(e,this._data.mouseEnterHandler)}tryCallMouseLeaveHandler(e){return null!==this._data&&r(e,this._data.mouseLeaveHandler)}tryCallMouseMoveHandler(e){return null!==this._data&&r(e,this._data.mouseMoveHandler)}tryCallClickOrTapHandler(e){return null!==this._data&&r(e,this._data.clickHandler,this._data.tapHandler)}tryCallDblClickOrDblTapHandler(e){return null!==this._data&&r(e,this._data.doubleClickHandler,this._data.doubleTapHandler)}tryCallContextMenuHandler(e){return null!==this._data&&r(e,this._data.contextMenuHandler,this._data.touchContextMenuHandler)}eraseMarker(){return this._eraseMarker}}},955831:(e,t,i)=>{i.d(t,{HorizontalLinePaneView:()=>n});var r=i(9524),s=i(458963);class n{constructor(){this._lineRendererData={y:0,color:"rgba(0, 0, 0, 0)",linewidth:1,linestyle:s.LINESTYLE_SOLID,visible:!1},this._lineRenderer=new r.HorizontalLineRenderer,this._invalidated=!0,this._lineRenderer.setData(this._lineRendererData)}update(e){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._lineRenderer}}},808068:(e,t,i)=>{i.d(t,{intervalsVisibilitiesDefaults:()=>r});const r={ticks:!0,seconds:!0,secondsFrom:1,secondsTo:59,minutes:!0,minutesFrom:1,minutesTo:59,hours:!0,hoursFrom:1,hoursTo:24,days:!0,daysFrom:1,daysTo:366,
weeks:!0,weeksFrom:1,weeksTo:52,months:!0,monthsFrom:1,monthsTo:12,ranges:!0}},312449:(e,t,i)=>{i.d(t,{IntervalsVisibilitiesProperty:()=>o});var r=i(354950),s=i.n(r),n=i(395098);class o extends(s()){state(e){var t;return null!==(t=(0,n.nonDefaultIntervalsVisibilities)(super.state(e)))&&void 0!==t?t:void 0}storeStateIfUndefined(){return!1}}},981107:(e,t,i)=>{function r(e){const t=(null==e?void 0:e.symbolSource)&&e.symbolSource()===e,i=void 0!==(null==e?void 0:e.isActingAsSymbolSource);return t||i}function s(e){return r(e)&&"quotesProvider"in e}function n(e){return r(e)&&e.isActingAsSymbolSource().value()}i.d(t,{isActingAsSymbolSource:()=>n,isSymbolSource:()=>r,isSymbolSourceWithQuotesProvider:()=>s})},517336:(e,t,i)=>{i.d(t,{LevelsProperty:()=>p});var r=i(389137),s=i(853965),n=i(42292);const o={prefixes:[""],range:[0,0],names:["coeff","color","visible","linestyle","linewidth"],typecheck:{pack:()=>Object(),unpack:()=>[]}};function l(e,t,i,r){return r.push(i[t]),r}function a(e,t,i,r){return r[t]=i[e],r}function c(){return[]}function h(){return{}}function d(e,t,i){return i.prefixes.forEach((s=>{const n=s+"level";for(let s=i.range[0];s<=i.range[1];s++)if(e[n+s]&&(0,r.isSameType)(e[n+s],t.typecheck())){let r=t.tpl();i.names.forEach(((i,o)=>{r=t.fill(""+o,i,e[n+s],r)})),e[n+s]=r}})),e}function u(e,t,i){return i(e,{tpl:h,fill:a,typecheck:t.typecheck.unpack},t)}class p extends s.DefaultProperty{constructor(e,t,i,r,s){s=null!=s?s:d;const n={...o,...null!=r?r:{}};super(e,t?u(t,n,s):t,i),this._map=n,this._levelsIterator=s}state(e,t){const i=super.state(e);return t?i:(r=i,s=this._map,(0,this._levelsIterator)(r,{tpl:c,fill:l,typecheck:s.typecheck.pack},s));var r,s}saveDefaults(){this._useUserPreferences&&(0,n.saveDefaults)(this._defaultName,this.state(this._exclusions,!0))}clone(){const e=this.state(),t=new p(this._defaultName,e);for(let e=0;e<this._exclusions.length;++e)t.addExclusion(this._exclusions[e]);return t}merge(e,t){return super.merge(u(e,this._map,this._levelsIterator),t)}}},147985:(e,t,i)=>{i.d(t,{LineTool5PointsPattern:()=>l});var r=i(650151),s=i(853965),n=i(821979),o=i(31712);class l extends n.LineDataSource{constructor(e,t,i,r){super(e,t||l.createProperties(),i,r),this._loadPaneViews(e)}pointsCount(){return 5}name(){return"XABCD Pattern"}static createProperties(e){const t=new s.DefaultProperty("linetool5pointspattern",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,63124)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}_loadPaneViews(e){Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,382242)).then((t=>{this._setPaneViews([new t.Pattern5pointsPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}},78:(e,t,i)=>{i.d(t,{LineToolABCD:()=>l})
;var r=i(650151),s=i(853965),n=i(821979),o=i(31712);class l extends n.LineDataSource{constructor(e,t,r,s){const n=t||l.createProperties();super(e,n,r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,662657)).then((t=>{this._setPaneViews([new t.ABCDPaneView(this,e)])}))}pointsCount(){return 4}name(){return"ABCD Pattern"}static createProperties(e){const t=new s.DefaultProperty("linetoolabcd",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,669403)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new o.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}},907416:(e,t,i)=>{i.d(t,{LineToolArc:()=>h});var r=i(650151),s=i(204652),n=i(86441),o=i(625422),l=i(853965),a=i(821979),c=i(31712);class h extends a.LineDataSource{constructor(e,t,r,s){const n=t||h.createProperties();super(e,n,r,s),this.version=2,this._dist=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,953940)).then((({ArcPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,s.distanceToLine)(e,t,i).distance;const o=t.subtract(e),l=new n.Point(-o.y,o.x),a=e.add(t).scaled(.5);i.subtract(a).dotProduct(l)<0&&(this._dist=-this._dist)}}endChanging(e,t){return this._dist=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Arc"}hasEditableCoordinates(){return!1}setPoint(e,t){const i={...t},l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));switch(e){case 0:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),s=a.subtract(t),o=t.add(a).scaled(.5);let l=new n.Point(-s.y,s.x);l=l.normalized();const c=o.add(l.scaled(e));this._points[0]=i,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(c));break}case 1:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),s=t.subtract(l),o=l.add(t).scaled(.5),a=new n.Point(-s.y,s.x).normalized(),c=o.add(a.scaled(e));this._points[1]=i,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(c));break}case 2:{let e=(0,r.ensureNotNull)(this.pointToScreenPoint(i));const t=(0,s.distanceToLine)(l,a,e).distance,c=a.subtract(l),h=l.add(a).scaled(.5),d=new n.Point(-c.y,c.x).normalized(),u=h.add(d.scaled(t)),p=h.add(d.scaled(-t)),_=c.length(),g=c.x/_,f=c.y/_;let P=Math.acos(g);f<0&&(P=-P);let v=(0,o.translationMatrix)(-h.x,-h.y);e=(0,o.transformPoint)(v,e);let m=(0,o.transformPoint)(v,u);v=(0,o.rotationMatrix)(-P),e=(0,o.transformPoint)(v,e),m=(0,
o.transformPoint)(v,m),v=(0,o.scalingMatrix)(1,_/(2*t)),e=(0,o.transformPoint)(v,e),m=(0,o.transformPoint)(v,m);const y=e.y*m.y>=0?new n.Point(u.x,u.y):new n.Point(p.x,p.y);this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(y));break}}this.normalizePoints()}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=(2*this._points[0].price+3*this._points[1].price)/5;this._points.push({price:e,index:this._points[1].index})}if(1===e&&2===this._timePoint.length){const e={price:(2*this._timePoint[0].price+3*this._timePoint[1].price)/5,offset:this._timePoint[1].offset,time_t:this._timePoint[1].time_t};this._timePoint.push(e)}}static createProperties(e){const t=new l.DefaultProperty("linetoolarc",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,967382))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new c.LineToolColorsProperty([e.childs().color]))}}},41394:(e,t,i)=>{i.d(t,{LineToolArrowMark:()=>a,LineToolArrowMarkDown:()=>u,LineToolArrowMarkLeft:()=>c,LineToolArrowMarkRight:()=>d,LineToolArrowMarkUp:()=>h});var r=i(853965),s=i(821979),n=i(354950),o=i.n(n),l=i(31712);class a extends s.LineDataSource{constructor(e,t,r,s,n){const o=t||a.createProperties(null,r);super(e,o,s,n),this._textPaneView=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,129022)).then((({ArrowMarkPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}paneViews(e){const t=super.paneViews();return null!==t&&this._textPaneView&&t.push(this._textPaneView),t}pointsCount(){return 1}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t){const i=new r.DefaultProperty(t,e);return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,952842)).then((e=>e.ArrowMarkDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().arrowColor])),e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().color])),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text")}}a.version=2;class c extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkleft",i,r)}direction(){return"left"}name(){return"Arrow Mark Left"}textAlignParams(){return{horzAlign:"left",vertAlign:"middle",offsetX:22,offsetY:3}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkleft")}}class h extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkup",i,r)}direction(){return"up"}name(){return"Arrow Mark Up"}textAlignParams(){return{horzAlign:"center",vertAlign:"top",offsetX:0,offsetY:20}}static createProperties(e){
return super.createProperties(e,"linetoolarrowmarkup")}}class d extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkright",i,r)}direction(){return"right"}name(){return"Arrow Mark Right"}textAlignParams(){return{horzAlign:"right",vertAlign:"middle",offsetX:22,offsetY:3,forceTextAlign:!0}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkright")}}class u extends a{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkdown",i,r)}direction(){return"down"}name(){return"Arrow Mark Down"}textAlignParams(){return{horzAlign:"center",vertAlign:"bottom",offsetX:0,offsetY:20}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkdown")}}},683396:(e,t,i)=>{i.d(t,{LineToolArrowMarker:()=>l});var r=i(821979),s=i(853965),n=i(354950),o=i.n(n);class l extends r.LineDataSource{constructor(e,t,r,s){super(e,null!=t?t:l.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,922514)).then((({ArrowMarkerPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}))}pointsCount(){return 2}name(){return"Trend Line"}static createProperties(e){const t=new s.DefaultProperty("linetoolarrowmarker",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,470719)).then((e=>e.ArrowMarkerDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text")}}},548160:(e,t,i)=>{i.d(t,{LineToolArrow:()=>s});var r=i(956268);class s extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,null!=t?t:s.createProperties(),i,r)}name(){return"Arrow"}static createProperties(e){const t=r.LineToolTrendLine.createProperties(e,"linetoolarrow");return s._configureProperties(t),t}}},179180:(e,t,i)=>{i.d(t,{LineToolBalloon:()=>h});var r=i(444372),s=i(853965),n=i(821979),o=i(354950),l=i.n(o),a=i(31712);const c=r.t(null,void 0,i(119372));class h extends n.LineDataSource{constructor(e,t,i,r){super(e,t||h.createProperties(),i,r),this._createPaneView()}pointsCount(){return 1}name(){return"Balloon"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}static createProperties(e){const t=new s.DefaultProperty("linetoolballoon",e);return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,417540)).then((e=>e.BalloonDefinitionsViewModel))}_createPaneView(){Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,35986)).then((e=>{this._setPaneViews([new e.BalloonPaneView(this,this._model)])}))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())(c)),e.addExclusion("text"),
e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}}},180148:(e,t,i)=>{i.d(t,{LineToolBarsPattern:()=>m});var r=i(650151),s=i(444372),n=i(809796),o=i(389137),l=i(373571),a=i(853965),c=i(534741),h=i(821979),d=i(540598),u=i(964824);const p=new n.TranslatedString("mirror bars pattern",s.t(null,void 0,i(881870))),_=new n.TranslatedString("flip bars pattern",s.t(null,void 0,i(559942))),g=s.t(null,void 0,i(363158)),f=s.t(null,void 0,i(892754)),P={0:2,1:4,2:1,3:1,4:2,5:3,6:-1},v={0:3,1:4,2:4,3:1,4:2,5:3,6:-1};class m extends h.LineDataSource{constructor(e,t=m.createProperties(),r,s){super(e,t,r,s),this._pattern=[],this._scale=1,this._pointsCoordinatePricesDiff=null;const n=t.childs().mode.value();(0,o.isString)(n)&&t.childs().mode.setValue(parseInt(n)),t.childs().mirrored.listeners().subscribe(this,this._mirror),t.childs().flipped.listeners().subscribe(this,this._flip),t.childs().mode.subscribe(this,this._updateLastPoint),this.version=2,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,416645)).then((t=>{this._setPaneViews([new t.BarsPatternPaneView(this,e)])}))}pattern(){return this._pattern}isSynchronizable(){return!1}additionalActions(e){return[new l.Action({actionId:"Chart.LineTool.BarsPattern.ToggleMirrored",checked:this.properties().childs().mirrored.value(),checkable:!0,label:g,onExecute:()=>{e.setProperty(this.properties().childs().mirrored,!this.properties().childs().mirrored.value(),p),this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}),new l.Action({actionId:"Chart.LineTool.BarsPattern.ToggleFlipped",checked:this.properties().childs().flipped.value(),checkable:!0,label:f,onExecute:()=>{e.setProperty(this.properties().childs().flipped,!this.properties().childs().flipped.value(),_),this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}})]}pointsCount(){return 2}state(e){return{...super.state(e),pattern:this._pattern,scale:this._scale,diff:this._pointsCoordinatePricesDiff}}restoreData(e){const{pattern:t=this._pattern,scale:i=this._scale,diff:r=this._pointsCoordinatePricesDiff}=e;this._pattern=t,this._scale=i,this._pointsCoordinatePricesDiff=r}name(){return"Bars Pattern"}hasEditableCoordinates(){return!1}cloneData(e){this._pattern=(0,o.clone)(e._pattern),this._scale=e._scale,this._pointsCoordinatePricesDiff=e._pointsCoordinatePricesDiff}firstPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[0];return e.value()===d.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[v[e.value()]]:i[P[e.value()]]}lastPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[this._pattern.length-1];return e.value()===d.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[P[e.value()]]:i[v[e.value()]]}addPoint(e,t,i){const s=super.addPoint(e,t,!0);if(s){const e=this._model.mainSeries(),[{index:t},{index:i}]=this.points(),s=(0,
r.ensureDefined)(e.nearestIndex(Math.min(t,i),c.PlotRowSearchMode.NearestRight)),n=(0,r.ensureDefined)(e.nearestIndex(Math.max(t,i),c.PlotRowSearchMode.NearestLeft));this._pattern=this._createPattern(s,n),this._pattern.length>0&&(t>i&&this._points.reverse(),this._points[1].price=this._points[0].price+this._patternPriceDiff(),this._points[1].index=this._points[0].index+(n-s),this.normalizePoints(),this.createServerPoints()),this._updatePointsCoordinatePricesDiff()}return s}setPoint(e,t,i,r){1===e&&t.index<=this._points[0].index&&(t.index=this._points[0].index+1),0===e&&t.index>=this._points[1].index&&(t.index=this._points[1].index-1),super.setPoint(e,t,i),this._updatePointsCoordinatePricesDiff()}move(e,t,i,r){super.move(e,t,i,r),this._updatePointsCoordinatePricesDiff()}migrateVersion(e,t,i){if(1===e&&this._pattern.length>0){const e=this._patternPriceDiff();2===this._timePoint.length&&(this._timePoint[1].price=this._timePoint[0].price+e),2===this._points.length&&(this._points[1].price=this._points[0].price+e)}}getScale(){return this._scale=this._calculateScale()}static createProperties(e){const t=new a.DefaultProperty("linetoolbarspattern",e);return this._configureProperties(t),t}_preparePoint(e,t){var i;const s=this._alignPointToRangeOfActualData(e),n=this._model.mainSeries(),o=(0,r.ensureNotNull)(n.bars().valueAt(s.index));this.properties().childs().mode.value()===d.LineToolBarsPatternMode.Bars?s.price=(0,r.ensure)(o[2]):s.price=(0,r.ensure)(o[4]);const l=(0,r.ensureNotNull)(this.priceScale()),a=(0,r.ensure)(null===(i=this.ownerSource())||void 0===i?void 0:i.firstValue()),c=.05*l.height(),h=l.priceToCoordinate(s.price,a)-c;return s.price=l.coordinateToPrice(h,a),super._preparePoint(s,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,154403))).BarsPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addExclusion("mirrored"),e.addExclusion("flipped")}_calculatePatternCoordinatePricesDiff(){var e;return this._pattern.length>0&&null!==(e=this._priceCoordinateDiff([this.firstPatternPrice(),this.lastPatternPrice()]))&&void 0!==e?e:null}_updatePointsCoordinatePricesDiff(){this._pointsCoordinatePricesDiff=this._calculatePointsCoordinatePricesDiff()}_calculatePointsCoordinatePricesDiff(){var e;if(2===this._points.length){const[{price:t},{price:i}]=this.points();return null!==(e=this._priceCoordinateDiff([t,i]))&&void 0!==e?e:null}return null}_createPattern(e,t){const i=this._model.mainSeries().data(),s=[];for(let n=e;n<=t;n++)s.push((0,o.clone)((0,r.ensureNotNull)(i.valueAt(n))));return s}_switchPointsPrice(){const e=this._points[0].price;this._timePoint[0].price=this._points[0].price=this._points[1].price,this._timePoint[1].price=this._points[1].price=e}_mirror(){const e=this._pattern;let t=Math.min(e[0][3],e[0][2]),i=Math.max(e[0][3],e[0][2]);for(let r=1;r<e.length;r++)t=Math.min(t,e[r][3]),i=Math.max(i,e[r][2]);if(t<i){const r=(t+i)/2,s=e=>r-(e-r)
;for(let t=0;t<e.length;t++)e[t][2]=s(e[t][2]),e[t][3]=s(e[t][3]),e[t][1]=s(e[t][1]),e[t][4]=s(e[t][4])}this._switchPointsPrice(),this.updateAllViews((0,u.sourceChangeEvent)(this.id()))}_flip(){const e=this._pattern,t=e.length;for(let i=0;i<t/2;i++){const r=e[i];e[i]=e[t-i-1],e[t-i-1]=r}this._switchPointsPrice(),this.updateAllViews((0,u.sourceChangeEvent)(this.id()))}_patternPriceDiff(){return this.lastPatternPrice()-this.firstPatternPrice()}_pricesToCoordinates(e){var t,i;const r=this.priceScale(),s=null!==(i=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue())&&void 0!==i?i:null;if(null!==s&&null!==r&&!r.isEmpty())return e.map((e=>r.priceToCoordinate(e,s)))}_priceCoordinateDiff(e){const t=this._pricesToCoordinates(e);if(t)return t[1]-t[0]}_calculateScale(){let e=1;if(2===this._points.length){const t=this._calculatePatternCoordinatePricesDiff();if(!t)return e;const i=this._calculatePointsCoordinatePricesDiff();if(t&&null!==i&&(e=+(i/t).toFixed(8)),this._pointsCoordinatePricesDiff!==i){if(this._scale!==e)return this._updateLastPoint(),this._scale;this._updatePointsCoordinatePricesDiff()}}return e}_updateLastPoint(){var e,t;if(this._points.length<2)return;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===r||null===i||i.isEmpty())return;const s=this._calculatePatternCoordinatePricesDiff(),n=this._pricesToCoordinates([this.points()[0].price]);null!==s&&n&&(this._timePoint[1].price=this._points[1].price=i.coordinateToPrice(+(this._scale*s).toFixed(8)+n[0],r),this._updatePointsCoordinatePricesDiff())}}},511628:(e,t,i)=>{i.d(t,{LineToolBezierCubic:()=>o});var r=i(650151),s=i(853965),n=i(821979);class o extends n.LineDataSource{constructor(e,t,r,s){const n=t||o.createProperties();super(e,n,r,s),this._controlPoints=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,98321)).then((t=>{this._setPaneViews([new t.BezierCubicPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Double Curve"}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoints=this._calculateControlPoints(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoints();this._controlPoints=null,this._points.push(e[0]),this._points.push(e[1]),i||(this.normalizePoints(),this.createServerPoints()),this._createPointProperty(2),this._createPointProperty(3)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2),this._createPointProperty(3)}controlPoints(){return this._controlPoints}static createProperties(e){const t=new s.DefaultProperty("linetoolbeziercubic",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,383716)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoints(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,
r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),s=e.add(t).scaled(.33),n=e.add(t).scaled(.67),o=s.add(i),l=n.subtract(i);return[(0,r.ensureNotNull)(this.screenPointToPoint(o)),(0,r.ensureNotNull)(this.screenPointToPoint(l))]}}},516487:(e,t,i)=>{i.d(t,{LineToolBezierQuadro:()=>o});var r=i(650151),s=i(853965),n=i(821979);class o extends n.LineDataSource{constructor(e,t,r,s){const n=t||o.createProperties();super(e,n,r,s),this._controlPoint=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,545357)).then((t=>{this._setPaneViews([new t.BezierQuadroPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Curve"}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoint=this._calculateControlPoint(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoint();this._points.push(e),this._controlPoint=null,i||(this.normalizePoints(),this.createServerPoints()),this._createPointProperty(2)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2)}controlPoint(){return this._controlPoint}static createProperties(e){const t=new s.DefaultProperty("linetoolbezierquadro",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,383716)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoint(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),s=e.add(t).scaled(.5).add(i);return(0,r.ensureNotNull)(this.screenPointToPoint(s))}}},168504:(e,t,i)=>{i.d(t,{LineToolBrushBase:()=>n});var r=i(650151),s=i(821979);class n extends s.LineDataSource{constructor(){super(...arguments),this._finished=!1}pointsCount(){return-1}finished(){return this._finished}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}hasEditableCoordinates(){return!1}addPoint(e,t,i){if(this._finished)return!0;if(this._lastPoint=null,this._points.length>0){const t=this._points[this._points.length-1],i=(0,r.ensureNotNull)(this.pointToScreenPoint(t));if((0,r.ensureNotNull)(this.pointToScreenPoint(e)).subtract(i).length()<2)return this._finished}return super.addPoint(e),this._finished}restorePoints(e,t,i){super.restorePoints(e,t,i),this._finished=!0}}},271133:(e,t,i)=>{i.d(t,{LineToolBrush:()=>o});var r=i(853965),s=i(168504),n=i(31712);class o extends s.LineToolBrushBase{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Brush"}hasEditableCoordinates(){return!1}static createProperties(e){const t=new r.DefaultProperty("linetoolbrush",e);return this._configureProperties(t),t}_loadPaneViews(e){Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,411733)).then((t=>{this._setPaneViews([new t.BrushPaneView(this,e)])}))}
_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,351109)).then((e=>e.BrushDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new n.LineToolColorsProperty([e.childs().backgroundColor],e.childs().fillBackground))}}},844295:(e,t,i)=>{i.d(t,{LineToolCallout:()=>c});var r=i(444372),s=i(354950),n=i.n(s),o=i(853965),l=i(31712),a=i(821979);class c extends a.LineDataSource{constructor(e,t,r,s){super(e,t||c.createProperties(),r,s),this._barOffset=0,this._dragStartLeftEdgeIndex=NaN,this._timeScale=e.timeScale(),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,279537)).then((e=>{this._setPaneViews([new e.CalloutPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Callout"}getBarOffset(){return this._barOffset}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}addPoint(e){const t=super.addPoint(e);return t&&this._calculateBarOffset(),t}setLastPoint(e){const t=super.setLastPoint(e);return 2===this.points().length&&this._calculateBarOffset(),t}setPoint(e,t){switch(e){case 0:super.setPoint(e,t),this._calculateBarOffset();break;case 1:const i=this.properties().childs();if(!i.wordWrapWidth)return;const r=this._points,s=this._dragStartLeftEdgeIndex,n=Math.round((t.index-s)/2);if(isFinite(s)&&isFinite(n)){r[1]={index:s+n,price:r[1].price},this._calculateBarOffset(),this.normalizePoints();const e=this._timeScale.indexToCoordinate(s+2*n)-this._timeScale.indexToCoordinate(s)-8-2;if(!isFinite(e))return;i.wordWrapWidth.setValue(Math.max(100,e));break}r[1]=t,this._calculateBarOffset(),this.normalizePoints()}}setPoints(e){super.setPoints(e);const t=this.properties().childs();if(!t.wordWrapWidth)return;const i=this._dragStartLeftEdgeIndex,r=Math.round((e[1].index-i)/2);if(this._calculateBarOffset(),this.normalizePoints(),isFinite(i)&&isFinite(r)){const e=this._timeScale.indexToCoordinate(i+2*r)-this._timeScale.indexToCoordinate(i)-8-2;if(!isFinite(e))return;t.wordWrapWidth.setValue(Math.max(100,e))}}move(e,t,i){super.move(e,t,i),this._calculateBarOffset()}state(e){const t=super.state(e);return t.barOffset=this._barOffset,t}restoreData(e){e.barOffset?this._barOffset=e.barOffset:this._calculateBarOffset(),this.calculatePoint2()}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&this.calculatePoint2()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}calculatePoint2(){if(this._model.lineBeingEdited()===this||this._model.sourcesBeingMoved().includes(this))return;if(this._points.length<2)return;const[e,t]=this.points();this._points[1]={price:t.price,index:e.index+this._barOffset}}static createProperties(e){const t=new o.DefaultProperty("linetoolcallout",e);return this._configureProperties(t),t}_applyTemplateImpl(e){this.properties().childs().text.setValue(e.text),super._applyTemplateImpl(e)}_correctPoints(e,t){
if(null===this._currentMovingPoint||void 0===this._currentMovingPoint.logical||null===this._startMovingPoint||void 0===this._startMovingPoint.logical)return!1;const i=this._currentMovingPoint.logical.index-this._startMovingPoint.logical.index,r=this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price,s=e[1];return s.index=s.index+i,s.price+=r,e[1]=s,!0}_onPointsetUpdated(e){super._onPointsetUpdated(e),0!==e.length&&(this._dragStartLeftEdgeIndex=this.points()[1].index)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,334183))).CalloutDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(n())(r.t(null,void 0,i(37229)))),e.addExclusion("text"),e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().color]))}_calculateBarOffset(){this.points().length>1&&(this._barOffset=this.points()[1].index-this.points()[0].index)}}},236549:(e,t,i)=>{var r=i(821979).LineDataSource,s=i(853965).DefaultProperty;class n extends r{constructor(e,t,r,s){super(e,t||n.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,592886,19)).then((({LineToolCircleLinesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 2}name(){return"Cyclic Lines"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,925293))).CyclicAndSineLinesPatternDefinitionsViewModel}static createProperties(e){var t=new s("linetoolcirclelines",e);return this._configureProperties(t),t}}t.LineToolCircleLines=n},638202:(e,t,i)=>{i.d(t,{LineToolCircle:()=>a});var r=i(354950),s=i.n(r),n=i(853965),o=i(821979),l=i(31712);class a extends o.LineDataSource{constructor(e,t,r,s){const n=t||a.createProperties();super(e,n,r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,434475)).then((({CirclePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Circle"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new n.DefaultProperty("linetoolcircle",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,70418))).EllipseCircleDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(s())("")),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().color])),e.addChild("linesWidths",new l.LineToolWidthsProperty([e.childs().linewidth])),e.addChild("backgroundsColors",new l.LineToolColorsProperty([e.childs().backgroundColor])),
e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("linesColors"),e.addExclusion("linesWidths"),e.addExclusion("backgroundsColors"),e.addExclusion("text")}}},768574:(e,t,i)=>{i.d(t,{LineToolComment:()=>n});var r=i(853965),s=i(179180);class n extends s.LineToolBalloon{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r)}name(){return"Comment"}static createProperties(e){const t=new r.DefaultProperty("linetoolcomment",e);return n._configureProperties(t),t}_createPaneView(){Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,229548)).then((e=>{this._setPaneViews([new e.CommentPaneView(this,this._model)])}))}}},73217:(e,t,i)=>{i.d(t,{LineToolCrossLine:()=>l});var r=i(853965),s=i(682912),n=i(421644),o=i(821979);class l extends o.LineDataSource{constructor(e,t,r,o){super(e,t||l.createProperties(),r,o),this._priceAxisView=new s.LineToolHorzLinePriceAxisView(this),this._timeAxisView=new n.LineToolVertLineTimeAxisView(this),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,533661)).then((({CrossLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Cross Line"}priceAxisViews(e,t){return this.isSourceHidden()?null:t===this.priceScale()&&this.properties().childs().showPrice.value()&&this._model.paneForSource(this)===e?[this._priceAxisView]:null}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e),this._timeAxisView.update()}canHasAlert(){return!1}lineColor(){return this.properties().childs().linecolor.value()}lineWidth(){return this.properties().childs().linewidth.value()}lineStyle(){return this.properties().childs().linestyle.value()}static createProperties(e){const t=new r.DefaultProperty("linetoolcrossline",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,184062)).then((e=>e.CrossLineDefinitionsViewModel))}}},70726:(e,t,i)=>{i.d(t,{CustomEventItem:()=>n,LineToolCustomUrlEvent:()=>o});var r=i(650151),s=i(776954);class n{constructor(e){this._source=e}position(){return this._props().childs().position.value()}_props(){return this._source.properties()}}class o extends s.LineToolWithRelativePriceCoordinate{constructor(){super(...arguments),this._item=null,this._eventTimePointIndex=null}pointsCount(){return 1}cloneable(){return!1}eventTimePointIndex(){return this._eventTimePointIndex}customEvent(){return this._item}restorePoints(e,t,i){i&&t.length>0&&(this._eventTimePointIndex=t[0].index),super.restorePoints(e,t,i)}priceAxisPoints(){return[]}_baseSeriesIndexForPoint(e){var t;return null!==(t=this._eventTimePointIndex)&&void 0!==t?t:e.index}_alignPointHorizontallyOrVertically(e){var t,i;if(null===this._eventTimePointIndex)return e;const s=this._points[0].index-this._eventTimePointIndex,n=(0,
r.ensure)(null===(i=null===(t=this._startMovingPoint)||void 0===t?void 0:t.logical)||void 0===i?void 0:i.index)-s;return{price:e.price,index:n}}_snapPoint45Degree(e,t,i){this._eventTimePointIndex&&(e.index=this._eventTimePointIndex)}_snapTo45DegreesAvailable(){return!0}_allowChangeAnchorHorizontally(){return!0}_pointsForPointset(){return[[(0,r.ensureNotNull)(this._item).time(),0],...super._pointsForPointset()]}_onPointsetUpdated(e){if(0===e.length)return;const t=e.findIndex((e=>0===e.index));-1!==t&&(this._eventTimePointIndex=e[t].value[0]);const i=e.slice(1).map((e=>({value:e.value,index:e.index-1})));super._onPointsetUpdated(i)}_readyToCreatePointset(){return super._readyToCreatePointset()&&null!==this._item}}},224777:(e,t,i)=>{i.d(t,{LineToolCypherPattern:()=>n});var r=i(147985),s=i(853965);class n extends r.LineTool5PointsPattern{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r)}name(){return"Cypher Pattern"}static createProperties(e){const t=new s.DefaultProperty("linetoolcypherpattern",e);return this._configureProperties(t),t}_loadPaneViews(e){Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,100417)).then((t=>{this._setPaneViews([new t.CypherPaneView(this,e)])}))}}},941883:(e,t,i)=>{i.d(t,{DateAndPriceBaseProperties:()=>_,allPropertiesStateKeysBase:()=>p,nonThemedFactoryDefaultsBase:()=>d,themedFactoryDefaultsBase:()=>u});var r=i(987088),s=i(61499),n=i(246733),o=i(808068),l=i(354950),a=i.n(l),c=i(404720);const h=(0,r.getHexColorByName)("color-tv-blue-500"),d={linewidth:2,fontsize:12,fillLabelBackground:!0,fillBackground:!0,backgroundTransparency:60,intervalsVisibilities:{...o.intervalsVisibilitiesDefaults},customText:{visible:!1,fontsize:12,bold:!1,italic:!1}},u=new Map([[s.StdTheme.Light,{textcolor:(0,r.getHexColorByName)("color-black"),labelBackgroundColor:(0,r.getHexColorByName)("color-white"),linecolor:h,backgroundColor:(0,n.generateColor)(h,85),shadow:"rgba(0, 0, 0, 0.2)",customText:{color:h}}],[s.StdTheme.Dark,{textcolor:(0,r.getHexColorByName)("color-white"),labelBackgroundColor:(0,r.getHexColorByName)("color-cold-gray-800"),linecolor:h,backgroundColor:(0,n.generateColor)(h,85),shadow:"rgba(0, 0, 0, 0.4)",customText:{color:h}}]]),p=["customText.text"];class _ extends c.LineDataSourceThemedProperty{constructor(e,t,i,r,s,n){var o,l,c;super(e,t,i,r,s,n),this._textProperty=new(a())(null!==(l=null===(o=null==n?void 0:n.customText)||void 0===o?void 0:o.text)&&void 0!==l?l:""),null===(c=this.childs().customText)||void 0===c||c.addChild("text",this._textProperty)}template(){const e=super.template();return e.customText.text=this._textProperty.value(),e}}},836843:(e,t,i)=>{i.d(t,{LineToolDateAndPriceRange:()=>v});var r=i(650151),s=i(821979),n=i(3140),o=i(61499),l=i(987088),a=i(738232),c=i(923237),h=i(941883);const d=(0,l.getHexColorByName)("color-tv-blue-500"),u={...h.nonThemedFactoryDefaultsBase,drawBorder:!1,borderWidth:1},p=new Map([[o.StdTheme.Light,{...h.themedFactoryDefaultsBase.get(o.StdTheme.Light),borderColor:d}],[o.StdTheme.Dark,{...h.themedFactoryDefaultsBase.get(o.StdTheme.Dark),borderColor:d
}]]),_=(0,a.extractAllPropertiesKeys)((0,r.ensureDefined)(p.get(o.StdTheme.Light))),g=(0,a.extractAllPropertiesKeys)(u),f=[..._,...g,...c.commonLineToolPropertiesStateKeys,...h.allPropertiesStateKeysBase];class P extends h.DateAndPriceBaseProperties{static create(e){return new this("linetooldateandpricerange",(()=>(0,a.factoryDefaultsForCurrentTheme)(u,p)),g,_,f,e)}}class v extends s.LineDataSource{constructor(e,t,r,s){super(e,t||v.createProperties(),r,s),this._volumeCalculator=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,745062)).then((e=>{this._setPaneViews([new e.DateAndPriceRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date and Price Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new n.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=P.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,133954))).GeneralDatePriceRangeDefinitionsViewModel}}},727264:(e,t,i)=>{i.d(t,{LineToolDateRange:()=>f});var r=i(650151),s=i(821979),n=i(3140),o=i(61499),l=i(738232),a=i(941883),c=i(923237);const h={...a.nonThemedFactoryDefaultsBase,extendTop:!1,extendBottom:!1},d=a.themedFactoryDefaultsBase,u=(0,l.extractAllPropertiesKeys)((0,r.ensureDefined)(d.get(o.StdTheme.Light))),p=(0,l.extractAllPropertiesKeys)(h),_=[...u,...p,...c.commonLineToolPropertiesStateKeys,...a.allPropertiesStateKeysBase];class g extends a.DateAndPriceBaseProperties{static create(e){return new this("linetooldaterange",(()=>(0,l.factoryDefaultsForCurrentTheme)(h,d)),p,u,_,e)}}class f extends s.LineDataSource{constructor(e,t,r,s){super(e,t||f.createProperties(),r,s),this._volumeCalculator=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,691448)).then((e=>{this._setPaneViews([new e.DateRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new n.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=g.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,133954))).GeneralDatePriceRangeDefinitionsViewModel}}},709638:(e,t,i)=>{i.d(t,{LineToolDisjointChannel:()=>a});var r=i(821979),s=i(853965),n=i(389137),o=i(354950),l=i.n(o);class a extends r.LineDataSource{constructor(e,t,r,s){super(e,null!=t?t:a.createProperties(),r,s),this.version=1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,318467)).then((e=>{this._setPaneViews([new e.DisjointChannelPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Disjoint Channel"}hasEditableCoordinates(){return!1}addPoint(e,t,i){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,r){const s=.5*(this._points[1].price+this._points[2].price);if(i&&i.shift()&&1===e){const e=0;this._snapPoint45Degree(t,this.points()[e])}if(e<3&&super.setPoint(e,t),0!==e&&2!==e){if(1===e){const e=this._points[1].price-s;this._points[2].price=this._points[1].price-2*e}else if(3===e){const e=t.price-this._points[2].price;this._points[0].price=this._points[1].price-e,this._points[0].index=t.index}this.normalizePoints()}}getPoint(e){if(e<3)return super.getPoint(e);const t=this._points[0].price-this._points[2].price;return{index:this._points[0].index,price:this._points[1].price-t}}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e){const t=new s.DefaultProperty("linetooldisjointangle",e);return this._configureProperties(t),t}_applyTemplateImpl(e){var t;super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(null!==(t=e.labelText)&&void 0!==t?t:"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const r=this._points[2];r.time=t.time,r.index=t.index;const s={price:r.price+(t.price-e.price),time:e.time,index:e.index},o=[];let l,a,c,h;r.index<=s.index?(o.push(r),o.push(s)):(o.push(s),o.push(r)),i[0].price>o[0].price?(l=i,a=o):o[0].price>i[0].price||o[1].price>i[1].price?(l=o,a=i):(l=i,a=o);const d=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return e.index<=t.index?(c=d,h=u):(c=u,h=d),[this._linePointsToAlertPlot(l,"Upper",c,h),this._linePointsToAlertPlot(a,"Lower",c,h)].filter(n.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,872077))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new(l())("")),e.addExclusion("labelText")}}},960690:(e,t,i)=>{i.d(t,{LineToolElliott:()=>u,LineToolElliottCorrection:()=>x,LineToolElliottDoubleCombo:()=>b,LineToolElliottImpulse:()=>g,
LineToolElliottTriangle:()=>P,LineToolElliottTripleCombo:()=>m});var r=i(444372),s=i(809796),n=i(821979),o=i(373571),l=i(853965),a=i(31712);const c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],h=new s.TranslatedString("change Elliott degree",r.t(null,void 0,i(876020))),d=[{value:0,title:r.t(null,void 0,i(433820))},{value:1,title:r.t(null,void 0,i(558397))},{value:2,title:r.t(null,void 0,i(609753))},{value:3,title:r.t(null,void 0,i(718367))},{value:4,title:r.t(null,void 0,i(591889))},{value:5,title:r.t(null,void 0,i(495176))},{value:6,title:r.t(null,void 0,i(348404))},{value:7,title:r.t(null,void 0,i(671778))},{value:8,title:r.t(null,{context:"wave"},i(266051))},{value:9,title:r.t(null,{context:"wave"},i(486054))},{value:10,title:r.t(null,void 0,i(185884))},{value:11,title:r.t(null,void 0,i(471722))},{value:12,title:r.t(null,void 0,i(210931))},{value:13,title:r.t(null,void 0,i(729662))},{value:14,title:r.t(null,void 0,i(609632))}];class u extends n.LineDataSource{constructor(e,t,r,s){super(e,null!=t?t:u.createProperties(),r,s),this.version=4,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,762994)).then((e=>{this._setPaneViews([new e.ElliottLabelsPaneView(this,this._model)])}))}migrateVersion(e,t,i){if(i.properties.hasChild("background")&&i.properties.removeProperty("background"),i.properties.hasChild("backgroundColor")&&i.properties.removeProperty("backgroundColor"),i.properties.hasChild("showBackground")&&i.properties.removeProperty("showBackground"),1===e){const e=Object.assign({},this._timePoint[0]);if(this._timePoint.unshift(e),this._points.length>0){const e=Object.assign({},this._points[0]);this._points.unshift(e)}}}applyTemplate(e){const t=e;delete t.background,delete t.backgroundColor,delete t.showBackground,super.applyTemplate(e)}name(){return"Elliott Labels"}additionalActions(e){return[new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",label:r.t(null,void 0,i(69479)),subItems:c.map((t=>{const i=d.filter((e=>e.value===t))[0];return new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",label:i.title,checkable:!0,checked:this.properties().childs().degree.value()===t,onExecute:()=>{e.setProperty(this.properties().childs().degree,t,h)}})}))})]}label(e){const t=c.length-this.properties().childs().degree.value()-1,i=Math.floor(t/3);return{group:i,bold:!!(i%2),decoration:["","brackets","circle"][t%3],label:this.labelsGroup()[i][e]}}availableDegreesValues(){return d}static createProperties(e){const t=new l.DefaultProperty("linetoolelliott",e);return this._configureProperties(t),t}static migrateState(e){const t={0:11,1:10,2:9,3:8,4:7,5:6,6:5,7:4,8:3},i={0:11,1:8};"LineToolElliottSubminuette"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinor"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottCircle"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize]),
"LineToolElliottMajorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize])}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,46971))).ElliottPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addExclusion("linesColors")}}class p extends u{pointsCount(){return 6}}const _=[["0","1","2","3","4","5"],["0","i","ii","iii","iv","v"],["0","1","2","3","4","5"],["0","I","II","III","IV","V"],["0","1","2","3","4","5"]];class g extends p{constructor(e,t,i,r){super(e,t||g.createProperties(),i,r)}name(){return"Elliott Impulse Wave (12345)"}labelsGroup(){return _}static createProperties(e){const t=new l.DefaultProperty("linetoolelliottimpulse",e);return this._configureProperties(t),t}}const f=[["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"]];class P extends p{constructor(e,t,i,r){super(e,t||P.createProperties(),i,r)}name(){return"Elliott Triangle Wave (ABCDE)"}labelsGroup(){return f}static createProperties(e){const t=new l.DefaultProperty("linetoolelliotttriangle",e);return this._configureProperties(t),t}}const v=[["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"]];class m extends p{constructor(e,t,i,r){super(e,null!=t?t:m.createProperties(),i,r)}name(){return"Elliott Triple Combo Wave (WXYXZ)"}labelsGroup(){return v}static createProperties(e){const t=new l.DefaultProperty("linetoolelliotttriplecombo",e);return this._configureProperties(t),t}}class y extends u{pointsCount(){return 4}}const C=[["0","A","B","C"],["0","a","b","c"],["0","A","B","C"],["0","a","b","c"],["0","A","B","C"]];class x extends y{constructor(e,t,i,r){super(e,null!=t?t:x.createProperties(),i,r)}name(){return"Elliott Correction Wave (ABC)"}labelsGroup(){return C}static createProperties(e){const t=new l.DefaultProperty("linetoolelliottcorrection",e);return this._configureProperties(t),t}}const w=[["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"]];class b extends y{constructor(e,t,i,r){super(e,null!=t?t:b.createProperties(),i,r)}name(){return"Elliott Double Combo Wave (WXY)"}labelsGroup(){return w}static createProperties(e){const t=new l.DefaultProperty("linetoolelliottdoublecombo",e);return this._configureProperties(t),t}}},43853:(e,t,i)=>{i.d(t,{LineToolEllipse:()=>d});var r=i(650151),s=i(204652),n=i(86441),o=i(354950),l=i.n(o),a=i(821979),c=i(853965),h=i(31712);class d extends a.LineDataSource{constructor(e,t,r,s){super(e,t||d.createProperties(),r,s),this.version=2,this._dist=null,this._fakePointAdded=!1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,555422)).then((({EllipsePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,
r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,s.distanceToLine)(e,t,i).distance||0}}addPoint(e,t,i){const r=super.addPoint(e,t,i);return r&&(this._fakePointAdded=!1),r}setPoint(e,t,i,o){const l={...t};let a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),c=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),h=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));switch(e){case 0:{if(i&&i.shift()){this._snapPoint45Degree(l,this._points[1]),this._points[0]=l,this._points[2]=this._preparePointInternal(this._points[2],i,!0),this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[0],this._points[1],this._points[2]);break}a=(0,r.ensureNotNull)(this.pointToScreenPoint(l));const e=c.subtract(a),t=a.add(c).scaled(.5),s=new n.Point(-e.y,e.x).normalized();h=t.add(s.scaled((0,r.ensureNotNull)(this._dist))),this._points[0]=l,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}case 1:{if(i&&i.shift()){this._snapPoint45Degree(l,this._points[0]),this._points[1]=l,this._points[2]=this._preparePointInternal(this._points[2],i,!0),this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[1],this._points[0],this._points[2]);break}c=(0,r.ensureNotNull)(this.pointToScreenPoint(l));const e=c.subtract(a),t=a.add(c).scaled(.5),s=new n.Point(-e.y,e.x).normalized();h=t.add(s.scaled((0,r.ensureNotNull)(this._dist))),this._points[1]=l,this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}case 2:{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),t=(0,s.distanceToLine)(a,c,e).distance,i=c.subtract(a),o=a.add(c).scaled(.5),d=new n.Point(-i.y,i.x).normalized();h=o.add(d.scaled(t)),this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}case 3:{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),t=(0,s.distanceToLine)(a,c,e).distance,i=c.subtract(a),o=a.add(c).scaled(.5),d=new n.Point(-i.y,i.x).normalized();h=o.add(d.scaled(t)),this._points[2]=(0,r.ensureNotNull)(this.screenPointToPoint(h));break}}this.normalizePoints()}pointsCount(){return 3}name(){return"Ellipse"}hasEditableCoordinates(){return!1}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._points[0].price,t=.5*(this._points[0].price+this._points[1].price);this._points[0]={price:t,index:this._points[0].index},this._points[1]={price:t,index:this._points[1].index},this._points.push({price:e,index:this._points[0].index})}if(1===e&&2===this._timePoint.length){const e=this._timePoint[0].price,t=.5*(this._timePoint[0].price+this._timePoint[1].price);this._timePoint[0].price=t,this._timePoint[1].price=t;const i={price:e,offset:this._timePoint[0].offset,time_t:this._timePoint[0].time_t};this._timePoint.push(i)}}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){
const t=new c.DefaultProperty("linetoolellipse",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,70418))).EllipseCircleDefinitionsViewModel}_preparePoint(e,t){const i=this._preparePointInternal(e,t,!1);return t&&t.shift()&&this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[1],this._points[0],i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())("")),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("text")}_preparePointInternal(e,t,i){let s={...e};if(t&&t.shift()){const t=this.points().length;if(!this._fakePointAdded&&3===t&&!i)return s;if(this._fakePointAdded||2===t||i){this._snapPoint45Degree(e,this._points[0]),this._fakePointAdded?this._points[1]=e:i||(this._fakePointAdded=!0,super._addPointIntenal(e));const t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),l=o.x-t.x,a=o.y-t.y,c=Math.sqrt(l*l+a*a)/2,h=o.subtract(t),d=t.add(o).scaled(.5),u=new n.Point(-h.y,h.x).normalized(),p=d.add(u.scaled(c));s=(0,r.ensureNotNull)(this.screenPointToPoint(p)),(isNaN(s.price)||isNaN(s.index))&&(s=(0,r.ensureNotNull)(this.screenPointToPoint(d)))}}else this._fakePointAdded&&(this._points.splice(1,1),this._fakePointAdded=!1);return s}_fixVerticalDiameterPoints(e,t,i){const s=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),o=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=this._model.timeScale(),a=l.indexToCoordinate(e.index),c=l.indexToCoordinate(i.index);let h=2*Math.abs(a-c);h*=t.price>e.price?1:-1,e.price=(0,r.ensureNotNull)(this.screenPointToPoint(new n.Point(s.x,o.y+h))).price}}},443361:(e,t,i)=>{i.d(t,{LineToolEmoji:()=>c});var r=i(328530),s=i(201089),n=i(120780),o=i(853965),l=i(760184);const a=(0,s.getLogger)("Chart.LineToolEmoji");class c extends l.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t||c.createProperties(),i,r),this.version=1,this._loadViews()}name(){return"Emoji"}static createProperties(e){const t=new o.DefaultProperty("linetoolemoji",e);return c._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,282375))).LineDataSourceDefinitionsViewModel}async _loadViews(){const e=this._properties.childs().emoji.value(),t=(0,r.getTwemojiUrl)(e,"svg");try{const[r,{EmojiPaneView:s},{svgRenderer:o}]=await Promise.all([(0,n.fetch)(t).then((e=>e.text())),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,496259)),i.e(72616).then(i.bind(i,500477))]);if(!this._isDestroyed){this._svgContent=r,this._onIconChanged.fire();const t=o(r)
;null===t&&a.logWarn(`Couldn't create svg renderer for emoji ${e}`),this._setPaneViews([new s(this,this._model,t)])}}catch(t){a.logWarn(`An error ocurred while loading emoji content ${e}: ${t}`)}}}},252598:(e,t,i)=>{i.d(t,{LineToolExtended:()=>s});var r=i(956268);class s extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,null!=t?t:s.createProperties(),i,r)}name(){return"Extended Line"}static createProperties(e){const t=r.LineToolTrendLine.createProperties(e,"linetoolextended");return s._configureProperties(t),t}}},965989:(e,t,i)=>{i.d(t,{LineToolFibChannel:()=>h});var r=i(650151),s=i(444372),n=i(809796),o=i(821979),l=i(517336),a=i(31712);const c=new n.TranslatedString("erase level line",s.t(null,void 0,i(812962)));class h extends o.LineDataSource{constructor(e,t,r,s){super(e,t||h.createProperties(),r,s),this.version=2,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,361501)).then((({FibChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}migrateVersion(e,t,i){i.properties.removeProperty("reverse")}pointsCount(){return 3}name(){return"Fib Channel"}processErase(e,t){const i="level"+t,r=this.properties().child(i).childs().visible;e.setProperty(r,!1,c)}static createProperties(e){const t=new l.LevelsProperty("linetoolfibchannel",e,!1,{range:[1,24],names:["coeff","color","visible"]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,866406))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[];for(let i=1;i<=24;i++){const s=(0,r.ensureDefined)(e.child("level"+i));t.push((0,r.ensureDefined)(s.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(t))}}},953718:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(821979).LineDataSource,n=i(517336).LevelsProperty,o=i(31712),l=o.LineToolWidthsProperty,a=o.LineToolColorsProperty,c=new r("erase level line",i.tf(null,void 0,i(812962)));class h extends s{constructor(e,t,r,s){super(e,t||h.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,889131,19)).then((({FibCirclesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 2}name(){return"Fib Circles"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,c)}static createProperties(e){var t=new n("linetoolfibcircles",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,151611))).FibCirclesDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=this.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"))
;e.addChild("linesColors",new a(i)),e.addChild("linesWidths",new l(t))}}h.LevelsCount=11,t.LineToolFibCircles=h},498995:(e,t,i)=>{i.d(t,{LineToolFibRetracement:()=>c});var r=i(444372),s=i(809796),n=i(517336),o=i(821979),l=i(31712);const a=new s.TranslatedString("erase level line",r.t(null,void 0,i(812962)));class c extends o.LineDataSource{constructor(e,t,r,s){super(e,t||c.createProperties(),r,s),this.version=2,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,832307)).then((e=>{this._setPaneViews([new e.FibRetracementPaneView(this,this._model)])}))}levelsCount(){return 24}pointsCount(){return 2}name(){return"Fib Retracement"}migrateVersion(e){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,{visible:r}=this.properties().childs()[i].childs();e.setProperty(r,!1,a)}fibLevelsBasedOnLogScale(){var e;return this.properties().childs().fibLevelsBasedOnLogScale.value()&&!!(null===(e=this.priceScale())||void 0===e?void 0:e.isLog())}static createProperties(e){const t=new n.LevelsProperty("linetoolfibretracement",e,!1,{range:[1,24],names:["coeff","color","visible"]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,866406))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){var t;const i=e;super._configureProperties(i);const r=[i.childs().trendline.childs().linewidth,i.childs().levelsStyle.childs().linewidth],s=[i.childs().trendline.childs().color];for(let e=1;e<=24;e++){const r=null===(t=i.child("level"+e))||void 0===t?void 0:t.child("color");s.push(r)}i.addChild("linesColors",new l.LineToolColorsProperty(s)),i.addChild("linesWidths",new l.LineToolWidthsProperty(r))}}},974472:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(821979).LineDataSource,n=i(517336).LevelsProperty,o=i(31712),l=o.LineToolWidthsProperty,a=o.LineToolColorsProperty,c=new r("erase level line",i.tf(null,void 0,i(812962)));class h extends s{constructor(e,t,r,s){super(e,t||h.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,303842)).then((({FibSpeedResistanceArcsPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 2}name(){return"Fib Speed Resistance Arcs"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,c)}static createProperties(e){var t=new n("linetoolfibspeedresistancearcs",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,149820))).FibSpeedResistanceArcsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=this.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new a(i)),
e.addChild("linesWidths",new l(t))}}h.LevelsCount=11,t.LineToolFibSpeedResistanceArcs=h},63491:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(821979).LineDataSource,n=i(517336).LevelsProperty,o=i(31712).LineToolColorsProperty,l=new r("erase level line",i.tf(null,void 0,i(812962)));class a extends s{constructor(e,t,r,s){super(e,t||a.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,446261)).then((({FibSpeedResistanceFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return a.HLevelsCount}vLevelsCount(){return a.VLevelsCount}pointsCount(){return 2}name(){return"Fib Speed Resistance Fan"}processErase(e,t){var i="h"===t.type?"hlevel"+t.index:"vlevel"+t.index,r=this.properties()[i].visible;e.setProperty(r,!1,l)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,233169))).FibSpeedResistanceFanDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){void 0!==e&&void 0===e.reverse&&(e.reverse=!0);var t=new n("linetoolfibspeedresistancefan",e,!1,{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);var t=[e.child("grid").child("color")];for(let i=1;i<=this.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(let i=1;i<=this.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new o(t)),e.addExclusion("linesColors")}}a.HLevelsCount=7,a.VLevelsCount=7,t.LineToolFibSpeedResistanceFan=a},165438:(e,t,i)=>{var r=i(821979).LineDataSource,s=i(853965).DefaultProperty;class n extends r{constructor(e,t,r,s){super(e,t||n.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,732983)).then((({FibSpiralPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 2}name(){return"Fib Spiral"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,918065))).FibSpiralDefinitionsViewModel}static createProperties(e){var t=new s("linetoolfibspiral",e);return this._configureProperties(t),t}}t.LineToolFibSpiral=n},958849:(e,t,i)=>{i.d(t,{LineToolFibTimeZone:()=>c});var r=i(444372),s=i(809796),n=i(31712),o=i(517336),l=i(821979);const a=new s.TranslatedString("erase level line",r.t(null,void 0,i(812962)));class c extends l.LineDataSource{constructor(e,t,r,s){super(e,t||c.createProperties(),r,s),this.version=2,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,122613)).then((({FibTimeZonePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}migrateVersion(e,t,i){if(1===e){const e=i.properties.childs(),t=i.properties,r=t.baselinecolor.value(),s=t.linecolor.value(),n=t.linewidth.value(),o=t.linestyle.value();e.level1.childs().color.setValue(r);for(let t=2;t<=11;t++)e["level"+t].childs().color.setValue(s)
;for(let t=1;t<=11;t++)e["level"+t].childs().linewidth.setValue(n),e["level"+t].childs().linestyle.setValue(o)}}pointsCount(){return 2}name(){return"Fib Time Zone"}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,a)}static createProperties(e){const t=new o.LevelsProperty("linetoolfibtimezone",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,542375))).FibTimezoneDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[];for(let r=1;r<=11;r++){const s=e.childs()["level"+r].childs();t.push(s.linewidth),i.push(s.color)}e.addChild("linesColors",new n.LineToolColorsProperty(i)),e.addChild("linesWidths",new n.LineToolWidthsProperty(t))}}},672688:(e,t,i)=>{i.d(t,{LineToolFibWedgeBase:()=>o});var r=i(650151),s=i(86441),n=i(821979);class o extends n.LineDataSource{pointsCount(){return 3}hasEditableCoordinates(){return!1}setPoint(e,t){if(super.setPoint(e,t),!this._recursiveGuard)try{if(this._recursiveGuard=!0,2===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0]));let t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));const i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2])).subtract(e).length();let n=t.subtract(e);n.length()<=0&&(n=new s.Point(1,0)),t=e.add(n.normalized().scaled(i));const o=(0,r.ensureNotNull)(this.screenPointToPoint(t)),l=this._pointsProperty.childs().points[1];l.childs().price.setValue(o.price),l.childs().bar.setValue(o.index)}else{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));const n=t.subtract(e).length();let o=i.subtract(e);o.length()<=0&&(o=new s.Point(1,0)),i=e.add(o.normalized().scaled(n));const l=(0,r.ensureNotNull)(this.screenPointToPoint(i)),a=this._pointsProperty.childs().points[2];a.childs().price.setValue(l.price),a.childs().bar.setValue(l.index)}}finally{this._recursiveGuard=!1}}addPoint(e){if(2===this._points.length){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let s=(0,r.ensureNotNull)(this.pointToScreenPoint(e));const n=i.subtract(t).length(),o=s.subtract(t).normalized();s=t.add(o.scaled(n));const l=(0,r.ensureNotNull)(this.ownerSource()),a=(0,r.ensureNotNull)(l.firstValue()),c=(0,r.ensureNotNull)(this.priceScale()).coordinateToPrice(s.y,a);e={index:Math.round(this._model.timeScale().coordinateToIndex(s.x)),price:c}}return super.addPoint(e)}}},781811:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(672688).LineToolFibWedgeBase,n=i(517336).LevelsProperty,o=i(31712),l=o.LineToolWidthsProperty,a=o.LineToolColorsProperty,c=new r("erase level line",i.tf(null,void 0,i(812962)));class h extends s{constructor(e,t,r,s){super(e,t||h.createProperties(),r,s),
Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,257760,19)).then((({FibWedgePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}isSynchronizable(){return!1}levelsCount(){return h.LevelsCount}name(){return"Fib Wedge"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,c)}static createProperties(e){var t=new n("linetoolfibwedge",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,444191))).FibWedgeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],r=1;r<=this.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new a(i)),e.addChild("linesWidths",new l(t))}}h.LevelsCount=11,t.LineToolFibWedge=h},218032:(e,t,i)=>{i.d(t,{LineToolFlagMark:()=>l});var r=i(86441),s=i(821979),n=i(853965),o=i(31712);class l extends s.LineDataSource{constructor(e,t,s,n){super(e,t||l.createProperties(),s,n),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,812318)).then((({FlagMarkPaneView:e})=>{const t=new e(this,this.model());t.setAnchors(new r.Point(0,0)),this._setPaneViews([t])}))}pointsCount(){return 1}name(){return"Flag Mark"}static createProperties(e){e&&void 0===e.flagColor&&(e.flagColor="#318757");const t=new n.DefaultProperty("linetoolflagmark",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,268987)).then((e=>e.FlagMarkDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new o.LineToolColorsProperty([e.childs().flagColor])),e.addExclusion("backgroundsColors")}}l.version=2},634659:(e,t,i)=>{i.d(t,{LineToolFlatBottom:()=>a});var r=i(821979),s=i(853965),n=i(389137),o=i(354950),l=i.n(o);class a extends r.LineDataSource{constructor(e,t,r,s){super(e,null!=t?t:a.createProperties(),r,s),this.version=1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,767345)).then((e=>{this._setPaneViews([new e.FlatBottomPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Flat Bottom"}hasEditableCoordinates(){return!1}addPoint(e,t,i){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,r){if(i&&i.shift()&&1===e){const e=0;this._snapPoint45Degree(t,this.points()[e])}if(2===e)this._points[1].index=t.index;else if(3===e)return this._points[0].index=t.index,this._points[2].price=t.price,void this.normalizePoints();super.setPoint(e,t)}getPoint(e){return e<3?super.getPoint(e):3===e?{index:this._points[0].index,
price:this._points[2].price}:null}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e){const t=new s.DefaultProperty("linetoolflatbottom",e);return this._configureProperties(t),t}_applyTemplateImpl(e){var t;super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(null!==(t=e.labelText)&&void 0!==t?t:"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const r=this._points[2];r.time=t.time,r.index=t.index;const s={price:r.price,time:e.time,index:e.index},o=[];let l,a,c,h;r.index<=s.index?(o.push(r),o.push(s)):(o.push(s),o.push(r)),i[0].price>o[0].price?(l=i,a=o):o[0].price>i[0].price||o[1].price>i[1].price?(l=o,a=i):(l=i,a=o);const d=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return e.index<=t.index?(c=d,h=u):(c=u,h=d),[this._linePointsToAlertPlot(l,"Upper",c,h),this._linePointsToAlertPlot(a,"Lower",d,h)].filter(n.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,872077))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new(l())("")),e.addExclusion("labelText")}}},406182:(e,t,i)=>{i.d(t,{createPropertiesObject:()=>l});var r=i(389137),s=i(517336);function n(e,t,i){var s;for(const n of Object.keys(null!==(s=e.levels)&&void 0!==s?s:{}))if(e.levels[n]&&(0,r.isSameType)(e.levels[n],t.typecheck())){let r=t.tpl();i.names.forEach(((i,s)=>{r=t.fill(""+s,i,e.levels[n],r)})),e.levels[n]=r}return e}class o extends s.LevelsProperty{constructor(e,t){super(e,t,!1,{names:["width","color","visible"]},n)}}function l(e,t){return new o(e,t)}},833762:(e,t,i)=>{i.d(t,{LineToolGannComplex:()=>d});var r=i(86441),s=i(650151),n=i(327453),o=i(821979),l=i(915179),a=i(406182),c=i(31712),h=i(422333);class d extends o.LineDataSource{constructor(e,t,r,s){super(e,t||d.createProperties(),r,s),this.version=2,this._scaleRatioFormatter=new n.LimitedPrecisionNumericFormatter(7),this.version=2,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,726868)).then((({GannComplexPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}));const o=this.properties();this._adjustScaleRatio(o),o.subscribe(this,this._adjustScaleRatio),o.childs().scaleRatio.subscribe(this,this._correctFirstPoint),this._syncStateExclusions=["scaleRatio"],o.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.subscribe(this,this._handleTemplateApplying),this._onTemplateApplied.subscribe(this,this._correctFirstPoint)}migrateVersion(e,t,i){1===e&&(this._points.length>=this.pointsCount()?setTimeout((()=>this._migratePoint())):this._timePoint.length>=this.pointsCount()&&this._pointAdded.subscribe(this,this._migratePoint))}destroy(){const e=this.properties()
;e.unsubscribe(this,this._adjustScaleRatio),e.childs().scaleRatio.unsubscribe(this,this._correctFirstPoint),e.onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.unsubscribe(this,this._handleTemplateApplying),this._onTemplateApplied.unsubscribe(this,this._correctFirstPoint),super.destroy()}pointsCount(){return 2}name(){return"Gann Square"}addPoint(e,t,i){this._points.length>1&&this._points.pop();const r=super.addPoint(e,t,i),n=this.priceScale();return!(0,s.ensureNotNull)(n).isLog()&&r&&this._correctFirstPoint(),r}setPoint(e,t,i){super.setPoint(e,t,i),void 0!==i&&i.shift()?this._correctPoint(e):this._correctScaleRatio()}setLastPoint(e,t){const i=this.priceScale();return(0,s.ensureNotNull)(i).isLog()||(this._points[1]=e,this._correctPoint(1)),super.setLastPoint(e,t)}isReversed(){return this.properties().childs().reverse.value()}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}isLabelsVisible(){return this.properties().childs().showLabels.value()}getLabelsStyle(){const e=this.properties().childs(),{fontSize:t,bold:i,italic:r}=e.labelsStyle.childs(),s=e.levels.childCount();return{textColor:e.levels.childs()[s-1].childs().color.value(),font:h.CHART_FONT_FAMILY,fontSize:t.value(),bold:i.value(),italic:r.value()}}getScaleRatioStep(){return 1e-7}getScaleRatioFormatter(){return this._scaleRatioFormatter}getPriceDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.price-t.price}getIndexDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.index-t.index}getScaleRatio(){const e=this.getPriceDiff(),t=this.getIndexDiff();return null!==e&&null!==t&&0!==t?Math.abs(e/t):null}static createProperties(e){const t=(0,a.createPropertiesObject)("linetoolganncomplex",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,108927)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExclusion("scaleRatio");const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let s=0;s<e;s++){const e=r.levels.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let s=0;s<e;s++){const e=r.fanlines.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let s=0;s<e;s++){const e=r.arcs.childs()[s].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}_correctScaleRatio(){const e=this.properties().childs(),t=this.getScaleRatio();e.scaleRatio.setValue(t)}_getAdjustedScaleRatio(){const e=this.model().mainSeries().priceScale(),t=this.model().timeScale();return(0,l.scaleRatio)(t,e)}_adjustScaleRatio(e){const t=e.scaleRatio.value();""!==t&&null!==t||e.scaleRatio.setValue(this._getAdjustedScaleRatio())}_correctPoint(e){if(this._points.length<2)return;const t=this.getIndexDiff();if(null===t)return;const i=this.properties().childs().scaleRatio.value();if(null!==i){const r=this._points[e],s=0===e?this._points[1]:this._points[0],n=r.price-s.price>0,o=r.index-s.index>0;let l=n&&!o||!n&&o?-1:1;0===e&&(l=-l),r.price=s.price+l*t*i,this._pointChanged.fire(e)}this.normalizePoints()}_correctFirstPoint(){this._correctPoint(this.isReversed()?0:1)}_handleRestoringFactoryDefaults(){this.properties().childs().scaleRatio.setValue(this._getAdjustedScaleRatio())}_handleTemplateApplying(e){""===e.scaleRatio&&(e.scaleRatio=this._getAdjustedScaleRatio())}_migratePoint(){if(this.points().length<this.pointsCount())return;const e=this._getScreenPoints();if(null===e)return;const t=(0,s.ensureNotNull)(this.screenPointToPoint(e[1]));this.setPoint(1,t),this._pointAdded.unsubscribe(this,this._migratePoint)}_getScreenPoints(){const e=this._calcAngle();if(null===e)return null;let[t,i]=this.points();this.isReversed()&&([t,i]=[i,t]);const n=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),o=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),l=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),a=new r.Point(Math.cos(e),-Math.sin(e)),c=a.normalized(),h=c.x<0?-1:1,d=c.y<0?-1:1;return[n.addScaled(a,l),n.add(new r.Point(5*l*h,5*l*d))]}_calcAngle(){const[e,t]=this.points(),i=(0,s.ensureNotNull)(this.pointToScreenPoint(e));let r=(0,s.ensureNotNull)(this.pointToScreenPoint(t)).subtract(i);if(r.length()>0){r=r.normalized();let e=Math.acos(r.x);return r.y>0&&(e=-e),e}return null}}},643442:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(821979).LineDataSource,n=i(517336).LevelsProperty,o=i(31712),l=o.LineToolWidthsProperty,a=o.LineToolColorsProperty,c=new r("erase level line",i.tf(null,void 0,i(812962)));class h extends s{constructor(e,t,r,s){super(e,t||h.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,33877)).then((({GannFanPaneView:e})=>{
this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 2}name(){return"Gann Fan"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,c)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,903951))).GannFanDefinitionsViewModel}static createProperties(e){var t=new n("linetoolgannfan",e,!1,{range:[1,9]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[],i=[],r=1;r<=this.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new a(i)),e.addChild("linesWidths",new l(t))}}h.LevelsCount=9,t.LineToolGannFan=h},839386:(e,t,i)=>{i.d(t,{LineToolGannFixed:()=>a});var r=i(86441),s=i(650151),n=i(821979),o=i(31712),l=i(406182);class a extends n.LineDataSource{constructor(e,t,r,s){super(e,t||a.createProperties(),r,s),this._constructor="LineToolGannFixed",Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,14986)).then((({GannFixedPaneView:e})=>{this._setPaneViews([new e(this,this.model())])})),this.properties().childs().reverse.subscribe(this,this._reversePoints)}pointsCount(){return 2}name(){return"Gann Square Fixed"}axisPoints(){const e=this.points(),t=this.getScreenPoints();return e.length<2||t.length<2?[]:[e[0],(0,s.ensureNotNull)(this.screenPointToPoint(t[1]))]}getScreenPoints(){const e=this.points();if(e.length<2)return[];const t=this._calcAngle();if(null===t)return[];const[i,n]=e,o=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),l=(0,s.ensureNotNull)(this.pointToScreenPoint(n)),a=Math.sqrt(Math.pow(o.x-l.x,2)+Math.pow(o.y-l.y,2)),c=new r.Point(Math.cos(t),-Math.sin(t)),h=c.normalized(),d=h.x<0?-1:1,u=h.y<0?-1:1;return[o.addScaled(c,a),o.add(new r.Point(5*a*d,5*a*u))]}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}
static createProperties(e){const t=(0,l.createPropertiesObject)("linetoolgannfixed",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,108927)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let s=0;s<e;s++){const e=r.levels.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let s=0;s<e;s++){const e=r.fanlines.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let s=0;s<e;s++){const e=r.arcs.childs()[s].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new o.LineToolColorsProperty(i)),e.addChild("linesWidths",new o.LineToolWidthsProperty(t))}_calcAngle(){const e=this.points();if(e.length<2)return null;const[t,i]=e,r=this.pointToScreenPoint(t),s=this.pointToScreenPoint(i);if(null===r||null===s)return null;let n=s.subtract(r);if(n.length()<=0)return null;n=n.normalized();let o=Math.acos(n.x);return n.y>0&&(o=-o),o}_reversePoints(){const[e,t]=this._points;this._points[0]=t,this._points[1]=e,this.normalizePoints(),this.restart()}}},168853:(e,t,i)=>{var r=i(821979).LineDataSource,s=i(517336).LevelsProperty,n=i(31712).LineToolColorsProperty,o=[4.5,9,11.25,18,22.5,36,45],l=function(){for(var e=[],t=o.length-1,i=1,r=0,s=0;s<1e10;)s=o[r]*i,e.push(Math.round(s)),e.push(Math.ceil(-s)),r===t-1&&(i*=10),r=(r+1)%t;return e.sort((function(e,t){return e<t?-1:e>t?1:0})),e}();class a extends r{constructor(e,t,r,s){super(e,t||a.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,257794,19)).then((({GannSquarePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return a.HLevelsCount}vLevelsCount(){return a.VLevelsCount}pointsCount(){return 2}name(){return"Gann Box"}_alignPriceOnPattern(e,t){var i=Math.round(1e6*(e.price-t.price))/1e6;if(0===i)return t.price;for(var r=o[0],s=o[o.length-1],n=1,l=Math.abs(i);l<r*n||s*n<l;)l<r*n?n*=.1:s*n<l&&(n*=10);for(var a=s*n,c=o.length-2;c>=0&&!(o[c]*n<l);--c)a=o[c]*n;return e.price=t.price+(i>=0?a:-a),e}_alignTimeOnPattern(e,t){var i=e.index-t.index;if(0===i)return 0;for(var r=l.length-2;r>=0&&!(l[r]<i);--r);return r+=i>0?1:0,e.index=t.index+l[r],e}_alignPointsFixedIncrement(e,t){return this._alignTimeOnPattern(e,t),this._alignPriceOnPattern(e,t),e}_preparePoint(e,t){return t&&t.shift()&&0!==this._points.length&&this._alignPointsFixedIncrement(e,this._points[0]),super._preparePoint(e,t)}getPoint(e){if(e<2)return super.getPoint(e);var t=null;switch(e){case 2:case 3:var i=this.points();if(i.length===this.pointsCount()){var r=i[0].index,s=i[1].price;3===e&&(r=i[1].index,s=i[0].price),t={index:r,price:s}}}return t}setPoint(e,t,i){if(i&&i.shift()){var r=e%2==0?this._points[1]:this._points[0];this._alignPointsFixedIncrement(t,r)}switch(e){case 2:this._points[0].index=t.index,this._points[1].price=t.price;break;case 3:
this._points[1].index=t.index,this._points[0].price=t.price;break;default:super.setPoint(e,t,i)}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,114388))).GannSquareDefinitionsViewModel}static createProperties(e){var t=new s("linetoolgannsquare",e,!1,{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("color"),e.child("fans").child("color")],i=1;i<=this.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(i=1;i<=this.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new n(t)),e.addExclusion("linesColors")}}a.HLevelsCount=7,a.VLevelsCount=7,t.LineToolGannSquare=a},711755:(e,t,i)=>{i.d(t,{LineToolGhostFeed:()=>c});var r=i(853965),s=i(821979),n=i(650151),o=i(389137);class l{constructor(e,t,i){this._source=e,this._segmentIndex=t,this._bars=null!=i?i:[]}setBars(e){this._bars=e}clone(e){return new l(e,this._segmentIndex,(0,o.clone)(this._bars))}generate(){this._bars=[];const e=this._source.points(),t=e[this._segmentIndex],i=e[this._segmentIndex+1];if(!t||!i||t.index===i.index)return;const r=this._segmentIndex?t.index+1:t.index,s=Math.sign(i.index-t.index);for(let e=r;e!==i.index;e+=s)this._bars.push(this._createBar())}bars(){return this._bars}setSize(e){if(e<this._bars.length)this._bars.splice(e,this._bars.length-e);else for(;this._bars.length<e;)this._bars.push(this._createBar())}_createBar(){const e=this._source.properties().averageHL.value(),t=this._source.properties().variance.value()/100,i=(0,n.ensureNotNull)(this._source.ownerSource()).base();let r=Math.random();const s=e*(1-2*r)*t;r=Math.random();const o=e*(1+(.5-r)*t),l=s-o/2,a=l+o;return{o:(l+Math.random()*o)/i,h:a/i,l:l/i,c:(l+Math.random()*o)/i}}}var a=i(964824);class c extends s.LineDataSource{constructor(e,t,r,s){const n=t||c.createProperties();if(super(e,n,r,s),this._segments=[],this._finished=!1,this._segmentsPixelsWhileMoving=null,!r){const e=Math.round(this._calculateATR());n.childs().averageHL.setValue(e)}n.childs().averageHL.listeners().subscribe(this,this._regenerate),n.childs().variance.listeners().subscribe(this,this._regenerate),this._currentAverageHL=n.childs().averageHL.value(),this._currentVariance=n.childs().variance.value(),this._currentInterval=e.mainSeries().interval(),this.properties().onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,626219)).then((t=>{this._setPaneViews([new t.GhostFeedPaneView(this,e)])}))}isSynchronizable(){return!1}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),super.destroy()}propertiesChanged(){super.propertiesChanged(),this._currentAverageHL===this.properties().childs().averageHL.value()&&this._currentVariance===this.properties().childs().variance.value()||this._regenerate()}pointsCount(){return-1}name(){
return"Ghost Feed"}segmentBars(e){return this._segments[e].bars()}segments(){return this._segments}generateBars(e){this._segments.length<=e&&this._segments.push(new l(this,e)),this._segments[e].generate()}addPoint(e,t,i){if(this._finished)return!0;if(this._points.length>0){const i=this._points[this._points.length-1];if(!(null==t?void 0:t.isApiEvent())&&i.index===e.index){this._lastPoint=null,this.normalizePoints(),this.createServerPoints();for(let e=0;e<this._points.length;e++)this._createPointProperty(e);return!0}}const r=super.addPoint(e,t,i);return this._points.length>1&&this.generateBars(this._points.length-2),r}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}setPoint(e,t,i,r){if(super.setPoint(e,t,i),e>0){const i=this.points()[e-1],r=t.index-i.index;this._segments[e-1].setSize(Math.abs(r))}if(e<this.points().length-1){const i=this.points()[e+1].index-t.index;this._segments[e].setSize(Math.abs(i))}}state(e){const t=super.state(e);return t.segments=this._segments.map((e=>({bars:[...e.bars()]}))),t}restoreData(e){e.segments&&(this._segments=e.segments.map(((e,t)=>new l(this,t,e.bars)))),this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value()}onData(e){super.onData(e);if(!this.pointsProperty().childs().points.child("0"))for(let e=0;e<this._points.length;e++)this._createPointProperty(e);this._currentInterval!==this._model.mainSeries().interval()&&(this._regenerate(),this._currentInterval=this._model.mainSeries().interval())}cloneData(e){this._segments=e._segments.map((e=>e.clone(this)))}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._preparePixelSegments()}move(e,t,i,r){super.move(e,t,i,r),this._restoreSegmentsFromPixels()}endMoving(e,t){return this._segmentsPixelsWhileMoving=null,super.endMoving(e,t)}static createProperties(e){const t=new r.DefaultProperty("linetoolghostfeed",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,743836))).GhostFeedDefinitionsViewModel}_handleRestoringFactoryDefaults(){const e=Math.round(this._calculateATR());this.properties().childs().averageHL.setValue(e)}_regenerate(){this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value(),this._segments.forEach((e=>e.generate())),this.updateAllViews((0,a.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_calculateATR(){const e=this._model.mainSeries(),t=[];e.bars().each(((e,i)=>{const r=i[2],s=i[3];return null!=r&&null!=s&&t.push(r-s),!1}));let i=0===t.length?0:t.reduce(((e,t)=>e+t),0)/t.length;return i*=e.base(),i}_preparePixelSegments(){var e,t;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===r||i.isEmpty()||!i.isLog())return;const s=this.points();this._segmentsPixelsWhileMoving=this._segments.map(((e,t)=>{
const n=s[t].price,o=s[t+1].price,l=i.priceToCoordinate(n,r),a=(i.priceToCoordinate(o,r)-l)/(e.bars().length-1);return{bars:e.bars().map(((e,t)=>{const s=l+t*a,n=i.coordinateToPrice(s,r);return{open:i.priceToCoordinate(n+e.o,r)-s,high:i.priceToCoordinate(n+e.h,r)-s,low:i.priceToCoordinate(n+e.l,r)-s,close:i.priceToCoordinate(n+e.c,r)-s}}))}}))}_restoreSegmentsFromPixels(){var e,t;const i=this.priceScale(),r=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===r||null===this._segmentsPixelsWhileMoving)return;const s=this.points();this._segmentsPixelsWhileMoving.forEach(((e,t)=>{const n=this._segments[t],o=s[t].price,l=s[t+1].price,a=i.priceToCoordinate(o,r),c=(i.priceToCoordinate(l,r)-a)/(e.bars.length-1),h=n.bars().map(((t,s)=>{const n=e.bars[s],o=a+s*c,l=i.coordinateToPrice(o,r);return{...t,o:i.coordinateToPrice(n.open+o,r)-l,h:i.coordinateToPrice(n.high+o,r)-l,l:i.coordinateToPrice(n.low+o,r)-l,c:i.coordinateToPrice(n.close+o,r)-l}}));n.setBars(h)}))}}},336471:(e,t,i)=>{i.d(t,{LineToolHeadAndShoulders:()=>o});var r=i(853965),s=i(821979),n=i(31712);class o extends s.LineDataSource{constructor(e,t,r,s){const n=t||o.createProperties();super(e,n,r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,726360)).then((t=>{this._setPaneViews([new t.LineToolHeadAndShouldersPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Head and Shoulders"}static createProperties(e){const t=new r.DefaultProperty("linetoolheadandshoulders",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,63124)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new n.LineToolColorsProperty([e.childs().textcolor]))}}},680330:(e,t,i)=>{i.d(t,{LineToolHighlighter:()=>n});var r=i(853965),s=i(168504);class n extends s.LineToolBrushBase{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Highlighter"}static createProperties(e){const t=new r.DefaultProperty("linetoolhighlighter",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,48462)).then((e=>e.HighlighterDefinitionsViewModel))}_loadPaneViews(e){Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,898471)).then((t=>{this._setPaneViews([new t.HighlighterPaneView(this,e)])}))}}},682912:(e,t,i)=>{i.d(t,{LineToolHorzLinePriceAxisView:()=>n});var r=i(229765),s=i(246733);class n extends r.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1;const r=this._source.points(),n=this._source.priceScale();if(0===r.length||null===n||n.isEmpty())return;const o=r[0];if(!isFinite(o.price))return
;const l=this._source.ownerSource(),a=null!==l?l.firstValue():null;if(null===a)return;const c=(0,s.resetTransparency)(this._source.properties().linecolor.value());i.background=c,i.textColor=this.generateTextColor(c),i.coordinate=n.priceToCoordinate(o.price,a),e.text=n.formatPrice(o.price,a),e.visible=!0}}},994761:(e,t,i)=>{i.d(t,{LineToolHorzLine:()=>a});var r=i(354950),s=i.n(r),n=i(853965),o=i(821979),l=i(682912);class a extends o.LineDataSource{constructor(e,t,r,s){super(e,t||a.createProperties(),r,s),this._priceAxisView=new l.LineToolHorzLinePriceAxisView(this),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,254896)).then((({HorzLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}state(e){const t=super.state(e);return t.points&&0!==t.points.length&&(t.points[0].offset=0),t}pointsCount(){return 1}name(){return"Horizontal Line"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}timeAxisViews(){return null}timeAxisPoints(){return[]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}denormalizeTimePoints(){this._points=[],this._timePoint.length>0&&this._points.push({price:this._timePoint[0].price,index:0})}clearData(){const e=this._points;super.clearData(),this._points=e}static createProperties(e){const t=new n.DefaultProperty("linetoolhorzline",e);return this._configureProperties(t),t}_getAlertPlots(){return[this.points()[0].price]}_pointsForPointset(){return[]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,51646)).then((e=>e.HorizontalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(s())("")),e.addExclusion("text")}}},867716:(e,t,i)=>{i.d(t,{LineToolHorzRay:()=>a});var r=i(853965),s=i(354950),n=i.n(s),o=i(682912),l=i(821979);class a extends l.LineDataSource{constructor(e,t,r,s){super(e,null!=t?t:a.createProperties(),r,s),this._priceAxisView=new o.LineToolHorzLinePriceAxisView(this),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,658622)).then((({HorzRayPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Horizontal Ray"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}canHasAlert(){return!0}static createProperties(e){
const t=new r.DefaultProperty("linetoolhorzray",e);return this._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index+1,price:e.price},i=this._linePointsToAlertPlot([e,t],null,!1,!0);return null!==i?[i]:[]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,852440))).HorizontalRayDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(n())("")),e.addExclusion("text")}}},7295:(e,t,i)=>{i.d(t,{LineToolIcon:()=>l});var r=i(853965),s=i(31712),n=i(760184);const o=(0,i(201089).getLogger)("Chart.LineToolIcon");class l extends n.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t||l.createProperties(),i,r),this.version=1,this._loadViews()}name(){return"Icon"}applyTemplate(e){delete e.icon,super.applyTemplate(e)}static createProperties(e){const t=new r.DefaultProperty("linetoolicon",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,681791)).then((e=>e.IconsDefinitionsViewModel))}async _loadViews(){const[{getSvgContentForCharCode:e,getSvgRenderer:t},{IconPaneView:r},{svgRenderer:s}]=await Promise.all([i.e(27987).then(i.bind(i,728996)),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,23728)),i.e(72616).then(i.bind(i,500477))]);if(!this._isDestroyed){const i=this._properties.childs().icon.value();this._svgContent=e(i),this._onIconChanged.fire();const n=t(s,i);null===n&&o.logWarn(`Couldn't create svg renderer for icon ${i}`),this._setPaneViews([new r(this,this._model,n)])}}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new s.LineToolColorsProperty([e.childs().color]))}}},953639:(e,t,i)=>{i.d(t,{createIdeaLineToolByUrl:()=>p,isIdeaAuthorProfileImageUrl:()=>d,isIdeaUrl:()=>h});var r=i(650151),s=i(62802),n=i(66974),o=i(541558),l=i(461794),a=i(900569);const c=/^\/chart\/.+?\/([0-9a-zA-Z]{8})(-[-\w]+)?\/?$/;function h(e){try{const t=new URL(e);return((e=>"https:"===e.protocol&&e.hostname.endsWith(".tradingview.com"))(t)||(e=>!(0,n.isProd)()&&e.hostname.endsWith(window.location.hostname))(t))&&c.test(t.pathname)}catch(e){return!1}}function d(e){if(e.startsWith("data:image/svg+xml,"))return!0;try{const t=new URL(e),i=new URL(window.AWS_S3_CDN);return t.protocol===i.protocol&&t.hostname===i.hostname&&t.pathname.includes("/userpics/")}catch(e){return!1}}async function u(e){const t=new URL(`/api/v1/ideas/${i=e,(0,r.ensureNotNull)(c.exec(new URL(i).pathname))[1]}/`,location.href);var i;return fetch(t.toString()).then((e=>{if(!e.ok)throw new Error(`Error processing idea: ${e.statusText}`);return e.json()}))}function p(e,t,i=!1){return u(e).then((e=>{const n=function(e,t){var i;const s=(0,r.ensureDefined)(e.user);let n
;s.avatars&&d(s.avatars.small)&&(n=s.avatars.small.startsWith("data:image/svg+xml,")?s.avatars.small:`${s.avatars.small.replace(window.AWS_S3_CDN,"")}?resetCache=true`);const o={avatarUrl:n,badges:null===(i=s.badges)||void 0===i?void 0:i.map((e=>e.name)),username:s.username};return{createdAt:e.created_timestamp,direction:e.direction,name:(0,l.clean)(e.name,!0),author:o,uuid:e.uuid}}(e),c={price:0,time_t:n.createdAt,offset:0},h=t.mainSeries(),u=(0,r.ensureNotNull)(t.model().paneForSource(h)),p=u.newLineToolZOrder(!0),_={type:"drawing",source:{id:(0,o.randomHashN)(6),zorder:p,type:"LineToolIdea",position:50,state:{interval:"1",...a.LineToolIdea.createProperties().state()},ideaData:n,symbol:h.symbol(),ownerSource:h.id(),points:[c]},geometry:[],modelId:t.model().id()},g=t.pasteLineTool(u,_,!0,!0);return i&&s.setValue("hint.pasteIdea",!0,{forceFlush:!0}),g.pointAdded().subscribe(null,(()=>t.scrollToLineTool(g)),!0),g}))}},900569:(e,t,i)=>{i.d(t,{LineToolIdea:()=>S});var r=i(853965),s=i(821979),n=i(444372),o=i(62802),l=i(345848),a=i(201089),c=i(167222),h=i(846778),d=i(270294),u=i(885482),p=i(543373),_=i(953639);const g=(0,a.getLogger)("Chart.IdeaDialog"),f=n.t(null,void 0,i(241246)),P=n.t(null,void 0,i(467466));let v=null;function m(e){"LineToolIdea"===e?(window.is_authenticated||(0,u.resetToCursor)(!0),(0,c.runOrSigninWithFeature)((()=>{u.tool.setValue("LineToolIdea"),v=(0,p.showCustomUrlEventDialog)({onConfirm:y,onClose:()=>{v=null,"LineToolIdea"===u.tool.value()&&(0,u.resetToCursor)(!0)},title:f,placeholderText:P}),(0,l.trackEvent)("Idea","Open idea dialog")}),{feature:"drawings",source:"Change drawing tool state"})):null!==v&&v.then((e=>e()))}function y(e){const t=(0,d.chartWidgetCollectionService)();if(null===t)return;if(!(0,_.isIdeaUrl)(e))return void g.logWarn(`Invalid idea url: ${e}`);const i=!Boolean(o.getBool("hint.pasteIdea")),r=t.activeChartWidget.value();(0,_.createIdeaLineToolByUrl)(e,r.model()).then((()=>{i&&(0,h.showPasteLineToolHint)(t.getContainer(),"hint.pasteIdea")}))}var C=i(354950),x=i.n(C),w=i(70726);class b extends w.CustomEventItem{constructor(e,t){super(t),this._data=e}ideaData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){var e;return null===(e=this._data.author)||void 0===e?void 0:e.avatarUrl}}class S extends w.LineToolCustomUrlEvent{constructor(e,t,r,s){super(e,t||S.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,320593)).then((t=>{this._setPaneViews([new t.IdeaPaneView(this,e)])}))}name(){return"Idea"}state(e){const t=super.state(e);return this._item&&(t.ideaData=this._item.ideaData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){e.ideaData&&(this._item=new b(e.ideaData,this)),void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){const t=new r.DefaultProperty("linetoolIdea",e);return this._configureProperties(t),t.hasChild("position")||t.addChild("position",new(x())(50)),t.addExclusion("position"),t}
_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,325232)).then((e=>e.IdeaDefinitionsViewModel))}static _configureProperties(e){s.LineDataSource._configureProperties(e)}}(0,u.runOnDrawingStateReady)((()=>{u.tool.subscribe(m)}))},923237:(e,t,i)=>{i.d(t,{commonLineToolPropertiesStateKeys:()=>r});const r=["symbolStateVersion","zOrderVersion","frozen","title","symbolInfo","interval","symbol","currencyId","unitId","visible"]},17329:(e,t,i)=>{i.d(t,{LineToolImage:()=>S,buildAbsoluteUserImageUrl:()=>b});var r=i(650151),s=i(86441),n=i(201089),o=i(853965),l=i(354950),a=i.n(l),c=i(821979),h=i(964824),d=i(62802),u=i(345848),p=i(167222),_=i(846778),g=i(270294),f=i(885482);async function P(e,t){return async function(e){return(await Promise.all([i.e(22666),i.e(62253),i.e(92108),i.e(9817),i.e(92191),i.e(38669),i.e(5145),i.e(76592),i.e(25190),i.e(24215),i.e(22333),i.e(14127),i.e(95569),i.e(50690),i.e(67209),i.e(745),i.e(77038)]).then(i.bind(i,595470))).renderImageDialog(e)}({onConfirm:e,onClose:t})}let v=null;function m(e){if("LineToolImage"!==e)return null==v||v.then((e=>e())),void(v=null);window.is_authenticated||(0,f.resetToCursor)(!0),(0,p.runOrSigninWithFeature)((()=>{f.tool.setValue("LineToolImage"),v=P(y,(()=>{null==v||v.then((e=>e())),v=null,"LineToolImage"===f.tool.value()&&(0,f.resetToCursor)(!0)})),(0,u.trackEvent)("Image","Open image dialog")}),{feature:"drawings",source:"Change drawing tool state"})}function y(e){const t=(0,g.chartWidgetCollectionService)();if(null===t)return;const i=!Boolean(d.getBool("hint.pasteImage")),s=t.activeChartWidget.value();s.model().pasteImageAsLineTool(e.url,e.blobUrl,(0,r.ensureNotNull)(s.model().model().paneForSource(s.model().mainSeries())),e.transparency),i&&(0,_.showPasteLineToolHint)(t.getContainer(),"hint.pasteImage")}const C=(0,n.getLogger)("Chart.LineToolImage");function x(e){return e.toLowerCase().startsWith("blob:")}const w=window.AWS_BBS3_DOMAIN;function b(e){if(x(e))return e;const t=new URL(e,w),i=new URL(t.pathname,w);if("/"===i.pathname)return null;const r=i.toString();return t.toString()!==r?null:r}class S extends c.LineDataSource{constructor(e,t,r,s){var n;super(e,t||S.createProperties(),r,s),this._image=null,this._originPoint=4;const o=this.properties().childs().url;this._absoluteUserImageUrl=new(a())(null!==(n=b(this.properties().childs().url.value()))&&void 0!==n?n:""),this._absoluteUserImageUrl.subscribe(this,(e=>{const t=e.value();if(x(t))return;const i=b(t);null!==i&&o.setValue(new URL(i).pathname)})),o.subscribe(this,(()=>{const e=b(o.value());null!==e&&this._absoluteUserImageUrl.setValue(e)})),this._loadImage(),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,102380)).then((({ImagePaneView:t})=>{this._setPaneViews([new t(this,e)])})),this.properties().childs().url.subscribe(this,(()=>{this._loadImage()}))}absoluteUserImageUrl(){return this._absoluteUserImageUrl}cssWidth(){return this.properties().childs().cssWidth.value()}cssHeight(){return this.properties().childs().cssHeight.value()
}angle(){return this.properties().childs().angle.value()}originPoint(){return this._originPoint}dOffsetX(){return this._dOffsetX||0}pointsCount(){return 1}name(){return"Image"}image(){return this._image}setBlobImageUrl(e){this._image||(this._createImage(e),this._blobUrl=e)}getChangePointForSync(e){return null}hasEditableCoordinates(){return!1}pointToScreenPoint({index:e,price:t},i=0){const n=this._model.timeScale(),o=(0,r.ensureNotNull)(this.priceScale()),l=(0,r.ensureNotNull)((0,r.ensureNotNull)(this.ownerSource()).firstValue()),a=n.indexToCoordinate(e)+i,c=o.priceToCoordinate(t,l);return new s.Point(a,c)}setPoint(e,t,i){if(null===this._image)return;const{width:s,height:n}=this._image,o=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0],this.dOffsetX())),a=Math.max(Math.abs(l.x-o.x)/s,Math.abs(l.y-o.y)/n),c=Math.round(s*a),h=Math.round(n*a),d=this.properties().childs();d.cssWidth.setValue(c),d.cssHeight.setValue(h),this.propertiesChanged()}startChanging(e,t){super.startChanging(e,t),this._changeOriginPoint(S._oppositePoints[e])}endChanging(e,t){return this._changeOriginPoint(4),super.endChanging(e,t)}getPoint(){return null}syncLineStyleState(){const e=super.syncLineStyleState();return!e.url&&this._blobUrl&&(e.blobUrl=this._blobUrl),e}restoreExternalState(e){const{blobUrl:t,...i}=e;t&&this.setBlobImageUrl(t),super.restoreExternalState(i)}isSavedInChart(){return super.isSavedInChart()&&""!==this.absoluteUserImageUrl().value()}static createProperties(e){const t=new o.DefaultProperty("linetoolimage",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,69487))).ImageDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("url")||e.addChild("url",new(a())("")),e.addExclusion("url"),e.addExclusion("cssWidth"),e.addExclusion("cssHeight"),e.addExclusion("angle")}_loadImage(){const e=this.properties(),t=(0,r.ensureDefined)(e.child("url")).value();t&&this._createImage(t)}_changeOriginPoint(e){const t=this.originPoint(),i=4===t?S._correctOriginDirections[e]:S._correctOriginDirections[S._oppositePoints[t]],n=this.properties().childs().cssWidth.value()/2,o=this.properties().childs().cssHeight.value()/2,[l]=this._points,a=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),c=new s.Point(a.x+n*i[0],a.y+o*i[1]),h=(0,r.ensureNotNull)(this.screenPointToPoint(c));this._dOffsetX=4===t?c.x-(0,r.ensureNotNull)(this.pointToScreenPoint(h)).x:void 0,l.index=h.index,l.price=h.price,this._originPoint=e}_createImage(e){var t;const i=x(e),s=b(e);if(null===s)return void C.logWarn(`Invalid image URL: ${e}`);if(s===(null===(t=this._image)||void 0===t?void 0:t.src))return;const n=document.createElement("img");n.crossOrigin="anonymous",n.src=s,n.addEventListener("load",(()=>{this._image=n;const e=this._model,t=this.properties().childs();if(!i){const e=new URL(s).pathname;t.url.setValue(e),this._blobUrl=void 0}
if(t.cssWidth.value()&&t.cssHeight.value())return void this._model.updateSource(this);const o=e.timeScale().width()/4,l=(0,r.ensureNotNull)(this.priceScale()).height()/4,a=n.naturalWidth,c=n.naturalHeight,d=Math.min(1,o/a),u=Math.min(1,l/c),p=Math.min(d,u),_=Math.round(p*a),g=Math.round(p*c);t.cssWidth.setValue(_),t.cssHeight.setValue(g),this.updateAllViews((0,h.sourceChangeEvent)(this.id())),this._model.updateSource(this)})),n.addEventListener("error",(()=>{this.model().removeSource(this)}))}}S._correctOriginDirections=[[-1,-1],[1,-1],[-1,1],[1,1],[0,0]],S._oppositePoints=[3,2,1,0,4],(0,f.runOnDrawingStateReady)((()=>{f.tool.subscribe(m)}))},933513:(e,t,i)=>{i.d(t,{LineToolInfoLine:()=>s});var r=i(956268);class s extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,t||s.createProperties(),i,r)}pointsCount(){return 2}name(){return"Info Line"}static createProperties(e){const t=r.LineToolTrendLine.createProperties(e,"linetoolinfoline");return s._configureProperties(t),t}}},478760:(e,t,i)=>{var r=i(517336).LevelsProperty,s=i(9093).LineToolPitchfork;class n extends s{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r)}name(){return"Inside Pitchfork"}static createProperties(e){var t=new r("linetoolinsidepitchfork",e,!1,{range:[0,8]});return this._configureProperties(t),t}}t.LineToolInsidePitchfork=n},616117:(e,t,i)=>{var r;i.d(t,{isImageToolName:()=>d,isLineDrawnWithPressedButton:()=>a,isLineToolDrawWithoutPoints:()=>h,isLineToolFinishRequiredWhenCreatedByApi:()=>c,isLineToolName:()=>l,isStudyLineToolName:()=>o,isTextToolName:()=>u});var s=i(968361);const n=new Set(["LineStudyMtpAnalysis","LineStudyMtpDecisionPoint","LineStudyMtpRiskReward","LineStudyMtpElliotWaveMain","LineStudyMtpElliotWaveMajor","LineStudyMtpElliotWaveMinor","LineStudyMtpDownWave1OrA","LineStudyMtpDownWave2OrB","LineStudyMtpDownWave3","LineStudyMtpDownWave4","LineStudyMtpDownWave5","LineStudyMtpDownWaveC","LineStudyMtpUpWave1OrA","LineStudyMtpUpWave2OrB","LineStudyMtpUpWave3","LineStudyMtpUpWave4","LineStudyMtpUpWave5","LineStudyMtpUpWaveC"]);function o(e){let t="LineToolRegressionTrend"===e||"LineToolVbPFixed"===e||"LineToolFixedRangeVolumeProfile"===e||"LineToolAnchoredVolumeProfile"===e||"LineToolAnchoredVWAP"===e;return t||(t=function(e){return n.has(e)}(e)),t}function l(e){return e in(r||(r=i.t(s,2)))||o(e)}function a(e){return"LineToolBrush"===e||"LineToolHighlighter"===e}function c(e){return a(e)||"LineToolPath"===e||"LineToolPolyline"===e||"LineToolGhostFeed"===e}function h(e){return"LineToolTweet"===e||"LineToolIdea"===e||"LineToolImage"===e}function d(e){return"LineToolImage"===e}function u(e){switch(e){case"LineToolBalloon":case"LineToolComment":case"LineToolText":case"LineToolTextAbsolute":case"LineToolCallout":case"LineToolNote":case"LineToolNoteAbsolute":case"LineToolSignpost":return!0}return!1}},68626:(e,t,i)=>{i.d(t,{LineDataSourcePointIndexProperty:()=>n});var r=i(354950),s=i.n(r);class n extends(s()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){
return this._lineSource.points()[this._pointIndex].index}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.index=e,this._lineSource.startChanging(this._pointIndex,t),this._setPointImpl(t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}_setPointImpl(e){this._lineSource.setPoint(this._pointIndex,e)}}},517067:(e,t,i)=>{i.d(t,{LineDataSourcePointPriceProperty:()=>o});var r=i(650151),s=i(354950),n=i.n(s);class o extends(n()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t,e.pointAdded().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this)})),e.pointChanged().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this)}))}value(){const e=this._lineSource.points()[this._pointIndex].price,t=(0,r.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),r=t.parse(i);return r.res?r.value:e}return e}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.price=parseFloat(""+e),this._lineSource.startChanging(this._pointIndex,t),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}}},404720:(e,t,i)=>{i.d(t,{LineDataSourceThemedProperty:()=>s});var r=i(738232);class s extends r.ThemedDefaultProperty{template(){return(0,r.extractState)(this.state(),this._allDefaultsKeys)}}},902214:(e,t,i)=>{i.d(t,{LineDataSourceTimeAxisView:()=>s});var r=i(161164);class s extends r.TimeAxisView{constructor(e,t){super(e.model()),this._active=!1,this._source=e,this._pointIndex=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_getIndex(){if(!this._model.selection().isSelected(this._source))return null;const e=this._source.timeAxisPoints();return e.length<=this._pointIndex?null:e[this._pointIndex].index}_isVisible(){return!0}}},776954:(e,t,i)=>{i.d(t,{LineToolWithRelativePriceCoordinate:()=>l});var r=i(650151),s=i(821979),n=i(77338),o=i(885482);class l extends s.LineDataSource{constructor(){super(...arguments),this._startMovingAnchorY=NaN}priceSource(){return this.ownerSource()}addPoint(e,t,i){return super.addPoint(this._updatePositionAndCorrectPoint(e),t,i)}setPoint(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!this.isPhantom()&&!this._allowChangeAnchorHorizontally()),i),this._syncPosition()}setPointAndChangeIndex(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!1),i),this._syncPosition()}startMoving(e,t,i,s){s||(this._startMovingAnchorY=(0,r.ensureNotNull)(this._anchorYCoordinate())),super.startMoving(e,t,i)}move(e,t,i,s){var n;const o=(0,r.ensureDefined)((0,r.ensureNotNull)(this.startMovingPoint()).logical),l=(0,
r.ensureDefined)(e.logical);if(!s&&0===t){const e=this._points[0],t=l.index-o.index,i=(0,r.ensureNotNull)(this.priceScale()),s=(0,r.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),a=i.priceToCoordinate(l.price,s)-i.priceToCoordinate(o.price,s),c=this._startMovingAnchorY+a,h=i.coordinateToPrice(c,s);this._updatePositionAndCorrectPoint({index:e.index+t,price:h})}super.move(e,t,i),s||this._syncPosition()}_allowChangeAnchorHorizontally(){return!1}_updatePositionAndCorrectPoint(e,t){t&&(e.index=this._points[0].index);const i=this.priceSource();if(null===i)return e;const r=i.priceScale(),s=i.firstValue();if(null===r||r.isEmpty()||null===s)return e;const o=r.height();let l=o/2,a=e.price>=r.coordinateToPrice(l,s)?1:-1;const c=this._model.mainSeries();if(i===c){const t=c.data().search(this._baseSeriesIndexForPoint(e));if(null!==t){const i=(0,n.seriesPrice)(c,t,-1),o=(0,n.seriesPrice)(c,t,1);a=e.price>=i?1:-1,l=r.priceToCoordinate(1===a?o:i,s),e.price=1===a?Math.max(o,e.price):e.price}}const h=1===(-1===a!==r.isInverted()?-1:1)?l:o-l,d=r.priceToCoordinate(e.price,s),u=Math.min(o,Math.abs(d-l)),p=Math.max(0,Math.min(100,100*u/h))*a;return this.properties().childs().position.setValue(p),e}_baseSeriesIndexForPoint(e){return e.index}_syncPosition(){const e=this.linkKey().value();if(null!==e){const t={position:this.properties().childs().position.value()};(0,o.changeLineStyle)({linkKey:e,state:t,model:this._model})}}_anchorYCoordinate(){const e=this.priceSource();if(null===e)return null;const t=e.priceScale(),i=e.firstValue();if(null===t||t.isEmpty()||null===i)return null;const r=this._model.mainSeries(),s=this.customEvent();if(null===s)return null;let o=null;if(e===r&&(o=(0,n.seriesBasePosition)(r,s)),null===o&&(o=(0,n.noDataBasePosition)(s,t,i)),null===o)return null;const l=s.position(),a=t.priceToCoordinate(o.price,i);return(0,n.positionToCoordinate)(l,t.height(),a,(0,n.positionVisualDirection)(l,t.isInverted()))}}},619540:(e,t,i)=>{var r=i(821979).LineDataSource,s=i(354950),n=i(853965).DefaultProperty;class o extends r{constructor(e,t,r,s){super(e,t||o.createProperties(),r,s),this.version=o.version,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,6360)).then((({NotePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Note"}getTooltipWidth(){return o.TOOLTIP_WIDTH}getTooltipPadding(){return o.TOOLTIP_PADDING}getTooltipLineSpacing(){return o.TOOLTIP_LINESPACING}template(){var e=super.template();return e.text=this.properties().childs().text.value(),e}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static createProperties(e){void 0!==e&&void 0!==e.markerColor&&void 0===e.borderColor&&(e.borderColor=e.markerColor);var t=new n("linetoolnote",e);return this._configureProperties(t),t}state(e){var t=super.state(e);return e&&(t.state.fixedSize=!1),t}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,193397))).NoteDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new s(i.tf(null,void 0,i(37229)))),e.addExclusion("text")}}o.TOOLTIP_WIDTH=300,o.TOOLTIP_PADDING=10,o.TOOLTIP_LINESPACING=5,o.version=1;class l extends o{constructor(e,t){super(e,t||l.createProperties())}title(){return i.tf(null,void 0,i(366828))}name(){return"Anchored Note"}isFixed(){return!0}hasEditableCoordinates(){return!1}static createProperties(e){var t=new n("linetoolnoteabsolute",e);return this._configureProperties(t),t}}t.LineToolNote=o,t.LineToolNoteAbsolute=l},778737:(e,t,i)=>{var r=i(477227).LineToolTrading,s=i(837202).LineToolPriceAxisView,n=i(586784),o=i(821979).LineDataSource,l=i(853965).DefaultProperty;const a=i(244842);var c=i(888929).sortSourcesPreOrdered.LineToolOrder;function h(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"order",quantityText:"0"},this._editable=!0,this._cancellable=!0,this._mode="",this._direction="buy",this._active=!0}setMode(e){return this._mode=e,this._line.updateAllViewsAndRedraw(),this}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setActive(e){return this._active=e,this._line.updateAllViewsAndRedraw(),this}setEditable(e){return this._editable=e,this._line.updateAllViewsAndRedraw(),this}getEditable(){return this._editable}setCancellable(e){return this._cancellable=e,this._line.updateAllViewsAndRedraw(),this}getCancellable(){return this._cancellable}hasMoveCallback(){return this.isFunction(this._onMoveCallback)}hasModifyCallback(){return this.isFunction(this._onModifyCallback)}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line._points[0]=t,this._line.normalizePoints(),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(h(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setModifyTooltip(e){return this._line.properties().modifyTooltip.setValue(h(e)),this}getModifyTooltip(){return this._line.properties().modifyTooltip.value()}setCancelTooltip(e){return this._line.properties().cancelTooltip.setValue(h(e)),this}getCancelTooltip(){return this._line.properties().cancelTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){
return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}getLineColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.lineActiveBuyColor.value():e.lineInactiveBuyColor.value():this._active?e.lineActiveSellColor.value():e.lineInactiveSellColor.value()}setLineColor(e){return"buy"===this._direction?this._active?this.setLineActiveBuyColor(e):this.setLineInactiveBuyColor(e):this._active?this.setLineActiveSellColor(e):this.setLineInactiveSellColor(e),this}setLineActiveBuyColor(e){return this._line.properties().lineActiveBuyColor.setValue(e),this}setLineInactiveBuyColor(e){return this._line.properties().lineInactiveBuyColor.setValue(e),this}setLineActiveSellColor(e){return this._line.properties().lineActiveSellColor.setValue(e),this}setLineInactiveSellColor(e){return this._line.properties().lineInactiveSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.bodyBorderActiveBuyColor.value():e.bodyBorderInactiveBuyColor.value():this._active?e.bodyBorderActiveSellColor.value():e.bodyBorderInactiveSellColor.value()}setBodyBorderColor(e){return"buy"===this._direction?this._active?this.setBodyBorderActiveBuyColor(e):this.setBodyBorderInactiveBuyColor(e):this._active?this.setBodyBorderActiveSellColor(e):this.setBodyBorderInactiveSellColor(e),this}setBodyBorderActiveBuyColor(e){return this._line.properties().bodyBorderActiveBuyColor.setValue(e),this}setBodyBorderInactiveBuyColor(e){return this._line.properties().bodyBorderInactiveBuyColor.setValue(e),this}setBodyBorderActiveSellColor(e){return this._line.properties().bodyBorderActiveSellColor.setValue(e),this}setBodyBorderInactiveSellColor(e){return this._line.properties().bodyBorderInactiveSellColor.setValue(e),this}getBodyBackgroundColor(){return n.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties()
;return"limit"===this._mode?this._active?e.bodyTextActiveLimitColor.value():e.bodyTextInactiveLimitColor.value():"stop"===this._mode?this._active?e.bodyTextActiveStopColor.value():e.bodyTextInactiveStopColor.value():"buy"===this._direction?this._active?e.bodyTextActiveBuyColor.value():e.bodyTextInactiveBuyColor.value():this._active?e.bodyTextActiveSellColor.value():e.bodyTextInactiveSellColor.value()}setBodyTextColor(e){return"limit"===this._mode?this._active?this.setBodyTextActiveLimitColor(e):this.setBodyTextInactiveLimitColor(e):"stop"===this._mode?this._active?this.setBodyTextActiveStopColor(e):this.setBodyTextInactiveStopColor(e):"buy"===this._direction?this._active?this.setBodyTextActiveBuyColor(e):this.setBodyTextInactiveBuyColor(e):this._active?this.setBodyTextActiveSellColor(e):this.setBodyTextInactiveSellColor(e),this}setBodyTextInactiveLimitColor(e){return this._line.properties().bodyTextInactiveLimitColor.setValue(e),this}setBodyTextActiveLimitColor(e){return this._line.properties().bodyTextActiveLimitColor.setValue(e),this}setBodyTextInactiveStopColor(e){return this._line.properties().bodyTextInactiveStopColor.setValue(e),this}setBodyTextActiveStopColor(e){return this._line.properties().bodyTextActiveStopColor.setValue(e),this}setBodyTextInactiveBuyColor(e){return this._line.properties().bodyTextInactiveBuyColor.setValue(e),this}setBodyTextActiveBuyColor(e){return this._line.properties().bodyTextActiveBuyColor.setValue(e),this}setBodyTextInactiveSellColor(e){return this._line.properties().bodyTextInactiveSellColor.setValue(e),this}setBodyTextActiveSellColor(e){return this._line.properties().bodyTextActiveSellColor.setValue(e),this}getBodyFont(){return n.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return n.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBorderActiveBuyColor.value():e.quantityBorderInactiveBuyColor.value():this._active?e.quantityBorderActiveSellColor.value():e.quantityBorderInactiveSellColor.value()}setQuantityBorderColor(e){return"buy"===this._direction?this._active?this.setQuantityBorderActiveBuyColor(e):this.setQuantityBorderInactiveBuyColor(e):this._active?this.setQuantityBorderActiveSellColor(e):this.setQuantityBorderInactiveSellColor(e),this}setQuantityBorderActiveBuyColor(e){return this._line.properties().quantityBorderActiveBuyColor.setValue(e),this}setQuantityBorderInactiveBuyColor(e){return this._line.properties().quantityBorderInactiveBuyColor.setValue(e),this}setQuantityBorderActiveSellColor(e){return this._line.properties().quantityBorderActiveSellColor.setValue(e),this}setQuantityBorderInactiveSellColor(e){return this._line.properties().quantityBorderInactiveSellColor.setValue(e),this}
getQuantityBackgroundColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBackgroundActiveBuyColor.value():e.quantityBackgroundInactiveBuyColor.value():this._active?e.quantityBackgroundActiveSellColor.value():e.quantityBackgroundInactiveSellColor.value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this._active?this.setQuantityBackgroundActiveBuyColor(e):this.setQuantityBackgroundInactiveBuyColor(e):this._active?this.setQuantityBackgroundActiveSellColor(e):this.setQuantityBackgroundInactiveSellColor(e),this}setQuantityBackgroundActiveBuyColor(e){return this._line.properties().quantityBackgroundActiveBuyColor.setValue(e),this}setQuantityBackgroundInactiveBuyColor(e){return this._line.properties().quantityBackgroundInactiveBuyColor.setValue(e),this}setQuantityBackgroundActiveSellColor(e){return this._line.properties().quantityBackgroundActiveSellColor.setValue(e),this}setQuantityBackgroundInactiveSellColor(e){return this._line.properties().quantityBackgroundInactiveSellColor.setValue(e),this}getQuantityTextColor(){return n.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return n.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return n.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return n.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getCancelButtonBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonBorderActiveBuyColor.value():e.cancelButtonBorderInactiveBuyColor.value():this._active?e.cancelButtonBorderActiveSellColor.value():e.cancelButtonBorderInactiveSellColor.value()}setCancelButtonBorderColor(e){return"buy"===this._direction?this._active?this.setCancelButtonBorderActiveBuyColor(e):this.setCancelButtonBorderInactiveBuyColor(e):this._active?this.setCancelButtonBorderActiveSellColor(e):this.setCancelButtonBorderInactiveSellColor(e),this}setCancelButtonBorderActiveBuyColor(e){return this._line.properties().cancelButtonBorderActiveBuyColor.setValue(e),this}setCancelButtonBorderInactiveBuyColor(e){return this._line.properties().cancelButtonBorderInactiveBuyColor.setValue(e),this}setCancelButtonBorderActiveSellColor(e){return this._line.properties().cancelButtonBorderActiveSellColor.setValue(e),this}setCancelButtonBorderInactiveSellColor(e){return this._line.properties().cancelButtonBorderInactiveSellColor.setValue(e),this}getCancelButtonBackgroundColor(){return n.getColorFromProperties(this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency)}setCancelButtonBackgroundColor(e){
return n.setColorToProperties(e,this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency),this}getCancelButtonIconColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonIconActiveBuyColor.value():e.cancelButtonIconInactiveBuyColor.value():this._active?e.cancelButtonIconActiveSellColor.value():e.cancelButtonIconInactiveSellColor.value()}setCancelButtonIconColor(e){return"buy"===this._direction?this._active?this.setCancelButtonIconActiveBuyColor(e):this.setCancelButtonIconInactiveBuyColor(e):this._active?this.setCancelButtonIconActiveSellColor(e):this.setCancelButtonIconInactiveSellColor(e),this}setCancelButtonIconActiveBuyColor(e){return this._line.properties().cancelButtonIconActiveBuyColor.setValue(e),this}setCancelButtonIconInactiveBuyColor(e){return this._line.properties().cancelButtonIconInactiveBuyColor.setValue(e),this}setCancelButtonIconActiveSellColor(e){return this._line.properties().cancelButtonIconActiveSellColor.setValue(e),this}setCancelButtonIconInactiveSellColor(e){return this._line.properties().cancelButtonIconInactiveSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}getBlocked(){return this._blocked}isFunction(e){return"function"==typeof e}onCancel(e,t){return t?this.isFunction(t)&&(this._onCancelData=e,this._onCancelCallback=t):this.isFunction(e)&&(this._onCancelCallback=e),this}callOnCancel(){this.isFunction(this._onCancelCallback)&&this._onCancelCallback.call(this,this._onCancelData)}isOnCancelCallbackPresent(){return this.isFunction(this._onCancelCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onMove(e,t){return t?this.isFunction(t)&&(this._onMoveData=e,this._onMoveCallback=t):this.isFunction(e)&&(this._onMoveCallback=e),this}callOnMove(){this.isFunction(this._onMoveCallback)&&this._onMoveCallback.call(this,this._onMoveData)}onMoving(e,t){return t?this.isFunction(t)&&(this._onMovingData=e,this._onMovingCallback=t):this.isFunction(e)&&(this._onMovingCallback=e),this}callOnMoving(){this.isFunction(this._onMovingCallback)&&this._onMovingCallback.call(this,this._onMovingData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class u extends r{constructor(e,t){super(e,t||u.createProperties()),this._adapter=new d(this),this.setSelectionEnabled(!0),
Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,198918)).then((({OrderPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}zorder(){return c}isSpeciallyZOrderedSource(){return!0}setPoint(e,t,i){this._points[e]=t,this.normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}name(){return"Order"}move(e,t,i,r){var s=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.move(e,t,i,r),s&&this._adapter.callOnMoving()}endMoving(e){var t=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.endMoving(),!e&&t&&this._adapter.callOnMove()}createPriceAxisView(e){var t={pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()};return this._priceAxisView=new s(this,t),this._priceAxisView}paneViews(){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.priceAxisViews.call(this,e,t):null}adapter(){return this._adapter}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}movable(){return Boolean(this._adapter._onMoveCallback)}static createProperties(e){var t=new l("linetoolorder",e,!1,!1);return this._configureProperties(t),t}}t.LineToolOrder=u},247035:(e,t,i)=>{i.d(t,{LineToolParallelChannel:()=>u});var r=i(650151),s=i(86441),n=i(853965),o=i(885482),l=i(821979),a=i(389137),c=i(401580),h=i(354950),d=i.n(h);class u extends l.LineDataSource{constructor(e,t,r,s){super(e,t||u.createProperties(),r,s),this._alertCreationAvailable=new c.WatchedValue(super.alertCreationAvailable().value()&&this._isTimePointsValid()),this._priceAxisViews.push(this.createPriceAxisView(3)),this._coordOffsetWhileMovingOrChanging=null,this._pendingPriceOffset=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,570404)).then((({ParallelChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})),this._normalizedPointsChanged.subscribe(this,(()=>this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())))}alertCreationAvailable(){return this._alertCreationAvailable.readonly()}paneViews(e){return null!==this._pendingPriceOffset&&this._applyPendingPriceOffset(),super.paneViews(e)}setLastPoint(e,t){t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[0]);const i=(0,a.clone)(e);return super.setLastPoint(e),i}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endMoving(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endMoving(e,t,i)}startChanging(e,t){super.startChanging(e,t),
this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endChanging(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endChanging(e,t,i)}restoreExternalPoints(e,t,i){const r=i?e.points:this._timePoint.map(((t,i)=>({price:t.price,offset:e.points[i].offset,time_t:e.points[i].time_t})));if(super.restoreExternalPoints({...e,points:r},t),t.pricesChanged&&this._points.length===r.length)for(let e=0;e<r.length;e++)this._points[e].price=r[e].price}restorePoints(e,t,i){super.restorePoints(e,t,i),this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())}setPoint(e,t,i,s){var n;if(this._points[0].index===this._points[1].index&&e>=4)return;this._snapPointBeforeChange(e,t,i);const l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),c=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),h=(0,r.ensureNotNull)(this._coordOffsetWhileMovingOrChanging),d=(0,r.ensureNotNull)(this.priceScale()),u=(0,r.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue());switch(e){case 0:super.setPoint(e,t,i),this._points[2].price=d.coordinateToPrice(c.y+h,u);break;case 1:super.setPoint(e,t,i);break;case 2:super.setPoint(e,t,i),this._points[0].price=d.coordinateToPrice(c.y-h,u),this._points[0].index=t.index;break;case 3:this._points[1].price=d.coordinateToPrice(c.y-h,u),this._points[1].index=t.index;break;case 4:{const e=a.subtract(l),t=(c.x-l.x)/e.x,i=l.addScaled(e,t),r=c.y-i.y;this._points[2].price=d.coordinateToPrice(l.y+r,u);break}case 5:{const e=a.subtract(l),t=(c.x-l.x)/e.x,i=l.addScaled(e,t),r=c.y-i.y;this._points[0].price=d.coordinateToPrice(l.y+r,u),this._points[1].price=d.coordinateToPrice(a.y+r,u);break}}const p=this.linkKey().value();if(p&&!s&&e<4){const e=this._points.map((e=>e.price));(0,o.changeLineStyle)({model:this._model,linkKey:p,state:{prices:e}})}}state(e){const t=super.state(e);return this._pendingPriceOffset&&(t.priceOffset=this._pendingPriceOffset),t}restoreExternalState(e){const{prices:t,...i}=e;if(t&&this.isActualSymbol())for(let e=0;e<t.length;e++)this._points[e].price=this._timePoint[e].price=t[e];super.restoreExternalState(i)}restoreData(e){void 0!==e.priceOffset&&(this._pendingPriceOffset=e.priceOffset)}getPoint(e){if(e<3)return super.getPoint(e);const t=this.pointToScreenPoint(this._points[0]),i=this.pointToScreenPoint(this._points[1]),r=this.pointToScreenPoint(this._points[2]);if(!t||!i||!r)return null;switch(e){case 3:{const e=r.y-t.y,n=i.add(new s.Point(0,e));return this.screenPointToPoint(n)}case 4:{const e=r.y-t.y,n=i.add(new s.Point(0,e)),o=r.add(n).scaled(.5);return this.screenPointToPoint(o)}case 5:{const e=t.add(i).scaled(.5);return this.screenPointToPoint(e)}}return null}alignCrossHairToAnchor(e){return e<=3}pointsCount(){return 3}name(){return"Parallel Channel"}hasEditableCoordinates(){return!1}addPoint(e,t,i){const s=this.points().length;return t&&t.shift()&&2===s&&this._snapPoint45Degree(e,this.points()[0]),
2===this._points.length&&(e=this._convertLastPointTo3rdPoint((0,r.ensureNotNull)(this._lastPoint))),super.addPoint(e,t)}timeAxisPoints(){return this._axisPoints()}priceAxisPoints(){return this._axisPoints()}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e){const t=new n.DefaultProperty("linetoolparallelchannel",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,761649))).ParallelChannelDefinitionsViewModel}_applyTemplateImpl(e){var t;super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(null!==(t=e.labelText)&&void 0!==t?t:"")}_getAlertPlots(){const e=this.getPoint(3);if(!e)return[];const t=[this._points[0],this._points[1],this._points[2],e],i=(e,t)=>e.index<=t.index?[e,t]:[t,e],r=i(t[0],t[1]),s=i(t[2],t[3]);let n,o,l,a;t[2].price<t[0].price?(o=s,n=r):(o=r,n=s);const c=this.properties().childs().extendLeft.value(),h=this.properties().childs().extendRight.value();return t[0].index<=t[1].index?(l=c,a=h):(l=h,a=c),[this._linePointsToAlertPlot(n,"Upper",l,a),this._linePointsToAlertPlot(o,"Lower",l,a)].filter((e=>null!==e))}_correctLastPoint(e){if(this._points.length<2||this._points[1].index===this._points[0].index)return e;const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),n=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=i.subtract(n),l=(t.x-n.x)/o.x,a=n.addScaled(o,l),c=t.y-a.y,h=n.add(new s.Point(0,c));return(0,r.ensureNotNull)(this.screenPointToPoint(h))}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new(d())("")),e.addExclusion("labelText")}_isTimePointsValid(){return this._timePoint.every((e=>Number.isFinite(e.price)))}_axisPoints(){const e=this.points(),t=this._points[0]?this.pointToScreenPoint(this._points[0]):null,i=this._points[1]?this.pointToScreenPoint(this._points[1]):null,n=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(t&&i&&n){const o=i.y-t.y,l=n.add(new s.Point(0,o));e.push((0,r.ensureNotNull)(this.screenPointToPoint(l)))}return e}_convertLastPointTo3rdPoint(e){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),n=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=i.subtract(n),l=(t.x-n.x)/o.x,a=n.addScaled(o,l),c=t.y-a.y,h=n.add(new s.Point(0,c));return(0,r.ensureNotNull)(this.screenPointToPoint(h))}_findPixelsHeight(){const e=this.pointToScreenPoint(this._points[2]),t=this.pointToScreenPoint(this._points[0]);return e&&t?e.y-t.y:null}_applyPendingPriceOffset(){const e=this._pendingPriceOffset;if(null===e||this._points.length<3)return;const t=this.priceScale(),i=(0,r.ensureNotNull)(this.ownerSource()).firstValue();if(!t||t.isEmpty()||null===i)return
;const s=e+this._points[0].price,n=e+this._points[1].price,o=.5*(s+n)-e,l=.5*(s+n),a=t.priceToCoordinate(o,i),c=t.priceToCoordinate(l,i)-a,h=t.priceToCoordinate(this._points[0].price,i)+c,d=t.coordinateToPrice(h,i);this._points[2].price=d,this._timePoint[2].price=d,this._points[2].index=this._points[0].index,this._timePoint[2].time_t=this._timePoint[0].time_t,this._timePoint[2].offset=this._timePoint[0].offset,this._pendingPriceOffset=null}_snapPointBeforeChange(e,t,i){if(i&&i.shift())switch(e){case 0:case 1:this._snapPoint45Degree(t,this._points[1-e]);break;case 2:case 3:const i=(0,r.ensureNotNull)(this.getPoint(5-e));this._snapPoint45Degree(t,i)}}}},999432:(e,t,i)=>{i.d(t,{LineToolPath:()=>c});var r=i(650151),s=i(86441),n=i(853965),o=i(239589),l=i(821979),a=i(31712);class c extends l.LineDataSource{constructor(e,t,r,s){const n=t||c.createProperties();super(e,n,r,s),this._finished=!1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,310981)).then((t=>{this._setPaneViews([new t.PathPaneView(this,e)])}))}pointsCount(){return-1}name(){return"Path"}hasEditableCoordinates(){return!1}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}addPoint(e,t,i){var n;if(this._finished)return!0;const l=(0,r.ensureNotNull)(this.priceScale()),a=this._model.timeScale().indexToCoordinate(e.index),c=e.price,h=(0,r.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),d=l.priceToCoordinate(c,h);if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),r=e.price,n=l.priceToCoordinate(r,h),c=new s.Point(a,d).subtract(new s.Point(i,n)).length();if(!(null==t?void 0:t.isApiEvent())&&c<(0,o.interactionTolerance)().minDistanceBetweenPoints)return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}static createProperties(e){const t=new n.DefaultProperty("linetoolpath",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,317115)).then((e=>e.PathDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesWidths",new a.LineToolWidthsProperty([(0,r.ensureDefined)(e.child("lineWidth"))])),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().lineColor]))}}},932732:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(821979).LineDataSource,n=i(517336).LevelsProperty,o=i(31712),l=o.LineToolWidthsProperty,a=o.LineToolColorsProperty,c=new r("erase level line",i.tf(null,void 0,i(812962)));class h extends s{constructor(e,t,r,s){super(e,t||h.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,443454)).then((({PitchfanLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 3}name(){return"Pitchfan"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,c)}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,315340))).PitchBaseDefinitionsViewModel}static createProperties(e){var t=new n("linetoolpitchfan",e,!1,{range:[0,8]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("median").child("linewidth")],i=[e.child("median").child("color")],r=0;r<=this.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new a(i)),e.addChild("linesWidths",new l(t))}}h.LevelsCount=8,t.LineToolPitchfan=h},9093:(e,t,i)=>{var r=i(809796).TranslatedString,s=i(821979).LineDataSource,n=i(517336).LevelsProperty,o=i(373571).Action,l=i(607509).ACTION_ID,a=i(642346).LineToolPitchforkStyle,c=null,h=i(31712),d=h.LineToolWidthsProperty,u=h.LineToolColorsProperty,p=new r("erase level line",i.tf(null,void 0,i(812962))),_=new r("change {title} style",i.tf(null,void 0,i(474428)));class g extends s{constructor(e,t,i,r){super(e,t||g.createProperties(),i,r),this._properties.style.listeners().subscribe(this,this._recreatePaneView),this._recreatePaneView()}levelsCount(){return g.LevelsCount}additionalActions(e){for(var t=[],s=[{title:i.tf(null,void 0,i(825595)),actionId:l.ChartLineToolPitchforkChangeTypeToOriginal},{title:i.tf(null,void 0,i(966276)),actionId:l.ChartLineToolPitchforkChangeTypeToModifiedSchiff},{title:i.tf(null,void 0,i(809114)),actionId:l.ChartLineToolPitchforkChangeTypeToInside},{title:i.tf(null,void 0,i(151464)),actionId:l.ChartLineToolPitchforkChangeTypeToSchiff}],n=0;n<4;n++){var a=new o({actionId:s[n].actionId,checked:this.properties().style.value()===n,checkable:!0,label:s[n].title,payload:{target:this,value:n},onExecute:function(t){var i=t.getPayload(),s=i.target;e.setProperty(s.properties().style,i.value,_.format({title:new r(s.name(),s.title())})),s.updateAllViews(),s._model.updateSource(s)}});t.push(a)}return[t[0],t[3],t[1],t[2]]}_recreatePaneView(){if(null!==c){var e=[];this._properties.style.value()===a.Original?e=[new c.PitchforkLinePaneView(this,this._model)]:this._properties.style.value()===a.Schiff?e=[new c.SchiffPitchforkLinePaneView(this,this._model)]:this._properties.style.value()===a.Schiff2?e=[new c.SchiffPitchfork2LinePaneView(this,this._model)]:this._properties.style.value()===a.Inside&&(e=[new c.InsidePitchforkLinePaneView(this,this._model)]),this._setPaneViews(e)}else Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,183415)).then((e=>{null===c&&(c=e),this._recreatePaneView()}))}pointsCount(){return 3}name(){return"Pitchfork"}processErase(e,t){var i="level"+t,r=this.properties()[i].visible;e.setProperty(r,!1,p)}static createProperties(e){var t=new n("linetoolpitchfork",e,!1,{range:[0,8]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,61107))).PitchForkDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e)
;for(var t=[e.child("median").child("linewidth")],i=[e.child("median").child("color")],r=0;r<=this.LevelsCount;r++)t.push(e.child("level"+r).child("linewidth")),i.push(e.child("level"+r).child("color"));e.addChild("linesColors",new u(i)),e.addChild("linesWidths",new d(t))}}g.LevelsCount=8,t.LineToolPitchfork=g},527342:(e,t,i)=>{i.d(t,{LineToolPolyline:()=>a});var r=i(650151),s=i(86441),n=i(853965),o=i(239589),l=i(821979);class a extends l.LineDataSource{constructor(e,t,r,s){const n=t||a.createProperties();super(e,n,r,s),this._finished=!1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,623652)).then((t=>{this._setPaneViews([new t.PolylinePaneView(this,e)])}))}pointsCount(){return-1}name(){return"Polyline"}hasEditableCoordinates(){return!1}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}addPoint(e,t,i){var n;if(this._finished)return!0;const l=(0,r.ensureNotNull)(this.priceScale()),a=this._model.timeScale().indexToCoordinate(e.index),c=e.price,h=(0,r.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),d=l.priceToCoordinate(c,h),u=(0,o.interactionTolerance)().minDistanceBetweenPoints;if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),r=e.price,n=l.priceToCoordinate(r,h),o=new s.Point(a,d).subtract(new s.Point(i,n)).length();if(!(null==t?void 0:t.isApiEvent())&&o<u)return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0;const c=this._points[0],p=this._model.timeScale().indexToCoordinate(c.index),_=l.priceToCoordinate(c.price,h),g=new s.Point(a,d).subtract(new s.Point(p,_)).length();if(!(null==t?void 0:t.isApiEvent())&&g<u)return this.properties().childs().filled.setValue(!0),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}setPoint(e,t,i){var n;super.setPoint(e,t,i);const l=this.priceScale();if(!(this._model.timeScale().isEmpty()||null===l||l.isEmpty()||e!==this._points.length-1&&0!==e)){const i=(0,r.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),a=this._model.timeScale().indexToCoordinate(t.index),c=l.priceToCoordinate(t.price,i),h=e===this._points.length-1?this._points[0]:this._points[this._points.length-1],d=this._model.timeScale().indexToCoordinate(h.index),u=l.priceToCoordinate(h.price,i);new s.Point(a,c).subtract(new s.Point(d,u)).length()<(0,o.interactionTolerance)().minDistanceBetweenPoints&&this.properties().childs().filled.setValue(!0)}}static createProperties(e){const t=new n.DefaultProperty("linetoolpolyline",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,371227)).then((e=>e.PolylinesDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExclusion("filled")}}},670023:(e,t,i)=>{i.d(t,{PositionAveragePriceAxisView:()=>s});var r=i(837202);class s extends r.LineToolPriceAxisView{_formatPrice(e,t){
return this._source.formatter().format(e)}}},674053:(e,t,i)=>{var r=i(477227).LineToolTrading,s=i(821979).LineDataSource,n=i(670023).PositionAveragePriceAxisView,o=i(586784),l=i(853965).DefaultProperty,a=i(624444).PriceFormatter;const c=i(244842);var h=i(888929).sortSourcesPreOrdered.LineToolPosition;function d(e){return null==e?e="":e+="",e}class u{constructor(e){this._line=e,this._data={bodyText:"position",quantityText:"0"},this._closeEnabled=!0,this._direction="buy",this._profitState="neutral"}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setProfitState(e){return this._profitState=e,this._line.updateAllViewsAndRedraw(),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line._points[0]=t,this._line.normalizePoints(),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(d(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setProtectTooltip(e){return this._line.properties().protectTooltip.setValue(d(e)),this}getProtectTooltip(){return this._line.properties().protectTooltip.value()}setCloseTooltip(e){return this._line.properties().closeTooltip.setValue(d(e)),this}getCloseTooltip(){return this._line.properties().closeTooltip.value()}setReverseTooltip(e){return this._line.properties().reverseTooltip.setValue(d(e)),this}getReverseTooltip(){return this._line.properties().reverseTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineColor(){var e=this._line.properties();return("buy"===this._direction?e.lineBuyColor:e.lineSellColor).value()}setLineColor(e){return"buy"===this._direction?this.setLineBuyColor(e):this.setLineSellColor(e),this}setLineBuyColor(e){return this._line.properties().lineBuyColor.setValue(e),this}setLineSellColor(e){return this._line.properties().lineSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value()
;return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.bodyBorderBuyColor:e.bodyBorderSellColor).value()}setBodyBorderColor(e){return"buy"===this._direction?this.setBodyBorderBuyColor(e):this.setBodyBorderSellColor(e),this}setBodyBorderBuyColor(e){return this._line.properties().bodyBorderBuyColor.setValue(e),this}setBodyBorderSellColor(e){return this._line.properties().bodyBorderSellColor.setValue(e),this}getBodyBackgroundColor(){return o.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return("positive"===this._profitState?e.bodyTextPositiveColor:"negative"===this._profitState?e.bodyTextNegativeColor:e.bodyTextNeutralColor).value()}setBodyTextColor(e){return"positive"===this._profitState?this.setBodyTextPositiveColor(e):"negative"===this._profitState?this.setBodyTextNegativeColor(e):this.setBodyTextNeutralColor(e),this}setBodyTextPositiveColor(e){return this._line.properties().bodyTextPositiveColor.setValue(e),this}setBodyTextNegativeColor(e){return this._line.properties().bodyTextNegativeColor.setValue(e),this}setBodyTextNeutralColor(e){return this._line.properties().bodyTextNeutralColor.setValue(e),this}getBodyFont(){return o.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return o.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBorderBuyColor:e.quantityBorderSellColor).value()}setQuantityBorderColor(e){return"buy"===this._direction?this.setQuantityBorderBuyColor(e):this.setQuantityBorderSellColor(e),this}setQuantityBorderBuyColor(e){return this._line.properties().quantityBorderBuyColor.setValue(e),this}setQuantityBorderSellColor(e){return this._line.properties().quantityBorderSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBackgroundBuyColor:e.quantityBackgroundSellColor).value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this.setQuantityBackgroundBuyColor(e):this.setQuantityBackgroundSellColor(e),this}setQuantityBackgroundBuyColor(e){
return this._line.properties().quantityBackgroundBuyColor.setValue(e),this}setQuantityBackgroundSellColor(e){return this._line.properties().quantityBackgroundSellColor.setValue(e),this}getQuantityTextColor(){return o.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return o.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return o.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return o.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getReverseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonBorderBuyColor:e.reverseButtonBorderSellColor).value()}setReverseButtonBorderColor(e){return"buy"===this._direction?this.setReverseButtonBorderBuyColor(e):this.setReverseButtonBorderSellColor(e),this}setReverseButtonBorderBuyColor(e){return this._line.properties().reverseButtonBorderBuyColor.setValue(e),this}setReverseButtonBorderSellColor(e){return this._line.properties().reverseButtonBorderSellColor.setValue(e),this}getReverseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency)}setReverseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency),this}getReverseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonIconBuyColor:e.reverseButtonIconSellColor).value()}setReverseButtonIconColor(e){return"buy"===this._direction?this.setReverseButtonIconBuyColor(e):this.setReverseButtonIconSellColor(e),this}setReverseButtonIconBuyColor(e){return this._line.properties().reverseButtonIconBuyColor.setValue(e),this}setReverseButtonIconSellColor(e){return this._line.properties().reverseButtonIconSellColor.setValue(e),this}getCloseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonBorderBuyColor:e.closeButtonBorderSellColor).value()}setCloseButtonBorderColor(e){return"buy"===this._direction?this.setCloseButtonBorderBuyColor(e):this.setCloseButtonBorderSellColor(e),this}setCloseButtonBorderBuyColor(e){return this._line.properties().closeButtonBorderBuyColor.setValue(e),this}setCloseButtonBorderSellColor(e){return this._line.properties().closeButtonBorderSellColor.setValue(e),this}getCloseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency)}setCloseButtonBackgroundColor(e){
return o.setColorToProperties(e,this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency),this}getCloseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonIconBuyColor:e.closeButtonIconSellColor).value()}setCloseButtonIconColor(e){return"buy"===this._direction?this.setCloseButtonIconBuyColor(e):this.setCloseButtonIconSellColor(e),this}setCloseButtonIconBuyColor(e){return this._line.properties().closeButtonIconBuyColor.setValue(e),this}setCloseButtonIconSellColor(e){return this._line.properties().closeButtonIconSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}isFunction(e){return"function"==typeof e}onReverse(e,t){return t?this.isFunction(t)&&(this._onReverseData=e,this._onReverseCallback=t):this.isFunction(e)&&(this._onReverseCallback=e),this}callOnReverse(){this.isFunction(this._onReverseCallback)&&this._onReverseCallback.call(this,this._onReverseData)}isOnReverseCallbackPresent(){return this.isFunction(this._onReverseCallback)}onClose(e,t){return t?this.isFunction(t)&&(this._onCloseData=e,this._onCloseCallback=t):this.isFunction(e)&&(this._onCloseCallback=e),this}setCloseEnabled(e){return this._closeEnabled===e||(this._closeEnabled=e,this._onCloseCallback&&this._line.updateAllViewsAndRedraw()),this}isCloseEnabled(){return this._closeEnabled}callOnClose(){this.isFunction(this._onCloseCallback)&&this._closeEnabled&&this._onCloseCallback.call(this,this._onCloseData)}isOnCloseCallbackPresent(){return this._closeEnabled&&this.isFunction(this._onCloseCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends r{constructor(e,t){super(e,t||p.createProperties()),this._adapter=new u(this),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,221759,19)).then((({PositionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}));var r=e.mainSeries().symbolInfo(),s=null!==r?r.pricescale:100,n=null!==r&&r.fractional?r.minmov:1,o=null!==r&&r.fractional,l=null!==r?r.minmove2:void 0;this._formatter=new a(s,n,o,l)}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t,i){this._points[e]=t,this.normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}name(){return"Position"}
createPriceAxisView(e){return this._priceAxisView=new n(this,{pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()}),this._priceAxisView}paneViews(){return TradingView.printing&&!c.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?s.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!c.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?s.prototype.priceAxisViews.call(this,e,t):null}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}formatter(){return this._formatter}static createProperties(e){var t=new l("linetoolposition",e,!1,!1);return this._configureProperties(t),t}}t.LineToolPosition=p},917004:(e,t,i)=>{var r,s;i.r(t),i.d(t,{AlertStatus:()=>r,Direction:()=>s}),function(e){e[e.Waiting=0]="Waiting",e[e.Success=1]="Success",e[e.Failure=2]="Failure"}(r||(r={})),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down"}(s||(s={}))},240569:(e,t,i)=>{var r=i(650151).ensureNotNull,s=i(821979).LineDataSource,n=i(853965).DefaultProperty,o=i(917004);class l extends s{constructor(e,t,r,s){super(e,t||l.createProperties(),r,s),this._predictionPaneView=null;const n=this._model.mainSeries();n.properties().interval.subscribe(this,(()=>{this.setStatus(o.AlertStatus.Waiting)})),n.dataEvents().dataUpdated().subscribe(this,this.recalculateStateByData),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,133539,19)).then((({PredictionPaneView:e})=>{this._predictionPaneView=new e(this,this._model),this._setPaneViews([this._predictionPaneView])}))}destroy(){const e=this._model.mainSeries();e.properties().interval.unsubscribeAll(this),e.dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._predictionPaneView&&this._predictionPaneView.iconsReady()}isSynchronizable(){return!1}status(){return this._properties.status.value()}setStatus(e){return this._properties.status.setValue(e)}pointsCount(){return 2}name(){return"Forecast"}restorePoints(e,t,i){super.restorePoints(e,t,i),this.recalculateStateByData()}recalculateStateByData(){if(!this.isSourceHidden()&&!(this._points.length<2||this._model.mainSeries().bars().isEmpty())){var e=this._points[1];if(this.status())e.index>this._model.timeScale().baseIndex()&&this.setStatus(o.AlertStatus.Waiting);else{var t=this._model.mainSeries().bars().valueAt(e.index);if(null!==t){var i=this.direction();if(i===o.Direction.Up&&t[TradingView.HIGH_PLOT]>=e.price)this.setStatus(o.AlertStatus.Success);else if(i===o.Direction.Down&&t[TradingView.LOW_PLOT]<=e.price)this.setStatus(o.AlertStatus.Success);else{var s=r(this._model.mainSeries().bars().lastIndex());e.index!==s&&this.setStatus(o.AlertStatus.Failure)}}}}}addPoint(e){var t=super.addPoint(e);return t&&this.recalculateStateByData(),t}endChanging(){super.endChanging(),this.setStatus(o.AlertStatus.Waiting),this.recalculateStateByData()}onData(e){super.onData(e),
this.recalculateStateByData()}endMoving(e,t,i){super.endMoving(e,t,i),this.setStatus(o.AlertStatus.Waiting),this.recalculateStateByData()}direction(){if(this.points().length<2)return o.Direction.Up;var e=this.points()[0];return this.points()[1].price>e.price?o.Direction.Up:o.Direction.Down}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,87069))).PredictionDefinitionsViewModel}cloneable(){return!1}static createProperties(e){var t=new n("linetoolprediction",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.merge({status:o.AlertStatus.Waiting})}}t.LineToolPrediction=l},729443:(e,t,i)=>{var r=i(821979).LineDataSource,s=i(853965).DefaultProperty,n=i(31712).LineToolColorsProperty;class o extends r{constructor(e,t,r,s){super(e,t||o.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,473612,19)).then((({PriceLabelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Price Label"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,732887))).PriceLabelDefinitionsViewModel}static createProperties(e){var t=new s("linetoolpricelabel",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n([e.childs().borderColor])),e.addChild("textsColors",new n([e.childs().color]))}}t.LineToolPriceLabel=o},830695:(e,t,i)=>{i.d(t,{LineToolPriceRange:()=>g});var r=i(821979),s=i(650151),n=i(61499),o=i(738232),l=i(941883),a=i(923237);const c={...l.nonThemedFactoryDefaultsBase,extendLeft:!1,extendRight:!1},h=l.themedFactoryDefaultsBase,d=(0,o.extractAllPropertiesKeys)((0,s.ensureDefined)(h.get(n.StdTheme.Light))),u=(0,o.extractAllPropertiesKeys)(c),p=[...d,...u,...a.commonLineToolPropertiesStateKeys,...l.allPropertiesStateKeysBase];class _ extends l.DateAndPriceBaseProperties{static create(e){return new this("linetoolpricerange",(()=>(0,o.factoryDefaultsForCurrentTheme)(c,h)),u,d,p,e)}}class g extends r.LineDataSource{constructor(e,t,r,s){super(e,t||g.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,425784)).then((e=>{this._setPaneViews([new e.PriceRangePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Price Range"}template(){return this._properties.template()}static createProperties(e){const t=_.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,133954))).GeneralDatePriceRangeDefinitionsViewModel}}},506416:(e,t,i)=>{var r=i(517336).LevelsProperty,s=i(672688).LineToolFibWedgeBase,n=i(31712).LineToolColorsProperty;class o extends s{constructor(e,t,r,s){super(e,t||o.createProperties(),r,s),
Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,678175,19)).then((({ProjectionLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 1}name(){return"Projection"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,758221))).ProjectionDefinitionsViewModel}static createProperties(e){var t=new r("linetoolprojection",e,!1,{range:[1,1]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n([e.trendline.color]))}}t.LineToolProjection=o},352747:(e,t,i)=>{i.d(t,{LineToolRay:()=>s});var r=i(956268);class s extends r.LineToolTrendLine{constructor(e,t,i,r){super(e,null!=t?t:s.createProperties(),i,r)}name(){return"Ray"}static createProperties(e){const t=r.LineToolTrendLine.createProperties(e,"linetoolray");return s._configureProperties(t),t}}},442724:(e,t,i)=>{i.d(t,{LineToolRectangle:()=>h});var r=i(86441),s=i(853965),n=i(354950),o=i.n(n),l=i(821979),a=i(31712),c=i(650151);class h extends l.LineDataSource{constructor(e,t,r,s){const n=t||h.createProperties();super(e,n,r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,239631)).then((({RectanglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}pointsCount(){return 2}textColorsProperty(){return this.properties().childs().showLabel.value()?super.textColorsProperty():null}name(){return"Rectangle"}setPoint(e,t,i){if(e<2&&super.setPoint(e,t,i),i&&i.shift()){const i=this._getAnchorPointForIndex(e);if(e>=4)return this._correctMiddlePoints(e,t,i),void this.normalizePoints();this._snapPoint45Degree(t,i)}switch(e){case 2:this._points[1].price=t.price,this._points[0].index=t.index;break;case 3:this._points[0].price=t.price,this._points[1].index=t.index;break;case 4:this._points[0].index=t.index;break;case 5:this._points[1].index=t.index;break;case 6:this._points[0].price=t.price;break;case 7:this._points[1].price=t.price}this.normalizePoints()}getPoint(e){return e<2?super.getPoint(e):this._getAnchorPointForIndex(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new s.DefaultProperty("linetoolrectangle",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,261145)).then((e=>e.RectangleDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_snapPoint45Degree(e,t,i){const r=this._priceScale,s=this.ownerSource();if(null===r||null===s)return;const n=s.firstValue();if(null===n)return;const o=this._model.timeScale(),l=(0,c.ensureNotNull)(this.pointToScreenPoint(e)),a=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),h=l.x-a.x,d=l.y-a.y,u=h<0?-1:1,p=d<0?-1:1,_=Math.max(Math.abs(h),Math.abs(d)),g=Math.round(o.coordinateToIndex(a.x+_*u)),f=Math.abs(o.indexToCoordinate(g)-a.x),P=r.coordinateToPrice(a.y+f*p,n);e.index=g,
e.price=P}_correctMiddlePoints(e,t,i){e<6?this._correctRightLeftMiddlePoint(e,t,i):this._correctTopBottomMiddlePoint(e,t,i)}_correctRightLeftMiddlePoint(e,t,i){const s=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),n=(0,c.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[0])),l=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let a=s.x-n.x;if(0===a)return;const h=o.x<l.x?1:-1,d=o.y<l.y?1:-1;switch(a*=h,e){case 4:{const e=l.y-d*a/2,t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(l.x,e)));this._points[1].price=t.price;const i=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(o.x+h*a,o.y+d*a/2)));this._points[0].price=i.price,this._points[0].index=i.index;break}case 5:{const e=o.y-d*a/2,t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(o.x,e)));this._points[0].price=t.price;const i=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(l.x+h*a,l.y+d*a/2)));this._points[1].price=i.price,this._points[1].index=i.index;break}}}_correctTopBottomMiddlePoint(e,t,i){const s=this._priceScale,n=this.ownerSource();if(null===s||null===n)return;const o=this._model.timeScale(),l=n.firstValue();if(null===l)return;const a=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),h=(0,c.ensureNotNull)(this.pointToScreenPoint(i)),d=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[0])),u=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[1])),p=a.y-h.y,_=p<0?-1:1,g=d.x<u.x?1:-1,f=d.y<u.y?1:-1;switch(e){case 6:{const e=Math.floor(u.x-g*p/2),t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(e,u.y))),i=Math.abs(this._points[1].index-t.index),n=g*f*_*Math.ceil(i/2);if(0===n)return;this._points[1].index=this._points[1].index-n;const a=_*Math.abs(o.indexToCoordinate(this._points[1].index)-u.x);this._points[0].price=s.coordinateToPrice(d.y+a,l),this._points[0].index=this._points[0].index+n;break}case 7:{const e=Math.floor(d.x-g*p/2),t=(0,c.ensureNotNull)(this.screenPointToPoint(new r.Point(e,d.y))),i=Math.abs(this._points[0].index-t.index),n=g*f*_*Math.ceil(i/2);if(0===n)return;this._points[0].index=this._points[0].index-n;const a=_*Math.abs(o.indexToCoordinate(this._points[0].index)-d.x);this._points[1].price=s.coordinateToPrice(u.y+a,l),this._points[1].index=this._points[1].index+n;break}}}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("text"),e.addExclusion("linesColors"),e.addExclusion("textsColors")}_getAnchorPointForIndex(e){const t=this.points(),i=t[0],r=t[1];let s=0,n=0;switch(e){case 0:s=i.price,n=i.index;break;case 1:s=r.price,n=r.index;break;case 2:s=r.price,n=i.index;break;case 3:s=i.price,n=r.index;break;case 4:s=(r.price+i.price)/2,n=i.index;break;case 5:s=(r.price+i.price)/2,n=r.index;break;case 6:s=i.price,n=(r.index+i.index)/2;break;case 7:
s=r.price,n=(r.index+i.index)/2}return{index:n,price:s}}}},264663:(e,t,i)=>{var r;i.d(t,{RiskDisplayMode:()=>r}),function(e){e.Percentage="percents",e.Money="money"}(r||(r={}))},514524:(e,t,i)=>{var r;i.d(t,{RiskRewardPointIndex:()=>r}),function(e){e[e.Entry=0]="Entry",e[e.Close=1]="Close",e[e.ActualEntry=2]="ActualEntry",e[e.ActualClose=3]="ActualClose"}(r||(r={}))},864555:(e,t,i)=>{i.d(t,{LineToolRiskRewardLong:()=>T,LineToolRiskRewardShort:()=>S});var r=i(650151),s=i(182436),n=i(534741),o=i(291784),l=i(821979),a=i(264663),c=i(514524),h=i(229765),d=i(246733);class u extends h.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){if(e.visible=!1,!this._showAxisLabel())return;const r=this._source.priceScale();if(0===this._source.points().length||null===r||r.isEmpty())return;const s=this._source.ownerSource(),n=null!==s?s.firstValue():null;if(null===n)return;const o=this._data.priceProperty.value(),l=(0,d.resetTransparency)(this._data.colorProperty.value());i.background=l,i.textColor=this.generateTextColor(l),i.coordinate=r.priceToCoordinate(o,n),e.text=r.formatPrice(o,n),e.visible=!0}_showAxisLabel(){return this._source.properties().childs().showPriceLabels.value()}}var p=i(354950),_=i.n(p);class g extends(_()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){const e=this._lineSource.points()[this._pointIndex].price;return this._formatAndParsePrice(e)}state(){return this.value()}merge(e,t){return this.setValue(e),t?[]:null}_formatAndParsePrice(e){const t=(0,r.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),r=t.parse(i);return r.res?r.value:e}return e}}class f extends g{constructor(e){super(e,0)}setValue(e){const t=this._lineSource.points()[this._pointIndex];this._lineSource.startChanging(this._pointIndex,t),t.price=parseFloat(""+e),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.recalculate(),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this),this._lineSource.endChanging(!1,!1),this._lineSource.syncPriceLevels()}}class P extends g{constructor(e){super(e,1)}value(){const e=this._lineSource.stopPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().stopLevel.setValue(t),this._lineSource.syncPriceLevels()}}class v extends g{constructor(e){super(e,2)}value(){const e=this._lineSource.profitPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().profitLevel.setValue(t),this._lineSource.syncPriceLevels()}}var m=i(389137),y=i(885482),C=i(964824);function x(e){return parseFloat(e.toFixed(2))}class w extends l.LineDataSource{constructor(e,t,n,l){super(e,t,n,l),this._syncStateExclusions=["points","entryPrice","stopPrice","targetPrice","stopLevel","profitLevel","riskSize","qty","amountTarget","amountStop"],
this._riskInChange=!1,this.version=2,t.hasChild("stopLevel")||t.hasChild("profitLevel")||(t.addProperty("stopLevel",0),t.addProperty("profitLevel",0),this.ownerSourceChanged().subscribe(this,(()=>{const i=(0,r.ensureNotNull)(e.timeScale().visibleBarsStrictRange()),s=i.firstBar(),n=i.lastBar(),l=(0,r.ensureNotNull)(this.ownerSource()),a=l.priceScale();let c=(0,r.ensureNotNull)(l.priceRange(s,n));if(a&&a.isLog()){const e=a.logicalToPrice(c.minValue()),t=a.logicalToPrice(c.maxValue());c=new o.PriceRange(e,t)}if(c&&!c.isEmpty()){const e=Math.round(.2*c.length()*this.ownerSourceBase());t.merge({stopLevel:e,profitLevel:e})}}),!0));const h=t.childs();h.stopLevel.listeners().subscribe(this,this.recalculate),h.stopLevel.listeners().subscribe(null,(()=>{this.properties().childs().stopPrice.childChanged(null)})),h.profitLevel.listeners().subscribe(this,this.recalculate),h.profitLevel.listeners().subscribe(null,(()=>{this.properties().childs().targetPrice.childChanged(null)})),t.addChild("entryPrice",new f(this)),t.addChild("stopPrice",new P(this)),t.addChild("targetPrice",new v(this)),t.hasChild("riskSize")||t.addProperty("riskSize",0),t.hasChild("qty")||t.addProperty("qty",0),t.hasChild("amountTarget")||t.addProperty("amountTarget",h.accountSize.value()),t.hasChild("amountStop")||t.addProperty("amountStop",h.accountSize.value()),t.addExclusion("riskSize"),t.addExclusion("qty"),t.addExclusion("amountTarget"),t.addExclusion("amountStop"),this._riskInPercentsFormatter=new s.NumericFormatter(2),this._riskInMoneyFormatter=new s.NumericFormatter,h.risk.subscribe(this,this._recalculateRiskSize),h.accountSize.subscribe(this,this._recalculateRiskSize),h.riskDisplayMode.subscribe(this,this._recalculateRisk),h.riskDisplayMode.subscribe(this,this._recalculateRiskSize),h.entryPrice.subscribe(this,this._recalculateRiskSize),h.stopPrice.subscribe(this,this._recalculateRiskSize),h.profitLevel.subscribe(this,this._recalculateRiskSize),h.profitLevel.subscribe(this,this.syncPriceLevels.bind(this)),h.stopLevel.subscribe(this,this._recalculateRiskSize),h.stopLevel.subscribe(this,this.syncPriceLevels.bind(this)),h.qty.subscribe(this,this._recalculateRiskSize),this.ownerSourceChanged().subscribe(null,((e,t)=>{e&&e.barsProvider().dataUpdated().unsubscribeAll(this),t&&t.barsProvider().dataUpdated().subscribe(this,this._onSeriesUpdated)})),this.pointAdded().subscribe(this,(e=>{switch(e){case c.RiskRewardPointIndex.Entry:case c.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}})),this.pointChanged().subscribe(this,(e=>{switch(e){case c.RiskRewardPointIndex.Entry:case c.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}})),h.riskDisplayMode.value()===a.RiskDisplayMode.Percentage&&h.risk.value()>100&&h.riskDisplayMode.setValueSilently(a.RiskDisplayMode.Money),h.entryPrice.subscribe(this,this._recalculateQty),h.stopPrice.subscribe(this,this._recalculateQty),h.riskSize.subscribe(this,this._recalculateQty),h.entryPrice.subscribe(this,this._recalculateAmount),
h.profitLevel.subscribe(this,this._recalculateAmount),h.stopLevel.subscribe(this,this._recalculateAmount),h.accountSize.subscribe(this,this._recalculateAmount),h.riskSize.subscribe(this,this._recalculateAmount),h.qty.subscribe(this,this._recalculateAmount),this._entryPriceAxisView=new u(this,{colorProperty:h.linecolor,priceProperty:h.entryPrice}),this._stopPriceAxisView=new u(this,{colorProperty:h.stopBackground,priceProperty:h.stopPrice}),this._profitPriceAxisView=new u(this,{colorProperty:h.profitBackground,priceProperty:h.targetPrice}),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,7293)).then((({RiskRewardPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}destroy(){var e;null===(e=this.ownerSource())||void 0===e||e.barsProvider().dataUpdated().unsubscribeAll(this),this.ownerSourceChanged().unsubscribeAll(this),super.destroy()}hasEditableCoordinates(){return!1}setOwnerSource(e){super.setOwnerSource(e);const t=this.ownerSource();t&&t.symbolSource().symbolInfo()&&(this._recalculateAmount(),this._recalculateRiskSize(),this._recalculateQty())}pointsCount(){return 1}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||this._model.paneForSource(this)!==e?null:[this._entryPriceAxisView,this._stopPriceAxisView,this._profitPriceAxisView]}updateAllViews(e){this.isActualSymbol()&&this.properties().childs().visible.value()&&((0,y.hideAllDrawings)().value()&&this.userEditEnabled()||(super.updateAllViews(e),this._entryPriceAxisView.update(e),this._stopPriceAxisView.update(e),this._profitPriceAxisView.update(e)))}migrateVersion(e,t,i){if(1===e&&this._points.length>=1){const e=[];e.push(this._points[0]);let t=this._points[0];if(t={price:t.price,index:this._getClosePointIndex(t.index)},e.push(t),this._points[1]&&e.push(this._points[1]),this._points[2]&&e.push(this._points[2]),this._points=e,this._timePoint.length>=1){const t=[],i=this._timePoint[0];t.push(i);const r={price:i.price,time_t:i.time_t,offset:this._getClosePointIndex(i.offset)};t.push(r),this._timePoint[1]&&e.push(this._points[1]),this._timePoint[2]&&e.push(this._points[2]),this._timePoint=t}}}restoreExternalState(e){if((0,m.isNumber)(e.entryPrice)){if(e=Object.assign({},e),!this.isActualSymbol()){this._timePoint[0].price=e.entryPrice,delete e.entryPrice}this.properties().merge(e)}else super.restoreExternalState(e)}addPoint(e,t,i){e.price=this._roundPrice(e.price),super.addPoint(e,void 0,!0);const r={price:e.price,index:this._getClosePointIndex(e.index)};super._addPointIntenal(r,void 0,!0);const s=this._calculateActualEntry(e,r);if(s){super._addPointIntenal(s,void 0,!0);const e=this._findClosePoint(s,r);e&&super._addPointIntenal(e,void 0,!0)}return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}setPoint(e,t,i,r){if(!this.isActualSymbol())return;const s=this.properties().childs();switch(this._muteSyncLineStyle(),e){case 0:this._changeEntryPoint(t);break;case 2:s.stopPrice.setValue(this.prepareStopPrice(t.price));break;case 3:s.targetPrice.setValue(this.prepareProfitPrice(t.price));break;case 1:
t.price=this._roundPrice(t.price),super.setPoint(1,t),this.recalculate()}this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels()}getPoint(e){switch(e){case 0:return this._points[0];case 1:return{index:this._points[1].index,price:this._points[0].price};case 2:return{index:this._points[0].index,price:this.stopPrice()};case 3:return{index:this._points[0].index,price:this.profitPrice()}}return null}setPoints(e){this._muteSyncLineStyle(),super.setPoints(e),this.recalculate(),this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels()}start(){super.start(),this.recalculate()}startMoving(e,t,i,s){const n=(0,r.ensureDefined)(e.logical);n.price=this._roundPrice(n.price),super.startMoving(e,t,i)}move(e,t,i,s){const n=(0,r.ensureDefined)(e.logical);n.price=this._roundPrice(n.price),super.move(e,t,i),this.recalculate(),this._entryPriceAxisView.update((0,C.sourceChangeEvent)(this.id()))}axisPoints(){if(!this._points[c.RiskRewardPointIndex.ActualEntry])return[];const e=this._points[c.RiskRewardPointIndex.ActualEntry];let t=null;if(4===this._points.length)t=this._points[c.RiskRewardPointIndex.ActualClose];else{const e=this.lastBarData();if(!e)return[];t={index:e.index,price:e.closePrice}}return[e,t]}recalculateStateByData(){this.recalculate()}recalculate(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.targetPrice.value(),i=e.stopPrice.value(),r=[this._points[0],this._points[1]],s=this._calculateActualEntry(this.points()[0],this.points()[1]);if(s){r.push(s);const e=this._findClosePoint(s,this.points()[1]);e&&r.push(e)}this._points=r,t!==e.targetPrice.value()&&e.targetPrice.listeners().fire(e.targetPrice),i!==e.stopPrice.value()&&e.stopPrice.listeners().fire(e.stopPrice)}syncPriceLevels(){const e=this.linkKey().value();if(e){const t=this.properties().childs(),i={entryPrice:t.entryPrice.value(),stopLevel:t.stopLevel.value(),profitLevel:t.profitLevel.value()};(0,y.changeLineStyle)({linkKey:e,state:i,model:this._model})}}entryPrice(){return this.points()[0].price}lastBarData(){var e;const t=null===(e=this.ownerSource())||void 0===e?void 0:e.barsProvider();if(!t)return null;const i=t.bars().firstIndex(),s=t.bars().lastIndex();if(null===i||null===s||isNaN(i)||isNaN(s))return null;const o=this.points();if(4===o.length){const e=o[c.RiskRewardPointIndex.ActualClose];return e.index<i?null:{closePrice:e.price,index:Math.min(s,e.index)}}const l=o[c.RiskRewardPointIndex.Close];if(l.index<i)return null;const a=Math.min(s,l.index),h=t.bars().search(a,n.PlotRowSearchMode.NearestLeft);return null===h?null:{closePrice:(0,r.ensure)(h.value[4]),index:h.index}}ownerSourceBase(){var e;const t=null===(e=this.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo();return t?t.pricescale/t.minmov:100}getOrderTemplate(){const e=this.ownerSource();if(null===e)return null;const t=this.properties().childs();return{symbol:e.symbolSource().symbol(),qty:t.qty.value()/t.lotSize.value(),limitPrice:t.entryPrice.value(),stopLoss:t.stopPrice.value(),takeProfit:t.targetPrice.value(),side:this._orderSide(),
type:1,seenPrice:null}}template(){const e=this.properties().childs(),t=super.template();return t.stopLevel=e.stopLevel.value(),t.profitLevel=e.profitLevel.value(),t}_applyTemplateImpl(e){const{targetPrice:t,stopPrice:i,entryPrice:r,...s}=e;super._applyTemplateImpl(s);const n=this.properties().childs();void 0!==e.stopLevel&&n.stopLevel.setValue(e.stopLevel),void 0!==e.profitLevel&&n.profitLevel.setValue(e.profitLevel)}_propertiesStateExclusions(){return["entryPrice","stopPrice","targetPrice"]}_correctPoints(e,t){return!!this.isActualSymbol()&&super._correctPoints([e[0],e[1]],t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,208393))).RiskRewardDefinitionsViewModel}_recalculateRiskSize(){if(this._riskInChange)return;const e=this.properties().childs(),t=e.risk.value(),i=e.riskDisplayMode.value(),r=e.accountSize.value();i===a.RiskDisplayMode.Percentage?e.riskSize.setValue(t/100*r):t>r?(e.risk.setValue(r),e.riskSize.setValue(r)):e.riskSize.setValue(t)}_roundPrice(e){const t=this.ownerSourceBase();return Math.round(e*t)/t}_ownerSourcePointValue(){var e,t,i;return null!==(i=null===(t=null===(e=this.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo())||void 0===t?void 0:t.pointvalue)&&void 0!==i?i:1}static _configureProperties(e){l.LineDataSource._configureProperties(e),e.addExclusion("stopLevel"),e.addExclusion("profitLevel"),e.addExclusion("stopPrice"),e.addExclusion("targetPrice"),e.addExclusion("entryPrice")}_onSeriesUpdated(e,t,i){this.isSourceHidden()||this._points.length<2||null!==i&&i.index>Math.max(this._points[0].index,this._points[1].index)||this.recalculateStateByData()}_recalculateRisk(){const e=this.properties().childs(),t=e.riskDisplayMode.value(),i=e.riskSize.value(),r=e.accountSize.value();let s=e.risk.value();s=t===a.RiskDisplayMode.Percentage?x(i/r*100):x(r/100*s),this._riskInChange=!0,e.risk.setValue(+this._riskFormatter(t).format(s)),this._riskInChange=!1}_recalculateAmount(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.accountSize.value(),i=e.entryPrice.value(),r=e.qty.value(),s=e.stopPrice.value(),n=e.targetPrice.value(),o=this._ownerSourcePointValue();e.amountTarget.setValue(this._amountTarget(t,n,i,r,o)),e.amountStop.setValue(this._amountStop(t,s,i,r,o))}_recalculateQty(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.entryPrice.value(),i=e.stopPrice.value(),r=e.riskSize.value()/(Math.abs(t-i)*this._ownerSourcePointValue());e.qty.setValue(r)}_calculateActualEntry(e,t){const i=this.ownerSource();if(!i)return null;const s=i.barsProvider().bars();if(s.isEmpty())return null;const n=(0,r.ensureNotNull)(s.firstIndex()),o=Math.max(e.index,n),l=e.price,a=(0,r.ensureNotNull)(s.lastIndex()),c=Math.min(a,t.index);for(const e of s.rangeIterator(o,c+1)){const t=e.value;if(null!==t&&(0,r.ensure)(t[2])>=l&&(0,r.ensure)(t[3])<=l)return{index:e.index,price:l}}return null}_riskFormatter(e){
return e===a.RiskDisplayMode.Percentage?this._riskInPercentsFormatter:this._riskInMoneyFormatter}_getClosePointIndex(e){const t=this._model.timeScale(),i=Math.round(t.width()/t.barSpacing());return e+Math.max(3,Math.round(.15*i))}_findClosePoint(e,t){const i=this.ownerSource();if(!i)return null;const s=i.barsProvider().bars(),n=(0,r.ensureNotNull)(s.firstIndex()),o=Math.max(e.index,n),l=(0,r.ensureNotNull)(s.lastIndex()),a=Math.min(l,t.index);for(const e of s.rangeIterator(o,a+1)){const t=e.value;if(null===t)continue;const i=this._checkStopPrice(t);if(null!=i)return{index:e.index,price:i}}return null}_changeEntryPoint(e){const t=this.properties().childs(),i=t.stopPrice.value(),r=t.targetPrice.value(),s=1/this.ownerSourceBase(),n=Math.min(i,r)+s,o=Math.max(i,r)-s;e.price=Math.max(n,Math.min(o,this._roundPrice(e.price))),super.setPoint(0,e),t.stopPrice.setValue(i),t.targetPrice.setValue(r)}}var b=i(853965);class S extends w{constructor(e,t,i,r){super(e,null!=t?t:S.createProperties(),i,r)}name(){return"Risk/Reward short"}stopPrice(){return this.entryPrice()+this.properties().childs().stopLevel.value()/this.ownerSourceBase()}calculatePL(e){return this.entryPrice()-e}profitPrice(){return this.entryPrice()-this.properties().childs().profitLevel.value()/this.ownerSourceBase()}prepareStopPrice(e){e=this._roundPrice(e);const t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}prepareProfitPrice(e){e=this._roundPrice(e);const t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}static createProperties(e){const t=new b.DefaultProperty("linetoolriskrewardshort",e);return this._configureProperties(t),t}_amountTarget(e,t,i,r,s){return x(e+(i-t)*r*s)}_amountStop(e,t,i,r,s){return x(e-(t-i)*r*s)}_checkStopPrice(e){const t=this.stopPrice(),i=this.profitPrice();return(0,r.ensure)(e[2])>=t?this.stopPrice():(0,r.ensure)(e[3])<=i?this.profitPrice():null}_orderSide(){return-1}}class T extends w{constructor(e,t,i,r){super(e,null!=t?t:T.createProperties(),i,r)}name(){return"Risk/Reward long"}stopPrice(){return this.entryPrice()-this.properties().childs().stopLevel.value()/this.ownerSourceBase()}profitPrice(){return this.entryPrice()+this.properties().childs().profitLevel.value()/this.ownerSourceBase()}calculatePL(e){return e-this.entryPrice()}prepareStopPrice(e){e=this._roundPrice(e);const t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}prepareProfitPrice(e){e=this._roundPrice(e);const t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}static createProperties(e){const t=new b.DefaultProperty("linetoolriskrewardlong",e);return this._configureProperties(t),t}_amountTarget(e,t,i,r,s){return x(e+(t-i)*r*s)}_amountStop(e,t,i,r,s){return x(e-(i-t)*r*s)}_checkStopPrice(e){const t=this.stopPrice(),i=this.profitPrice();return(0,r.ensure)(e[3])<=t?this.stopPrice():(0,r.ensure)(e[2])>=i?this.profitPrice():null}_orderSide(){return 1}}},605703:(e,t,i)=>{var r=i(86441).Point,s=i(204652).distanceToLine,n=i(821979).LineDataSource,o=i(853965).DefaultProperty,l=i(31712).LineToolColorsProperty
;class a extends n{constructor(e,t,r,s){super(e,t||a.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,642366,19)).then((({RotatedRectanglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){var i=this._getPaneViews()[0],r=i._points[0],n=i._points[1],o=i._points[2];this._distance=s(r,n,o).distance}}setPoint(e,t,i){if(super.setPoint(e,t,i),0===e||1===e){var s=this._getPaneViews()[0];s.update();var n=s._points[0],o=s._points[1].subtract(n),l=new r(o.y,-o.x).normalized().scaled(this._distance),a=n.add(l),c=this.screenPointToPoint(a);this._points[2]=c}}endChanging(e,t){delete this._distance,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Rotated Rectangle"}hasEditableCoordinates(){return!1}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,967382))).GeneralFiguresDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){var t=new o("linetoolrotatedrectangle",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new l([e.color]))}}t.LineToolRotatedRectangle=a},115137:(e,t,i)=>{var r=i(517336).LevelsProperty,s=i(9093).LineToolPitchfork;class n extends s{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r)}name(){return"Modified Schiff Pitchfork"}static createProperties(e){var t=new r("linetoolschiffpitchfork",e,!1,{range:[0,8]});return this._configureProperties(t),t}}t.LineToolSchiffPitchfork=n},126144:(e,t,i)=>{var r=i(517336).LevelsProperty,s=i(9093).LineToolPitchfork;class n extends s{constructor(e,t,i,r){super(e,t||n.createProperties(),i,r)}name(){return"Schiff Pitchfork"}static createProperties(e){var t=new r("linetoolschiffpitchfork2",e,!1,{range:[0,8]});return this._configureProperties(t),t}}t.LineToolSchiffPitchfork2=n},812788:(e,t,i)=>{i.d(t,{LineToolSignpost:()=>p});var r=i(444372),s=i(853965),n=i(821979),o=i(354950),l=i.n(o);class a extends(l()){constructor(e){super(),this._source=e,e.pointAdded().subscribe(this,(()=>this.listeners().fire(this))),e.pointChanged().subscribe(this,(()=>this.listeners().fire(this)))}value(){const e=this._source.properties().childs().position.value();return parseFloat(e.toFixed(2))}setValue(e){this._source.properties().childs().position.setValue(e),this._source.model().updateSource(this._source),this.listeners().fire(this),this._source.syncMultichartState({pricesChanged:!1,indexesChanged:!1})}}var c=i(68626);class h extends c.LineDataSourcePointIndexProperty{constructor(e,t){super(e,t),this._source=e}_setPointImpl(e){this._source.setPointAndChangeIndex(this._pointIndex,e)}}var d=i(31712),u=i(776954);class p extends u.LineToolWithRelativePriceCoordinate{constructor(e,t,r,s){super(e,null!=t?t:p.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,944581)).then((t=>{this._setPaneViews([new t.SignpostPaneView(this,e)])}))}pointsCount(){return 1}name(){
return"Signpost"}customEvent(){return{index:()=>{var e,t;return null!==(t=null===(e=this.points()[0])||void 0===e?void 0:e.index)&&void 0!==t?t:null},position:()=>this.properties().childs().position.value()}}showInObjectTree(){return!this.isPhantom()&&super.showInObjectTree()}isPhantom(){return this._model.isPhantomLine(this)}clonePositionOffset(){return{barOffset:1,xCoordOffset:0,yCoordOffset:0}}template(){const e=super.template(),t=this.properties().childs();return e.text=t.text.value(),e.position=t.position.value(),e}shouldBeRemovedOnDeselect(){const e=this._properties.childs();if(e.showImage.value())return!1;return""===e.text.value().trim()}static createProperties(e){const t=new s.DefaultProperty("linetoolsignpost",e);return this._configureProperties(t),t.hasChild("text")||t.addChild("text",new(l())(r.t(null,void 0,i(37229)))),t.hasChild("position")||t.addChild("position",new(l())(50)),t.addExclusion("text"),t.addExclusion("position"),t.addChild("backgroundsColors",new d.LineToolColorsProperty([t.childs().plateColor])),t}_createPointProperty(e){super._createPointProperty(e);const t=this._pointsProperty.childs().points[e];t.removeProperty("price"),t.removeProperty("bar"),t.addChild("price",new a(this)),t.addChild("bar",new h(this,0))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text),this.properties().childs().position.setValue(e.position)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,611989)).then((e=>e.SignpostDefinitionsViewModel))}static _configureProperties(e){n.LineDataSource._configureProperties(e)}}p.supportPhantomMode=!0},305480:(e,t,i)=>{i.d(t,{LineToolSineLine:()=>n});var r=i(853965),s=i(821979);class n extends s.LineDataSource{constructor(e,t,r,s){super(e,t||n.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,435977)).then((e=>{this._setPaneViews([new e.SineLinePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Sine Line"}static createProperties(e){const t=new r.DefaultProperty("linetoolsineline",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,925293))).CyclicAndSineLinesPatternDefinitionsViewModel}}},7948:(e,t,i)=>{i.d(t,{LineToolSticker:()=>o});var r=i(853965),s=i(760184);const n=(0,i(201089).getLogger)("Chart.LineToolSticker");class o extends s.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t||o.createProperties(),i,r),this.version=1,this._loadViews()}name(){return"Sticker"}static createProperties(e){const t=new r.DefaultProperty("linetoolsticker",e);return o._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,282375))).LineDataSourceDefinitionsViewModel}async _loadViews(){
const[{getSvgContentForSticker:e,getSvgRenderer:t},{StickerPaneView:r},{svgRenderer:s}]=await Promise.all([i.e(25598).then(i.bind(i,40038)),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,434576)),i.e(72616).then(i.bind(i,500477))]);if(!this._isDestroyed){const i=this._properties.childs().sticker.value();this._svgContent=e(i),this._onIconChanged.fire();const o=t(s,i);null===o&&n.logWarn(`Couldn't create svg renderer for sticker ${i}`),this._setPaneViews([new r(this,this._model,o)])}}}},760184:(e,t,i)=>{i.d(t,{LineToolSvgIconBase:()=>a});var r=i(650151),s=i(86441),n=i(625422),o=i(707957),l=i(821979);class a extends l.LineDataSource{constructor(e,t,i,r){super(e,t,i,r),this._onIconChanged=new o.Delegate,this._svgContent=null,this._changePointData=null,this._loadViews()}pointsCount(){return 1}hasEditableCoordinates(){return!1}getAnchorLimit(){return 80}getChangePointForSync(e){return null}startChanging(e,t){const i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=this.properties().childs(),l=o.size.value();let a;if(t)a=(0,r.ensureNotNull)(this.pointToScreenPoint(t));else{let e=new s.Point(0,Math.max(80,l)/2);const t=(0,n.rotationMatrix)(o.angle.value());e=(0,n.transformPoint)(t,e),a=i.add(e)}const c=i.subtract(a).length();this._changePointData={centerPoint:i,initialLength:c,initialSize:l},super.startChanging(e,t)}setPoint(e,t,i){const{centerPoint:s,initialLength:n,initialSize:o}=(0,r.ensureNotNull)(this._changePointData),l=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),a=this.properties().childs();if(0===e||1===e){const t=l.subtract(s).normalized();let i=Math.acos(-t.x);Math.asin(t.y)>0&&(i=2*Math.PI-i),0===e&&(i+=Math.PI),a.angle.setValue(i)}else{const e=o*(s.subtract(l).length()/n);a.size.setValue(e)}}getSourceIcon(){const e=this.svgContent();return null===e?null:{type:"svgContent",content:e}}onSourceIconChanged(){return this._onIconChanged}svgContent(){return this._svgContent}static _configureProperties(e){super._configureProperties(e),e.addExclusion("angle")}}},520259:(e,t,i)=>{i.d(t,{LineToolText:()=>u,LineToolTextAbsolute:()=>p});var r=i(650151),s=i(86441),n=i(444372),o=i(821979),l=i(354950),a=i.n(l),c=i(853965),h=i(31712),d=i(964824);class u extends o.LineDataSource{constructor(e,t,r,s){const n=t||u.createProperties();super(e,n,r,s),this._barSpacing=e.timeScale().barSpacing(),this._recalculatePointsOnCenter=!1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,630468)).then((({TextPaneView:t})=>{const i=this._recalculatePointsOnCenter?(e,t)=>{this._recalculatePointsOnCenter&&this._recalculateCenterPosition(e,t)}:void 0;this._setPaneViews([new t(this,e,void 0,void 0,void 0,void 0,void 0,i)])}))}centerPosition(){this._recalculatePointsOnCenter=!0}setPoint(e,t,i){const s=this.properties().childs();let n;if(1===e&&s.wordWrapWidth.value()){const e=this.model().timeScale();n=this.isFixed()?(0,r.ensureDefined)(this.fixedPoint()).x:e.indexToCoordinate(this.points()[0].index);const i=e.indexToCoordinate(t.index)-n-~~(s.fontsize.value()/6);if(!isFinite(i))return;s.wordWrapWidth.setValue(Math.max(100,i))}}
pointsCount(){return 1}name(){return"Text"}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&(this._priceDencity=e.height()/(0,r.ensureNotNull)(e.priceRange()).length(),this._isPriceDencityLog=e.isLog())}restoreSize(){const e=(0,r.ensureNotNull)(this.priceScale());this._barSpacing=this.model().timeScale().barSpacing(),this._priceDencity=e.height()/(0,r.ensureNotNull)(e.priceRange()).length(),this.redraw((0,d.sourceChangeEvent)(this.id()))}redraw(e){this.updateAllViews(e),this._model.updateSource(this)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}state(e){const t=super.state(e);return e&&(t.state.fixedSize=!1),t}barSpacing(){return this._barSpacing}priceDencity(){return this._priceDencity}isPriceDencityLog(){return this._isPriceDencityLog}hasEditableCoordinates(){return!1}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}static createProperties(e){const t=new c.DefaultProperty("linetooltext",e);return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,941117)).then((e=>e.TextDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(a())(n.t(null,void 0,i(37229)))),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().color])),e.addExclusion("text"),e.addExclusion("linesColors"),e.addExclusion("textsColors")}_recalculateCenterPosition(e,t){const i=this.isFixed()?(0,r.ensureDefined)(this.fixedPoint()):(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=new s.Point(i.x-e/2,i.y-t/2),o=(0,r.ensureNotNull)(this.screenPointToPoint(n));this.setPoints([o]),this.normalizePoints(),this.createServerPoints(),this.redraw((0,d.sourceChangeEvent)(this.id()))}}class p extends u{constructor(e,t){super(e,t||p.createProperties())}name(){return"Anchored Text"}hasEditableCoordinates(){return!1}isFixed(){return!0}static createProperties(e){const t=new c.DefaultProperty("linetooltextabsolute",e);return this._configureProperties(t),t}}},521600:(e,t,i)=>{i.d(t,{LineToolThreeDrivers:()=>o});var r=i(853965),s=i(821979),n=i(31712);class o extends s.LineDataSource{constructor(e,t,r,s){const n=t||o.createProperties();super(e,n,r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,927913)).then((t=>{this._setPaneViews([new t.LineToolThreeDrivesPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Three Drives Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetoolthreedrivers",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,669403)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){
super._configureProperties(e),e.addChild("linesColors",new n.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new n.LineToolColorsProperty([e.childs().textcolor])),e.addChild("linesWidths",new n.LineToolWidthsProperty([e.childs().linewidth])),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors")}}},36459:(e,t,i)=>{i.d(t,{LineToolTimeCycles:()=>o});var r=i(822914),s=i(853965),n=i(821979);class o extends n.LineDataSource{constructor(e,t,r,s){super(e,null!=t?t:o.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,764389)).then((e=>{this._setPaneViews([new e.TimeCyclesPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Time Cycles"}setPoint(e,t){const i=(0,r.default)(t),s=this._points[0],n=this._points[1];s.price=i.price,n.price=i.price,this._points[e]=i,this.normalizePoints()}addPoint(e,t,i){const r=super.addPoint(e,t,!0);if(r){const e=this._points[0];this._points[1].price=e.price,i||(this.normalizePoints(),this.createServerPoints())}return r}static createProperties(e){const t=new s.DefaultProperty("linetooltimecycles",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,73900))).TimeCyclesPatternDefinitionsViewModel}}},167723:(e,t,i)=>{i.d(t,{LineToolTrendAngle:()=>d});var r=i(86441),s=i(650151),n=i(853965),o=i(821979),l=i(354950),a=i.n(l),c=i(964824);class h extends(a()){constructor(e){super(),this._lineSource=e}value(){return Math.round(180*this._lineSource.angle()/Math.PI)}setValue(e){const t=e*Math.PI/180,i=(0,s.ensureNotNull)(this._lineSource.pointToScreenPoint(this._lineSource.points()[0])),n=Math.cos(t),o=-Math.sin(t),l=new r.Point(n,o),a=i.addScaled(l,this._lineSource.distance()),h=(0,s.ensureNotNull)(this._lineSource.screenPointToPoint(a));this._lineSource.setPoint(1,h);const d=this._lineSource.model();d.updateSource(this._lineSource),this._lineSource.updateAllViews((0,c.sourceChangeEvent)(this._lineSource.id())),d.updateSource(this._lineSource)}notifyChanged(){this._listeners.fire(this)}}class d extends o.LineDataSource{constructor(e,t,r,s){const n=t||d.createProperties();super(e,n,r,s),this._angle=0,this._distance=0,n.addChild("angle",new h(this)),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,528123)).then((({TrendAnglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}isSynchronizable(){return!1}pointsCount(){return 2}name(){return"Trend Angle"}angle(){return this._angle}distance(){return this._distance}addPoint(e,t){const i=super.addPoint(e,t);return i&&this._calculateAngle(),i}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this.points().length>1&&this._calculateAngle(),i}axisPoints(){if(this.points().length<2)return[];const e=[this.points()[0]],t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),i=Math.cos(this._angle)*this._distance,n=-Math.sin(this._angle)*this._distance,o=t.add(new r.Point(i,n)),l=(0,s.ensureNotNull)(this.screenPointToPoint(o))
;return e.push(l),e}timeAxisPoints(){return this.axisPoints()}priceAxisPoints(){return this.axisPoints()}setPoint(e,t,i){super.setPoint(e,t,i),this.points().length>1&&1===e&&this._calculateAngle()}restoreData(e){var t,i;this._angle=null!==(t=e.angle)&&void 0!==t?t:0,this._distance=null!==(i=e.distance)&&void 0!==i?i:0}state(e){const t=super.state(e);return t.angle=this._angle,t.distance=this._distance,t}cloneData(e){this._angle=e.angle(),this._distance=e.distance()}canHasAlert(){return!0}static createProperties(e){e&&void 0===e.showPercentPriceRange&&(e.showPercentPriceRange=e.showPriceRange,e.showPipsPriceRange=e.showPriceRange);const t=new n.DefaultProperty("linetooltrendangle",e);return this._configureProperties(t),t}_snapTo45DegreesAvailable(){return!0}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}_calculateAngle(){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0]));let t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[1])).subtract(e);const i=t.length();i>0?(t=t.normalized(),this._angle=Math.acos(t.x),t.y>0&&(this._angle=-this._angle),this._distance=i):this._angle=0;this.properties().childs().angle.notifyChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,476535)).then((e=>e.TrendAngleDefinitionsViewModel))}}},882980:(e,t,i)=>{i.d(t,{LineToolTrendBasedFibExtension:()=>c});var r=i(444372),s=i(809796),n=i(517336),o=i(31712),l=i(821979);const a=new s.TranslatedString("erase level line",r.t(null,void 0,i(812962)));class c extends l.LineDataSource{constructor(e,t,r,s){super(e,t||c.createProperties(),r,s),this.version=2,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,242128)).then((({TrendBasedFibExtensionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}pointsCount(){return 3}name(){return"Trend-Based Fib Extension"}migrateVersion(e,t){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,a)}fibLevelsBasedOnLogScale(){var e;return this.properties().childs().fibLevelsBasedOnLogScale.value()&&Boolean(null===(e=this.priceScale())||void 0===e?void 0:e.isLog())}static createProperties(e){const t=new n.LevelsProperty("linetooltrendbasedfibextension",e,!1,{range:[0,8]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,866406))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){const t=e.childs();super._configureProperties(e);const i=[t.trendline.childs().color];for(let e=1;e<=24;e++){const r=t["level"+e].childs().color;i.push(r)}e.addChild("linesColors",new o.LineToolColorsProperty(i));const r=[t.trendline.childs().linewidth,t.levelsStyle.childs().linewidth]
;e.addChild("linesWidths",new o.LineToolWidthsProperty(r))}}},418219:(e,t,i)=>{i.d(t,{LineToolTrendBasedFibTime:()=>c});var r=i(444372),s=i(809796),n=i(821979),o=i(517336),l=i(31712);const a=new s.TranslatedString("erase level line",r.t(null,void 0,i(812962)));class c extends n.LineDataSource{constructor(e,t,r,s){super(e,t||c.createProperties(),r,s),this.version=1,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,61304)).then((({TrendBasedFibTimePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 3}name(){return"Trend-Based Fib Time"}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,a)}static createProperties(e){const t=new o.LevelsProperty("linetooltrendbasedfibtime",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,663394))).TrendBasedFibTimeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],r=[t.trendline.childs().color];for(let e=1;e<=11;e++)i.push(t["level"+e].childs().linewidth),r.push(t["level"+e].childs().color);e.addChild("linesColors",new l.LineToolColorsProperty(r)),e.addChild("linesWidths",new l.LineToolWidthsProperty(i))}}},956268:(e,t,i)=>{i.d(t,{LineToolTrendLine:()=>a});var r=i(853965),s=i(821979),n=i(837202),o=i(354950),l=i.n(o);class a extends s.LineDataSource{constructor(e,t,r,s){super(e,t||a.createProperties(),r,s),this._trendLinePaneView=null,Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,982446)).then((({TrendLinePaneView:e})=>{this._trendLinePaneView=new e(this,this._model),this._setPaneViews([this._trendLinePaneView])}))}dataAndViewsReady(){return super.dataAndViewsReady()&&null!==this._trendLinePaneView&&this._trendLinePaneView.iconsReady()}pointsCount(){return 2}name(){return"Trend Line"}canHasAlert(){return!0}showPriceLabels(){return this._properties.childs().showPriceLabels.value()}createPriceAxisView(e){return new n.LineToolPriceAxisView(this,{pointIndex:e,backgroundPropertyGetter:()=>this.showPriceLabels()?this._properties.childs().linecolor.value():null})}isForcedDrawPriceAxisLabel(){return this.showPriceLabels()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t){e&&void 0===e.showPercentPriceRange&&(e.showPercentPriceRange=e.showPriceRange,e.showPipsPriceRange=e.showPriceRange);const i=new r.DefaultProperty(null!=t?t:"linetooltrendline",e);return this._configureProperties(i),i}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,167738))).TrendLineDefinitionsViewModel}_applyTemplateImpl(e){
super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())("")),e.addExclusion("text")}}},948653:(e,t,i)=>{i.d(t,{LineToolTrianglePattern:()=>o});var r=i(853965),s=i(821979),n=i(31712);class o extends s.LineDataSource{constructor(e,t,r,s){const n=t||o.createProperties();super(e,n,r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,658539)).then((t=>{this._setPaneViews([new t.LineToolTrianglePatternPaneView(this,e)])}))}pointsCount(){return 4}name(){return"Triangle Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetooltrianglepattern",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,63124)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new n.LineToolColorsProperty([e.childs().textcolor])),e.addChild("backgroundsColors",new n.LineToolColorsProperty([e.childs().backgroundColor]))}}},287743:(e,t,i)=>{var r=i(821979).LineDataSource,s=i(853965).DefaultProperty,n=i(31712).LineToolColorsProperty;class o extends r{constructor(e,t,r,s){super(e,t||o.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.t.bind(i,560001,19)).then((({TrianglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 3}name(){return"Triangle"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,967382))).GeneralFiguresDefinitionsViewModel}static createProperties(e){var t=new s("linetooltriangle",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n([e.childs().color]))}}t.LineToolTriangle=o},972375:(e,t,i)=>{i.d(t,{createTweetLineToolByUrl:()=>d,isTwitterProfileImageUrl:()=>h,isTwitterUrl:()=>c});var r=i(650151),s=i(62802),n=i(541558),o=i(461794),l=i(623336);const a=(0,i(125226).isFeatureEnabled)("mock_tweet_data_for_tests");function c(e){try{const t=new URL(e);return("twitter.com"===t.hostname||t.hostname.endsWith(".twitter.com"))&&"https:"===t.protocol}catch(e){return!1}}function h(e){try{const t=new URL(e);return"pbs.twimg.com"===t.hostname&&"https:"===t.protocol&&t.pathname.startsWith("/profile_images/")}catch(e){return!1}}function d(e,t,i=!1){return async function(e){if(a)return{id:0x853cb08cfe8b,created_at:1638107940,text:"𝓭𝓪𝓲𝓵𝔂 𝓻𝓮𝓶𝓲𝓷𝓭𝓮𝓻\r\rAlways do your own research.",username:"tradingview",user:"TradingView",profile_image_url:"https://pbs.twimg.com/profile_images/1598328471729704963/D7slFVZN_400x400.jpg",tweet_url:"https://twitter.com/tradingview/status/1464957065621872641?s=20"};const t=new URL("/api/v1/get-tweet-data/",location.href)
;return t.searchParams.append("tweet_url",e),fetch(t.toString()).then((e=>{if(!e.ok)throw new Error(`Error processing tweet: ${e.statusText}`);return e.json()}))}(e).then((a=>{const c=function(e,t){var i;return{id:e.id,createdAt:e.created_at,text:(0,o.clean)(e.text,!0),username:`@${e.username}`,user:e.user,profileImageUrl:e.profile_image_url,tweetUrl:null!==(i=e.tweet_url)&&void 0!==i?i:t}}(a,e),h={price:0,time_t:c.createdAt,offset:0},d=t.mainSeries(),u=(0,r.ensureNotNull)(t.model().paneForSource(d)),p=u.newLineToolZOrder(!0),_={type:"drawing",source:{id:(0,n.randomHashN)(6),zorder:p,type:"LineToolTweet",position:50,state:{interval:"1",...l.LineToolTweet.createProperties().state()},tweetData:c,symbol:d.symbol(),ownerSource:d.id(),points:[h]},geometry:[],modelId:t.model().id()},g=t.pasteLineTool(u,_,!0,!0);return i&&s.setValue("hint.pasteTweet",!0,{forceFlush:!0}),g.pointAdded().subscribe(null,(()=>t.scrollToLineTool(g)),!0),g}))}},623336:(e,t,i)=>{i.d(t,{LineToolTweet:()=>b});var r=i(853965),s=i(444372),n=i(62802),o=i(345848),l=i(201089),a=i(167222),c=i(846778),h=i(270294),d=i(885482),u=i(543373),p=i(972375);const _=(0,l.getLogger)("Chart.TweetDialog"),g=s.t(null,void 0,i(100970)),f=s.t(null,void 0,i(735415));let P=null;function v(e){"LineToolTweet"===e?(window.is_authenticated||(0,d.resetToCursor)(!0),(0,a.runOrSigninWithFeature)((()=>{d.tool.setValue("LineToolTweet"),P=(0,u.showCustomUrlEventDialog)({onConfirm:m,onClose:()=>{P=null,"LineToolTweet"===d.tool.value()&&(0,d.resetToCursor)(!0)},title:g,placeholderText:f}),(0,o.trackEvent)("Tweet","Open tweet dialog")}),{feature:"drawings",source:"Change drawing tool state"})):null!==P&&P.then((e=>e()))}function m(e){const t=(0,h.chartWidgetCollectionService)();if(null===t)return;if(!(0,p.isTwitterUrl)(e))return void _.logWarn(`Invalid tweet url: ${e}`);const i=!Boolean(n.getBool("hint.pasteTweet")),r=t.activeChartWidget.value();(0,p.createTweetLineToolByUrl)(e,r.model()).then((()=>{i&&(0,c.showPasteLineToolHint)(t.getContainer(),"hint.pasteTweet")}))}var y=i(354950),C=i.n(y),x=i(70726);class w extends x.CustomEventItem{constructor(e,t){super(t),this._data=e}tweetData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){return this._data.profileImageUrl}}class b extends x.LineToolCustomUrlEvent{constructor(e,t,r,s){super(e,t||b.createProperties(),r,s),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,123896)).then((t=>{this._setPaneViews([new t.TweetPaneView(this,e)])}))}name(){return"Tweet"}state(e){const t=super.state(e);return this._item&&(t.tweetData=this._item.tweetData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){if(e.tweetData){if(!(0,p.isTwitterUrl)(e.tweetData.tweetUrl))throw new Error(`Invalid url for tweet line tool: ${e.tweetData.tweetUrl}`);this._item=new w(e.tweetData,this)}void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){const t=new r.DefaultProperty("linetoolTweet",e);return this._configureProperties(t),
t.hasChild("position")||t.addChild("position",new(C())(50)),t.addExclusion("position"),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,427491)).then((e=>e.TweetDefinitionsViewModel))}}(0,d.runOnDrawingStateReady)((()=>{d.tool.subscribe(v)}))},421644:(e,t,i)=>{i.d(t,{LineToolVertLineTimeAxisView:()=>s});var r=i(902214);class s extends r.LineDataSourceTimeAxisView{constructor(e){super(e,0)}_getBgColor(){return this._source.properties().linecolor.value()}_getAlwaysInViewPort(){return!1}_getIndex(){const e=this._source.points();return 0===e.length?null:e[0].index}}},43653:(e,t,i)=>{i.d(t,{LineToolVertLine:()=>h});var r=i(650151),s=i(86441),n=i(853965),o=i(354950),l=i.n(o),a=i(821979),c=i(421644);class h extends a.LineDataSource{constructor(e,t,r,s){const n=t||h.createProperties();super(e,n,r,s),this._timeAxisView=new c.LineToolVertLineTimeAxisView(this),this._paneViewFactory=null,this.properties().childs().extendLine.subscribe(this,(()=>e.lightUpdate())),Promise.all([i.e(98081),i.e(51583)]).then(i.bind(i,590810)).then((t=>{this._paneViewFactory=i=>new t.VertLinePaneView(this,e,i),this._model.lightUpdate()}))}destroy(){this.properties().childs().extendLine.unsubscribeAll(this),super.destroy()}pointsCount(){return 1}name(){return"Vertical Line"}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._timeAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}isMultiPaneAvailable(){return!0}isMultiPaneEnabled(){return this.properties().childs().extendLine.value()}paneViews(e){return e=(0,r.ensureDefined)(e),this.isMultiPaneEnabled()||this._model.paneForSource(this)===e?(null===this._getPaneViews(e)&&null!==this._paneViewFactory&&this._setPaneViews([this._paneViewFactory(e)],e,!0),super.paneViews(e)):null}priceAxisViews(){return null}priceAxisPoints(){return[]}pointToScreenPoint(e){const t=this._model.timeScale();if(t.isEmpty())return null;const i=t.indexToCoordinate(e.index);return new s.Point(i,0)}convertYCoordinateToPriceForMoving(e){return 0}static createProperties(e){null!=e&&(void 0===e.textOrientation&&(e.textOrientation="horizontal"),void 0===e.extendLine&&(e.extendLine=!1));const t=new n.DefaultProperty("linetoolvertline",e);return this._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index,price:e.price+1},i=this._linePointsToAlertPlot([e,t],null,!0,!0);return null===i?[]:[i]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(33038),i.e(15913),i.e(25900),i.e(56386),i.e(18537)]).then(i.bind(i,480262)).then((e=>e.VerticalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())("")),e.addExclusion("text")}}},964824:(e,t,i)=>{
i.r(t),i.d(t,{globalChangeEvent:()=>o,selectionChangeEvent:()=>h,sourceChangeEvent:()=>s,viewportChangeEvent:()=>a});var r=i(827147);function s(e){return(0,r.default)(e)?{type:"data-source-change",sourceId:e}:{type:"data-source-change",...e}}const n={type:"global-change"};function o(){return n}const l={type:"viewport-change"};function a(){return l}const c={type:"selection-change"};function h(){return c}},60897:(e,t,i)=>{i.d(t,{notAvailable:()=>r});i(444372),i(244842);const r="∅"},147354:(e,t,i)=>{var r;i.d(t,{PaneCursorType:()=>r}),function(e){e[e.Default=0]="Default",e[e.Pointer=1]="Pointer",e[e.Eraser=2]="Eraser",e[e.Dot=3]="Dot",e[e.Grabbing=4]="Grabbing",e[e.ZoomIn=5]="ZoomIn",e[e.VerticalResize=6]="VerticalResize",e[e.HorizontalResize=7]="HorizontalResize",e[e.DiagonalNeSwResize=8]="DiagonalNeSwResize",e[e.DiagonalNwSeResize=9]="DiagonalNwSeResize"}(r||(r={}))},742391:(e,t,i)=>{i.d(t,{PanePriceAxisView:()=>n});var r=i(294162);class s{constructor(e){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._width=0,this._height=0,this._textWidthCache=e}setParams(e,t,i,r,s){this._priceAxisViewRenderer=e,this._rendererOptions=t,this._width=i,this._height=r,this._align=s}draw(e,t){null!==this._rendererOptions&&null!==this._priceAxisViewRenderer&&this._priceAxisViewRenderer.draw(e,this._rendererOptions,this._textWidthCache,this._width,this._height,this._align,t.pixelRatio)}hitTest(e){var t,i;return void 0===(null===(t=this._priceAxisViewRenderer)||void 0===t?void 0:t.hitTest)?null:null===(i=this._priceAxisViewRenderer)||void 0===i?void 0:i.hitTest(e,this._width,this._align)}}class n{constructor(e,t,i){this._renderer=null,this._invalidated=!0,this._priceAxisView=e,this._textWidthCache=new r.TextWidthCache(100),this._dataSource=t,this._chartModel=i,this._fontSize=-1,this._panePriceAxisViewRenderer=new s(this._textWidthCache)}update(e){this._invalidated=!0}renderer(e,t){return this._invalidated&&this._updateImpl(e,t),this._renderer}_position(){const e=this._chartModel.crossHairSource(),t=this._dataSource===e?e.pane:this._chartModel.paneForSource(this._dataSource);if(null===t)return null;const i=this._priceScale();if(null===i)return null;let r=t.priceScalePosition(i);return"overlay"===r&&(r=t.priceScalePosition(t.defaultPriceScale())),"overlay"===r?null:r}_updateImpl(e,t){this._renderer=null;const i=this._position();if(null===i)return;const r=this._chartModel.priceAxisRendererOptions();r.fontSize!==this._fontSize&&(this._fontSize=r.fontSize,this._textWidthCache.reset()),this._panePriceAxisViewRenderer.setParams(this._priceAxisView.paneRenderer(),r,t,e,i),this._renderer=this._panePriceAxisViewRenderer,this._invalidated=!1}_priceScale(){return this._dataSource.priceScale()}}},57372:(e,t,i)=>{i.d(t,{AreaBackgroundItem:()=>a,AreaBackgroundItemsGroup:()=>o,AreaBackgroundRenderer:()=>c,CachedMap:()=>l});var r=i(650151),s=i(43192),n=i(632739);class o extends n.CachedContainer{constructor(e){super(),this.color=e}}class l{constructor(){this._map=new Map,this._usedKeys=new Set,this._invalidations=0}
invalidateCache(){this._invalidations+=1,50===this._invalidations&&(this._deleteUnused(),this._invalidations=0),this._usedKeys.clear(),this._map.forEach(((e,t)=>e.invalidateCache()))}get(e){const t=this._map.get(e);return void 0!==t&&this._usedKeys.add(e),t}set(e,t){this._usedKeys.add(e),this._map.set(e,t)}[Symbol.iterator](){const e=Array.from(this._usedKeys)[Symbol.iterator]();return{[Symbol.iterator](){return this},next:()=>{const t=e.next();return t.value?{value:[t.value,(0,r.ensureDefined)(this._map.get(t.value))],done:!1}:{value:void 0,done:!0}}}}forEach(e){this._map.forEach(((t,i)=>{this._usedKeys.has(i)&&e(t,i)}))}delete(e){const t=this._map.get(e);void 0!==t&&t.invalidateCache(),this._usedKeys.delete(e)}_deleteUnused(){const e=[];this._map.forEach(((t,i)=>{this._usedKeys.has(i)||e.push(i)}));for(const t of e)this._map.delete(t)}}class a extends n.CachedContainer{constructor(){super(),this.points1=new n.CachedContainer,this.points2=new n.CachedContainer,this.push(this.points1),this.push(this.points2)}addPoints1Point(e,t){let i=this.points1.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points1.push(i)}addPoints2Point(e,t){let i=this.points2.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points2.push(i)}invalidateCache(){this.points1.invalidateCache(),this.points2.invalidateCache()}}class c extends s.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=null,this._data=null!=e?e:null}setData(e){this._data=e}hitTest(e,t){return null}_drawImpl(e){var t,i;if(null===this._data)return;const{context:r,horizontalPixelRatio:s,verticalPixelRatio:n}=e,o=.25*this._data.barSpacing;for(const[,e]of this._data.colorAreas){r.beginPath();for(let t=0;t<e.length();t++){const i=e.at(t);if(i.points1.isEmpty()||i.points2.isEmpty())continue;const l=i.points1.at(0).x,a=i.points1.at(0).y;if(r.moveTo(Math.round(l*s),a*n),1!==i.points1.length()&&1!==i.points2.length()){for(const e of i.points1.iterator(1))r.lineTo(Math.round(e.x*s),e.y*n);for(const e of i.points2.iterator(i.points2.length()-1,!0))r.lineTo(Math.round(e.x*s),e.y*n)}else{const e=i.points2.at(0).x,t=i.points2.at(0).y;r.lineTo(Math.round((l+o)*s),a*n),r.lineTo(Math.round((e+o)*s),t*n),r.lineTo(Math.round((e-o)*s),t*n),r.lineTo(Math.round((l-o)*s),a*n)}}if(r.closePath(),0===e.color.type)r.fillStyle=e.color.color;else{const s=r.createLinearGradient(0,e.color.coordinate1*n,0,e.color.coordinate2*n);s.addColorStop(0,null!==(t=e.color.color1)&&void 0!==t?t:"transparent"),s.addColorStop(1,null!==(i=e.color.color2)&&void 0!==i?i:"transparent"),r.fillStyle=s}r.fill()}}}},413225:(e,t,i)=>{i.d(t,{PaneRendererArea:()=>l});var r=i(650151),s=i(879617),n=i(239589),o=i(787123);class l extends s.PaneRendererLine{constructor(e){e.forceLineColor=!1,super(e)}_drawImpl(e){var t,i,s,l,a;const c=this._data;if(0===c.items.length)return;let h=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,d=(null!==(l=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==l?l:this._data.items.length)-1
;for(;h<d&&!(0,n.coordinateIsValid)(c.items[h].y);)h++;for(;d>=0&&!(0,n.coordinateIsValid)(c.items[d].y);)d--;if(h>d)return;const{context:u,horizontalPixelRatio:p,verticalPixelRatio:_}=e;u.save(),u.scale(p,_),u.lineCap="round",u.strokeStyle=c.lineColor,u.lineWidth=c.lineWidth,(0,o.setLineStyle)(u,c.lineStyle),u.lineWidth=1;const g={},f=c.items;for(let e=h;e<=d;e++){const t=f[e];let i;if(i=t.style?t.style.color:c.lineColor,e<d&&f[e+1].style){const s=(0,r.ensureDefined)(f[e+1].style).color;if(i!==s){const e=g[s]||[];e.push(t),g[s]=e}}const s=g[i]||[];s.push(t),g[i]=s}for(const e of Object.keys(g)){const t=g[e];u.beginPath();let i=0;for(let r=0;r<t.length;r++)t[r].style&&(null===(a=t[r].style)||void 0===a?void 0:a.color)!==e&&(u.moveTo(Math.round(t[i].x),c.bottom),this._walkLine(u,t.slice(i,r),!0,c.bottom,!0),i=r);if(u.moveTo(Math.round(t[i].x),c.bottom),this._walkLine(u,t.slice(i,t.length),!0,c.bottom,!0),u.closePath(),c.isSeries){const e=u.createLinearGradient(0,0,0,c.bottom);e.addColorStop(0,c.color1),e.addColorStop(1,c.color2),u.fillStyle=e,c.simpleMode=!0}else u.fillStyle=e;u.fill()}u.lineWidth=c.lineWidth,u.restore(),super._drawImpl(e)}}},43192:(e,t,i)=>{i.d(t,{BitmapCoordinatesPaneRenderer:()=>s});var r=i(327714);class s{draw(e,t){new r.CanvasRenderingTarget2D(e,(0,r.size)({width:t.cssWidth,height:t.cssHeight}),(0,r.size)({width:t.physicalWidth,height:t.physicalHeight})).useBitmapCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new r.CanvasRenderingTarget2D(e,(0,r.size)({width:t.cssWidth,height:t.cssHeight}),(0,r.size)({width:t.physicalWidth,height:t.physicalHeight})).useBitmapCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},142119:(e,t,i)=>{i.d(t,{CompositeRenderer:()=>r});class r{constructor(){this._renderers=[],this._globalAlpha=1}setGlobalAlpha(e){this._globalAlpha=e}append(e){this._renderers.push(e)}insert(e,t){this._renderers.splice(t,0,e)}clear(){this._renderers.length=0}isEmpty(){return 0===this._renderers.length}draw(e,t){for(let i=0;i<this._renderers.length;i++)e.save(),e.globalAlpha=this._globalAlpha,this._renderers[i].draw(e,t),e.restore()}drawBackground(e,t){e.save(),e.globalAlpha=this._globalAlpha;for(let i=0;i<this._renderers.length;i++){const r=this._renderers[i];r.drawBackground&&r.drawBackground(e,t)}e.restore()}hitTest(e,t){let i=null;for(let r=this._renderers.length-1;r>=0;r--){const s=this._renderers[r].hitTest(e,t);null!==s&&(null===i||s.target()>i.target())&&(i=s)}return i}doesIntersectWithBox(e){return this._renderers.some((t=>!!t.doesIntersectWithBox&&t.doesIntersectWithBox(e)))}}},787123:(e,t,i)=>{i.r(t),i.d(t,{addHorizontalLineToPath:()=>l,addLineToPath:()=>C,addPixelPerfectLineToPath:()=>w,addVerticalLineToPath:()=>c,clearRectWithGradient:()=>n,computeDashPattern:()=>y,createCircle:()=>P,drawHorizontalLine:()=>a,drawLine:()=>x,drawPixelPerfectLine:()=>b,drawPoly:()=>v,drawRoundRect:()=>p,drawRoundRectWithInnerBorder:()=>_,drawVerticalLine:()=>h,fillRectInnerBorder:()=>o,fillRectWithBorder:()=>f,scaleDrawRoundRectRadii:()=>d,
scaledDashPattern:()=>g,setLineStyle:()=>m});var r=i(458963),s=i(379048);function n(e,t,i,r,s,n,o){e.save(),e.globalCompositeOperation="copy";const l=e.createLinearGradient(0,0,0,s);l.addColorStop(0,n),l.addColorStop(1,o),e.fillStyle=l,e.fillRect(t,i,r,s),e.restore()}function o(e,t,i,r,s,n){e.fillRect(t+n,i,r-2*n,n),e.fillRect(t+n,i+s-n,r-2*n,n),e.fillRect(t,i,n,s),e.fillRect(t+r-n,i,n,s)}function l(e,t,i,r){const s=e.lineWidth%2?.5:0;e.moveTo(i,t+s),e.lineTo(r,t+s)}function a(e,t,i,r){e.beginPath(),l(e,t,i,r),e.stroke()}function c(e,t,i,r){const s=e.lineWidth%2?.5:0;e.moveTo(t+s,i),e.lineTo(t+s,r)}function h(e,t,i,r){e.beginPath(),c(e,t,i,r),e.stroke()}function d(e,t){return Array.isArray(e)?e.map((e=>Math.round(e*t))):Math.round(e*t)}function u(e,t){return Array.isArray(e)?e.map((e=>0===e?e:e+t)):e+t}function p(e,t,i,r,s,n,o){let l,a,c,h;if(Array.isArray(n))if(2===n.length){const e=Math.max(0,n[0]),t=Math.max(0,n[1]);l=e,a=e,c=t,h=t}else{if(4!==n.length)throw new Error("Wrong border radius - it should be like css border radius");l=Math.max(0,n[0]),a=Math.max(0,n[1]),c=Math.max(0,n[2]),h=Math.max(0,n[3])}else{const e=Math.max(0,n);l=e,a=e,c=e,h=e}o||e.beginPath(),e.moveTo(t+l,i),e.lineTo(t+r-a,i),0!==a&&e.arcTo(t+r,i,t+r,i+a,a),e.lineTo(t+r,i+s-c),0!==c&&e.arcTo(t+r,i+s,t+r-c,i+s,c),e.lineTo(t+h,i+s),0!==h&&e.arcTo(t,i+s,t,i+s-h,h),e.lineTo(t,i+l),0!==l&&e.arcTo(t,i,t+l,i,l)}function _(e,t,i,r,n,o,l=0,a=0,c="",h=s.LineStyle.Solid){if(e.save(),!a||!c||c===o)return p(e,t,i,r,n,l),e.fillStyle=o,e.fill(),void e.restore();const d=a/2;if("transparent"!==o){const d="transparent"!==c&&h!==s.LineStyle.Solid;p(e,d?t:t+a,d?i:i+a,d?r:r-2*a,d?n:n-2*a,d?l:u(l,-a)),e.fillStyle=o,e.fill()}if("transparent"!==c){p(e,t+d,i+d,r-a,n-a,u(l,-d)),e.lineWidth=a,e.strokeStyle=c,m(e,h),e.closePath(),e.stroke()}e.restore()}function g(e,t){return t=Math.max(1,t),e.map((e=>e*t))}function f(e,t,i,s,n,o,l,a){const c=o%2/2,h=t+c,d=s+c;let u,p;if(a){const{borderMode:l,borderWidth:c,color:_,dashPattern:f,lineStyle:P}=a;switch(l){case"outer":{const e=-o/2-c/2,t=-c/2;p={left:h+e,right:d-e,top:i+t,bottom:n-t};break}case"center":{const e=c%2/2;p={left:t+e,right:s+e,top:i+e,bottom:n+e};break}case"inner":{const e=-o/2+c/2,t=c/2;p={left:h+e,right:d-e,top:i+t,bottom:n-t}}}e.strokeStyle=_,e.lineWidth=c;let v=-1;f?e.setLineDash(g(f,c)):void 0!==P&&(m(e,P),P===r.LINESTYLE_SOLID&&(v=1)),u={left:p.left+v*c/2,top:p.top+v*c/2,right:p.right-v*c/2,bottom:p.bottom-v*c/2}}l&&(e.fillStyle=l.color,u||(u={left:h-o/2,right:d+o/2,top:i,bottom:n}),e.fillRect(u.left,u.top,u.right-u.left,u.bottom-u.top)),p&&e.strokeRect(p.left,p.top,p.right-p.left,p.bottom-p.top)}function P(e,t,i,r){e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.closePath()}function v(e,t,i){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(const i of t)e.lineTo(i.x,i.y);e.closePath(),e.stroke(),i&&e.fill()}function m(e,t){let i=[];t!==r.LINESTYLE_SOLID&&(i=y(e.lineWidth,t)),e.setLineDash(i)}function y(e,t){return[[e,2*e],[5*e,6*e],[6*e,6*e],[e,4*e],[2*e,e]][t-1]}function C(e,t,i,r,s){e.moveTo(t,i),e.lineTo(r,s)}
function x(e,t,i,r,s){isFinite(t)&&isFinite(r)&&isFinite(i)&&isFinite(s)&&(e.beginPath(),C(e,t,i,r,s),e.stroke())}function w(e,t,i,r,s,n=1){t===r?c(e,Math.round(t*n),i*n,s*n):i===s?l(e,Math.round(i*n),t*n,r*n):C(e,t*n,i*n,r*n,s*n)}function b(e,t,i,r,s,n=1){e.beginPath(),w(e,t,i,r,s,n),e.stroke()}},239589:(e,t,i)=>{i.d(t,{coordinateIsValid:()=>f,extendAndClipLineSegment:()=>h,fillScaledRadius:()=>v,getArrowPoints:()=>d,interactionTolerance:()=>g,optimalBarWidth:()=>u,optimalCandlestickWidth:()=>p,optimalHiLoWidth:()=>_,setValidLineStyle:()=>P,strokeScaledRadius:()=>m});var r=i(86441),s=i(5531),n=i(86121),o=i(389137),l=i(787123);const a={common:13,line:13,minDistanceBetweenPoints:10,series:14,curve:10,anchor:13,esd:4},c={common:3,line:3,minDistanceBetweenPoints:5,series:2,curve:3,anchor:2,esd:0};function h(e,t,i,n,o,l){if((0,r.equalPoints)(e,t))return null;const a=new r.Point(0,0),c=new r.Point(i,n);if(o){if(l){const i=(0,s.intersectLineAndBox)((0,r.lineThroughPoints)(e,t),(0,r.box)(a,c));return Array.isArray(i)?i:null}{const i=(0,s.intersectRayAndBox)(t,e,(0,r.box)(a,c));return null===i||(0,r.equalPoints)(t,i)?null:(0,r.lineSegment)(t,i)}}if(l){const i=(0,s.intersectRayAndBox)(e,t,(0,r.box)(a,c));return null===i||(0,r.equalPoints)(e,i)?null:(0,r.lineSegment)(e,i)}{const i=(0,s.intersectLineSegmentAndBox)((0,r.lineSegment)(e,t),(0,r.box)(a,c));return Array.isArray(i)?i:null}}function d(e,t,i,r,s){const n=.5*i,o=Math.sqrt(2),l=t.subtract(e),a=l.normalized();let c=5*i;r&&(c=Math.min(c,.35*l.length()));const h=1*n;if(c*o*.2<=h)return[];const d=a.scaled(c),u=t.subtract(d),p=a.transposed(),_=1*c,g=p.scaled(_),f=u.add(g),P=u.subtract(g),v=f.subtract(t).normalized().scaled(h),m=P.subtract(t).normalized().scaled(h),y=s?t:t.add(v),C=s?t:t.add(m),x=n*(o-1),w=p.scaled(x),b=Math.min(c-1*n/o,n*o*1),S=a.scaled(b),T=t.subtract(w),I=t.add(w),L=t.subtract(S);return[[f,y],[C,P],[T,L.subtract(w)],[I,L.add(w)]]}function u(e,t){return t=t||1,Math.floor(.3*e*t)}function p(e,t){if(e>=2.5&&e<=4)return Math.floor(3*t);const i=1-.2*Math.atan(Math.max(4,e)-4)/(.5*Math.PI),r=Math.floor(e*i*t),s=Math.floor(e*t),n=Math.min(r,s);return Math.max(Math.floor(t),n)}function _(e){return.4*e}function g(){return(0,n.lastMouseOrTouchEventInfo)().isTouch?a:c}function f(e){return null!=e&&!(0,o.isNaN)(e)}function P(e,t){void 0!==t&&(0,l.setLineStyle)(e,t)}function v(e,t){const i=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+i}function m(e,t,i){const r=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+(r!==i%2?.5:0)}},9524:(e,t,i)=>{i.d(t,{HorizontalLineRenderer:()=>a});var r=i(315801),s=i(787123),n=i(239589),o=i(43192),l=i(199471);class a extends o.BitmapCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null,this._hitTest=new r.HitTestResult(r.HitTarget.Regular)}setData(e){this._data=e}setHitTest(e){this._hitTest=e}hitTest(e){if(null===this._data||!1===this._data.visible||null===this._hitTest)return null;const t=(0,
n.interactionTolerance)().line,i=Math.abs(e.y-this._data.y)<=t+this._data.linewidth/2,r=void 0===this._data.left||this._data.left-e.x<=t,s=void 0===this._data.right||e.x-this._data.right<=t;return i&&r&&s?this._hitTest:null}_drawImpl(e){if(null===this._data||!1===this._data.visible)return;const{context:t,horizontalPixelRatio:i,verticalPixelRatio:r,mediaSize:n}=e;if(this._data.y<-this._data.linewidth/2||this._data.y>n.height+this._data.linewidth/2)return;t.lineCap="butt",t.strokeStyle=this._data.color,t.lineWidth=Math.max(1,Math.floor(this._data.linewidth*i)),void 0!==this._data.linestyle&&(0,s.setLineStyle)(t,this._data.linestyle);const o=void 0!==this._data.left?Math.max(this._data.left,0):0,a=void 0!==this._data.right?Math.min(this._data.right,n.width):n.width,c=Math.round(this._data.y*r),h=Math.round(o*i),d=Math.round(a*i),u=this._data.excludeBoundaries;void 0!==u&&(0,l.addExclusionAreaByScope)(e,u),(0,s.drawHorizontalLine)(t,c,h,d)}}},879617:(e,t,i)=>{i.d(t,{PaneRendererLine:()=>c});var r=i(86441),s=i(204652),n=i(315801),o=i(239589),l=i(787123),a=i(43192);class c extends a.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){var t,i,l,a;const c=(0,o.interactionTolerance)().series+this._data.lineWidth/2;let h=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,d=(null!==(a=null===(l=this._data.visibleItemsRange)||void 0===l?void 0:l.endItemIndex)&&void 0!==a?a:this._data.items.length)-1;for(;d-h>2;){const t=Math.round((d+h)/2);this._data.items[t].x<=e.x?h=t:d=t}h=Math.max(1,h-1),d=Math.min(this._data.items.length-1,d+1);for(let t=h;t<=d;++t){const i=this._data.items[t-1],o=this._data.items[t],l=i.x,a=o.x;if((0,s.distanceToSegment)(new r.Point(l,i.y),new r.Point(a,o.y),new r.Point(e.x,e.y)).distance<=c)return this._data.hittest?this._data.hittest:new n.HitTestResult(n.HitTarget.Regular)}return null}_drawImpl(e){const{context:t,horizontalPixelRatio:i,verticalPixelRatio:r}=e;t.scale(i,r),t.lineCap="round",t.lineJoin="round",t.strokeStyle=this._data.lineColor,t.fillStyle=this._data.lineColor,t.lineWidth=this._data.lineWidth,(0,l.setLineStyle)(t,this._data.lineStyle),(0,o.setValidLineStyle)(t,this._data.lineStyle),this._data.simpleMode?this._drawSimpleMode(t,i,r):this._drawLines(t)}_drawSimpleMode(e,t,i){var r,s,n,o;e.beginPath(),this._walkLine(e,this._data.items,!1,NaN),e.stroke();const l=this._data.lineWidth+2;if(this._data.withMarkers&&2*l<this._data.barSpacing){e.scale(1/t,1/i);const a=Math.max(1,Math.floor(t))%2/2,c=l*i+a,h=2*Math.PI;e.beginPath();const d=null!==(s=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.startItemIndex)&&void 0!==s?s:0;for(let r=(null!==(o=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.endItemIndex)&&void 0!==o?o:this._data.items.length)-1+1;r-- >=d;){const s=this._data.items[r];if(s){const r=Math.round(s.x*t)+a,n=s.y*i;e.moveTo(r,n),e.arc(r,n,c,0,h)}}e.fill()}}_walkLine(e,t,i,r,s){var n,l,a,c;if(!t)return;const h=.25*this._data.barSpacing;let d,u,p,_,g
;const f=o.coordinateIsValid,P=s?0:null!==(l=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.startItemIndex)&&void 0!==l?l:0,v=s?t.length-1:Math.min((null!==(c=null===(a=this._data.visibleItemsRange)||void 0===a?void 0:a.endItemIndex)&&void 0!==c?c:t.length)-1,t.length-1);for(let e=P;e<=v;e++){const i=t[e];if(f(i.y)){u=i,d=e;break}}if(void 0!==d&&void 0!==u)for(let s=d;s<=v;s++){_=t[s],g=t[s+1]||{};const n=Math.round(_.x);if(f(_.y))if(p&&f(p.y))e.lineTo(n,_.y),i&&!f(g.y)&&e.lineTo(n,r);else if(g&&f(g.y))i?(s!==d&&e.lineTo(n,r),e.lineTo(n,_.y)):e.moveTo(n,_.y);else if(i){if(0===s)continue;s!==d&&e.lineTo(n-h,r),e.lineTo(n-h,_.y),e.lineTo(n+h,_.y),e.lineTo(n+h,r)}else e.moveTo(n-h,_.y),e.lineTo(n+h,_.y);p=_}}_drawLines(e){var t,i,r,s;if(!this._data.items.length)return;let n,l,a;const c=.25*this._data.barSpacing,h=o.coordinateIsValid;e.beginPath();const d=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,u=(null!==(s=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==s?s:this._data.items.length)-1,p=this._data.items[d];p&&e.moveTo(p.x,p.y);let _,g=e.strokeStyle,f=e.lineWidth;for(let t=d+1;t<=u;++t){let i,r,s;n=this._data.items[t-1],l=this._data.items[t],a=this._data.items[t+1],l.style&&!this._data.forceLineColor?(i=l.style.color,r=l.style.width,s=l.style.style):(i=this._data.lineColor,r=this._data.lineWidth,s=this._data.lineStyle),this._data.ignorePaletteLineWidth&&(r=this._data.lineWidth);(i!==g||r!==f||s!==_)&&(g=i,f=r,_=s,e.stroke(),e.beginPath(),e.strokeStyle=i,e.lineWidth=r,(0,o.setValidLineStyle)(e,s),e.moveTo(n.x,n.y)),P=n,m=a,h((v=l).y)&&(h(P.y)?e.lineTo(v.x,v.y):m&&h(m.y)?e.moveTo(v.x,v.y):(e.moveTo(v.x-c,v.y),e.lineTo(v.x+c,v.y)))}var P,v,m;e.stroke()}}},710455:(e,t,i)=>{i.d(t,{MediaCoordinatesPaneRenderer:()=>s});var r=i(327714);class s{draw(e,t){new r.CanvasRenderingTarget2D(e,(0,r.size)({width:t.cssWidth,height:t.cssHeight}),(0,r.size)({width:t.physicalWidth,height:t.physicalHeight})).useMediaCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new r.CanvasRenderingTarget2D(e,(0,r.size)({width:t.cssWidth,height:t.cssHeight}),(0,r.size)({width:t.physicalWidth,height:t.physicalHeight})).useMediaCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},632739:(e,t,i)=>{i.d(t,{CachedContainer:()=>s,ObjectValuesCache:()=>n});class r{constructor(e,t,i,r){this._items=e,this._actualLength=t,this._step=r?-1:1,this._currentIndex=i-this._step}[Symbol.iterator](){return this}next(){return this._currentIndex+=this._step,this._currentIndex>=this._actualLength||this._currentIndex<0?{value:void 0,done:!0}:{done:!1,value:this._items[this._currentIndex]}}}class s{constructor(){this._items=[],this._actualLength=0,this._invalidations=0}push(e){this._items.length===this._actualLength?this._items.push(e):this._items[this._actualLength]!==e&&(this._items[this._actualLength]=e),this._actualLength+=1}newItem(){const e=this._items.length>this._actualLength?this._items[this._actualLength]:null
;return null!==e&&Boolean(e.invalidateCache)&&e.invalidateCache(),e}invalidateCache(){this._invalidations+=1,3e3===this._invalidations&&(this._items.splice(this._actualLength),this._invalidations=0),this._actualLength=0}at(e){return this._items[e]}data(){return this._items}length(){return this._actualLength}isEmpty(){return 0===this._actualLength}iterator(e,t){return new r(this._items,this._actualLength,e,t)}}class n extends s{constructor(){super(...arguments),this._startIndex=0}setStartIndex(e){this._startIndex=e}isValidIndex(e){return e>=this._startIndex}at(e){const t=e-this._startIndex;for(;t>=this._actualLength;)this._items.length<=t?this._items.push(this._newObject()):this._clearObject(this._items[this._actualLength]),this._actualLength+=1;return this._items[t]}}},627172:(e,t,i)=>{i.d(t,{PaneRendererStepLine:()=>f,StepLineDecoration:()=>r});var r,s=i(204652),n=i(86441),o=i(246733),l=i(315801),a=i(674981),c=i(239589),h=i(787123),d=i(43192);!function(e){e[e.None=0]="None",e[e.Diamonds=1]="Diamonds"}(r||(r={}));class u{initialize(e,t,i){var r,s,n,o;const{context:l,horizontalPixelRatio:a,verticalPixelRatio:c}=t,d=e.lineStyle;l.lineCap="butt",l.lineJoin="round";const u=Math.max(Math.floor(null!==(s=null===(r=i.style)||void 0===r?void 0:r.width)&&void 0!==s?s:e.lineWidth*a));void 0!==d&&(0,h.setLineStyle)(l,d);const p=u%2?.5:0;l.moveTo(Math.round(i.x*a)+p,Math.round(i.y*c)+p),l.strokeStyle=null!==(o=null===(n=i.style)||void 0===n?void 0:n.color)&&void 0!==o?o:e.lineColor,l.lineWidth=u}finishFragment(e){e.stroke()}hitTest(e,t,i,r,s){return u.hitTest(e,t,i,r,s)}applyColor(e,t){e.strokeStyle=t}applyLineWidth(e,t){e.lineWidth=t}drawItem(e,t,i){const r=e.context;r.lineTo(t.x,t.y),void 0!==i&&(r.lineTo(i.x,t.y),r.lineTo(i.x,i.y))}static hitTest(e,t,i,r,o){var l,a;const h=t.pixelRatio,d=null!==(a=null===(l=i.style)||void 0===l?void 0:l.width)&&void 0!==a?a:e.lineWidth,u=Math.max(1,Math.floor(d*h))%2?.5:0,p=(0,c.interactionTolerance)().series+d/2;let _;if(isNaN(r.y)){const e=i.x+u,t=r.x+u,l=new n.Point(e,i.y),a=new n.Point(t,i.y);_=(0,s.distanceToSegment)(l,a,o).distance}else{const t=Math.round(r.x-e.barSpacing/2*h)+u,l=new n.Point(t,i.y),a=new n.Point(t,r.y);_=Math.min((0,s.distanceToSegment)(i,l,o).distance,(0,s.distanceToSegment)(l,a,o).distance,(0,s.distanceToSegment)(a,r,o).distance)}return _<=p}}class p{constructor(){this._lineWidth=1}initialize(e,t,i){var r,s,n,o;const{context:l,horizontalPixelRatio:a}=t;this.applyColor(l,null!==(s=null===(r=i.style)||void 0===r?void 0:r.color)&&void 0!==s?s:e.lineColor),this._lineWidth=Math.max(Math.floor(null!==(o=null===(n=i.style)||void 0===n?void 0:n.width)&&void 0!==o?o:e.lineWidth*a))}finishFragment(e){e.fill()}drawItem(e,t,i,r){if(r&&void 0!==i&&!Number.isNaN(i.y)){const t=e.context;t.save(),t.translate(i.x,i.y),t.rotate(Math.PI/4);const r=this._scaleByLineWidth(this._lineWidth);t.scale(r,r),this._drawItemRotatedAndTranslated(e),t.restore()}}applyLineWidth(e,t){this._lineWidth=t}hitTest(e,t,i,r,s){var o,l;if(!r.valIsNotSameAsPrev)return!1
;const a=Math.round((i.x+r.x)/2),c=new n.Point(a,r.y),h=s.subtract(c),d=Math.max(Math.floor(null!==(l=null===(o=i.style)||void 0===o?void 0:o.width)&&void 0!==l?l:e.lineWidth*t.pixelRatio));return this._hitTestTranslated(h,d)}_scaleByLineWidth(e){return Math.sqrt(e)}}class _ extends p{applyColor(e,t){e.fillStyle=t}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<8*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e){(0,h.drawRoundRect)(e.context,-4,-4,8,8,2,!0)}}class g extends p{applyColor(e,t){e.fillStyle=(0,o.applyTransparency)(t,85)}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<21*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e){(0,h.drawRoundRect)(e.context,-10.5,-10.5,21,21,5,!0)}}class f extends d.BitmapCoordinatesPaneRenderer{constructor(e,t){super(),this._data=null,this._data=null!=e?e:null,this._extendLineToLastConfirmedBar=Boolean(t)}setData(e){this._data=e}hitTest(e,t){const i=this._data;if(null===i||0===i.items.length)return null;const{items:s,items:{length:o},lastConfirmedSeriesBarCoordinate:c,visibleItemsRange:{startItemIndex:h,endItemIndex:d}={startItemIndex:0,endItemIndex:o}}=i,p=i.decoration===r.Diamonds?[new u,new g]:[new u];const _=(0,a.lowerbound)(s,e,((e,t)=>e.x<=t.x),h,d),f=Math.max(0,_-1),P=Math.min(o,_+1);for(let r=f;r<P;r++){const a=s[r],h=s[r+1];if(h){if(p.some((r=>r.hitTest(i,t,a,h,e))))return new l.HitTestResult(l.HitTarget.Regular)}else if(this._extendLineToLastConfirmedBar&&void 0!==c&&P===o&&a.x<t.cssWidth&&a.x<c){const r=(0,n.point)(c,a.y);if(u.hitTest(i,t,a,r,e))return new l.HitTestResult(l.HitTarget.Regular)}}return null}_drawImpl(e){if(null===this._data||0===this._data.items.length)return;(this._data.decoration===r.Diamonds?[new u,new _,new g]:[new u]).forEach((t=>this._drawDecorationItem(e,t)))}_drawDecorationItem(e,t){var i,r,s,o,l,a,c,h,d,u,p,_,g,f,P,v;if(null===this._data||0===this._data.items.length)return;const{lineWidth:m,lineColor:y,items:C}=this._data,{context:x,horizontalPixelRatio:w,verticalPixelRatio:b,bitmapSize:S}=e;let T=Math.max(Math.floor(null!==(r=null===(i=C[0].style)||void 0===i?void 0:i.width)&&void 0!==r?r:m*w)),I=T%2?.5:0;t.initialize(this._data,e,C[0]);const L=null!==(o=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.startItemIndex)&&void 0!==o?o:0,M=null!==(a=null===(l=this._data.visibleItemsRange)||void 0===l?void 0:l.endItemIndex)&&void 0!==a?a:C.length,V=this._data.barSpacing;if(!(M<=L)){x.beginPath(),t.applyColor(x,null!==(h=null===(c=C[L].style)||void 0===c?void 0:c.color)&&void 0!==h?h:y);for(let i=L;i<M;i++){const r=C[i],s=i===M-1?null:C[i+1];let o=0;this._data.extendToBarsEndings&&(i===L&&(o=-this._data.barSpacing/2),i===M-1&&(o=this._data.barSpacing/2));const l=Math.round((r.x+o)*w)+I,a=Math.round(r.y*b)+I;if(!s){if(t.drawItem(e,(0,n.point)(l,a)),this._extendLineToLastConfirmedBar&&void 0!==this._data.lastConfirmedSeriesBarCoordinate&&l<S.width&&r.x<this._data.lastConfirmedSeriesBarCoordinate){const i=Math.round((this._data.lastConfirmedSeriesBarCoordinate+o)*w)+I;l<i&&t.drawItem(e,(0,
n.point)(Math.min(S.width,i),a),void 0,!0)}continue}const c=isNaN(s.y),h=Math.round((s.x-V/2)*w)+I,D=Math.round(s.y*b)+I;t.drawItem(e,(0,n.point)(l,a),(0,n.point)(h,D),s.valIsNotSameAsPrev);const B=null!==(u=null===(d=r.style)||void 0===d?void 0:d.color)&&void 0!==u?u:y,A=null!==(_=null===(p=r.style)||void 0===p?void 0:p.width)&&void 0!==_?_:m,R=null!==(f=null===(g=s.style)||void 0===g?void 0:g.color)&&void 0!==f?f:y,N=null!==(v=null===(P=s.style)||void 0===P?void 0:P.width)&&void 0!==v?v:m,k=B!==R,E=A!==N;(k||E||c)&&(t.finishFragment(x),k&&t.applyColor(x,R),E&&(T=Math.max(1,Math.floor(N*w)),I=T%2?.5:0,t.applyLineWidth(x,T)),x.beginPath(),x.moveTo(h,D))}t.finishFragment(x)}}}},888929:(e,t,i)=>{i.d(t,{sortSources:()=>s,sortSourcesPreOrdered:()=>r});const r={LatestUpdates:10000001,BarMarks:10000002,TimeScaleMarks:10000003,ChartEventsSource:10000004,Dividends:10000005,Splits:10000006,Earnings:10000007,RollDates:10000008,FutureContractExpiration:10000009,LineToolOrder:10000010,LineToolPosition:10000011,LineToolExecution:10000012,AlertLabel:10000013};function s(e){return[...e].sort(((e,t)=>e.zorder()-t.zorder()))}},601183:(e,t,i)=>{i.d(t,{PriceAxisViewRenderer:()=>u,hittestByData:()=>d});var r=i(86441),s=i(934026),n=i(86121),o=i(31341),l=i(199471),a=i(315801),c=i(787123);const h=new Path2D("M7.5 0.8a1 1 0 0 0 0 13.4 1 1 0 0 0 0-13.4zm0 1a1 1 0 0 1 0 11 1 1 0 0 1 0-11zm-.97-.25A3.5 3.5 0 0 0 3.5 0 3.5 3.5 0 0 0 0 3.5a3.5 3.5 0 0 0 1.75 3.03l.5-.86A2.5 2.5 0 0 1 1 3.5 2.5 2.5 0 0 1 3.5 1a2.5 2.5 0 0 1 2.17 1.25zm6.72 4.78A3.5 3.5 0 0 0 15 3.5 3.5 3.5 0 0 0 11.5 0a3.5 3.5 0 0 0-3.03 1.75l.86.5A2.5 2.5 0 0 1 11.5 1 2.5 2.5 0 0 1 14 3.5a2.5 2.5 0 0 1-1.25 2.17zM7 5h1v5H7zm3 2v1H5V7z");function d(e,t){var i;const o=(0,n.lastMouseOrTouchEventInfo)().isTouch?10:0,l=e.hitTestData;if(void 0===l||!e.visible)return null;const{itemBox:c,clickHandler:h,tooltip:d}=l;if(c){const n=(0,r.box)(new r.Point(c.min.x-o,c.min.y-o),new r.Point(c.max.x+o,c.max.y+o));if((0,s.pointInBox)(t,n))return new a.HitTestResult(null!==(i=e.hitTarget)&&void 0!==i?i:a.HitTarget.Custom,{clickHandler:null==h?void 0:h.bind(null,t),tapHandler:null==h?void 0:h.bind(null,t),hoverModelFromAxis:l.hoverModelFromAxis,activeItem:l.activeItem,tooltip:d})}return null}class u{constructor(e,t){this._bodyBox=null,this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}lastDrawnBodyBox(){return this._bodyBox}draw(e,t,i,s,n,a,h){var d,u,p,_;const g=this._data;if(!g.visible||this._isOutOfScreen(t,n))return;const f=this._commonData,P=void 0!==g.labelIcon,v=t.borderSize,m=t.paddingTop+f.additionalPaddingTop,y=t.paddingBottom+f.additionalPaddingBottom,C=t.paddingInner,x=g.ignoreAdditionalPaddingInner?0:t.additionalPaddingInner,w=t.paddingOuter,b=t.fontSize;let S=g.text,T=g.textColor||f.textColor,I=g.secondLine||"",L=f.secondLineTextColor||T,M=g.thirdLine||"";const V=f.thirdLineTextColor||T;0===I.length&&(I=M,L=V,M=""),0===S.length&&(S=I,T=L,I=M,L=V,M=""),e.save(),e.font=t.font
;const D=i.yMidCorrection(e,S)*h,B=Math.ceil(i.measureText(e,S)),A=b+m+y,R=(null!==(d=g.labelIconMinWidth)&&void 0!==d?d:0)*h,N=Boolean(I),k=Boolean(M),E=N?Math.ceil(i.measureText(e,I)):0,O=k?Math.ceil(i.measureText(e,M)):0,F=v+C+w+B+x,W=E>0?v+C+w+E+x:0,z=O>0?v+C+w+O+x:0,H=Math.max(F,W,z),U=Math.max(1,Math.floor(h));let G=Math.round(A*h);G%2!=U%2&&(G+=1);const q=Math.round((b+t.lineSpacing)*h),K=Math.round(2*(b+t.lineSpacing)*h),Y=Math.max(1,Math.floor(v*h)),j=g.separatorVisible?Y:0,Q=g.borderVisible?Y:0,$=P?Math.max(G,R):Math.round(H*h),X=Math.round(x*h),Z=Math.ceil(s*h),J=Math.ceil(C*h),ee=Math.round((null!==(u=f.fixedCoordinate)&&void 0!==u?u:f.coordinate)*h)-Math.floor(.5*h),te=Math.floor(ee+U/2-G/2),ie=te+G,re="right"===a,se=void 0!==g.xCoord?Math.round(g.xCoord*h)+(re?1:-1)*Math.round($/2):re?Z-j:j,ne=Z;let oe,le=se;const ae=null!==(p=g.backgroung)&&void 0!==p?p:f.background;e.fillStyle=ae;const ce=2*h;if(e.textAlign=re?"right":"left",e.textBaseline="middle",re?(le=se-$,oe=se-X-J-1):(le=se+$,oe=se+X+J),this._bodyBox=null,S||P){const i=k?G+K:N?G+q:G,s=null!==(_=f.borderColor)&&void 0!==_?_:ae,n=void 0!==g.xCoord?ce:0;if(((t,s,o)=>{if(re){(0,c.drawRoundRectWithInnerBorder)(e,le,te,$,i,t,g.overridenRadius?(0,c.scaleDrawRoundRectRadii)(g.overridenRadius,h):[ce,n,n,ce],Q,s,o);const l=(0,r.point)(le/h,te/h),a=l.add((0,r.point)($/h,i/h));this._bodyBox=(0,r.box)(l,a)}else{(0,c.drawRoundRectWithInnerBorder)(e,se,te,$,i,t,g.overridenRadius?(0,c.scaleDrawRoundRectRadii)(g.overridenRadius,h):[n,ce,ce,n],Q,s,o);const l=(0,r.point)(se/h,te/h),a=l.add((0,r.point)($/h,i/h));this._bodyBox=(0,r.box)(l,a)}})(ae,s,f.borderStyle),g.separatorVisible&&(e.fillStyle=t.paneBackgroundColor,e.fillRect(re?ne-j:0,te,j,ie-te)),P){switch(g.labelIcon){case 0:this._drawPlusIcon(e,se,le,te,ee,ie,U);break;case 1:this._drawClockIcon(e,se,le,ee,U,h)}return void e.restore()}e.save(),e.translate(oe,(te+ie)/2+D),(0,l.drawScaled)(e,h,h,(()=>{e.fillStyle=T,e.fillText(S,0,0)})),e.restore()}N&&(e.fillStyle=L,e.save(),e.translate(oe,(te+ie)/2+D+q),(0,l.drawScaled)(e,h,h,(()=>{e.fillText((0,o.startWithLTR)(I),0,0)})),e.restore()),k&&(e.fillStyle=V,e.save(),e.translate(oe,(te+ie)/2+D+K),(0,l.drawScaled)(e,h,h,(()=>{e.fillText((0,o.startWithLTR)(M),0,0)})),e.restore()),e.restore()}topBottomTotalHeight(e){const t=this._lines();if(!this._data.visible||0===t)return{top:0,bottom:0,total:0};const i=e.fontSize/2+e.paddingTop+this._commonData.additionalPaddingTop,r=(t-.5)*e.fontSize+(t-1)*e.lineSpacing+e.paddingBottom+this._commonData.additionalPaddingBottom;return{top:i,bottom:r,total:i+r}}hitTest(e){return d(this._data,e)}_drawPlusIcon(e,t,i,r,s,n,o){e.fillStyle=this._commonData.textColor,e.strokeStyle=this._commonData.textColor,e.lineWidth=o;const l=Math.abs(t-i);let a=Math.round(.35*l);a%2!=o%2&&(a+=1);let c=Math.round(.65*l);c%2!=o%2&&(c+=1);const h=Math.floor((l-a)/2),d=Math.min(t,i),u=d+Math.floor(l/2-o/2);e.fillRect(d+h,s,a,o),e.fillRect(u,r+h,o,a),e.beginPath(),e.arc(u+o/2,s+o/2,c/2,0,2*Math.PI,!1),e.stroke()}_drawClockIcon(e,t,i,r,s,n){
e.fillStyle=this._commonData.textColor,e.lineWidth=s;const o=Math.abs(t-i);let l=Math.round(.35*o);l%2!=s%2&&(l+=1);let a=Math.round(.65*o);a%2!=s%2&&(a+=1);const c=Math.min(t,i)+Math.floor(o/2-s/2);e.save(),e.translate(c+s/2-a/2,r+s/2-a/2),e.scale(n,n),e.fill(h),e.restore()}_lines(){const e=this._data;return(e.text?1:0)+(e.secondLine?1:0)+(e.thirdLine?1:0)}_isOutOfScreen(e,t){var i;const r=this._commonData,s=null!==(i=r.fixedCoordinate)&&void 0!==i?i:r.coordinate,{total:n}=this.topBottomTotalHeight(e),o=n/this._lines();return s-o/2-3>t||s+(n-o/2)+3<0}}},229765:(e,t,i)=>{i.d(t,{PriceAxisView:()=>n});var r=i(601183),s=i(246733);class n{constructor(e){this._commonRendererData={coordinate:0,textColor:"#FFF",background:"#000",additionalPaddingBottom:0,additionalPaddingTop:0},this._axisRendererData={text:"",visible:!1,separatorVisible:!1,borderVisible:!1,ignoreAdditionalPaddingInner:!1},this._paneRendererData={text:"",visible:!1,separatorVisible:!0,borderVisible:!1,ignoreAdditionalPaddingInner:!0},this._invalidated=!0,this._active=!1,this._axisRenderer=new(e||r.PriceAxisViewRenderer)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(e||r.PriceAxisViewRenderer)(this._paneRendererData,this._commonRendererData)}setActive(e){this._active=e}text(){return this._updateRendererDataIfNeeded(),this._axisRendererData.text}secondLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.secondLine}thirdLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.thirdLine}background(){return this._updateRendererDataIfNeeded(),this._commonRendererData.background}color(){return this._updateRendererDataIfNeeded(),this.generateTextColor(this.background())}generateTextColor(e){return(0,s.colorFromBackground)(e)}coordinate(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate}floatCoordinate(){var e;return this._updateRendererDataIfNeeded(),null!==(e=this._commonRendererData.floatCoordinate)&&void 0!==e?e:this._commonRendererData.coordinate}update(e){this._invalidated=!0}topBottomTotalHeight(e){this._updateRendererDataIfNeeded();const{top:t,bottom:i,total:r}=this._axisRenderer.topBottomTotalHeight(e),{top:s,bottom:n,total:o}=this._paneRenderer.topBottomTotalHeight(e);return{top:Math.max(t,s),bottom:Math.max(i,n),total:Math.max(r,o)}}getFixedCoordinate(){return this._commonRendererData.fixedCoordinate||0}setFixedCoordinate(e){this._commonRendererData.fixedCoordinate=e}isVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible}isAxisLabelVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible}isPaneLabelVisible(){return this._updateRendererDataIfNeeded(),this._paneRendererData.visible}renderer(){return this._updateRendererDataIfNeeded(),this._axisRenderer}paneRenderer(){return this._updateRendererDataIfNeeded(),this._paneRenderer}setPaneRendererLabelIcon(e){this._paneRendererData.labelIcon=e}setPaneLabelVisible(e){this._paneRendererData.visible=e,this._invalidated=!0}
ignoreAlignment(){return!1}_updateRendererDataIfNeeded(){this._invalidated&&(this._commonRendererData.fixedCoordinate=void 0,this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData),this._invalidated=!1)}}},506387:(e,t,i)=>{i.d(t,{PriceLineAxisView:()=>a,SeriesPriceLineAxisView:()=>c,StudyPriceLineAxisView:()=>h});var r=i(229765),s=i(650151),n=i(458963),o=i(787123);class l{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,r,l,a,c){var h;if(!this._data.visible)return;const d=null!==(h=this._commonData.fixedCoordinate)&&void 0!==h?h:this._commonData.coordinate;e.lineWidth=Math.max(1,Math.floor((0,s.ensureDefined)(this._data.linewidth)*c)),e.lineCap="butt",(0,o.setLineStyle)(e,void 0===this._data.linestyle?n.LINESTYLE_DOTTED:this._data.linestyle),e.strokeStyle=this._commonData.textColor,(0,o.drawHorizontalLine)(e,Math.round(d*c),0,Math.ceil(r*c))}topBottomTotalHeight(e){return{top:0,bottom:0,total:0}}}class a extends r.PriceAxisView{constructor(e){super(e||l)}ignoreAlignment(){return!0}_updateRendererData(e,t,i){if(t.visible=!1,e.visible=!1,!this._isVisible())return;const r=this._value();r.noData||(i.background="",i.textColor=this._priceLineColor(r.color),i.coordinate=r.coordinate,i.floatCoordinate=r.floatCoordinate,e.linewidth=this._lineWidth(),e.linestyle=this._lineStyle(),e.backgroundAreaVisible=this._backgroundAreaVisible(),e.backgroundAreaColor=this._backgroundAreaColor(),e.backgroundAreaHeight=this._backgroundAreaHeight(),e.visible=!0)}_lineStyle(){return n.LINESTYLE_DOTTED}_backgroundAreaVisible(){return!1}_backgroundAreaColor(){return""}_backgroundAreaHeight(){return 0}}class c extends a{constructor(e){super(),this._series=e}_value(){return this._series.lastValueData(void 0,!0)}_priceLineColor(e){return this._series.priceLineColor(e)}_lineWidth(){return this._series.properties().childs().priceLineWidth.value()}_isVisible(){const e=this._series.model().properties().childs().scalesProperties.childs().showSeriesLastValue.value();return this._series.properties().childs().showPriceLine.value()&&e}}class h extends a{constructor(e,t){super(),this._study=e,this._plotname=t}_value(){return this._study.lastValueData(this._plotname,!0)}_lineWidth(){return this._study.properties().childs().styles.childs()[this._plotname].childs().linewidth.value()}_lineStyle(){return n.LINESTYLE_DOTTED}_priceLineColor(e){return e}_isVisible(){const e=this._study.model().properties().childs().scalesProperties.childs().showStudyLastValue.value(),t=this._study.isPlotVisibleAt(this._plotname,1);return this._study.properties().childs().styles.childs()[this._plotname].childs().trackPrice.value()&&e&&t}}},291784:(e,t,i)=>{i.d(t,{PriceRange:()=>n});var r=i(389137);const s=(0,i(201089).getLogger)("Chart.PriceRange");class n{constructor(e,t){if(null!==e&&"object"==typeof e){const t=e;this._minValue=t.m_minValue,this._maxValue=t.m_maxValue}else{const i=e;this._minValue=i,void 0!==t&&(this._maxValue=t)}}equals(e){
return this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new n(this._minValue,this._maxValue)}minValue(){return this._minValue}setMinValue(e){this._minValue=e}maxValue(){return this._maxValue}setMaxValue(e){this._maxValue=e}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||this._maxValue!=this._maxValue||this._minValue!=this._minValue}serialize(){return{m_maxValue:this._maxValue,m_minValue:this._minValue}}state(){return{max:this._maxValue,min:this._minValue}}merge(e){return new n(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))}apply(e,t){this._minValue=Math.min(this._minValue,e),this._maxValue=Math.max(this._maxValue,t)}set(e,t){this._minValue=e,this._maxValue=t}scaleAroundCenter(e){if(!(0,r.isNumber)(e))return void s.logDebug("PriceRange.scaleAroundCenter: invalid coeff");if(0===this._maxValue-this._minValue)return;const t=.5*(this._maxValue+this._minValue);let i=this._maxValue-t,n=this._minValue-t;i*=e,n*=e,this._maxValue=t+i,this._minValue=t+n}shift(e){(0,r.isNumber)(e)?(this._maxValue+=e,this._minValue+=e):s.logDebug("PriceRange.shift: invalid coeff")}containsStrictly(e){return e.minValue()>this._minValue&&e.maxValue()<this._maxValue}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}},152633:(e,t,i)=>{i.d(t,{createPrimitiveProperty:()=>n});var r=i(354950),s=i.n(r);function n(e){return new(s())(e)}},738232:(e,t,i)=>{i.d(t,{ThemedDefaultProperty:()=>x,extractAllPropertiesKeys:()=>v,extractState:()=>m,factoryDefaultsForCurrentTheme:()=>y});var r=i(712433),s=i(571059),n=i(316230),o=i(598279),l=i(138651),a=i(650151),c=i(62802),h=i(103221),d=i(331633),u=i(919346),p=i(354950),_=i.n(p),g=i(42292),f=i(707957);const P=(0,i(201089).getLogger)("ThemedDefaults");function v(e){const t=Object.keys(e),i=[];return t.forEach((t=>{const r=e[t];if((0,o.default)(r)){v(r).forEach((e=>i.push(`${t}.${e}`)))}else i.push(t)})),i}function m(e,t,i=""){const r={};return t.forEach((s=>{const n=s.split("."),l=n[0],a=e[l],c=""===i?l:`${i}.${l}`;if(e.hasOwnProperty(l))if(n.length>1){if(!(0,o.default)(a))return void P.logError(`path ${c} must be an object, but it is a primitive`);{const e=t.filter((e=>e.startsWith(`${l}.`))).map((e=>e.split(".").slice(1).join(".")));r[l]=m(a,e,c)}}else{if((0,o.default)(a))return void P.logError(`path ${c} must be a primitive, but it is an object`);r[l]=a}})),r}function y(e,t){var i;const s=null!==(i=d.watchedTheme.value())&&void 0!==i?i:u.StdTheme.Light,n=(0,h.deepCopy)(e);return(0,r.default)(n,(0,a.ensureDefined)(t.get(s))),n}function C(e,t){const i=(0,s.default)(e,((e,i,r)=>{if(void 0===t[r])return e;if(!(0,n.default)(i,t[r]))if((0,o.default)(i)&&(0,o.default)(t[r])){const s=C(i,t[r]);void 0!==s&&(e[r]=s)}else e[r]=i;return e}),{});return(0,l.default)(i)?void 0:i}class x extends(_()){constructor(e,t,i,s,n,o){super(function(e,t,i,s){var n;const o=t(),l=m((0,h.deepCopy)(null!==(n=c.getJSON(e,null))&&void 0!==n?n:{}),i);return(0,r.default)(o,l),(0,r.default)(o,m(null!=s?s:{},i)),o}(e,t,n,o)),
this._applyingThemeInProcess=!1,this._restoreFactoryDefaultsEvent=new f.Delegate,this._defaultName=e,this._defaultsSupplier=t,this._notThemedDefaultsKeys=i,this._themedDefaultsKeys=s,this._allStateKeys=n,this._allDefaultsKeys=[...i,...s]}restoreFactoryDefaults(){const e=this._defaultsSupplier();this.mergeAndFire(e),this.saveDefaults(),this._restoreFactoryDefaultsEvent.fire()}addExclusion(){}state(){return m(super.state(),this._allStateKeys)}mergePreferences(e){this.mergeAndFire(m(e,this._allStateKeys))}childChanged(e){super.childChanged(e),this._applyingThemeInProcess||this.saveDefaults()}saveDefaults(){const e=this.state(),t=this._defaultsSupplier();let i=C(m(e,this._notThemedDefaultsKeys),m(t,this._notThemedDefaultsKeys));const s=m(t,this._themedDefaultsKeys),n=m(e,this._themedDefaultsKeys),o=C(n,s);(0,l.default)(o)||(i=null!=i?i:{},(0,r.default)(i,n)),(0,g.saveDefaults)(this._defaultName,i)}}},354950:(e,t,i)=>{const{weakReference:r,ownership:s}=i(428123);var n=i(389137).isFunction,o=i(707957).Delegate;function l(e){if(this._listeners=new o,this._childs=[],this._muteChildChanges=!1,void 0!==e)if(this.isPrimitiveType(e))this._value=e;else for(var t in e)this.addProperty(t,e[t])}l.prototype.destroy=function(){this.listeners().destroy()},l.prototype.merge=function(e,t){var i=null;if(t)var r=(i=[]).length;if(void 0===e)return i;if(this.isPrimitiveType(e))return t&&this._value!==e&&i.push(this),this._value=e,i;if(Array.isArray(e))for(var s=0;s<e.length;s++)if(this[s]){var n=this[s].merge(e[s],t);t&&(i=i.concat(n))}else this.addProperty(s,e[s]),t&&i.push(this[s]);else for(var o in e)if(this[o]){n=this[o].merge(e[o],t);t&&void 0!==n&&(i=i.concat(n))}else this.addProperty(o,e[o]),t&&i.push(this[o]);return t&&i.length>r&&i.push(this),i},l.prototype.mergeAndFire=function(e){var t=this.merge(e,!0);this._muteChildChanges=!0,t.forEach((function(e){e._muteChildChanges=!0})),t.forEach((function(e){e._muteChildChanges=!1,e.listeners().fire(e)})),this._muteChildChanges=!1,t.length>0&&this.listeners().fire(this)},l.prototype.state=function(e){var t=n(this.value)?this.value():void 0;void 0===t&&(t={});for(var i=0;i<this._childs.length;i++){var r=this._childs[i];if(e&&-1!==e.indexOf(r))continue;const n=this[r];let a;if(e){for(var s=[],o=0;o<e.length;o++){var l=e[o];l.startsWith(r+".")&&s.push(l.substring(r.length+1))}a=n.state(s)}else a=n.state();(void 0!==a||n.storeStateIfUndefined())&&(t[r]=a)}return t},l.prototype.storeStateIfUndefined=function(){return!0},l.prototype.clone=function(e){return new l(this.state())},l.prototype.isPrimitiveType=function(e){return null===e||(!!isNumber(e)||("string"==typeof e||"boolean"==typeof e))},l.prototype.value=function(){return this._value},l.prototype.listeners=function(){return this._listeners},l.prototype.childCount=function(){return this._childs.length},l.prototype.childNames=function(){return this._childs},l.prototype.child=function(e){return this[e]},l.prototype.setValue=function(e,t){(this._value!==e||t)&&(this._value=e,this._listeners.fire(this))},l.prototype.setValueSilently=function(e){
this._value=e},l.prototype.addProperty=function(e,t){var i=new l(t);this[e]=i,this._childs.push(e),i.subscribe(this,this.childChanged)},l.prototype.removeProperty=function(e){this[e].unsubscribe(this,this.childChanged),delete this[e],this._childs=this._childs.filter((function(t){return t!==e}))},l.prototype.hasChild=function(e){return this._childs.indexOf(e)>=0},l.prototype.addChild=function(e,t){this[e]&&this[e].unsubscribe(this,this.childChanged),this[e]=t,-1===this._childs.indexOf(e)&&this._childs.push(e),t.subscribe(this,this.childChanged)},l.prototype.childChanged=function(e,t){this._muteChildChanges||this.listeners().fire(this)},l.prototype.subscribe=function(e,t){this.listeners().subscribe(e,t,!1)},l.prototype.unsubscribe=function(e,t){this.listeners().unsubscribe(e,t)},l.prototype.unsubscribeAll=function(e){this.listeners().unsubscribeAll(e)},l.prototype.childs=function(){return this},l.prototype.weakReference=function(){return r(this)},l.prototype.ownership=function(){return s(this)},e.exports=l},915179:(e,t,i)=>{i.d(t,{barSpacingByScaleRatio:()=>o,priceRangeByScaleRatio:()=>n,scaleRatio:()=>s});var r=i(291784);function s(e,t){if(t.isLog()||e.isEmpty()||t.isEmpty())return null;const i=function(e){if(e.isEmpty())return null;const t=e.priceRange();if(null===t)return null;const i=t.length();return e.internalHeight()/i}(t);if(null===i)return null;return e.getValidBarSpacing()/Math.max(1e-10,i)}function n(e,t,i){if(e.isLog()||null===i||e.isEmpty())return null;const s=e.priceRange();if(null===s||s.isEmpty())return null;const n=e.internalHeight()/(t/i),o=s.length();if(n===o)return s;const l=(n-o)/2;return new r.PriceRange(s.minValue()-l,s.maxValue()+l)}function o(e,t){if(e.isLog()||null===t||e.isEmpty())return null;const i=e.priceRange();if(null===i)return null;const r=i.length();return e.internalHeight()/r*t}},662080:(e,t,i)=>{i.d(t,{patchPropertiesAsync:()=>c});var r=i(650151),s=i(201089),n=i(345848),o=i(516684),l=i(823127);const a=(0,s.getLogger)("Pine.ScriptLib");function c(e,t,i){return a.logNormal("patchPropertiesAsync"),new Promise(((s,a)=>{if(!t.TVScriptMetaInfoExprs)return void s(e);const c=t.TVScriptMetaInfoExprs.tree,h=t.TVScriptMetaInfoExprs.patchMap;(function(e,t){(0,n.trackEvent)("Pine","ScriptLib.evalMetaInfoExprs");const i=l.Deferred(),r={username:window.user&&window.user.username,source:e,inputs:JSON.stringify(t||{})};return(0,o._pineFacadeAjax)("POST","/eval_pine_ex/",r).done(((e,t)=>{e.error?i.reject((0,o._readableError)(e.error,t)):e.success?i.resolve(e.result):i.reject((0,o.safetyGetReason)(e))})).fail((e=>{(0,o._anyRequestAsyncFail)(i,e)})),i.promise()})(c,i).done((i=>{if(!i)return void s(e);const n=i.rootValues,o=Object.keys(h);for(let i=0;i<o.length;i++){const s=o[i],l=n[h[s]],a=s.split(".");"defaults"===a[0]&&a.splice(0,1),(0,r.assert)(a.length>1,"Unexpectedly short json path");let c=e,d=t,u=t.defaults;for(let e=0;e<a.length-1;++e){const t=a[e];c=c?c[t]:null,u=u?u[t]:null,d=d?d[t]:null}const p=a[a.length-1];u.hasOwnProperty(p)?c[p].setValue(l):d[p]=l}s(e)})).fail((e=>{a(e)}))}))}},
63316:(e,t,i)=>{i.d(t,{SelectionIndexes:()=>s});var r=i(650151);class s{constructor(e){this._baseIndex=null,this._offsetInBar=null,this._offsetInTime=null,this._barsBetweenPoints=null,this._timescale=e}indexes(){const e=this._timescale.visibleBarsStrictRange();if(null===e)return[];const t=e.firstBar(),i=e.lastBar();if(null===this._offsetInTime||null===this._barsBetweenPoints){const e=this._timescale.barSpacing();this._barsBetweenPoints=Math.floor(120/e),this._offsetInBar=i%this._barsBetweenPoints,this._offsetInTime=this._timescale.indexToTimePoint(this._offsetInBar),this._baseIndex=this._timescale.baseIndex()}const s=this._timescale.baseIndex();this._baseIndex!==s&&(this._baseIndex=s,this._offsetInBar=(0,r.ensureNotNull)(this._timescale.timePointToIndex(this._offsetInTime)));const n=(0,r.ensureNotNull)(this._offsetInBar),o=[];let l=Math.floor((t-n)/this._barsBetweenPoints);const a=Math.floor((i-n)/this._barsBetweenPoints);for(;l<=a;l++)o.push(n+l*this._barsBetweenPoints);return o}clear(){this._offsetInBar=null,this._offsetInTime=null,this._baseIndex=null,this._barsBetweenPoints=null}}},230058:(e,t,i)=>{i.d(t,{SelectionRenderer:()=>c});var r=i(934026),s=i(987088),n=i(315801),o=i(147354),l=i(43192);const a=s.colorsPalette["color-tv-blue-600"];class c extends l.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e||null}setData(e){this._data=e}hitTest(e){if(!this._data||!this._data.visible)return null;for(let t=0;t<this._data.points.length;t++){const i=this._data.points[t];if(i.subtract(e).length()<=5.5){const e=void 0!==this._data.pointsCursorType?this._data.pointsCursorType[t]:o.PaneCursorType.Default;return new n.HitTestResult(this._data.hittestResult,{pointIndex:i.data,cursorType:e})}}return null}doesIntersectWithBox(e){return!!this._data&&this._data.points.some((t=>(0,r.pointInBox)(t,e)))}_drawImpl(e){if(null===this._data||!this._data.visible)return;const{context:t,horizontalPixelRatio:i}=e;t.strokeStyle=void 0!==this._data.color?this._data.color:a,t.lineCap="butt";const r=Math.max(1,Math.floor(i));t.lineWidth=r;const s=this._data.vertOffset||0;for(let i=0;i<this._data.points.length;++i){const o=this._data.points[i];(n=o,Number.isFinite(n.x)&&Number.isFinite(n.y))&&(t.fillStyle=this._data.bgColors[i],this._drawMarker(e,o,s,r))}var n}_drawMarker(e,t,i,r){const{context:s,horizontalPixelRatio:n,verticalPixelRatio:o}=e;let l=Math.round(3.5*n*2);l%2!=r%2&&(l+=1);let a=Math.round(l+2*(.5*r+.75*n));a%2!=r%2&&(a+=1);const c=Math.round(t.x*n),h=Math.round((t.y+i)*o),d=r%2/2;s.beginPath(),s.arc(c+d,h+d,a/2,0,2*Math.PI,!0),s.closePath(),s.fill(),s.beginPath(),s.arc(c+d,h+d,l/2,0,2*Math.PI,!0),s.closePath(),s.stroke()}}},3140:(e,t,i)=>{i.d(t,{SeriesTimeRangeVolumeCalculator:()=>r});class r{constructor(e){this._value=null,this._series=e,this._series.dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated)}destroy(){this._series.dataEvents().dataUpdated().unsubscribeAll(this)}volume(e,t){if(null!==this._value&&this._value.from===e&&this._value.to===t)return this._value.value;let i=0
;const r=this._series.data().bars(),s=r.firstIndex(),n=r.lastIndex();if(null!==s&&e<s&&t<s||null!==n&&e>n&&t>n)i=NaN;else{const r=this._series.data().bars().rangeIterator(Math.min(e,t),Math.max(e,t));for(const e of r){const t=e.value[5];if(void 0===t){i=NaN;break}i+=t}}return this._value={from:e,to:t,value:i},i}_onSeriesUpdated(e,t){if(null===this._value)return;if(t)return void(this._value=null);const i=this._series.data().bars().lastIndex();(null===i||i<=this._value.to)&&(this._value=null)}}},969419:(e,t,i)=>{i.d(t,{PaneRendererBars:()=>n});var r=i(239589),s=i(756930);class n extends s.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._dontDrawOpen=e.dontDrawOpen,this._thinBars=e.thinBars}draw(e,t){e.save();const i=t.pixelRatio;if(this._barWidth=this._calcBarWidth(i),this._barWidth>=2){Math.max(1,Math.floor(i))%2!=this._barWidth%2&&this._barWidth--}this._barLineWidth=this._thinBars?Math.min(this._barWidth,Math.floor(i)):this._barWidth;let r=null;const s=this._barLineWidth<=this._barWidth&&this._barSpacing>=Math.floor(1.5*t.pixelRatio);for(const t of this._bars){r!==t.color&&(e.fillStyle=t.color,r=t.color);const n=Math.floor(.5*this._barLineWidth),o=Math.round(t.time*i),l=o-n,a=this._barLineWidth,c=l+a-1,h=Math.min(t.high,t.low),d=Math.max(t.high,t.low),u=Math.round(h*i)-n,p=Math.round(d*i)+n,_=Math.max(p-u,this._barLineWidth);e.fillRect(l,u,a,_);const g=Math.ceil(1.5*this._barWidth);if(s){const r=o-g,s=o+g,h=Math.min(l-r,s-c);if(!this._dontDrawOpen){let s=Math.max(u,Math.round(t.open*i)-n),o=s+a-1;o>u+_-1&&(o=u+_-1,s=o-a+1),e.fillRect(r,s,h,o-s+1)}let d=Math.max(u,Math.round(t.close*i)-n),p=d+a-1;p>u+_-1&&(p=u+_-1,d=p-a+1),e.fillRect(c+1,d,h,p-d+1)}}e.restore()}_getTolerance(){const e=this._calcBarWidth(1),t=this._thinBars?Math.min(e,1):e;return(0,r.interactionTolerance)().series+t/2}_getBarSpacing(){return this._barSpacing}_calcBarWidth(e){const t=Math.floor(e);return Math.max(t,Math.floor((0,r.optimalBarWidth)(this._barSpacing,e)))}}},756930:(e,t,i)=>{i.d(t,{PaneRendererSeriesBase:()=>s});var r=i(315801);class s{constructor(){this._bars=[]}hitTest(e){const t=this._bars,i=this._getBarSpacing(),r=i/2;if(0===t.length)return null;const s=this._getTolerance(),n=t[0],o=t[t.length-1];if(e.x<n.time-r-s)return null;if(e.x>o.time+r+s)return null;let l=0,a=t.length-1,c=-1;for(;l<=a;){const i=Math.floor((l+a)/2),h=t[i];let d=r;if(h!==n&&h!==o||(d+=s),Math.abs(h.time-e.x)<=d){c=i;break}e.x-h.time>r?l=i+1:a=i-1}if(-1!==c){const n=Math.ceil(s/i);if(0!==n){const i=Math.max(0,c-n),o=Math.min(t.length-1,c+n);for(let n=i;n<=o;n++)if(Math.abs(e.x-t[n].time)<=r+s&&this._isPointAtBar(t[n],e.y,s))return this._getHitTest()}else if(this._isPointAtBar(t[c],e.y,s))return this._getHitTest()}return null}_getHitTest(){return new r.HitTestResult(r.HitTarget.Regular)}_isPointAtBar(e,t,i){const r=Math.min(e.high,e.low),s=Math.max(e.high,e.low);return r-i<=t&&t<=s+i}}},956725:(e,t,i)=>{i.d(t,{PaneRendererCandles:()=>a});var r=i(650151),s=i(315801),n=i(787123),o=i(239589),l=i(756930)
;class a extends l.PaneRendererSeriesBase{constructor(e){super(),this._barSpacing=1,this._barWidth=1,this._borderVisible=!1,this._barBorderWidth=1,this._wickVisible=!1,this._bodyVisible=!0,this._borderColor=void 0,this._wickColor=void 0,this._hittest=void 0,this._isPriceScaleInverted=!1,e&&this.setData(e)}setData(e){this._bars=e.bars,this._barSpacing=e.barSpacing,this._borderVisible=e.borderVisible,this._bodyVisible=e.bodyVisible,this._wickVisible=e.wickVisible,this._borderColor=e.borderColor,this._wickColor=e.wickColor,this._hittest=e.hittest,this._isPriceScaleInverted=e.isPriceScaleInverted}hitTest(e){return this._wickVisible||this._borderVisible||this._bodyVisible?super.hitTest(e):null}draw(e,t){if(0===this._bars.length)return;const i=t.pixelRatio;if(this._barWidth=(0,o.optimalCandlestickWidth)(this._barSpacing,i),this._barWidth>=2){Math.floor(i)%2!=this._barWidth%2&&this._barWidth--}this._wickVisible&&this._drawWicks(e,i),this._borderVisible&&this._drawBorder(e,i),this._bodyVisible&&this._drawCandles(e,i)}_getTolerance(){return(0,o.interactionTolerance)().series+this._barBorderWidth/2}_getBarSpacing(){return this._barSpacing}_getHitTest(){return this._hittest||new s.HitTestResult(s.HitTarget.Regular)}_isPointAtBar(e,t,i){const r=this._bodyVisible||this._borderVisible,s=this._wickVisible;if(!r&&!s)return!1;if(r){const r=s?Math.min(e.high,e.low):Math.min(e.open,e.close),n=s?Math.max(e.high,e.low):Math.max(e.open,e.close);return r-i<=t&&t<=n+i}{const r=Math.min(e.open,e.close),s=Math.max(e.open,e.close);return e.high-i<=t&&t<=r+i||s-i<=t&&t<=e.low+i}}_drawWicks(e,t){const i=this._bars;let s="",n=Math.min(Math.floor(t),Math.floor(this._barSpacing*t));n=Math.max(Math.floor(t),Math.min(n,this._barWidth));const o=Math.floor(.5*n);let l=null;for(const a of i){const i=a.wickColor?a.wickColor:(0,r.ensureDefined)(this._wickColor);i!==s&&(e.fillStyle=i,s=i);let c=Math.round(Math.min(a.open,a.close)*t),h=Math.round(Math.max(a.open,a.close)*t);this._isPriceScaleInverted&&([h,c]=[c,h]);const d=Math.round(a.high*t),u=Math.round(a.low*t);let p=Math.round(t*a.time)-o;const _=p+n-1;null!==l&&(p=Math.max(l+1,p),p=Math.min(p,_));const g=_-p+1;e.fillRect(p,d,g,c-d),e.fillRect(p,h+1,g,u-h-1),l=_}}_calculateBorderWidth(e){let t=Math.floor(1*e);this._barWidth<=2*t&&(t=Math.floor(.5*(this._barWidth-1)));const i=Math.max(Math.floor(e),t);return this._barWidth<=2*i?Math.max(Math.floor(e),Math.floor(1*e)):i}_drawBorder(e,t){let i="";const s=this._calculateBorderWidth(t);let o=null;for(const l of this._bars){if(l.borderColor!==i&&(e.fillStyle=l.borderColor?l.borderColor:(0,r.ensureDefined)(this._borderColor),i=l.borderColor),this._bodyVisible&&l.hollow)continue;let a=Math.round(l.time*t)-Math.floor(.5*this._barWidth);const c=a+this._barWidth-1,h=Math.round(Math.min(l.open,l.close)*t),d=Math.round(Math.max(l.open,l.close)*t);if(null!==o&&(a=Math.max(o+1,a),a=Math.min(a,c)),this._barSpacing*t>2*s)(0,n.fillRectInnerBorder)(e,a,h,c-a+1,d-h+1,s);else{const t=c-a+1;e.fillRect(a,h,t,d-h+1)}o=c}}_drawCandles(e,t){let i=""
;const r=this._calculateBorderWidth(t);for(const s of this._bars){if(this._borderVisible&&this._barWidth<=2*r&&!s.hollow)continue;let o=Math.round(Math.min(s.open,s.close)*t),l=Math.round(Math.max(s.open,s.close)*t),a=Math.round(s.time*t)-Math.floor(.5*this._barWidth),c=a+this._barWidth-1;if(s.color!==i){const t=s.color;e.fillStyle=t,i=t}if(s.hollow)e.fillStyle=s.color,(0,n.fillRectInnerBorder)(e,a,o,c-a+1,l-o+1,r);else{if(this._borderVisible&&(a+=r,o+=r,c-=r,l-=r),o>l)continue;e.fillRect(a,o,c-a+1,l-o+1)}}}}},985715:(e,t,i)=>{i.d(t,{StatusProviderBase:()=>r});class r{constructor(e){this._colorProperty=e}size(){return"13px"}bold(){return!1}color(){return this._colorProperty.value()}}},833642:(e,t,i)=>{i.d(t,{StatusView:()=>r});class r{constructor(e){this._text="",this._color="",this._size="13px",this._bold=!1,this._statusProvider=e}text(){return this._text}getSplitTitle(){return[this._text]}color(){return this._statusProvider.color()}bold(){return this._bold}size(){return this._size}}},77338:(e,t,i)=>{i.d(t,{getNoDataPosition:()=>d,getSeriesPosition:()=>u,noDataBasePosition:()=>c,positionToCoordinate:()=>a,positionVisualDirection:()=>l,seriesBasePosition:()=>h,seriesPrice:()=>n});var r=i(650151),s=i(534741);function n(e,t,i){const r=e.barFunction();switch(e.style()){case 3:case 10:case 2:case 14:case 15:return r(t.value);default:return t.value[-1===i?3:2]}}function o(e){return e>=0?1:-1}function l(e,t){return-1===o(e)!==t?-1:1}function a(e,t,i,r){const s=Math.min(t,Math.max(0,1===r?i:t-i));return i-r*Math.abs(s*e/100)}function c(e,t,i){const r=e.index();return null===r?null:{index:r,price:t.coordinateToPrice(t.height()/2,i)}}function h(e,t){const i=e.data().bars(),r=i.first(),l=i.last();if(null===r||null===l)return null;let a;const c=t.index();if(null===c){if(void 0===t.time)return null;const e=t.time(),n=r.value[0],o=l.value[0];if(e<n-86400||e>o)return null;a=i.searchByTime(e,s.PlotRowSearchMode.NearestRight,4)}else a=i.search(c);return null===a?null:{index:a.index,price:n(e,a,o(t.position()))}}function d(e,t,i){const r=c(e,t,i);if(null===r)return null;const s=l(e.position(),t.isInverted());return{index:r.index,price:r.price,poleStartY:t.height(),visualDirection:1,positionPointDirection:s,startsOnSeriesData:!1}}function u(e,t,i=!0){const s=h(e,t),n=e.priceScale(),o=(0,r.ensureNotNull)(e.firstValue());if(null===s)return d(t,n,o);let a=0;const c=e.properties().childs(),u=e.model().timeScale(),p=n.priceToCoordinate(s.price,o),_=l(t.position(),n.isInverted());if(i)switch(e.style()){case 16:a=1===_?c.hlcAreaStyle.childs().highLineWidth.value()/2:c.hlcAreaStyle.childs().lowLineWidth.value()/2;break;case 3:a=c.areaStyle.childs().linewidth.value()/2;break;case 2:a=c.lineStyle.childs().linewidth.value()/2;break;case 14:a=c.lineWithMarkersStyle.childs().linewidth.value()/2;break;case 15:a=c.steplineStyle.childs().linewidth.value()/2;break;case 10:const e=Math.abs(100-c.baselineStyle.childs().baseLevelPercentage.value())
;a=n.height()*e/100>p?c.baselineStyle.childs().topLineWidth.value()/2:c.baselineStyle.childs().bottomLineWidth.value()/2;break;case 1:case 9:case 8:case 12:case 4:case 7:a=3;break;case 0:a=c.barStyle.childs().thinBars.value()?3:Math.max(3,.25*u.barSpacing());break;case 11:a=c.rangeStyle.childs().thinBars.value()?3:Math.max(3,.25*u.barSpacing());break;case 5:a=Math.max(4,.25*u.barSpacing());break;case 6:a=Math.max(5,.25*u.barSpacing())}const g=p-_*a;return{index:s.index,price:s.price,poleStartY:g,visualDirection:_,positionPointDirection:_,startsOnSeriesData:!0}}},434294:(e,t,i)=>{i.d(t,{AbstractFilledAreaPaneView:()=>_});var r=i(650151),s=i(674981),n=i(448874),o=i(246733),l=i(407478);var a=i(57372),c=i(272933);function h(e,t){return Array.from({length:e},((e,i)=>({timePointIndex:i+t})))}function d(e,t,i){let r,s;const n=e.length;for(let o=t;o>=0&&o<n;o+=i){const t=e[o];if(void 0===r&&void 0!==t.plot1Value&&(r=o),void 0===s&&void 0!==t.plot2Value&&(s=o),void 0!==r&&void 0!==s)return o}return null}function u(e){return 0===e.type?`${e.color}`:`${e.color1}:${e.color2}:${e.coordinate1}:${e.coordinate2}`}const p={type:0,color:""};class _{constructor(e,t,i=!1){this._isHlineFill=!1,this._bandAKey=null,this._bandBKey=null,this._colorPlotIndex=null,this._areaRenderer=new a.AreaBackgroundRenderer,this._dataInvalidated=null,this._viewportInvalidated=!1,this._plIndex1=null,this._plIndex2=null,this._items=[],this._colorAreas=new a.CachedMap,this._generateColor=function(e=1e3){const t=n.default.Cache;n.default.Cache=l.CircularCacheBuffer.bind(l.CircularCacheBuffer,e);const i=(0,n.default)(o.generateColor,((e,t,i)=>`${e}_${t}_${i}`));return n.default.Cache=t,i}(),this._source=e,this._model=t,this._fillGaps=i}update(e){if("global-change"===e.type)return this._dataInvalidated=(0,c.mergeDataInvalidation)(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{e.sourceId===this._source.id()&&(this._dataInvalidated=(0,c.mergeDataInvalidation)(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData}))}}renderer(e,t){return this._dataInvalidated?this._updateImplFull(this._dataInvalidated)&&(this._dataInvalidated=null,this._viewportInvalidated=!1):this._viewportInvalidated&&(this._updateImplLight(),this._viewportInvalidated=!1),this._areaRenderer}_minFirstBarIndex(){return-1/0}_plotNames(){return this._source.metaInfo().plots.map((e=>e.id))}_plotIndex1(){return null===this._plIndex1&&(this._plIndex1=this._plotNames().indexOf(this._plotAId())+1),this._plIndex1}_plotIndex2(){return null===this._plIndex2&&(this._plIndex2=this._plotNames().indexOf(this._plotBId())+1),this._plIndex2}_updateImplFull(e){var t,i,n,o;if(this._areaRenderer.setData(null),(null===(t=this._dataInvalidated)||void 0===t?void 0:t.clearData)&&(this._items=[]),!this._visible())return!1;if(null===this._source.priceScale())return!1;if(null===this._source.firstValue())return!1;const l=this._source.plots().plottableRange(),a=l.size();if(0===a)return!1
;const c=this._source.offset(this._plotAId()),d=this._source.offset(this._plotBId()),u=Math.min(c,d),p=Math.max(c,d);let _=e.firstIndex;const g=a+(p-u)+1,f=this._plotIndex1(),P=this._plotIndex2();g!==this._items.length&&(void 0===_||0===this._items.length||_<this._items[0].timePointIndex+u?(_=void 0,this._items=h(g,1e10)):this._items=this._items.concat(h(g-this._items.length,1e10+this._items.length)));const v=this._colorPlotIndex,m=this._transparency(),y=void 0===_?l.fullRangeIterator():l.rangeIterator(_,(0,r.ensureNotNull)(l.lastIndex()));let C=void 0!==_?(0,s.lowerbound)(this._items,_+u,((e,t)=>e.timePointIndex<t))-u:-u;for(const e of y){const t=e.index+c,r=e.index+d,s=this._items[C+c],l=this._items[C+d];if(s.timePointIndex=t,l.timePointIndex=r,this._isHlineFill||(s.plot1Value=null!==(i=e.value[f])&&void 0!==i?i:void 0,l.plot2Value=null!==(n=e.value[P])&&void 0!==n?n:void 0),null!==v){const t=C+u-1;if(t>=0&&t<this._items.length){const i=this._items[t];let r;r=0===v.type?{type:0,colorIndexOrRgba:e.value[v.colorIndexOrRgba+1]}:{type:1,colorIndexOrRgba1:void 0===v.colorIndexOrRgba1?void 0:e.value[v.colorIndexOrRgba1+1],colorIndexOrRgba2:void 0===v.colorIndexOrRgba2?void 0:e.value[v.colorIndexOrRgba2+1],value1:void 0===v.valueIndex1?void 0:e.value[v.valueIndex1+1],value2:void 0===v.valueIndex2?void 0:e.value[v.valueIndex2+1]};const s=i.color=null!==(o=this._getColorByPlotValue(r))&&void 0!==o?o:void 0;void 0!==s&&(1===s.type?(s.color1=s.color1&&this._generateColor(s.color1,m),s.color2=s.color2&&this._generateColor(s.color2,m)):s.color=this._generateColor(s.color,m))}}C+=1}return this._updateImplLight(),!0}_updateImplLight(){var e,t,i,n;if(!this._visible())return;const o=this._source.priceScale();if(null===o)return;const l=this._source.firstValue();if(null===l)return;if(0===this._items.length)return;let c;if(this._isHlineFill){const e=this._source.properties().bands[(0,r.ensureNotNull)(this._bandAKey)],t=this._source.properties().bands[(0,r.ensureNotNull)(this._bandBKey)];c={level1:o.priceToCoordinate(e.value.value(),l),level2:o.priceToCoordinate(t.value.value(),l)}}const h=this._model.timeScale(),_=h.visibleBarsStrictRange();if(null===_)return;const g=o.priceToCoordinateFn(l),f=this._transparency(),P=this._minFirstBarIndex(),v=Math.max(P,_.firstBar()),m=(0,s.lowerbound)(this._items,v,((e,t)=>e.timePointIndex<t));if(m>=this._items.length)return;const y=Math.min(this._items.length-1,(0,s.lowerbound)(this._items,_.lastBar(),((e,t)=>e.timePointIndex<t)));let C,x;this._isHlineFill?(C=P===v?m:Math.max(0,m-1),x=Math.min(this._items.length-1,y+1)):(C=P===v?m:null!==(e=d(this._items,m-1,-1))&&void 0!==e?e:m,x=null!==(t=d(this._items,y+1,1))&&void 0!==t?t:y);const w=this._colorAreas;w.invalidateCache();let b=null,S=null;const T=this._commonColor();let I;1===T.type?(T.coordinate1=g(T.value1),T.coordinate2=g(T.value2),T.color1=T.color1&&this._generateColor(T.color1,f),T.color2=T.color2&&this._generateColor(T.color2,f)):T.color=this._generateColor(T.color,f);for(let e=C;e<=x;e+=1){const t=this._items[e],r=t.timePointIndex;let s,o
;!this._fillGaps&&void 0!==I&&r-I>1&&(b=null),void 0!==c?(s=c.level1,o=c.level2):(s=t.plot1Coordinate=void 0===t.plot1Value?void 0:g(t.plot1Value),o=t.plot2Coordinate=void 0===t.plot2Value?void 0:g(t.plot2Value));const l=t.xCoordinate=h.indexToCoordinate(t.timePointIndex);if(t.color&&1===t.color.type&&(t.color.coordinate1=g(t.color.value1),t.color.coordinate2=g(t.color.value2)),this._fillGaps?void 0!==s||void 0!==o:void 0!==s&&void 0!==o){const r=null!==this._colorPlotIndex?t.color||p:T;if(M=r,!(null===(L=S)||null===M?L===M:0===L.type&&0===M.type?L.color===M.color:1===L.type&&1===M.type&&L.color1===M.color1&&L.color2===M.color2&&L.coordinate1===M.coordinate1&&L.coordinate2===M.coordinate2)||null===b){if(null!==b&&(void 0!==s&&b.addPoints1Point(l,s),void 0!==o&&b.addPoints2Point(l,o)),e===x)continue;S=r;const t=u(r),c=null!==(i=w.get(t))&&void 0!==i?i:new a.AreaBackgroundItemsGroup(r);b=null!==(n=c.newItem())&&void 0!==n?n:new a.AreaBackgroundItem,c.push(b),w.set(t,c)}void 0!==s&&b.addPoints1Point(l,s),void 0!==o&&b.addPoints2Point(l,o)}else this._fillGaps||(S=null,b=null);I=r}var L,M;w.delete(u(p));const V={barSpacing:this._model.timeScale().barSpacing(),colorAreas:w};this._areaRenderer.setData(V)}}},1584:(e,t,i)=>{i.d(t,{AreaBackgroundPaneView:()=>n});var r=i(650151),s=i(434294);class n extends s.AbstractFilledAreaPaneView{constructor(e,t){super(e,t)}_plotAId(){return(0,r.ensureDefined)(this._source.metaInfo().area)[0].name}_plotBId(){return(0,r.ensureDefined)(this._source.metaInfo().area)[1].name}_commonColor(){return{type:0,color:this._source.properties().areaBackground.backgroundColor.value()}}_transparency(){return this._source.properties().areaBackground.transparency.value()}_visible(){return this._source.properties().areaBackground.fillBackground.value()}_getColorByPlotValue(e){return this._commonColor()}}},738449:(e,t,i)=>{i.d(t,{BandBackgroundPaneView:()=>l});var r=i(650151),s=i(246733),n=i(678515),o=i(425049);class l{constructor(e){this._bandBgRenderer=new o.BandBackgroundRenderer,this._invalidated=!0,this._source=e}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._bandBgRenderer}_updateImpl(){this._bandBgRenderer.setData(null);const e=this._source.properties().childs(),t=e.bands;if(t.childCount()<2)return;const i=e.bandsBackground;if(!(null==i?void 0:i.childs().fillBackground.value()))return;const o=t[0].childs(),l=t[1].childs(),a=this._source.priceScale(),c=this._source.firstValue();if(!a||a.isEmpty()||null===c)return;const h=[a.priceToCoordinate(o.value.value(),c),a.priceToCoordinate(l.value.value(),c)],d=(0,r.ensureDefined)(e.bandsBackground).childs(),u=(0,n.clamp)(d.transparency.value(),0,100);this._bandBgRenderer.setData({gradient:!1,points:h,backcolor:(0,s.generateColor)(d.backgroundColor.value(),u)})}}},425049:(e,t,i)=>{i.d(t,{BandBackgroundRenderer:()=>s});var r=i(710455);class s extends r.MediaCoordinatesPaneRenderer{constructor(){super(),this._data=null,this._data=null}setData(e=null){this._data=e}hitTest(){return null}_drawImpl(e){
var t,i;if(null===this._data||0===this._data.points.length)return;const r=e.context,s=e.mediaSize.width;if(this._data.gradient){const e=r.createLinearGradient(0,this._data.coordinate1,0,this._data.coordinate2);e.addColorStop(0,null!==(t=this._data.backColor1)&&void 0!==t?t:"transparent"),e.addColorStop(1,null!==(i=this._data.backColor2)&&void 0!==i?i:"transparent"),r.fillStyle=e}else r.fillStyle=this._data.backcolor;const n=Math.min(this._data.points[0],this._data.points[1]),o=Math.max(this._data.points[0],this._data.points[1]);r.fillRect(0,n,s,o-n)}}},999615:(e,t,i)=>{i.d(t,{BandPaneView:()=>o});var r=i(86441),s=i(389137),n=i(9524);class o{constructor(e,t){this._invalidated=!0,this._lineRenderer=new n.HorizontalLineRenderer,this._source=t,this._points=[new r.Point(-1,-1)],this._invalidated=!0,this._properties=e}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={y:this._points[0].y,color:this._properties.childs().color.value(),linewidth:this._properties.childs().linewidth.value(),linestyle:this._properties.childs().linestyle.value()};return this._lineRenderer.setData(e),this._lineRenderer}_updateImpl(){const e=this._source.priceScale();if(!e||e.isEmpty())return void(this._points[0]=new r.Point(-1,-1));const t=this._properties.childs().value.value(),i=this._source.firstValue(),n=(0,s.isNumber)(t)&&null!==i?e.priceToCoordinate(t,i):NaN;this._points[0]=new r.Point(-1,n)}}},644164:(e,t,i)=>{i.d(t,{HlineFillPaneView:()=>l});var r=i(650151),s=i(678515),n=i(246733),o=i(425049);class l{constructor(e,t,i){var s;this._bandBgRenderer=new o.BandBackgroundRenderer,this._bandAKey=null,this._bandBKey=null,this._invalidated=!0,this._source=e,(0,r.assert)("hline_hline"===t.type,"Wrong filledArea type: "+t.type),this._initBandIndexes(t.objAId,t.objBId),this._fillStyleProps=i,this._bandBgRenderer=new o.BandBackgroundRenderer,this._gradientFillType=i.hasChild("fillType")&&"gradient"===(null===(s=i.childs().fillType)||void 0===s?void 0:s.value()),this._gradientStaticState={color1:t.topColor,color2:t.bottomColor,value1:t.topValue,value2:t.bottomValue}}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._bandBgRenderer}_updateImpl(){var e,t,i,o,l,a,c,h;if(this._bandBgRenderer.setData(null),!this._fillStyleProps.childs().visible.value())return;if(null===this._bandAKey||null===this._bandBKey)return;const d=(0,r.ensureDefined)(this._source.properties().childs().bands),u=d.childs()[this._bandAKey].childs(),p=d.childs()[this._bandBKey].childs(),_=this._source.priceScale(),g=this._source.firstValue();if(!_||_.isEmpty()||null===g)return;const f=[_.priceToCoordinate(u.value.value(),g),_.priceToCoordinate(p.value.value(),g)],P=(0,s.clamp)(this._fillStyleProps.childs().transparency.value(),0,100);let v;const m=this._fillStyleProps.childs();if(this._gradientFillType){
const r=this._gradientStaticState,s=m,d=null!==(e=r.value1)&&void 0!==e?e:null===(t=s.topValue)||void 0===t?void 0:t.value(),u=null!==(i=r.value2)&&void 0!==i?i:null===(o=s.bottomValue)||void 0===o?void 0:o.value();if(void 0===d||void 0===u)return;const p=null!==(l=r.color1)&&void 0!==l?l:null===(a=s.topColor)||void 0===a?void 0:a.value(),y=null!==(c=r.color2)&&void 0!==c?c:null===(h=s.bottomColor)||void 0===h?void 0:h.value();if(void 0===p&&void 0===y)return;v={gradient:!0,points:f,backColor1:p&&(0,n.generateColor)(p,P),backColor2:y&&(0,n.generateColor)(y,P),coordinate1:_.priceToCoordinate(d,g),coordinate2:_.priceToCoordinate(u,g)}}else v={gradient:!1,points:f,backcolor:(0,n.generateColor)(m.color.value(),P)};this._bandBgRenderer.setData(v)}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;(0,r.ensureDefined)(this._source.metaInfo().bands).forEach(((i,r)=>{null===this._bandAKey&&i.id===e&&(this._bandAKey=r),null===this._bandBKey&&i.id===t&&(this._bandBKey=r)}))}}},539163:(e,t,i)=>{i.d(t,{DwgLabelPaneViewConstants:()=>r,calculateDwgLabelsMargins:()=>l,calculateLabelHeight:()=>o});var r,s=i(368135),n=i(294024);function o(e,t,i){let r=i;switch(t){case s.PlotSymbolSize.Tiny:r=.6*e;break;case s.PlotSymbolSize.Small:r=.8*e;break;case s.PlotSymbolSize.Normal:r=e;break;case s.PlotSymbolSize.Large:r=1.5*e;break;case s.PlotSymbolSize.Huge:r=2*e}return r}function l(e,t,i){const s=e.model().timeScale().barSpacing(),l=Math.round(s*r.AUTO_SIZE_MULT),a=o(r.NORMAL_SIZE,t.size,l)*r.SHAPE_HEIGHT_MULT,c=Math.round(a/2);switch(t.style){case n.DwgLabelStyle.LabelUp:case n.DwgLabelStyle.LabelLeftUp:case n.DwgLabelStyle.LabelRightUp:return{bottomPixelMargin:c,topPixelMargin:0};case n.DwgLabelStyle.LabelDown:case n.DwgLabelStyle.LabelLeftDown:case n.DwgLabelStyle.LabelRightDown:return{bottomPixelMargin:0,topPixelMargin:c};case n.DwgLabelStyle.LabelLeft:case n.DwgLabelStyle.LabelRight:case n.DwgLabelStyle.LabelCenter:return{bottomPixelMargin:c,topPixelMargin:c}}return{bottomPixelMargin:0,topPixelMargin:0}}!function(e){e.NORMAL_SIZE=50,e.AUTO_SIZE_MULT=1,e.SHAPE_HEIGHT_MULT=.5,e.SHAPE_WIDTH_MULT=.6,e.FONT_SIZE_MULT=.24}(r||(r={}))},280664:(e,t,i)=>{i.d(t,{LevelPriceAxisView:()=>n});var r=i(229765),s=i(246733);class n extends r.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){var r,n;e.visible=!1;const o=this._source.priceScale(),l=this._source.properties().childs(),a=l.visible.value();if(!o||o.isEmpty()||!a)return;const c=null===(n=null===(r=l.graphics.childs()[this._data.lineType])||void 0===r?void 0:r.childs()[this._data.styleId])||void 0===n?void 0:n.childs();if(!(void 0!==c&&c.visible&&c.visible.value()&&c.showPrice&&c.showPrice.value()&&this._isLabelVisibleAccordinglyToProperties()))return;const h=this._source.firstValue();if(null===h)return;const d=this._data.line.level,u=(0,s.resetTransparency)(c.color.value());i.background=u,i.textColor=this.generateTextColor(u),i.coordinate=o.priceToCoordinate(d,h),e.text=o.formatPrice(d,h,!0),e.visible=!0}
_isLabelVisibleAccordinglyToProperties(){const e=this._source.model().properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()}}},78456:(e,t,i)=>{i.d(t,{getGraphicsPriceRangeGroups:()=>g,studyGraphicsFirstValue:()=>y,studyGraphicsPixelsMargins:()=>P,studyGraphicsPriceRange:()=>f});var r=i(650151),s=i(291784),n=i(539163);class o{constructor(e,t,i=!1){this.price=t,this.index=e,this.useMainSeriesForPriceRange=i}}var l=i(92245);function a(e,t,i,s){if(e.y1===e.y2)return function(e,t,i){return(0,r.assert)(e.y1===e.y2),(0,l.doesItemAffectVisibleRange)(e.x1,e.x2,e.extend,t,i)?[new o(t,e.y1,!1),new o(i,e.y2,!1)]:[]}(e,i,s);const n=[];return null!==e.x1&&n.push(new o(e.x1,e.y1,!1)),null!==e.x2&&n.push(new o(e.x2,e.y2,!1)),n}function c(e,t,i,r){return(0,l.doesItemAffectVisibleRange)(e.left,e.right,e.extend,i,r)?[new o(i,e.top,!1),new o(r,e.bottom,!1)]:[]}var h=i(294024);function d(e,t,i,r){let s;const n=e.yloc!==h.DwgLabelYloc.Price&&e.yloc!==h.DwgLabelYloc.Auto;if(n){const i=e.yloc===h.DwgLabelYloc.AboveBar?2:3,r=t.valueAt(e.x);null!==r&&(s=r[i])}else s=e.y;return null==s?null:[new o(e.x,s,n)]}function u(e,t,i,r,s,n){if(!(0,l.doesItemAffectVisibleRange)(e.firstBarTime,e.lastBarTime,l.DwgExtend.None,i,r))return[];let a=1/0,c=-1/0;for(const[t,i]of s.tpoBlockSets())if(n===t)for(const t of i)t.tpoId===e.id&&(a=Math.min(a,t.rowIndex*e.priceRange),c=Math.max(c,(t.rowIndex+1)*e.priceRange));return Number.isFinite(a)?[new o(i,c,!1),new o(r,a,!1)]:[]}class p{constructor(e,t,i,r,s){this._mapGetter=e,this._study=t,this._bars=t.series().bars(),this._visibilityGetter=i,this._getPoints=r,this._getMargins=s}groupPriceRange(e,t){let i=null;const r=this._study.graphics();for(const[n,o]of this._mapGetter())if(this._visibilityGetter(n))for(const l of o){const o=this._getPoints(l,this._bars,e,t,r,n);if(null===o)continue;let a=1/0,c=-1/0,h=!1,d=!1,u=!1;for(const i of o){const r=i.index<=t,s=i.index>=e;h=h||r,d=d||s,u=u||r&&s;let n=i.price,o=i.price;if(i.useMainSeriesForPriceRange){const e=this._bars.valueAt(i.index);if(null===e)continue;const t=e[2];if(null==t)continue;const r=e[3];if(null==r)continue;n=r,o=t}n<a&&(a=n),o>c&&(c=o)}if(!(u||h&&d))continue;const p=new s.PriceRange(a,c);i=null===i?p:i.merge(p)}return i}firstValue(e,t){let i=1/0,r=1/0,s=-1/0,n=1/0,l=1/0,a=1/0;const c=this._study.graphics();for(const[o,h]of this._mapGetter())if(this._visibilityGetter(o))for(const d of h){const h=this._getPoints(d,this._bars,e,t,c,o);if(null!==h)for(const o of h){const c=o.index;c>=e&&c<=t&&c<i?(i=c,r=o.price):c<e&&c>s?(s=c,n=o.price):c>t&&c<l&&(l=c,a=o.price)}}return{firstVisible:i===1/0?null:new o(i,r),leftClosest:s===-1/0?null:new o(s,n),rightClosest:l===1/0?null:new o(l,a)}}groupPixelMargins(e,t){if(!this._getMargins)return _();const i=_();if(null===this._study.priceScale())return i;if(null===this._study.firstValue())return i;const r=this._study.graphics()
;for(const[s,n]of this._mapGetter())if(this._visibilityGetter(s))for(const o of n){const n=this._getPoints(o,this._bars,e,t,r,s);if(null===n)continue;if(0===n.filter((i=>{const r=i.index;return r>=e&&r<=t})).length)continue;const l=this._getMargins(o,this._bars);i.bottomPixelMargin=Math.max(i.bottomPixelMargin,l.bottomPixelMargin),i.topPixelMargin=Math.max(i.topPixelMargin,l.topPixelMargin)}return i}}const _=()=>({bottomPixelMargin:0,topPixelMargin:0});function g(e){const t=(0,r.ensureDefined)(e.properties().childs().graphics).childs();return[new p((()=>e.graphics().tpos()),e,(e=>{const i=(0,r.ensureDefined)(t.tpoBlockSets).childs()[e].childs();return i.showLetters.value()||i.showBlocks.value()||(0,r.ensureDefined)(t.tpoVolumeRows).childs()[e].childs().visible.value()}),u,_),new p((()=>e.graphics().dwglabels()),e,(e=>(0,r.ensureDefined)(t.dwglabels).childs()[e].childs().visible.value()),d,n.calculateDwgLabelsMargins.bind(null,e)),new p((()=>e.graphics().dwglines()),e,(e=>(0,r.ensureDefined)(t.dwglines).childs()[e].childs().visible.value()),a,_),new p((()=>e.graphics().dwgboxes()),e,(e=>(0,r.ensureDefined)(t.dwgboxes).childs()[e].childs().visible.value()),c,_),new p((()=>e.graphics().dwglinefills()),e,(e=>(0,r.ensureDefined)(t.dwglinefills).childs()[e].childs().visible.value()),((t,i,r,s)=>{const n=new Map;for(const[,t]of e.graphics().dwglines())for(const e of t)n.set(e.id,e);return function(e,t,i,r,s){const n=e.get(t.line1),a=e.get(t.line2);return void 0!==n&&void 0!==a&&((0,l.doesItemAffectVisibleRange)(n.x1,n.x2,n.extend,r,s)||(0,l.doesItemAffectVisibleRange)(a.x1,a.x2,a.extend,r,s))?[new o(r,n.y1,!1),new o(s,n.y2,!1),new o(r,a.y1,!1),new o(s,a.y2,!1)]:[]}(n,t,0,r,s)}),_)]}function f(e,t,i){let r=null;for(const s of e){const e=s.groupPriceRange(t,i);null!==e&&(r=null===r?e:r.merge(e))}return r}function P(e,t,i){const r=_();for(const s of e){const e=s.groupPixelMargins(t,i);r.bottomPixelMargin=Math.max(r.bottomPixelMargin,e.bottomPixelMargin),r.topPixelMargin=Math.max(r.topPixelMargin,e.topPixelMargin)}return r}function v(e,t,i){return null===t?e:null===e?t:e.index<t.index?i?t:e:i?e:t}class m{constructor(){this.firstVisible=null,this.leftClosest=null,this.rightClosest=null}improve(e){this.firstVisible=v(this.firstVisible,e.firstVisible,!0),this.leftClosest=v(this.leftClosest,e.leftClosest,!0),this.rightClosest=v(this.rightClosest,e.rightClosest,!1)}bestPrice(){return null!==this.firstVisible?this.firstVisible.price:null!==this.leftClosest?this.leftClosest.price:null!==this.rightClosest?this.rightClosest.price:null}}function y(e,t){const i=e.model().timeScale();if(i.isEmpty())return null;const r=i.visibleBarsStrictRange();if(null===r)return null;const s=r.firstBar(),n=r.lastBar(),o=new m;for(const e of t){const t=e.firstValue(s,n);o.improve(t)}return o.bestPrice()}},567467:(e,t,i)=>{i.d(t,{HHistBasedValuesProvider:()=>_});var r=i(150335),s=i(650151),n=i(638456),o=i(534741),l=i(885482),a=i(943994),c=i(396372),h=i(616117),d=i(60897);function u(e,t="",i=""){return{id:t,index:e,title:i,value:"",visible:!1}}
const p=n.CheckMobile.any();class _{constructor(e,t){this._emptyValues=[],this._study=e,this._model=t,void 0!==this._study.metaInfo().graphics.hhists&&this._emptyValues.push(u(0),u(1),u(2))}getItems(){return this._emptyValues}getValues(e){var t,i;const n=this._emptyValues.map((e=>({...e})));n.forEach((e=>{e.visible=this._study.isVisible(),e.value=d.notAvailable}));const l=this._study.properties().childs().inputs.childs().volume.value();switch(l){case c.HHistVolumeMode.UpDown:n[0].title="Up",n[1].title="Down",n[2].title="Total";break;case c.HHistVolumeMode.Total:n[0].title="Total",n[1].visible=!1,n[2].visible=!1;break;case c.HHistVolumeMode.Delta:n[0].title="Delta",n[1].title="Max(Up, Down)",n[2].title="Total"}const h=this._study.priceScale(),u=this._model.timeScale();if(null===h||h.isEmpty()||u.isEmpty()||this._hideValues())return n;if(null===e||!isFinite(e)){const t=this._study.data().last();if(null===t)return n;e=t.index}const p=this._model.crossHairSource(),_=p.price;if(!isFinite(p.y)&&(e=function(e,t){var i;const r=null===(i=e.visibleBarsStrictRange())||void 0===i?void 0:i.lastBar();if(!r)return null;const s=t.data().search(r,o.PlotRowSearchMode.NearestLeft);return s?s.index:null}(this._model.timeScale(),this._model.mainSeries()),null===e))return n;const g=function(e,t,i,r){if(0===e.size)return null;if(!i){const e=(0,s.ensureNotNull)(r.data().valueAt(t));i=r.barFunction()(e)}const n=function(e,t){let i=null;return e.forEach(((e,r)=>{r<=t&&(null===i||r>i)&&(i=r)})),i}(e,t);if(null===n)return null;const o=e.get(n);if(!o||0===o.size)return null;return function(e,t){let i=null;return e.forEach((e=>{e.priceLow<=t&&t<e.priceHigh&&(i=e)})),i}(o,i)}(this._study.graphics().hhistsByTimePointIndex(),e,_,this._model.mainSeries());if(null===g)return n.forEach((e=>{e.value="0"})),n;const f=this._study.metaInfo().graphics.hhists;if(void 0===f)return n;if(void 0===f[g.styleId])return n;const P=null===(i=null===(t=this._study.properties().childs().graphics.childs().hhists)||void 0===t?void 0:t.childs()[g.styleId])||void 0===i?void 0:i.childs(),v=new a.VolumeFormatter,m=e=>(0,r.isNumber)(e)?v.format(e):"";if(l!==c.HHistVolumeMode.Delta){if(g.rate.forEach(((e,t)=>{n[t].value=m(e),n[t].color=(0,s.ensureDefined)(P).colors[t].value()})),l===c.HHistVolumeMode.UpDown){const e=g.rate[0]+g.rate[1];n[2].value=m(e),n[2].color=(0,s.ensureDefined)(P).valuesColor.value()}}else{const e=g.rate[0]>g.rate[1]?0:1,t=(0,s.ensureDefined)(P).colors[e].value(),i=g.rate[0]+g.rate[1];[2*g.rate[e]-i,g.rate[e],i].forEach(((e,i)=>{n[i].value=m(e),n[i].color=t}))}return n}_hideValues(){return p&&(null===this._model.crossHairSource().pane||(0,h.isLineToolName)(l.tool.value())||null!==this._model.lineBeingEdited())}}},173220:(e,t,i)=>{i.d(t,{makeNextStudyId:()=>o,makeNextSymbolId:()=>s});let r=0;function s(){return r++,"ss_"+r}let n=0;function o(){return n++,"st"+n}},272933:(e,t,i)=>{function r(e,t){if(null===e)return t;const i=e.firstIndex,r=t.firstIndex,s=e.clearData||t.clearData;return{firstIndex:s||void 0===i||void 0===r?void 0:Math.min(i,r),clearData:s}}
i.d(t,{mergeDataInvalidation:()=>r})},753877:(e,t,i)=>{i.d(t,{PlotFillPaneView:()=>a});var r=i(650151),s=i(151149),n=i(434294),o=i(368135);const l={type:0,color:"transparent"};class a extends n.AbstractFilledAreaPaneView{constructor(e,t,i,n){var l,a,c;super(e,t,!!i.fillgaps),this._palettesInfo={},this._gradientPropsStateCache=null,this._rgbaFromInteger=(0,s.rgbaFromIntegerCached)();const h=this._source.metaInfo();this._isRGB=Boolean(h.isRGB),this._isHlineFill="hline_hline"===i.type,(0,r.assert)(this._isHlineFill||"plot_plot"===i.type,"Wrong filledArea type: "+i.type),this._isHlineFill&&this._initBandIndexes(i.objAId,i.objBId),this._fillMetaInfo=i,this._fillStyleProps=n,this._gradientFillType=n.hasChild("fillType")&&"gradient"===(null===(l=n.childs().fillType)||void 0===l?void 0:l.value()),this._gradientStaticState={color1:i.topColor,color2:i.bottomColor,value1:i.topValue,value2:i.bottomValue},this._hasAllGradientRequiredProps=this._gradientFillType&&(void 0!==this._gradientStaticState.color1||n.hasChild("topColor")||void 0!==this._gradientStaticState.color2||n.hasChild("bottomColor"))&&(void 0!==this._gradientStaticState.value1||n.hasChild("topValue"))&&(void 0!==this._gradientStaticState.value2||n.hasChild("bottomValue"));const d=()=>{var e;return this._colorPlotIndex=null!==(e=this._colorPlotIndex)&&void 0!==e?e:{type:1}};for(let t=0;t<h.plots.length;++t){const s=h.plots[t];if(((0,o.isColorerPlot)(s)||(0,o.isDataPlot)(s))&&s.target===i.id){if((0,o.isColorerPlot)(s)){let i;void 0!==s.targetField?"topColor"===s.targetField?(d().colorIndexOrRgba1=t,i="color1"):"bottomColor"===s.targetField&&(d().colorIndexOrRgba2=t,i="color2"):this._colorPlotIndex={type:0,colorIndexOrRgba:t},(0,o.isPaletteColorerPlot)(s)&&(this._palettesInfo[null!=i?i:"color"]={map:(0,r.ensureDefined)(null===(a=(0,r.ensureDefined)(h.palettes)[s.palette])||void 0===a?void 0:a.valToIndex),values:e.properties().palettes[s.palette].colors})}else(0,o.isDataPlot)(s)&&("topValue"===s.targetField?d().valueIndex1=t:"bottomValue"===s.targetField&&(d().valueIndex2=t));if(0===(null===(c=this._colorPlotIndex)||void 0===c?void 0:c.type))break}}}update(e){super.update(e),this._gradientPropsStateCache=null}_minFirstBarIndex(){return this._source.getMinFirstBarIndexForPlot(this._fillMetaInfo.id)}_getColorByPlotValue(e){var t,i,s;if(0===e.type){let i;if(null==e.colorIndexOrRgba)return null;if(this._isRGB)i=this._rgbaFromInteger(e.colorIndexOrRgba);else{const s=(0,r.ensureDefined)(this._palettesInfo.color),n=(0,r.ensureDefined)(s.map[e.colorIndexOrRgba]);i=null===(t=s.values[n])||void 0===t?void 0:t.childs().color.value()}return{type:0,color:i}}const n=this._gradientColorPropsState();let o,l;if(this._isRGB)null!=e.colorIndexOrRgba1&&(o=this._rgbaFromInteger(e.colorIndexOrRgba1)),null!=e.colorIndexOrRgba2&&(l=this._rgbaFromInteger(e.colorIndexOrRgba2));else{if(null!=e.colorIndexOrRgba1){const t=(0,r.ensureDefined)(this._palettesInfo.color1);o=t.values[(0,r.ensureDefined)(t.map[e.colorIndexOrRgba1])].childs().color.value()}if(null!=e.colorIndexOrRgba2){const t=(0,
r.ensureDefined)(this._palettesInfo.color2);l=t.values[(0,r.ensureDefined)(t.map[e.colorIndexOrRgba2])].childs().color.value()}}const a=null!==(i=e.value1)&&void 0!==i?i:n.value1,c=null!==(s=e.value2)&&void 0!==s?s:n.value2;return o=null!=o?o:n.color1,l=null!=l?l:n.color2,void 0===a||void 0===c||void 0===o&&void 0===l?null:{type:1,color1:o,color2:l,value1:a,value2:c,coordinate1:NaN,coordinate2:NaN}}_plotAId(){return this._fillMetaInfo.objAId}_plotBId(){return this._fillMetaInfo.objBId}_commonColor(){const e=this._fillStyleProps.childs();if(this._gradientFillType){if(!this._hasAllGradientRequiredProps)return l;const e=this._gradientColorPropsState();return{type:1,color1:e.color1,color2:e.color2,value1:e.value1,value2:e.value2,coordinate1:NaN,coordinate2:NaN}}return{type:0,color:e.color.value()}}_transparency(){return this._fillStyleProps.childs().transparency.value()}_visible(){return this._fillStyleProps.childs().visible.value()}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;const i=this._source.metaInfo().bands;if(void 0!==i)for(let r=0;r<i.length;++r){const s=i[r];null!==this._bandAKey||s.id!==e?null===this._bandBKey&&s.id===t&&(this._bandBKey=r):this._bandAKey=r}}_gradientColorPropsState(){var e,t,i,r;if(null===this._gradientPropsStateCache){const s=this._fillStyleProps.state();this._gradientPropsStateCache={color1:null!==(e=this._gradientStaticState.color1)&&void 0!==e?e:s.topColor,color2:null!==(t=this._gradientStaticState.color2)&&void 0!==t?t:s.bottomColor,value1:null!==(i=this._gradientStaticState.value1)&&void 0!==i?i:s.topValue,value2:null!==(r=this._gradientStaticState.value2)&&void 0!==r?r:s.bottomValue}}return this._gradientPropsStateCache}}},490207:(e,t,i)=>{i.d(t,{StudyPlotArrowsPaneView:()=>v});var r=i(650151),s=i(724377),n=i(678515),o=i(246733),l=i(142119),a=i(86441),c=i(315801),h=i(43192);class d extends a.Point{constructor(e,t,i,r){super(e,t),this.height=i,this.isUp=r,this.style={}}}function u(e){return Math.round(e/4)}function p(e){return Math.round(e/2)}class _ extends h.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=this._data,i=p(t.barSpacing),r=Math.round(i/2),s=Math.round(i),n=u(t.barSpacing);for(const i of t.items){if(!i)continue;if(!Number.isFinite(i.x)||!Number.isFinite(i.y))continue;const t=Math.abs(i.height),o=i.isUp?-1:1,l=t+s,a=i.y-o*n,h=a-o*l,d=i.x-r,u=i.x+r;if(d<e.x&&e.x<u&&(i.isUp?a<e.y&&e.y<h:h<e.y&&e.y<a))return new c.HitTestResult(c.HitTarget.Regular)}return null}_drawImpl(e){var t;const{horizontalPixelRatio:i,verticalPixelRatio:r,context:s}=e,o=this._data,l=p(o.barSpacing),a=u(o.barSpacing),c=l<4,h=Math.max(l/2,1),d=(0,n.ceiledEven)(l*i),_=d/2,g=Math.round(l*r);s.lineCap="butt",s.lineWidth=Math.max(1,Math.floor(i));const f=s.lineWidth%2?.5:0;for(const e of o.items){const n=e.isUp?-1:1,l=Math.round(Math.abs(e.height)*r),u=Math.round(e.x*i)+f,p=Math.round((e.y-n*a)*r)+f;s.beginPath(),s.translate(u,p);const P=null!==(t=e.style&&e.style.color)&&void 0!==t?t:e.isUp?o.colorup:o.colordown;c?(s.moveTo(0,0),s.lineTo(-_,-_*n),
s.moveTo(0,0),s.lineTo(_,-_*n),s.moveTo(0,0),s.lineTo(0,-l*n),s.moveTo(-_,-l*n),s.lineTo(_,-l*n),s.lineWidth=h,s.strokeStyle=P,s.stroke()):(s.moveTo(0,0),l<g?(s.lineTo(d,-l*n),s.lineTo(-d,-l*n)):(s.lineTo(d,-g*n),s.lineTo(_,-g*n),s.lineTo(_,-l*n),s.lineTo(-_,-l*n),s.lineTo(-_,-g*n),s.lineTo(-d,-g*n)),s.lineTo(0,0),s.strokeStyle=e.isUp?o.colorBorderUp:o.colorBorderDown,s.stroke(),s.fillStyle=P,s.fill()),s.translate(-u,-p)}}}var g=i(230058);class f extends g.SelectionRenderer{_drawMarker(e,t,i,s){const{context:n,horizontalPixelRatio:o,verticalPixelRatio:l}=e,a=(0,r.ensureNotNull)(this._data),c=t.isUp?1:-1;const h=i+c*u(a.barSpacing)+c*p(a.barSpacing);let d=Math.round(3.5*o*2);d%2!=s%2&&(d+=1);const _=s%2/2,g=Math.round(t.x*o)+_,f=Math.round((t.y+h)*l)+_;n.beginPath(),n.arc(g,f,d/2,0,2*Math.PI,!0),n.closePath(),n.fill(),n.stroke()}}var P=i(112311);class v extends P.StudyPlotShapesPaneViewBase{constructor(){super(...arguments),this._maxAbsValue=0}renderer(){if(!this._isPlotVisible()||!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=this._study.properties().childs().styles.childs()[this._plotName].childs(),t={},i=(0,n.clamp)(this._getTranspValue(),0,100),r=this._model.timeScale().barSpacing();t.items=this._items,t.barSpacing=r,t.colorup=(0,o.generateColor)(e.colorup.value(),i),t.colordown=(0,o.generateColor)(e.colordown.value(),i);const a=(0,s.parseRgba)(t.colorup),c=a?100*(1-a[3]):0,h=(0,s.parseRgba)(t.colordown),d=h?100*(1-h[3]):0;t.colorBorderUp=(0,o.generateColor)("#000000",c),t.colorBorderDown=(0,o.generateColor)("#000000",d),t.minHeight=this._plotStyleInfo.minHeight,t.maxHeight=this._plotStyleInfo.maxHeight;const u=new l.CompositeRenderer;if(u.append(new _(t)),this._model.selection().isSelected(this._study)&&null!==this._selectionData){const e=this._selectionData;e.barSpacing=r,u.append(new f(e))}return u}_fillItemWithPointStyle(e,t,i){const s=(0,r.ensureDefined)(e.style);e.isUp?void 0!==t.colors[5]?s.color=(0,o.generateColor)((0,r.ensureDefined)(t.colors[5]),i):s.color=(0,o.generateColor)(this._study.properties().childs().styles.childs()[this._plotName].childs().colorup.value(),i):void 0!==t.colors[6]?s.color=(0,o.generateColor)((0,r.ensureDefined)(t.colors[6]),i):s.color=(0,o.generateColor)(this._study.properties().childs().styles.childs()[this._plotName].childs().colordown.value(),i)}_createItem(e,t,i,r){if(0===t)return null;Math.abs(t)>this._maxAbsValue&&(this._maxAbsValue=Math.abs(t));const s=t>0;let n;if(s){const t=this._getSeriesVal(r,e);if(null===t)return null;n=t}else{const t=this._getSeriesVal(i,e);if(null===t)return null;n=t}return new d(e,n,t,s)}_convertItemsToCoordinates(){var e,t,i,s;const n=this._model.timeScale(),o=(0,r.ensureNotNull)(this._study.priceScale());n.timedValuesToCoordinates(this._items),o.pointsArrayToCoordinates(this._items,(0,r.ensureNotNull)(this._study.firstValue()));const l=this._study.properties().childs().styles.childs();let a=Math.abs((0,
r.ensureDefined)(null!==(t=null===(e=l[this._plotName].childs().minHeight)||void 0===e?void 0:e.value())&&void 0!==t?t:this._plotStyleInfo.minHeight)),c=Math.abs((0,r.ensureDefined)(null!==(s=null===(i=l[this._plotName].childs().maxHeight)||void 0===i?void 0:i.value())&&void 0!==s?s:this._plotStyleInfo.maxHeight));if(a>c){const e=a;a=c,c=e}const h=(c-a)/this._maxAbsValue,d=this._items;for(let e=0;e<d.length;e++){const t=d[e],i=Math.abs(t.height);t.height=i*h+a}}}},418804:(e,t,i)=>{i.d(t,{StudyBackgroundPaneView:()=>_});var r=i(650151),s=i(86441),n=i(389137),o=i(246733),l=i(534741),a=i(244842),c=i(142119),h=i(43192);class d extends h.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){return null}_drawImpl(e){}_drawBackgroundImpl(e){const{context:t,horizontalPixelRatio:i,bitmapSize:r}=e,s=this._data;let n=null;const o=Math.round(this._data.barSpacing*i);for(let e=0;e<s.items.length;++e){const l=s.items[e];if(null==l.color){n=null;continue}t.fillStyle=l.color;const a=Math.round(l.x*i);let c=a;if(e>0){s.items[e-1].index===l.index-1&&null!==n&&(c=n+1)}const h=a+o,d=h-c+1;t.fillRect(c,0,d,r.height),n=h}}}var u=i(368135),p=i(441212);class _{constructor(e,t,i,s){this._items=[],this._invalidated=!0,this._isMarkersEnabled=a.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=s;const n=this._study.metaInfo().plots;for(let e=0;e<n.length;e++){const t=n[e];t.id===this._plotName&&(this._plotIndex=e,(0,r.assert)((0,u.isBgColorerPlot)(t),"Plot '"+this._plotName+"' is not a background colorer!"))}this._colorProvider=(0,p.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s)}items(){return this._items}update(){this._invalidated=!0}renderer(){if(1!=(1&(0,r.ensureDefined)(this._study.properties().childs().styles.childs()[this._plotName]).childs().display.value()))return null;if(!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={items:this._items,barSpacing:this._model.timeScale().barSpacing()},t=new c.CompositeRenderer;return t.append(new d(e)),t}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&!e.isEmpty()&&null!==t&&!t.isEmpty()}_getTranspValue(){const e=(0,r.ensureDefined)(this._study.properties().childs().styles.childs()[this._plotName]).childs();let t=0;return e.transparency&&(t=e.transparency.value(),t=(0,n.isNumber)(t)?t:40),t}_updateImpl(){this._items=[],(0,r.assert)(this._scalesReady(),"Scales must be ready!");const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return;const t=this._getTranspValue();let i=(0,r.ensureDefined)(this._series.nearestIndex(e.firstBar(),l.PlotRowSearchMode.NearestRight)),a=(0,r.ensureDefined)(this._series.nearestIndex(e.lastBar(),l.PlotRowSearchMode.NearestLeft));const c=this._study.offset(this._plotName);c>0?(i-=c,a+=c):(i+=c,a-=c);const h=this._study.getMinFirstBarIndexForPlot(this._plotName);if(h>a)return;i=Math.max(h,i);const d=this._study.data();for(const e of d.rangeIterator(i,a)){let i=e.index;const l=e.value;i+=c
;const a=new s.Point(Math.floor(i)-.5,NaN);let h=(0,n.isNumber)(t)?t:50;h=Math.min(h,100),h=Math.max(h,0);const d=this._colorProvider.getPlotPointStyle(l);void 0!==d.colors[1]&&(a.color=(0,o.generateColor)((0,r.ensureDefined)(d.colors[1]),h)),a.index=i,this._items.push(a)}this._model.timeScale().timedValuesToCoordinates(this._items)}}},408107:(e,t,i)=>{i.d(t,{StudyPlotCharsPaneView:()=>v});var r=i(650151),s=i(461794),n=i(246733),o=i(142119),l=i(230058),a=i(687795),c=i.n(a),h=i(86441),d=i(821885),u=i(315801),p=i(239589),_=i(422333),g=i(600642);class f extends d.PaneRendererAbstractShape{constructor(e,t){super(null,t),this._fontSizeEnsured=0,this._ch="",this._fontFamily=_.CHART_FONT_FAMILY,this._charCache=null,null!==e&&this.setData(e)}setData(e){super.setData(e),this._fontSizeEnsured=(0,r.ensureDefined)(this._height);const t=e.char.slice(0,40);this._ch=c()(t)[0]||" ",this._fontFamily=e.fontFamily||_.CHART_FONT_FAMILY}hitTest(e){const t=(0,p.interactionTolerance)().series+this._fontSizeEnsured/2;for(const i of this._items){if(new h.Point(i.x,i.y+i.vertOffset).subtract(e).length()<=t)return new u.HitTestResult(u.HitTarget.Regular)}return null}_drawItemShape(e,t,i){const r=i.x,s=i.vertOffset>0?1:-1,n=i.y+i.vertOffset-s*Math.round(this._fontSizeEnsured/2);let o;o=i.style&&void 0!==i.style.color?i.style.color:this._color;const l=this._textImageCache(),a=t.pixelRatio;if(this._fontSizeEnsured<=4/a){e.save();const t=Math.max(1,Math.floor(a));let s=Math.max(1,Math.floor(l.textImageWidth*a));s%2!=t%2&&(s+=s>1?-1:1);const c=Math.round(n*a)+(i.vertOffset>=0?0:-s);return e.fillStyle=o,e.fillRect(Math.round(r*a)+(a%2?.5:0)-s/2,c,s,s),void e.restore()}const c={style:{fillStyle:o},location:{x:r,y:n,horzAlign:g.HorizontalAlign.Center,vertAlign:i.vertOffset>0?g.VerticalAlign.Top:g.VerticalAlign.Bottom}};l.paintTo(e,t,c)}_startPath(e,t,i,r){}_endPath(e){}_textImageCache(){return null!==this._charCache&&this._charCache.fontFamily===this._fontFamily&&this._charCache.fontSize===this._fontSizeEnsured||(this._charCache={fontSize:this._fontSizeEnsured,fontFamily:this._fontFamily,cache:new g.TextImageCache(this._ch,!1,!1,this._fontFamily,this._fontSizeEnsured,"center",0)}),this._charCache.cache}}var P=i(112311);class v extends P.StudyPlotShapesPaneViewBase{constructor(){super(...arguments),this._compositeRenderer=new o.CompositeRenderer,this._charRenderer=new f(null)}renderer(){return this._isPlotVisible()&&this._scalesReady()?(this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer):null}_updateImpl(){var e,t;if(this._compositeRenderer.clear(),super._updateImpl(),0===this._items.length)return;const i=this._getTranspValue(),o=this._model.timeScale().barSpacing();let a;const c=this._study.properties().childs().styles.childs()[this._plotName].childs();a=this._plotStyleInfo.size?this._calculateShapeHeight(50,this._plotStyleInfo.size):Math.round(o);const h=c.location.value(),d=(0,n.generateColor)(c.color.value(),i),u=this._calculateVerticalOffset(h,a),p={items:this.items(),barSpacing:o,char:(0,
r.ensureDefined)(null!==(t=null===(e=c.char)||void 0===e?void 0:e.value())&&void 0!==t?t:this._plotStyleInfo.char),height:a,vertOffset:u,color:d},_=this._plotStyleInfo.text;if(void 0!==_&&""!==_.trim()){let e=_.trim().replace(/\\n/gm,"\n");e=(0,s.cleanButAmpersand)(e,!0),p.text=e,p.fontSize=12;const t=c.textColor?c.textColor.value():void 0;p.textColor=t?(0,n.generateColor)(t,i):d}this._charRenderer.setData(p),this._compositeRenderer.append(this._charRenderer),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=u,this._compositeRenderer.append(new l.SelectionRenderer(this._selectionData)))}}},574809:(e,t,i)=>{function r(e){e.lineWidth=void 0,e.lineStyle=void 0;for(let t=0;t<e.colors.length;t++)e.colors[t]=void 0;return e}function s(){return{colors:[void 0,void 0,void 0,void 0,void 0,void 0,void 0],lineWidth:void 0,lineStyle:void 0}}i.d(t,{clearStyle:()=>r,createEmptyStyle:()=>s})},800275:(e,t,i)=>{i.d(t,{PaneRendererCircles:()=>c});var r=i(86441),s=i(389137),n=i(239589),o=i(315801),l=i(43192),a=i(638456);class c extends l.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){var t,i,s,l;const a=this._data,c=a.lineWidth||a.height/2,h=a.vertOffset||0,d=(0,n.interactionTolerance)().series+c,u=null!==(i=null===(t=a.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,p=null!==(l=null===(s=a.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==l?l:a.items.length;for(let t=u;t<p;t++){const i=a.items[t];if(new r.Point(i.x,i.y+h).subtract(e).length()+c<=d)return new o.HitTestResult(o.HitTarget.Regular)}return null}_drawImpl(e){var t,i,r,n;const o=this._data,{horizontalPixelRatio:l,verticalPixelRatio:c,context:h}=e,d=Math.max(1,Math.floor(l))%2?.5:0,u=o.vertOffset||0,p=o.lineColor||o.color,_=o.lineWidth||o.height/2;let g="",f=!1;const P=null!==(i=null===(t=o.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,v=null!==(n=null===(r=o.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:o.items.length;for(let e=P;e<v;e++){const t=o.items[e],i=t.x,r=t.y+u;if((0,s.isNaN)(i)||(0,s.isNaN)(r))continue;let n,P;null!=t.style?(n=t.style.color,P=t.style.width):(n=p,P=_),(n!==g||a.isSafari)&&(g=n,f&&h.fill(),h.beginPath(),h.fillStyle=n);const v=Math.round(i*l)+d,m=Math.round(r*c)+d,y=Math.round(P*l)+d;h.moveTo(v+y,m),h.arc(v,m,y,0,2*Math.PI,!1),f=!0}f&&h.fill()}}},793907:(e,t,i)=>{i.d(t,{PaneRendererColumns:()=>n});var r=i(43192),s=i(315801);class n extends r.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=null,this._precalculatedCache=[],this.setData(e)}setData(e){this._data=e,this._precalculatedCache=[]}hitTest(e){var t,i,r,n;if(null===this._data)return null;const o=.5*this._data.barSpacing,l=e.x-o,a=e.x+o,c=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,h=(null!==(n=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:this._data.items.length)-1
;for(let t=c;t<=h;t++){const i=this._data.items[t],r=i.x;if(r>=l&&r<=a){const t=i.y;if(e.y>=Math.min(t,this._data.histogramBase)&&e.y<=Math.max(t,this._data.histogramBase))return new s.HitTestResult(s.HitTarget.Regular)}}return null}_drawImpl(e){var t,i,r,s;if(null===this._data||0===this._data.items.length)return;const{context:n,horizontalPixelRatio:o,verticalPixelRatio:l}=e;this._precalculatedCache.length||this._fillPrecalculatedCache(o);const a=Math.max(1,Math.floor(o)),c=Math.max(1,Math.floor(l)),h=Math.round(this._data.histogramBase*l)-Math.floor(a/2),d=h+a,u=this._data.lineColor,p=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,_=(null!==(s=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==s?s:this._data.items.length)-1;for(let e=p;e<=_;e++){const t=this._data.items[e],i=this._precalculatedCache[e-p],r=Math.round(t.y*l);let s,o;n.fillStyle=t.style?t.style.color:u,r<=h?(s=r,o=d):(s=h,o=r-Math.floor(c/2)+c),n.fillRect(i.left,s,i.right-i.left+1,o-s)}}_fillPrecalculatedCache(e){var t,i;if(null===this._data||0===this._data.items.length)return void(this._precalculatedCache=[]);const{barSpacing:r,visibleItemsRange:s,items:n}=this._data,o=Math.ceil(r*e)<=1?0:Math.max(1,Math.floor(e)),l=Math.round(r*e)-o,a=null!==(t=null==s?void 0:s.startItemIndex)&&void 0!==t?t:0,c=(null!==(i=null==s?void 0:s.endItemIndex)&&void 0!==i?i:n.length)-1,h=c-a+1;if(h<=0)return void(this._precalculatedCache=[]);this._precalculatedCache=new Array(h);for(let t=a;t<=c;t++){const i=n[t],r=Math.round(i.x*e);let s,o;if(l%2){const e=(l-1)/2;s=r-e,o=r+e}else{const e=l/2;s=r-e,o=r+e-1}this._precalculatedCache[t-a]={left:s,right:o,roundedCenter:r,center:i.x*e,time:i.timePointIndex}}for(let e=a+1;e<=c;e++){const t=this._precalculatedCache[e-a],i=this._precalculatedCache[e-a-1];t.time===i.time+1&&(t.left-i.right!==o+1&&(i.roundedCenter>i.center?i.right=t.left-o-1:t.left=i.right+o+1))}let d=Math.ceil(r*e);for(let e=a+1;e<=c;e++){const t=this._precalculatedCache[e-a];t.right<t.left&&(t.right=t.left);const i=t.right-t.left+1;d=Math.min(i,d)}if(o>0&&d<4)for(let e=a+1;e<=c;e++){const t=this._precalculatedCache[e-a];t.right-t.left+1>d&&(t.roundedCenter>t.center?t.right-=1:t.left+=1)}}}},308812:(e,t,i)=>{i.d(t,{PaneRendererCross:()=>h});var r=i(86441),s=i(204652),n=i(389137),o=i(239589),l=i(315801),a=i(43192),c=i(638456);class h extends a.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,o.interactionTolerance)().series+this._data.lineWidth/2;let i,n,a,c;for(let o=1;o<this._data.items.length;++o){i=this._data.items[o-1],n=this._data.items[o],a=i.x,c=n.x;if((0,s.distanceToSegment)(new r.Point(a,i.y),new r.Point(c,n.y),new r.Point(e.x,e.y)).distance<=t)return new l.HitTestResult(l.HitTarget.Regular)}return null}_drawImpl(e){var t,i,r,s,o,l,a,h;const{context:d,horizontalPixelRatio:u,verticalPixelRatio:p}=e;let _="",g=!1
;const f=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,P=(null!==(s=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==s?s:this._data.items.length)-1;for(let e=f;e<=P;e++){const t=this._data.items[e];if((0,n.isNaN)(t.x)||(0,n.isNaN)(t.y))continue;const i=null!==(l=null===(o=t.style)||void 0===o?void 0:o.color)&&void 0!==l?l:this._data.lineColor,r=null!==(h=null===(a=t.style)||void 0===a?void 0:a.width)&&void 0!==h?h:this._data.lineWidth,s=Math.max(1,Math.floor(r*u)),f=Math.max(1,Math.floor(r*p));(i!==_||c.isSafari)&&(_=i,g&&d.fill(),d.beginPath(),d.fillStyle=i);let P=3*s;P%2!=s%2&&(P+=1);let v=3*f;v%2!=f%2&&(v+=1);const m=Math.round(Math.round(t.x*u)-P/2),y=Math.round(Math.round(t.y*p)-v/2),C=m+Math.floor(P/2-s/2),x=y+Math.floor(v/2-f/2);d.rect(m,x,P,f),d.rect(C,y,s,v),g=!0}g&&d.fill()}}},700562:(e,t,i)=>{i.d(t,{PaneRendererHistogram:()=>c});var r=i(650151),s=i(86441),n=i(204652),o=i(43192),l=i(239589),a=i(315801);class c extends o.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,l.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const o of this._data.items){const l=o.x,c=o.y;let h=t;o.style&&(i.has(o.style.width)?h=(0,r.ensureDefined)(i.get(o.style.width)):i.set(this._data.lineWidth,h));if((0,n.distanceToSegment)(new s.Point(l,c),new s.Point(l,this._data.histogramBase),new s.Point(e.x,e.y)).distance<=h)return new a.HitTestResult(a.HitTarget.Regular)}return null}_drawImpl(e){var t,i,r,s;if(0===this._data.items.length)return;const{context:n,horizontalPixelRatio:o,verticalPixelRatio:l}=e;n.fillStyle=this._data.lineColor;const a=Math.max(1,Math.floor(this._data.lineWidth*o)),c=a/2,h=Math.max(1,Math.floor(o)),d=Math.round(this._data.histogramBase*l)-Math.floor(h/2),u=d+h,p=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,_=(null!==(s=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==s?s:this._data.items.length)-1;for(let e=p;e<=_;e++){const t=this._data.items[e];let i=a,r=c;t.style?(n.fillStyle=t.style.color,i=Math.max(1,Math.floor(t.style.width*o)),r=i/2):n.fillStyle=this._data.lineColor;const s=i%2?.5:0,p=Math.round(t.x*o)+s,_=Math.round(t.y*l);let g,f;_<=d?(g=_,f=u):(g=d,f=_-Math.floor(h/2)+h),n.fillRect(Math.floor(p-r),g,i,f-g)}}}},835793:(e,t,i)=>{i.d(t,{StudyPlotBarCandlesPaneView:()=>p});var r=i(86441),s=i(650151),n=i(244842),o=i(246733),l=i(63316),a=i(534741),c=i(315801),h=i(368135),d=i(574809),u=i(441212);class p{constructor(e,t,i,r){this._bars=[],this._invalidated=!1,this._isMarkersEnabled=n.enabled("source_selection_markers"),this._selectionData=null,this._ohlcPlotIndexes=new Map,this._study=e,this._series=t,this._model=i,this._plotName=r,this._isMarkersEnabled=n.enabled("source_selection_markers"),this._colorProvider=(0,u.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),r),this._selectionIndexer=new l.SelectionIndexes(i.timeScale())
;const s=this._study.metaInfo().plots;for(let e=0;e<s.length;e++){const t=s[e];"target"in t&&(t.target===this._plotName&&((0,h.isOhlcOpenPlot)(t)&&this._ohlcPlotIndexes.set(1,e),(0,h.isOhlcHighPlot)(t)&&this._ohlcPlotIndexes.set(2,e),(0,h.isOhlcLowPlot)(t)&&this._ohlcPlotIndexes.set(3,e),(0,h.isOhlcClosePlot)(t)&&this._ohlcPlotIndexes.set(4,e)))}}update(){this._invalidated=!0}items(){return this._bars}_updateImpl(){this._bars.length=0;const e=this._study.priceScale();if(this._model.timeScale().isEmpty()||null===e||e.isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;let i=this._series.nearestIndex(t.firstBar(),a.PlotRowSearchMode.NearestRight);const n=this._series.nearestIndex(t.lastBar(),a.PlotRowSearchMode.NearestLeft);if(void 0===i||void 0===n)return;const l=this._study.getMinFirstBarIndexForPlot(this._plotName);if(l>n)return;i=Math.max(l,i);const h=this._study.data(),u=this._study.firstValue();if(null===u)return;const p=h.rangeIterator(i,n),_=(0,s.ensureDefined)(this._study.properties().childs().ohlcPlots).childs()[this._plotName].childs(),g=new Map,f=(e,t)=>{const i=e+"@"+t;if(!g.has(i)){const r=(0,o.generateColor)(e,t);return g.set(i,r),r}return g.get(i)},P=(0,d.createEmptyStyle)();for(const e of p){let t=e.index;const i=e.value;t=Math.floor(t);let r=!0;const n=new Map;for(let e=1;e<=4;++e){const t=this._ohlcPlotIndexes.get(e);if(void 0===t){r=!1;break}const s=i[t+1];if(null==s){r=!1;break}n.set(e,s)}if(!r)continue;const o=(0,s.ensureDefined)(n.get(1)),l=(0,s.ensureDefined)(n.get(4)),a=(0,s.ensureDefined)(n.get(2)),c=(0,s.ensureDefined)(n.get(3)),h=Math.max(o,a,c,l),d=Math.min(o,a,c,l);let u=(0,s.ensureDefined)(f(_.color.value(),0));const p=this._colorProvider.getPlotPointStyle(i,P);void 0!==p.colors[0]&&(u=(0,s.ensureDefined)(p.colors[0]));const g={time:Math.round(t),open:o,high:h,low:d,close:l,color:u,wickColor:p.colors[4],borderColor:p.colors[3],hollow:null};this._bars.push(g)}if(e.barPricesToCoordinates(this._bars,u),this._model.timeScale().barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._study)){const t=this._selectionIndexer.indexes();this._selectionData={points:[],hittestResult:c.HitTarget.Regular,bgColors:[],visible:!0,barSpacing:this._model.timeScale().barSpacing()};const i=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height(),n=(0,s.ensureDefined)(this._ohlcPlotIndexes.get(4));for(let s=0;s<t.length;s++){const o=t[s],l=this._study.data().valueAt(o);if(null===l)continue;const a=l[n+1];if(null==a)continue;const c=this._model.timeScale().indexToCoordinate(Math.floor(o)),h=e.priceToCoordinate(a,u);this._selectionData.points.push(new r.Point(c,h)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(h/i))}}else this._selectionIndexer.clear()}_isOHLCPlotVisible(){return this._study.isPlotVisibleAt(this._plotName,1)}}},55458:(e,t,i)=>{i.d(t,{StudyPlotBarsPaneView:()=>l});var r=i(142119),s=i(230058),n=i(969419),o=i(835793);class l extends o.StudyPlotBarCandlesPaneView{renderer(){
if(!this._isOHLCPlotVisible())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={bars:this._bars,barSpacing:this._model.timeScale().barSpacing(),dontDrawOpen:this._series.properties().childs().barStyle.childs().dontDrawOpen.value(),thinBars:this._series.properties().childs().barStyle.childs().thinBars.value()},t=new r.CompositeRenderer;return t.append(new n.PaneRendererBars(e)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&t.append(new s.SelectionRenderer(this._selectionData)),t}}},330786:(e,t,i)=>{i.d(t,{StudyPlotCandlesPaneView:()=>c});var r=i(650151),s=i(142119),n=i(239589),o=i(230058),l=i(956725),a=i(835793);class c extends a.StudyPlotBarCandlesPaneView{renderer(){if(!this._isOHLCPlotVisible())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=(0,r.ensureDefined)(this._study.properties().childs().ohlcPlots).childs()[this._plotName].childs(),t=this._model.timeScale().barSpacing(),i={bars:this._bars,barSpacing:t,wickVisible:e.drawWick.value(),bodyVisible:!0,borderVisible:e.drawBorder.value(),barWidth:(0,n.optimalBarWidth)(t),borderColor:e.borderColor.value(),wickColor:e.wickColor.value()},a=new s.CompositeRenderer;return a.append(new l.PaneRendererCandles(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&a.append(new o.SelectionRenderer(this._selectionData)),a}}},821885:(e,t,i)=>{i.d(t,{PaneRendererAbstractFillStrokeShape:()=>_,PaneRendererAbstractShape:()=>u,PaneRendererAbstractStrokeShape:()=>p});var r=i(650151),s=i(86441),n=i(934026),o=i(315801),l=i(318041),a=i(600642),c=i(422333),h=i(199471),d=i(638456);class u{constructor(e,t={skipRenderingOptimizations:!1}){this._items=[],this._barSpacing=0,this._vertOffset=0,this._textCache=t.textCache||new l.TextImageCachesContainer(5e3),this._drawOperation=t.skipRenderingOptimizations?this._drawWithoutOptimizations.bind(this):this._drawWithOptimizations.bind(this),null!==e&&this.setData(e)}draw(e,t){this._preDrawInit(),this._drawOperation(e,t)}hitTest(e){const t=o.HitTarget.Regular;let i=null;for(const r of this._items){if(!r)continue;const s=this._calcBoundingBox(r);if(s&&(0,n.pointInBox)(e,s)){const e={tooltip:this._getTooltip(r,s)};i=new o.HitTestResult(t,e)}}return i}setData(e){this._height=void 0!==e.height?e.height:e.width,this._width=void 0!==e.width?e.width:e.height,this._color=e.color,this._borderColor=e.borderColor,this._vertOffset=e.vertOffset||0,e.text&&(this._text=e.text,this._fontSize=e.fontSize,this._lineSpacing=e.lineSpacing,this._textColor=e.textColor,this._textAlign=e.textAlign||"center"),void 0!==e.items&&void 0!==e.barSpacing&&this.setItems(e.items,e.barSpacing)}setItems(e,t){this._setBaseData(e,t)}_calcBoundingBox(e){const t=e.vertOffset,i=this._getTextCache(e);if(!i)return;const r=i.textImageWidth,n=i.textImageHeight,o=r/2,l=e.y+t+e.textVertOffset,a=t>0?0:-n,c=t>0?n:0,h=new s.Point(e.x-o,l+a),d=new s.Point(e.x+o,l+c);return(0,s.box)(h,d)}_unionBox(e,t){
const i=Math.min(e.min.x,t.min.x),r=Math.max(e.max.x,t.max.x),n=Math.min(e.min.y,t.min.y),o=Math.max(e.max.y,t.max.y),l=new s.Point(i,n),a=new s.Point(r,o);return(0,s.box)(l,a)}_getTooltip(e,t){if(e.tooltip)return{content:{type:"text",data:e.tooltip},tooltipDelay:200,extendMargin:!0,rect:{x:t.min.x,y:t.min.y,w:Math.abs(t.max.x-t.min.x),h:Math.abs(t.max.y-t.min.y)}}}_setBaseData(e,t){this._items.length=0,this._barSpacing=t;for(const t of e){const e=void 0===t.width?(0,r.ensureDefined)(this._width):t.width,i=void 0===t.height?(0,r.ensureDefined)(this._height):t.height,s=void 0===t.vertOffset?this._vertOffset:t.vertOffset,n=s>0?i:-i;this._items.push({width:e,height:i,vertOffset:s,textVertOffset:n,shapeWidth:0,shapeHeight:0,stepX:0,stepY:0,...t})}}_drawItemText(e,t,i){const r=this._getTextCache(i);if(null===r)return;const s=i.x,n=i.vertOffset,o=i.y+n+i.textVertOffset;let l;l=i.style&&void 0!==i.style.textColor?i.style.textColor:this._textColor;const c={style:{fillStyle:l},location:{x:s,y:o,horzAlign:a.HorizontalAlign.Center,vertAlign:n>0?a.VerticalAlign.Top:a.VerticalAlign.Bottom}};r.paintTo(e,t,c)}_drawWithOptimizations(e,t){let i,r,s=null,n=!1;for(const o of this._items)o.style&&void 0!==o.style.color?(i=o.style.color||"rgba(0, 0, 0, 0)",r=o.style.borderColor||"rgba(0, 0, 0, 0)"):(i=this._color,r=this._borderColor),(s!==i||d.isSafari)&&(s=i,n&&this._endPath(e),this._startPath(e,t,i,r)),this._drawItemShape(e,t,o),n=!0;n&&this._endPath(e);for(const i of this._items)this._drawItemText(e,t,i)}_drawWithoutOptimizations(e,t){let i,s;for(const n of this._items){const o=(0,r.ensureDefined)(n.style);i=o.color||"rgba(0, 0, 0, 0)",s=o.borderColor||"rgba(0, 0, 0, 0)",this._startPath(e,t,i,s),this._drawItemShape(e,t,n),this._endPath(e),this._drawItemText(e,t,n)}}_drawItemShape(e,t,i){(0,h.drawScaled)(e,t.pixelRatio,t.pixelRatio,(()=>this._drawItemShapeUsingCSSPixels(e,i)))}_drawItemShapeUsingCSSPixels(e,t){}_preDrawInit(){}_startPath(e,t,i,r){}_endPath(e){}_getTextCache(e){var t,i;const r=e.text||this._text,s=e.fontSize||this._fontSize,n=null!==(t=e.lineSpacing)&&void 0!==t?t:this._lineSpacing,o=e.textAlign||this._textAlign,l=null!==(i=e.font)&&void 0!==i?i:c.CHART_FONT_FAMILY;return this._textCache.get({text:r,bold:!1,italic:!1,font:l,fontSize:s,lineSpacing:n,align:o})}}class p extends u{_startPath(e,t,i,r){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.strokeStyle=i}_endPath(e){e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(2*e.pixelRatio))}}class _ extends u{_startPath(e,t,i,r){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.fillStyle=i,e.strokeStyle=r}_endPath(e){e.fill(),e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(e.pixelRatio))}}},111595:(e,t,i)=>{i.d(t,{PaneRendererArrowDown:()=>a,PaneRendererArrowUp:()=>l});var r=i(821885),s=i(86441),n=i(678515);class o extends r.PaneRendererAbstractFillStrokeShape{constructor(){super(...arguments),this._sign=0,this._thinArrow=!1,this._thinArrowLineWidth=0,this._headHeight=0,this._arrowWidth=0}setItems(e,t){this._setBaseData(e,t)}
_drawItemShape(e,t,i){const r=t.pixelRatio,s=this._lineWidth(t)%2?.5:0,o=this._sign,l=this._arrowWidth,a=this._headHeight,c=Math.abs(i.height),h=Math.round(i.x*r)+s,d=i.vertOffset,u=Math.round((i.y+d+o*c/2)*r)+s,p=(0,n.ceiledEven)(l*r),_=p/2,g=Math.round(c*r),f=Math.round(a*r);e.translate(h,u),this._thinArrow?(e.moveTo(0,0),e.lineTo(-_,-_*o),e.moveTo(0,0),e.lineTo(_,-_*o),e.moveTo(0,0),e.lineTo(0,-g*o),e.moveTo(-_,-g*o),e.lineTo(_,-g*o)):(e.moveTo(0,0),g<f?(e.lineTo(p,-g*o),e.lineTo(-p,-g*o)):(e.lineTo(p,-f*o),e.lineTo(_,-f*o),e.lineTo(_,-g*o),e.lineTo(-_,-g*o),e.lineTo(-_,-f*o),e.lineTo(-p,-f*o)),e.lineTo(0,0)),e.translate(-h,-u)}_preDrawInit(){const e=this._calculateWidth();this._arrowWidth=e,this._sign=this._isUp()?-1:1,this._thinArrow=e<4,this._thinArrowLineWidth=Math.max(e/2,1),this._headHeight=Math.round(e)}_startPath(e,t,i,r){e.beginPath(),e.fillStyle=i,e.strokeStyle=r,e.lineWidth=this._lineWidth(t)}_lineWidth(e){return this._thinArrow?this._thinArrowLineWidth:super._lineWidth(e)}_calcBoundingBox(e){const t=e.vertOffset,i=this._sign,r=this._arrowWidth,n=this._headHeight,o=Math.abs(e.height),l=e.x-r,a=l+2*r,c=e.y+t+i*Math.round(o/2),h=c+(-o-n)*i,d=new s.Point(l,c),u=new s.Point(a,h);let p=(0,s.box)(d,u);const _=super._calcBoundingBox(e);return _&&(p=this._unionBox(p,_)),p}_calculateWidth(){return Math.round(this._barSpacing/4)}}class l extends o{_isUp(){return!0}}class a extends o{_isUp(){return!1}}},594931:(e,t,i)=>{i.d(t,{PaneRendererCircleShape:()=>o});var r=i(86441),s=i(821885);const n=2*Math.PI;class o extends s.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=Math.max(t.width,t.height)/2,r=t.x,s=t.vertOffset,o=t.y+s;e.moveTo(r+i,o),e.arc(r,o,i,0,n,!1)}_calcBoundingBox(e){const t=Math.max(e.width,e.height)/2,i=e.x,s=e.vertOffset,n=e.y+s,o=i-t,l=i+t,a=n-t,c=n+t,h=new r.Point(o,a),d=new r.Point(l,c);let u=(0,r.box)(h,d);const p=super._calcBoundingBox(e);return p&&(u=this._unionBox(u,p)),u}}},506366:(e,t,i)=>{i.d(t,{PaneRendererCrossShape:()=>n});var r=i(821885),s=i(86441);class n extends r.PaneRendererAbstractStrokeShape{_drawItemShape(e,t,i){const r=i.width,s=i.height,n=i.x-r/2,o=i.vertOffset,l=i.y-s/2+o,a=t.pixelRatio,c=this._lineWidth(t),h=c%2?.5:0,d=Math.round(n*a);let u=Math.round((n+r)*a);(u-d)%2!=c%2&&(u+=1);const p=Math.floor((d+u)/2)+h,_=Math.round(l*a);let g=Math.round((l+s)*a);(g-_)%2!=c%2&&(g+=1);const f=Math.floor((_+g)/2)+h;e.moveTo(p,_),e.lineTo(p,g),e.moveTo(d,f),e.lineTo(u,f)}_calcBoundingBox(e){const t=e.width,i=e.height,r=e.x-t/2,n=e.vertOffset,o=e.y-i/2+n,l=r,a=r+t,c=o,h=o+i,d=new s.Point(l,c),u=new s.Point(a,h);let p=(0,s.box)(d,u);const _=super._calcBoundingBox(e);return _&&(p=this._unionBox(p,_)),p}}},992885:(e,t,i)=>{i.d(t,{PaneRendererDiamond:()=>n});var r=i(86441),s=i(821885);class n extends s.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=Math.round(t.height/2),r=t.x,s=t.vertOffset,n=t.y+s;e.moveTo(r,n-i),e.lineTo(r+i,n),e.lineTo(r,n+i),e.lineTo(r-i,n),e.lineTo(r,n-i)}_calcBoundingBox(e){
const t=Math.round(e.height/2),i=e.x,s=e.vertOffset,n=e.y+s,o=i-t,l=i+t,a=n-t,c=n+t,h=new r.Point(o,a),d=new r.Point(l,c);let u=(0,r.box)(h,d);const p=super._calcBoundingBox(e);return p&&(u=this._unionBox(u,p)),u}}},618241:(e,t,i)=>{i.d(t,{PaneRendererFlagShape:()=>n});var r=i(86441),s=i(821885);class n extends s.PaneRendererAbstractFillStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,r=t.height,s=r/2,n=(i-3)/3,o=t.x-i/2,l=t.vertOffset,a=t.y-s+l;e.moveTo(o,a),e.lineTo(o+3,a),e.bezierCurveTo(o+n,a-n,o+2*n,a+n,o+i,a),e.lineTo(o+i,a+s),e.bezierCurveTo(o+i-n,a+s+n,o+i-2*n,a+s-n,o+3,a+s),e.lineTo(o+3,a+r),e.lineTo(o,a+r),e.lineTo(o,a)}_calcBoundingBox(e){const t=e.width,i=e.height,s=i/2,n=e.x-t/2,o=e.vertOffset,l=e.y-s+o,a=n,c=n+t,h=l,d=l+i,u=new r.Point(a,h),p=new r.Point(c,d);let _=(0,r.box)(u,p);const g=super._calcBoundingBox(e);return g&&(_=this._unionBox(_,g)),_}}},379730:(e,t,i)=>{i.d(t,{CornerVectorsClockwise:()=>r,PaneRendererLabelBase:()=>l});var r,s=i(650151),n=i(821885),o=i(600642);class l extends n.PaneRendererAbstractFillStrokeShape{setItems(e,t){this._setBaseData(e,t);for(const e of this._items){if(e.fontSize){const t=e.fontSize;e.stepX=Math.round(t/1.5),e.stepY=Math.round(t/2)-1}else{const t=e.height;e.stepX=Math.round(t/2*.65)+.5,e.stepY=e.stepX}e.vertOffset=this._calcVertOffset(e);const t=this._getTextCache(e);if(null===t){e.shapeWidth=2*e.stepX,e.shapeHeight=2.5*e.stepY;continue}const i=t.textImageWidth,r=t.textImageHeight;e.shapeWidth=i+2*e.stepX,e.shapeHeight=r+2*e.stepY,e.vertOffset=this._calcVertOffset(e),e.textHorizOffset=this._getHorizontalTextOffset(e),e.textVertOffset=this._getVerticalTextOffset(e)}}_calcVertOffset(e){return e.vertOffset}_drawCorner(e,t,i,r,s){const n=Math.max(1,Math.floor(2*s));e.lineTo(t-n*r.prevPointSignX,i-n*r.prevPointSignY),e.arcTo(t,i,t+n*r.nextPointSignX,i+n*r.nextPointSignY,n)}_getArrowSize(e){return e.stepX}_getHorizontalTextOffset(e){return 0}_getVerticalTextOffset(e){return 0}_hasText(e){return Boolean(e.text)||Boolean(this._text)}_drawItemText(e,t,i){var r;const n=this._getTextCache(i);if(null===n)return;const l=i.textHorizOffset||0,a=i.x+l,c=i.vertOffset,h=i.y+c+i.textVertOffset,d=(null===(r=i.style)||void 0===r?void 0:r.textColor)||this._textColor,u={style:{fillStyle:(0,s.ensureDefined)(d)},location:{x:a,y:Math.floor(h),horzAlign:o.HorizontalAlign.Center,vertAlign:o.VerticalAlign.Middle}};n.paintTo(e,t,u)}}class a{constructor(e,t,i,r){this.prevPointSignX=e,this.prevPointSignY=t,this.nextPointSignX=i,this.nextPointSignY=r}}!function(e){e.rightUp=new a(1,0,0,1),e.rightDown=new a(0,1,-1,0),e.leftDown=new a(-1,0,0,-1),e.leftUp=new a(0,-1,1,0)}(r||(r={}))},778190:(e,t,i)=>{i.d(t,{PaneRendererLabelCenter:()=>c,PaneRendererLabelDown:()=>o,PaneRendererLabelLeft:()=>l,PaneRendererLabelRight:()=>a,PaneRendererLabelUp:()=>n});var r=i(86441),s=i(379730);class n extends s.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,s=e.y+e.vertOffset,n=e.y+e.shapeHeight+e.vertOffset,o=new r.Point(t,s),l=new r.Point(i,n);return(0,
r.box)(o,l)}_drawItemShape(e,t,i){const r=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,o=Math.max(1,Math.floor(r))%2?.5:0,l=this._getArrowSize(i);let a=Math.round(l*r);(o+a)%1!=n%1&&(a+=.5);let c=Math.round(i.shapeWidth/2*r);(o+c)%1!=n%1&&(c+=.5);const h=Math.round(i.x*r)+o,d=Math.round((i.y+i.vertOffset)*r)+n,u=h-a,p=Math.round((i.y+i.vertOffset+l)*r)+n,_=h+a,g=h+c,f=Math.round((i.y+i.vertOffset+l+i.shapeHeight)*r)+n,P=h-c;e.moveTo(u,p),e.lineTo(h,d),e.lineTo(_,p),i.shapeWidth<=2*l?(e.lineTo(g,p),this._drawCorner(e,g,f,s.CornerVectorsClockwise.rightDown,r),this._drawCorner(e,P,f,s.CornerVectorsClockwise.leftDown,r),e.lineTo(P,p)):(this._drawCorner(e,g,p,s.CornerVectorsClockwise.rightUp,r),this._drawCorner(e,g,f,s.CornerVectorsClockwise.rightDown,r),this._drawCorner(e,P,f,s.CornerVectorsClockwise.leftDown,r),this._drawCorner(e,P,p,s.CornerVectorsClockwise.leftUp,r)),e.lineTo(u,p)}_getVerticalTextOffset(e){return e.shapeHeight/2+this._getArrowSize(e)}_calcVertOffset(e){return Math.sign(e.vertOffset)>=0?e.vertOffset:e.vertOffset-e.shapeHeight}}class o extends s.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,s=e.y-e.shapeHeight+e.vertOffset,n=e.y+e.vertOffset,o=new r.Point(t,s),l=new r.Point(i,n);return(0,r.box)(o,l)}_drawItemShape(e,t,i){const r=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,o=Math.max(1,Math.floor(r))%2?.5:0,l=this._getArrowSize(i);let a=Math.round(l*r);(o+a)%1!=n%1&&(a+=.5);let c=Math.round(i.shapeWidth/2*r);(o+c)%1!=n%1&&(c+=.5);const h=Math.round(i.x*r)+o,d=Math.round((i.y+i.vertOffset)*r)+n,u=h+a,p=Math.round((i.y+i.vertOffset-l)*r)+n,_=h-a,g=h+c,f=Math.round((i.y+i.vertOffset-i.shapeHeight-l)*r)+n,P=h-c;e.moveTo(u,p),e.lineTo(h,d),e.lineTo(_,p),i.shapeWidth<=2*l?(e.lineTo(P,p),this._drawCorner(e,P,f,s.CornerVectorsClockwise.leftUp,r),this._drawCorner(e,g,f,s.CornerVectorsClockwise.rightUp,r),e.lineTo(g,p)):(this._drawCorner(e,P,p,s.CornerVectorsClockwise.leftDown,r),this._drawCorner(e,P,f,s.CornerVectorsClockwise.leftUp,r),this._drawCorner(e,g,f,s.CornerVectorsClockwise.rightUp,r),this._drawCorner(e,g,p,s.CornerVectorsClockwise.rightDown,r)),e.lineTo(u,p)}_getVerticalTextOffset(e){return-e.shapeHeight/2-this._getArrowSize(e)}_calcVertOffset(e){return Math.sign(e.vertOffset)<=0?e.vertOffset:e.vertOffset+e.shapeHeight}}class l extends s.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x,i=e.x+e.shapeWidth,s=e.y-e.shapeHeight/2+e.vertOffset,n=e.y+e.shapeHeight/2+e.vertOffset,o=new r.Point(t,s),l=new r.Point(i,n);return(0,r.box)(o,l)}_drawItemShape(e,t,i){const r=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,o=this._getArrowSize(i),l=this._hasText(i),a=l?i.shapeHeight/2:o,c=Math.round(i.x*r)+n,h=Math.round((i.y+i.vertOffset)*r)+n,d=Math.round((i.x+o)*r)+n,u=Math.round((i.y+i.vertOffset+o)*r)+n,p=Math.round((i.y+i.vertOffset-o)*r)+n,_=Math.round((i.y+i.vertOffset-a)*r)+n,g=Math.round((i.x+i.shapeWidth+o)*r)+n,f=Math.round((i.y+i.vertOffset+a)*r)+n;e.moveTo(d,u),e.lineTo(c,h),e.lineTo(d,p),l?this._drawCorner(e,d,_,s.CornerVectorsClockwise.leftUp,r):e.lineTo(d,_),
this._drawCorner(e,g,_,s.CornerVectorsClockwise.rightUp,r),this._drawCorner(e,g,f,s.CornerVectorsClockwise.rightDown,r),l?this._drawCorner(e,d,f,s.CornerVectorsClockwise.leftDown,r):e.lineTo(d,f),e.lineTo(d,u)}_getHorizontalTextOffset(e){return e.shapeWidth/2+this._getArrowSize(e)}}class a extends s.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth,i=e.x,s=e.y-e.shapeHeight/2+e.vertOffset,n=e.y+e.shapeHeight/2+e.vertOffset,o=new r.Point(t,s),l=new r.Point(i,n);return(0,r.box)(o,l)}_drawItemShape(e,t,i){const r=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,o=this._getArrowSize(i),l=this._hasText(i),a=l?i.shapeHeight/2:o,c=Math.round(i.x*r)+n,h=Math.round((i.y+i.vertOffset)*r)+n,d=Math.round((i.x-o)*r)+n,u=Math.round((i.y+i.vertOffset-o)*r)+n,p=Math.round((i.y+i.vertOffset+o)*r)+n,_=Math.round((i.y+i.vertOffset-a)*r)+n,g=Math.round((i.x-i.shapeWidth-o)*r)+n,f=Math.round((i.y+i.vertOffset+a)*r)+n;e.moveTo(d,u),e.lineTo(c,h),e.lineTo(d,p),l?this._drawCorner(e,d,f,s.CornerVectorsClockwise.rightDown,r):e.lineTo(d,f),this._drawCorner(e,g,f,s.CornerVectorsClockwise.leftDown,r),this._drawCorner(e,g,_,s.CornerVectorsClockwise.leftUp,r),l?this._drawCorner(e,d,_,s.CornerVectorsClockwise.rightUp,r):e.lineTo(d,_),e.lineTo(d,u)}_getHorizontalTextOffset(e){return-e.shapeWidth/2-this._getArrowSize(e)}}class c extends s.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,s=e.y-e.shapeHeight/2+e.vertOffset,n=e.y+e.shapeHeight/2+e.vertOffset,o=new r.Point(t,s),l=new r.Point(i,n);return(0,r.box)(o,l)}_drawItemShape(e,t,i){const r=t.pixelRatio,n=this._lineWidth(t)%2?.5:0,o=i.shapeHeight/2,l=i.shapeWidth/2,a=Math.round(i.x*r)+n,c=Math.round((i.x-l)*r)+n,h=Math.round((i.x+l)*r)+n,d=Math.round((i.y+i.vertOffset-o)*r)+n,u=Math.round((i.y+i.vertOffset+o)*r)+n;e.moveTo(a,d),this._drawCorner(e,h,d,s.CornerVectorsClockwise.rightUp,r),this._drawCorner(e,h,u,s.CornerVectorsClockwise.rightDown,r),this._drawCorner(e,c,u,s.CornerVectorsClockwise.leftDown,r),this._drawCorner(e,c,d,s.CornerVectorsClockwise.leftUp,r),e.lineTo(a,d)}}},502322:(e,t,i)=>{i.d(t,{StudyPlotShapesPaneView:()=>c});var r=i(461794),s=i(246733),n=i(142119),o=i(230058),l=i(466144),a=i(112311);class c extends a.StudyPlotShapesPaneViewBase{_updateRenderer(e){const t=e.childs();this._updateImpl();const i=this._model.timeScale(),a={},c=this._getTranspValue(),h=i.barSpacing();let d;d=this._plotStyleInfo.size?this._calculateShapeHeight(25,this._plotStyleInfo.size):Math.round(h/2),d=Math.max(d,1);const u=t.location.value(),p=(0,s.generateColor)(t.color.value(),c),_=c>19?c-10:0,g=this._calculateVerticalOffset(u,Math.round(1.5*d));a.barSpacing=h,a.items=this.items(),a.color=p,a.borderColor=(0,s.generateColor)(t.color.value(),_),a.height=d,a.vertOffset=g;const f=t.plottype.value(),P=l.plotShapesData[f],v=new n.CompositeRenderer,m=this._plotStyleInfo.text;if(void 0!==m&&""!==m.trim()){let e=m.trim().replace(/\\n/gm,"\n");e=(0,r.cleanButAmpersand)(e,!0),a.text=e,a.fontSize=12;const i=t.textColor?t.textColor.value():void 0;a.textColor=i?(0,
s.generateColor)(i,c):p}v.append(super._createRenderer(P.paneRendererClass,a)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=g,v.append(new o.SelectionRenderer(this._selectionData))),this._renderer=v}}},29164:(e,t,i)=>{i.d(t,{PaneRendererSquare:()=>n});var r=i(821885),s=i(86441);class n extends r.PaneRendererAbstractFillStrokeShape{_drawItemShape(e,t,i){const r=t.pixelRatio,s=Math.max(1,Math.floor(r))%2?.5:0,n=this._lineWidth(t)%2?.5:0;let o=Math.round(i.height/2*r);(s+o)%1!=n%1&&(o+=.5);const l=Math.round(i.x*r)+s,a=Math.round((i.y+i.vertOffset)*r)+s,c=l-o,h=a-o,d=l+o,u=a+o;e.rect(c,h,d-c,u-h)}_calcBoundingBox(e){const t=e.height,i=Math.round(t/2),r=e.x-i,n=e.vertOffset,o=e.y+n-i,l=r,a=r+t,c=o,h=o+t,d=new s.Point(l,c),u=new s.Point(a,h);let p=(0,s.box)(d,u);const _=super._calcBoundingBox(e);return _&&(p=this._unionBox(p,_)),p}}},119914:(e,t,i)=>{i.d(t,{PaneRendererTriangleApexDown:()=>l,PaneRendererTriangleApexUp:()=>o});var r=i(821885),s=i(86441);class n extends r.PaneRendererAbstractFillStrokeShape{_calcBoundingBox(e){const t=e.width,i=e.height,r=t/2,n=Math.round(i/3),o=e.x,l=e.vertOffset-2*n,a=e.y+l,c=o-r,h=o+r,d=a,u=a+i,p=new s.Point(c,d),_=new s.Point(h,u);let g=(0,s.box)(p,_);const f=super._calcBoundingBox(e);return f&&(g=this._unionBox(g,f)),g}}class o extends n{_drawItemShape(e,t,i){const r=i.width,s=i.height,n=Math.round(s/3),o=i.vertOffset-2*n,l=t.pixelRatio,a=this._lineWidth(t)%2?.5:0,c=Math.max(1,Math.floor(l)),h=c%2?.5:0;let d=Math.round(r*l);d%2!=c%2&&(d+=1);const u=Math.round(i.x*l)+h,p=Math.round((i.y+o)*l),_=u+d/2,g=Math.round((i.y+o+s)*l)+a,f=u-d/2;e.moveTo(u,p),e.lineTo(_,g),e.lineTo(f,g),e.lineTo(u,p)}}class l extends n{_drawItemShape(e,t,i){const r=i.width,s=i.height,n=Math.round(s/3),o=i.vertOffset-n,l=t.pixelRatio,a=this._lineWidth(t)%2?.5:0,c=Math.max(1,Math.floor(l)),h=c%2?.5:0;let d=Math.round(r*l);d%2!=c%2&&(d+=1);const u=Math.round(i.x*l)+h,p=Math.round((i.y+o)*l)+a,_=u+d/2,g=Math.round((i.y+o+s)*l),f=u-d/2;e.moveTo(f,p),e.lineTo(_,p),e.lineTo(u,g),e.lineTo(f,p)}}},815555:(e,t,i)=>{i.d(t,{PaneRendererXCross:()=>n});var r=i(86441),s=i(821885);class n extends s.PaneRendererAbstractStrokeShape{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,r=t.height,s=t.x-i/2,n=t.vertOffset,o=t.y-r/2+n;e.moveTo(s,o),e.lineTo(s+i,o+r),e.moveTo(s,o+r),e.lineTo(s+i,o)}_calcBoundingBox(e){const t=e.width,i=e.height,s=e.x-t/2,n=e.vertOffset,o=e.y-i/2+n,l=s,a=s+t,c=o,h=o+i,d=new r.Point(l,c),u=new r.Point(a,h);let p=(0,r.box)(d,u);const _=super._calcBoundingBox(e);return _&&(p=this._unionBox(p,_)),p}}},441212:(e,t,i)=>{i.d(t,{createStudyPlotColorProvider:()=>p});var r=i(368135),s=i(650151),n=i(574809);const o=new Map([[0,"color"],[2,"textColor"],[3,"borderColor"],[4,"wickColor"],[5,"colorup"],[6,"colordown"]]);class l{constructor(e){this._plotStyle=e}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return o.forEach(((e,t)=>{this._plotStyle[e]&&(i.colors[t]=this._plotStyle[e].value())})),
i.lineWidth=this._plotStyle.linewidth?this._plotStyle.linewidth.value():void 0,i.lineStyle=this._plotStyle.linestyle?this._plotStyle.linestyle.value():void 0,i}isColorDefined(){return!0}singleColor(){return!0}getDefaultPlotPointStyle(){return null}}const a=[0,1,2,3,4,5,6];class c{constructor(e,t,i,r){this._palettesColors=new Map,this._defaultPlotColors=new Map,this._indexes=r;const n=t.styles[i];if(n)for(const[e,t]of o)this._defaultPlotColors.set(e,n[t]);const l=(0,s.ensureDefined)(e.palettes),a=e.plots;r.forEach(((e,i)=>{const r=a[e];if(r&&"palette"in r){const e=l[r.palette],s=t.palettes[r.palette];if(e&&s){const{valToIndex:t}=e,{colors:r}=s,n={...r};t&&Object.keys(t).forEach((e=>{const i=t[e];void 0!==i&&(n[e]=r[i])})),this._palettesColors.set(i,n)}}}))}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return a.forEach((t=>{var r,n;if(this._palettesColors.has(t)){const n=e[(0,s.ensureDefined)(this._indexes.get(t))+1];if("number"==typeof n){const e=null===(r=this._palettesColors.get(t))||void 0===r?void 0:r[n];0===t&&e&&(i.lineWidth=e.width.value(),i.lineStyle=e.style.value()),i.colors[t]=null==e?void 0:e.color.value()}else i.colors[t]="transparent"}else i.colors[t]=null===(n=this._defaultPlotColors.get(t))||void 0===n?void 0:n.value()})),i}getDefaultPlotPointStyle(){var e;const t=null===(e=this._palettesColors.get(0))||void 0===e?void 0:e[0];if(void 0!==t){return{colors:[t.color.value(),void 0,void 0,void 0,void 0,void 0,void 0],lineStyle:void 0,lineWidth:t.width.value()}}return null}isColorDefined(){return!!this._palettesColors.size}singleColor(){return!1}}var h=i(151149);class d{constructor(e){this._rgbaFromInteger=(0,h.rgbaFromIntegerCached)(),this._indexes=e}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return this._indexes.forEach(((t,r)=>{const s=e[t+1];if(null!=s){const e=this._rgbaFromInteger(s);i.colors[r]=e}else i.colors[r]="transparent"})),i}isColorDefined(){return!0}singleColor(){return!1}getDefaultPlotPointStyle(){return null}}const u=new Map([[0,function(e,t){const i=(0,r.isColorerPlot)(t)||(0,r.isOhlcColorerPlot)(t);return"target"in t&&t.target===e&&i}],[2,function(e,t){const i=(0,r.isTextColorerPlot)(t);return"target"in t&&t.target===e&&i}],[1,function(e,t){return(0,r.isBgColorerPlot)(t)&&t.id===e}],[3,function(e,t){const i=(0,r.isCandleBorderColorerPlot)(t);return"target"in t&&t.target===e&&i}],[4,function(e,t){const i=(0,r.isCandleWickColorerPlot)(t);return"target"in t&&t.target===e&&i}],[5,function(e,t){const i=(0,r.isUpColorerPlot)(t);return"target"in t&&t.target===e&&i}],[6,function(e,t){const i=(0,r.isDownColorerPlot)(t);return"target"in t&&t.target===e&&i}]]);function p(e,t,i){const{colorers:r}=function(e,t){const i=e.plots,r=i.findIndex((e=>e.id===t)),s=new Map;return i.forEach(((e,i)=>{u.forEach(((r,n)=>{r(t,e)&&s.set(n,i)}))})),{plotIndex:-1===r?null:r,colorers:s}}(e,i);if(r.size)return e.isRGB?new d(r):new c(e,t,i,r);{const e=t.ohlcPlots;if(e&&e[i])return new l(e[i]);const r=t.styles[i];return new l(r)}}},112311:(e,t,i)=>{i.d(t,{
StudyPlotShapesPaneViewBase:()=>V});var r=i(650151),s=i(86441),n=i(244842),o=i(678515),l=i(389137),a=i(246733),c=i(315801),h=i(142119),d=i(534741),u=i(63316),p=i(230058),_=i(544421),g=i(466144),f=i(379048),P=i(574809),v=i(111595),m=i(594931),y=i(506366),C=i(992885),x=i(618241),w=i(778190),b=i(29164),S=i(119914),T=i(815555),I=i(368135),L=i(441212);const M=new Map;M.set("PaneRendererArrowUp",v.PaneRendererArrowUp),M.set("PaneRendererArrowDown",v.PaneRendererArrowDown),M.set("PaneRendererCircleShape",m.PaneRendererCircleShape),M.set("PaneRendererCrossShape",y.PaneRendererCrossShape),M.set("PaneRendererDiamond",C.PaneRendererDiamond),M.set("PaneRendererFlagShape",x.PaneRendererFlagShape),M.set("PaneRendererLabelUp",w.PaneRendererLabelUp),M.set("PaneRendererLabelDown",w.PaneRendererLabelDown),M.set("PaneRendererSquare",b.PaneRendererSquare),M.set("PaneRendererTriangleApexUp",S.PaneRendererTriangleApexUp),M.set("PaneRendererTriangleApexDown",S.PaneRendererTriangleApexDown),M.set("PaneRendererXCross",T.PaneRendererXCross);class V{constructor(e,t,i,s){var o;this._items=[],this._invalidated=!1,this._renderer=null,this._isMarkersEnabled=n.enabled("source_selection_markers"),this._selectionData=null,this._plotIndex=null,this._topCoord=0,this._bottomCoord=0,this._study=e,this._series=t,this._model=i,this._plotName=s;const l=e.metaInfo().plots;for(let e=0;e<l.length;e++)if(l[e].id===this._plotName){this._plotIndex=e;break}this._plotStyleInfo=(0,r.ensureDefined)(null===(o=e.metaInfo().styles)||void 0===o?void 0:o[this._plotName]),this._colorProvider=(0,L.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new u.SelectionIndexes(i.timeScale())}items(){return this._items}update(){this._invalidated=!0}renderer(){if(!this._isPlotVisible()||!this._scalesReady())return null;if(this._invalidated){const e=this._study.properties().childs().styles.childs()[this._plotName];this._updateRenderer(e),this._invalidated=!1}return this._renderer}_isPlotVisible(){return this._study.isPlotVisibleAt(this._plotName,1)}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&null!==t&&!e.isEmpty()&&!t.isEmpty()}_updateImpl(){if(this._items=[],!this._scalesReady())return;const e=this._model.timeScale(),t=this._study.priceScale(),i=e.visibleBarsStrictRange();if(null===i||null===t)return;let s=this._series.nearestIndex(i.firstBar(),d.PlotRowSearchMode.NearestRight),n=this._series.nearestIndex(i.lastBar(),d.PlotRowSearchMode.NearestLeft);if(void 0===s||void 0===n)return;const o=this._study.offset(this._plotName);o>0?(s-=o,n+=o):(s+=o,n-=o);const l=this._study.getMinFirstBarIndexForPlot(this._plotName);if(l>n)return;s=Math.max(l,s);const a=this._study.data(),h=this._study.firstValue();if(null===h)return;const u=a.rangeIterator(s,n),p=this._getTranspValue();let _=[];const g=this._model.selection().isSelected(this._study);g?(_=this._selectionIndexer.indexes(),this._selectionData={points:[],hittestResult:c.HitTarget.Regular,vertOffset:0,bgColors:[],barSpacing:e.barSpacing(),visible:!0
}):(this._selectionIndexer.clear(),this._selectionData=null);let f,v,m=null;switch(this._series.properties().childs().style.value()){case 2:m="lineStyle";break;case 14:m="lineWithMarkersStyle";break;case 15:m="steplineStyle";break;case 3:m="areaStyle"}m?(f=this._series.properties().childs()[m].childs().priceSource.value(),v=f):(f="high",v="low");const y=t.isInverted(),C=t.coordinateToPrice(t.height()*t.topMargin(),h),x=t.coordinateToPrice(t.height()*(1-t.bottomMargin()),h);this._topCoord=y?x:C,this._bottomCoord=y?C:x;const w=(0,r.ensureNotNull)(this._model.paneForSource(this._study)).height(),b=this._study.properties().childs().styles.childs()[this._plotName].childs(),S=b.color.value(),T=b.textColor?b.textColor.value():void 0,I=S,L=S,M=void 0===T?void 0:T,V=(0,r.ensureNotNull)(this._plotIndex),D=(0,P.createEmptyStyle)();for(const e of u){const t=e.index,i=e.value,r=Math.floor(t+o),s=i[V+1];if(null==s)continue;const n=this._createItem(r,s,f,v);if(null!==n){if(this._colorProvider.isColorDefined()){n.style={color:I,borderColor:L,textColor:M};const e=this._colorProvider.getPlotPointStyle(i,D);this._fillItemWithPointStyle(n,e,p)}g&&-1!==_.indexOf(t)&&null!==this._selectionData&&(this._selectionData.points.push(n),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(n.y/w))),this._items.push(n)}}this._convertItemsToCoordinates()}_fillItemWithPointStyle(e,t,i){const s=(0,r.ensureDefined)(e.style);if(void 0!==t.colors[0]){s.color=(0,a.generateColor)((0,r.ensureDefined)(t.colors[0]),i);const e=i>9?i-10:0;s.borderColor=(0,a.generateColor)(s.color,e)}void 0!==t.colors[2]&&(s.textColor=(0,a.generateColor)((0,r.ensureDefined)(t.colors[2]),i))}_updateRenderer(e){this._updateImpl();const t=this._model.timeScale(),i={},r=this._getTranspValue(),s=t.barSpacing(),n=this._calculateShapeHeight(s),o=this._study.properties().childs().styles.childs()[this._plotName].childs(),l=o.location.value(),c=this._calculateVerticalOffset(l,n+n/2);i.barSpacing=s,i.items=this._items,i.color=(0,a.generateColor)(o.color.value(),r),i.height=n,i.vertOffset=c;const d=o.plottype.value(),u=g.plotShapesData[d],_=new h.CompositeRenderer;u&&_.append(this._createRenderer(u.paneRendererClass,i)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=c,_.append(new p.SelectionRenderer(this._selectionData))),this._renderer=_}_createRenderer(e,t){const i=M.get(e);return new((0,r.ensureDefined)(i))(t)}_getSeriesVal(e,t){const i=(0,_.barFunction)(e),r=this._series.data().valueAt(t);return null===r?null:i(r)}_getTranspValue(){let e=0;const t=this._study.properties().childs();t.transparency&&(e=t.transparency.value(),e=(0,l.isNumber)(e)?e:50);const i=t.styles.childs()[this._plotName].childs();return i.transparency&&(e=i.transparency.value(),e=(0,l.isNumber)(e)?e:50),(0,o.clamp)(e,0,100)}_createItem(e,t,i,n){const o=this._study.properties().childs().styles.childs()[this._plotName].childs().location.value();if((null===t||0===t)&&o!==f.MarkLocation.Absolute)return null
;let l;switch(o){case f.MarkLocation.AboveBar:const s=this._getSeriesVal(i,e);if(null===s)return null;l=s;break;case f.MarkLocation.BelowBar:const a=this._getSeriesVal(n,e);if(null===a)return null;l=a;break;case f.MarkLocation.Top:l=this._topCoord;break;case f.MarkLocation.Bottom:l=this._bottomCoord;break;case f.MarkLocation.Absolute:l=(0,r.ensureNotNull)(t);break;default:throw new Error("Bad value: "+o)}return new s.Point(e,l)}_convertItemsToCoordinates(){const e=this._model.timeScale(),t=this._study.priceScale();e.timedValuesToCoordinates(this._items);const i=(0,r.ensureNotNull)(this._study.firstValue());(0,r.ensureNotNull)(t).pointsArrayToCoordinates(this._items,i)}_calculateVerticalOffset(e,t){let i=0;switch(e){case f.MarkLocation.AboveBar:case f.MarkLocation.Bottom:i=-t;break;case f.MarkLocation.BelowBar:case f.MarkLocation.Top:i=t}return(0,r.ensureNotNull)(this._study.priceScale()).isInverted()&&(i*=-1),i}_calculateShapeHeight(e,t){let i=e;switch(t){case I.PlotSymbolSize.Tiny:i=.3*e;break;case I.PlotSymbolSize.Small:i=.6*e;break;case I.PlotSymbolSize.Normal:i=e;break;case I.PlotSymbolSize.Large:i=1.5*e;break;case I.PlotSymbolSize.Huge:i=2*e}return i}}},260414:(e,t,i)=>{i.d(t,{StudyBaseWindowView:()=>n});var r=i(782086),s=i(982217);class n extends r.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._study=e,this._model=t,this._valueProvider=this._createValuesProvider(e,t),this._items=this._valueProvider.getItems().map((e=>new r.DataWindowItem(e.id,e.title,""))),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}study(){return this._study}_updateImpl(){this._header=this._study.title(s.TitleDisplayTarget.DataWindow,!0),this._title=this._study.title(s.TitleDisplayTarget.DataWindow);const e=this._valueProvider.getValues(this._currentIndex());for(let t=0;t<e.length;++t){const i=e[t],r=this._items[t];r.setValue(i.value),r.setVisible(i.visible),r.setColor(i.color),r.setTitle(i.title)}}_currentIndex(){const e=this._model.crossHairSource().appliedIndex();return isNaN(e)?null:e}}},544820:(e,t,i)=>{i.d(t,{StudyDataWindowView:()=>l});var r=i(260414),s=i(103055),n=i(567467);class o{constructor(e,t){this._study=e,this._model=t,this._hhistBasedStudy=void 0!==e.metaInfo().graphics.hhists,this._valuesProvider=this._createValuesProvider(e,t)}getItems(){return this._valuesProvider.getItems()}getValues(e){const t=this._valuesProvider.getValues(e),i=e=>!!this._hhistBasedStudy||this._study.isPlotVisibleAt(e,2);for(const e of t)e.visible=e.visible&&i(e.id);return t}_createValuesProvider(e,t){return this._hhistBasedStudy?new n.HHistBasedValuesProvider(e,t):new s.StudyValuesProvider(e,t)}}class l extends r.StudyBaseWindowView{_createValuesProvider(e,t){return new o(e,t)}}},634005:(e,t,i)=>{i.d(t,{StudyLegendValuesProvider:()=>n});var r=i(103055),s=i(567467);class n{constructor(e,t){this._study=e,this._model=t,this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,
this._hhistBasedStudy=void 0!==e.metaInfo().graphics.hhists,this._valuesProvider=this._createValuesProvider(e,t)}getItems(){return this._valuesProvider.getItems()}getValues(e){const t=this._valuesProvider.getValues(e),i=this._study.properties(),r=this._showStudyValues.value()&&i.childs().showLegendValues.value(),s=e=>!!this._hhistBasedStudy||this._study.isPlotVisibleAt(e,8);for(const e of t)e.visible=e.visible&&r&&s(e.id);return t}_createValuesProvider(e,t){return this._hhistBasedStudy?new s.HHistBasedValuesProvider(e,t):new r.StudyValuesProvider(e,t)}}},464633:(e,t,i)=>{i.d(t,{StudyLegendView:()=>o});var r=i(260414),s=i(634005),n=i(368135);class o extends r.StudyBaseWindowView{constructor(e,t){super(e,t),this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,this._showStudyValues.subscribe(this,this.update);const i=this._study.properties();i.childs().showLegendValues.subscribe(this,this.update);const r=this._study.metaInfo().plots,s=new Set;r.forEach((e=>{var t;if((0,n.isOhlcPlot)(e)){const t=e.target;if(s.has(t))return;s.add(t),i.childs().ohlcPlots.childs()[t].childs().display.subscribe(this,this.update)}else(0,n.isPlotSupportDisplay)(e)&&(null===(t=i.childs().styles.childs()[e.id])||void 0===t||t.childs().display.subscribe(this,this.update))}))}areValuesVisible(){return this._showStudyValues.value()}additional(){return null}destroy(){this._showStudyValues.unsubscribeAll(this);const e=this._study.properties();e.childs().showLegendValues.unsubscribeAll(this);const t=this._study.metaInfo().plots,i=new Set;t.forEach((t=>{var r;if((0,n.isOhlcPlot)(t)){const r=t.target;if(i.has(r))return;i.add(r),e.childs().ohlcPlots.childs()[r].childs().display.unsubscribe(this,this.update)}else(0,n.isPlotSupportDisplay)(t)&&(null===(r=e.childs().styles.childs()[t.id])||void 0===r||r.childs().display.unsubscribe(this,this.update))}))}_createValuesProvider(e,t){return new s.StudyLegendValuesProvider(e,t)}}},470130:(e,t,i)=>{i.d(t,{fundamentalsPrefix:()=>r,isFundamentalStudyMetaInfo:()=>s,studyNameByMetaInfo:()=>n});const r="study_Internal$STD;Fund_";function s(e){return n(e)===r}function n(e){const t="study_"+(e.classId||e.shortId);return t.startsWith(r)?r:t}},509550:(e,t,i)=>{i.d(t,{StudyStatusProvider:()=>a});var r=i(444372),s=i(504101),n=i(971417),o=i(414585);const l=r.t(null,void 0,i(947542));class a extends o.StudyStatusProviderBase{constructor(e,t){super(e,t),this._study=e}color(){return this._study.isFailed()||this._study.metaInfo&&this._study.metaInfo().isTVScriptStub?"#ff0000":super.color()}sourceStatusText(){if(this._study.status().type===s.StudyStatusType.Error){const e=this._study.metaInfo(),t=(0,n.extractPineId)(e.fullId);if(e.scriptIdPart&&(0,n.isEdgrPineId)(e.scriptIdPart)||t&&(0,n.isEdgrPineId)(t))return l}return super.sourceStatusText()}}},555502:(e,t,i)=>{i.d(t,{StudyStatusView:()=>s});var r=i(833642);class s extends r.StatusView{constructor(e){super(e.statusProvider())}color(){return this._statusProvider.color()}getSplitTitle(){
return this._statusProvider.getSplitTitle()}update(){this._text=this._statusProvider.text()}}},480311:(e,t,i)=>{i.d(t,{StudyTrackPricePaneView:()=>n});var r=i(955831),s=i(458963);class n extends r.HorizontalLinePaneView{constructor(e,t){super(),this._lineRendererData.linestyle=s.LINESTYLE_DOTTED,this._study=e,this._plotName=t}_updateImpl(){this._lineRendererData.visible=!1;const e=this._study.properties().childs().styles.childs()[this._plotName].childs();if(!e.trackPrice.value()||!this._study.isPlotVisibleAt(this._plotName,1))return;const t=this._study.lastValueData(this._plotName,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=t.color,this._lineRendererData.linewidth=e.linewidth.value())}}},103055:(e,t,i)=>{i.d(t,{StudyValuesProvider:()=>y});var r=i(150335),s=i(638456),n=i(246733),o=i(244842),l=i(534741),a=i(616117),c=i(885482),h=i(368135),d=i(441212),u=i(470130),p=i(570226),_=i(650151),g=i(60897),f=i(982217);const P=s.CheckMobile.any(),v=o.enabled("hide_last_na_study_output"),m=o.enabled("always_show_legend_values_on_mobile");class y{constructor(e,t){this._emptyValues=[],this._colorProviders=new Map,this._study=e,this._model=t,this._studyMetaInfo=this._study.metaInfo(),this._studyProperties=this._study.properties().childs(),this._isFundamental=(0,u.isFundamentalStudyMetaInfo)(this._studyMetaInfo);const i=this._studyMetaInfo.plots;i&&i.forEach(((e,t)=>{if((0,h.isPlotWithTechnicalValues)(e))return;const i=e.id;this._emptyValues.push(function(e,t="",i=""){return{id:t,index:e,title:i,value:"",visible:!1}}(t,i,this._study.guiPlotName(f.TitleDisplayTarget.StatusLine,i)));const r=(0,h.isOhlcPlot)(e)?e.target:i;this._colorProviders.set(r,(0,d.createStudyPlotColorProvider)(this._studyMetaInfo,this._study.properties(),r))}))}getItems(){return this._emptyValues}getPlotColor(e,t){var i;const s=t[e+1];if(!(0,r.isNumber)(s))return"";const n=s>0;let o;const l=this._studyMetaInfo.plots[e];let a=l.id;const c=this._studyProperties;if((0,h.isOhlcPlot)(l))a=l.target||a,o=(0,_.ensureDefined)(c.ohlcPlots.childs()[a].childs().color).value();else if((0,h.isArrowsPlot)(l)){const e=(0,_.ensureDefined)(c.styles.childs()[a]);o=n?e.childs().colorup.value():e.childs().colordown.value()}else o=(0,_.ensureDefined)(null===(i=c.styles.childs()[a])||void 0===i?void 0:i.child("color")).value();let d=o;const u=this._colorProviders.get(a),p=u&&u.getPlotPointStyle(t);return p&&((0,h.isArrowsPlot)(l)?(n&&void 0!==p.colors[5]&&(d=p.colors[5]),n||void 0===p.colors[6]||(d=p.colors[6])):void 0!==p.colors[0]&&(d=p.colors[0])),"transparent"===d&&(d=o),d}getValues(e){var t,i;const s=this._emptyValues.map((e=>({...e})));let o=null;const a=this._study.data().lastIndex(),c=this._studyProperties;if(null!==a)for(const e of s){if(0===(null===(t=c.styles.childs()[e.id])||void 0===t?void 0:t.childs().display.value()))continue;const i=this._study.nearestIndex(a,l.PlotRowSearchMode.NearestLeft,e.index+1);if(void 0===i)continue;const r=i+this._study.offset(e.id);o=null!==o?Math.max(r,o):r}
(null===e||null!==o&&e>o)&&(e=o);const d=this._hideValues(),u=this._study.isVisible()&&!d?g.notAvailable:"";for(const e of s)e.value=u;if(d)return s;v&&s.length&&(s[s.length-1].value="");const f=this._study.priceScale();if(!this._study.isVisible()||null===e||null===f||f.isEmpty()||this._model.timeScale().isEmpty())return s;const P=(0,p.getPriceValueFormatterForSource)(this._study),m={};for(const t of s){const s=t.id,o=(0,_.ensureDefined)(c.styles.childs()[s]),d=o.childs().display.value();if(t.visible=0!==d,!t.visible)continue;const u=o.hasChild("plottype")?null===(i=o.child("plottype"))||void 0===i?void 0:i.value():null,p=this._isFundamental&&(u===h.LineStudyPlotStyle.StepLine||u===h.LineStudyPlotStyle.StepLineWithDiamonds),g=t.index,f=e-this._study.offset(s),v=p||null!==a&&f>a?l.PlotRowSearchMode.NearestLeft:l.PlotRowSearchMode.Exact,y=this._study.nearestIndex(f,v);if(void 0===y)continue;let C=m[s];if(void 0===C&&(C=this._study.getMinFirstBarIndexForPlot(s),Number.isFinite(C)&&(m[s]=C)),C>y)continue;const x=this._study.data().last(),w=this._study.data().valueAt(y)||(null!==x?x.value:null);if(null===w)continue;const b=w[g+1];(0,r.isNumber)(b)&&(t.value=P(b),t.color=(0,n.resetTransparency)(this.getPlotColor(g,w)))}return s}_hideValues(){return m?(0,a.isLineToolName)(c.tool.value())||null!==this._model.lineBeingEdited():P&&(null===this._model.crossHairSource().pane||(0,a.isLineToolName)(c.tool.value())||null!==this._model.lineBeingEdited())}}},886708:(e,t,i)=>{i.d(t,{buildTreeForStudy:()=>l,buildTurnaround:()=>o});var r=i(650151);function s(e,t){return e.studyId.localeCompare(t.studyId)}function n(e){const t=new Set,i=[];return e.forEach((e=>{t.has(e.studyId)||(t.add(e.studyId),i.push(e))})),i}function o(e,t){let i=t.turnaround,r=[t];for(;r.length>0;){let e=[];const t=[];r.forEach((i=>{const r=n(i.sourceStudies).sort(s);if(r.length>0){e=e.concat(r);const i=r.map((e=>e.turnaround)).join("_");t.push(i)}})),t.length&&(i=t.join("_")+"_"+i),r=e}return e+"_"+i}function l(e){const t=e.model().mainSeries();return{studyId:(0,r.ensureNotNull)(e.sourceId()),turnaround:e.turnaround(),sourceStudies:e.parentSources().filter((e=>e!==t)).map((e=>l(e)))}}},466144:(e,t,i)=>{i.d(t,{plotShapesData:()=>s});var r=i(444372);const s={shape_arrow_down:{guiName:r.t(null,void 0,i(348732)),id:"shape_arrow_down",paneRendererClass:"PaneRendererArrowDown",pineName:"shape.arrowdown",icon:"arrow_down"},shape_arrow_up:{guiName:r.t(null,void 0,i(610650)),id:"shape_arrow_up",paneRendererClass:"PaneRendererArrowUp",pineName:"shape.arrowup",icon:"arrow_up"},shape_circle:{guiName:r.t(null,void 0,i(490068)),id:"shape_circle",paneRendererClass:"PaneRendererCircleShape",pineName:"shape.circle",icon:"circle"},shape_cross:{guiName:r.t(null,void 0,i(429908)),id:"shape_cross",paneRendererClass:"PaneRendererCrossShape",pineName:"shape.cross",icon:"cross"},shape_diamond:{guiName:r.t(null,void 0,i(773720)),id:"shape_diamond",paneRendererClass:"PaneRendererDiamond",pineName:"shape.diamond",icon:"diamond"},shape_flag:{guiName:r.t(null,void 0,i(121524)),id:"shape_flag",
paneRendererClass:"PaneRendererFlagShape",pineName:"shape.flag",icon:"flag"},shape_label_down:{guiName:r.t(null,void 0,i(318528)),id:"shape_label_down",paneRendererClass:"PaneRendererLabelDown",pineName:"shape.labeldown",icon:"label_down"},shape_label_up:{guiName:r.t(null,void 0,i(513046)),id:"shape_label_up",paneRendererClass:"PaneRendererLabelUp",pineName:"shape.labelup",icon:"label_up"},shape_square:{guiName:r.t(null,void 0,i(944904)),id:"shape_square",paneRendererClass:"PaneRendererSquare",pineName:"shape.square",icon:"square"},shape_triangle_down:{guiName:r.t(null,void 0,i(483356)),id:"shape_triangle_down",paneRendererClass:"PaneRendererTriangleApexDown",pineName:"shape.triangledown",icon:"triangle_down"},shape_triangle_up:{guiName:r.t(null,void 0,i(928340)),id:"shape_triangle_up",paneRendererClass:"PaneRendererTriangleApexUp",pineName:"shape.triangleup",icon:"triangle_up"},shape_xcross:{guiName:r.t(null,void 0,i(707050)),id:"shape_xcross",paneRendererClass:"PaneRendererXCross",pineName:"shape.xcross",icon:"x_cross"}}},294162:(e,t,i)=>{i.d(t,{TextWidthCache:()=>r});class r{constructor(e=150){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._tick2Labels=new Map,this._cache=new Map,this._maxSize=e}reset(){this._actualSize=0,this._cache.clear(),this._usageTick=1,this._oldestTick=1,this._tick2Labels.clear()}measureText(e,t){return this.getMetrics(e,t).width}yMidCorrection(e,t){const i=this.getMetrics(e,t);return"actualBoundingBoxAscent"in i&&"actualBoundingBoxDescent"in i?(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)/2:0}getMetrics(e,t){const i=this._cache.get(t);if(void 0!==i)return i.metrics;if(this._actualSize===this._maxSize){const e=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(e),this._oldestTick++,this._actualSize--}e.save(),e.textBaseline="middle";const r=e.measureText(t);return e.restore(),0===r.width&&t.length||(this._cache.set(t,{metrics:r,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,t),this._actualSize++,this._usageTick++),r}}},161164:(e,t,i)=>{i.d(t,{TimeAxisView:()=>o});var r=i(246733),s=i(199471);class n{constructor(){this._data=null}setData(e){this._data=e}draw(e,t,i){if(null===this._data||!this._data.visible||0===this._data.text.length)return;const r=this._data;e.font=t.font;const n=Math.round(t.widthCache.measureText(e,r.text));if(n<=0)return;e.save();const o=t.paddingHorizontal,l=n+2*o,a=l/2;let c=r.coordinate,h=Math.floor(c-a)+.5;if(r.alwaysInViewPort){const e=r.width;h<0?(c+=Math.abs(0-h),h=Math.floor(c-a)+.5):h+l>e&&(c-=Math.abs(e-(h+l)),h=Math.floor(c-a)+.5)}const d=h+l,u=Math.ceil(0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize+t.paddingBottom);e.fillStyle=r.background;const p=Math.round(h*i),_=Math.round(0*i),g=Math.round(d*i),f=Math.round(u*i),P=Math.round(2*i);e.beginPath(),e.moveTo(p,_),e.lineTo(p,f-P),e.arcTo(p,f,p+P,f,P),e.lineTo(g-P,f),e.arcTo(g,f,g,f-P,P),e.lineTo(g,_),e.fill();const v=0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize/2;e.textAlign="left",e.textBaseline="middle",
e.fillStyle=r.color;const m=t.widthCache.yMidCorrection(e,"Apr0");e.translate((h+o)*i,(v+m)*i),(0,s.drawScaled)(e,i,i,(()=>e.fillText(r.text,0,0))),e.restore()}}class o{constructor(e){this._renderer=new n,this._rendererData={background:"",color:"",coordinate:0,text:"",visible:!1,width:0,alwaysInViewPort:!0},this._invalidated=!0,this._model=e,this._renderer.setData(this._rendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}coordinate(){return this._rendererData.coordinate}_getAlwaysInViewPort(){return!0}_getText(e){const t=this._model.timeScale().indexToUserTime(e);return null!==t?this._model.dateTimeFormatter().format(t):""}_updateImpl(){const e=this._rendererData;if(e.visible=!1,this._model.timeScale().isEmpty()||!this._isVisible())return;const t=this._getIndex();null!==t&&(e.visible=!0,e.width=this._model.timeScale().width(),e.background=this._getBgColor(),e.color=(0,r.colorFromBackground)(e.background),e.coordinate=this._model.timeScale().indexToCoordinate(t),e.alwaysInViewPort=this._getAlwaysInViewPort(),e.text=this._getText(t),this._invalidated=!1)}}},87053:(e,t,i)=>{i.d(t,{createVisibilityController:()=>c});var r=i(444372),s=i(778785),n=i(152633),o=i(62802);const l="visibleOnMouseOver";function a(e){return"alwaysOn"===e||"alwaysOff"===e?e:l}function c(e,t){let c,h;function d(){if(!c){c=(0,n.createPrimitiveProperty)();let i=o.getValue(e);void 0===i&&void 0!==t&&(i=o.getValue(t)),c.setValue(a(i)),c.subscribe(c,(t=>{o.setValue(e,a(t.value()))}))}return c}return{property:d,availableValues:function(){return[{id:"visibleOnMouseOver",value:"visibleOnMouseOver",title:r.t(null,void 0,i(689960))},{id:"alwaysOn",value:"alwaysOn",title:r.t(null,void 0,i(471997))},{id:"alwaysOff",value:"alwaysOff",title:r.t(null,void 0,i(109408))}]},actualBehavior:function(){if(!h){h=(0,n.createPrimitiveProperty)();const e=d(),t=()=>{let t=e.value();"alwaysOn"!==t&&"alwaysOff"!==t&&(t=s.mobiletouch?"alwaysOn":"visibleOnMouseOver"),h&&h.setValue(t)};e.subscribe(h,t),t()}return h},restoreDefaultValue:function(){d().setValue(l),o.remove(e)}}}},558793:(e,t,i)=>{i.d(t,{getChartAlertsFacade:()=>n,getChartAlertsFacadeIfCreatedBefore:()=>o});var r=i(949307);let s;async function n(){return void 0===s&&(s=await async function(){const[e,t]=await Promise.all([Promise.all([i.e(58194),i.e(17447),i.e(43077),i.e(25977),i.e(68647),i.e(75692),i.e(41414),i.e(17022),i.e(86922),i.e(37619),i.e(48158)]).then(i.bind(i,408114)),(0,r.getPriceAlertsDispatcher)()]);return new e.ChartAlertsFacadeOld(t)}()),s}function o(){return null!=s?s:null}},764861:(e,t,i)=>{i.d(t,{getStudyDangerReason:()=>o,getStudyDangerReasons:()=>n});var r=i(782856),s=i(298113);function n(e){const t=new Set,i=e.metaInfo();!0===i.historyCalculationMayChange&&t.add(r.DataSourceDangerReason.PineRepainting);const o=i.inputs.filter((e=>"symbol"===e.type)).map((e=>e.id));for(const i of o){const s=e.properties().childs().inputs.childs()[i].value(),n=e.resolvedSymbolInfoBySymbol(s)
;n&&("spread"===n.type&&t.add(r.DataSourceDangerReason.Spread),"CRYPTOCAP"===n.exchange&&t.add(r.DataSourceDangerReason.CryptoCap))}for(const i of e.parentSources())(0,s.addToSet)(t,n(i));const l=e.ownerSource();return e.isChildStudy()&&l&&(0,s.addToSet)(t,n(l)),t}function o(e){const[t]=n(e);return null!=t?t:null}},246733:(e,t,i)=>{i.r(t),i.d(t,{alphaToTransparency:()=>o,applyAlpha:()=>n,applyTransparency:()=>a,colorFromBackground:()=>u,colorToInteger:()=>P,generateColor:()=>s,getLuminance:()=>h,gradientColorAtPercent:()=>p,isColorDark:()=>_,isHexColor:()=>d,resetTransparency:()=>c,rgbaFromInteger:()=>g,rgbaToInteger:()=>f,transparencyToAlpha:()=>l});var r=i(724377);function s(e,t,i){if(t=t||0,!d(e))return i?(0,r.rgbaToString)((0,r.rgba)((0,r.parseRgb)(e),(0,r.normalizeAlphaComponent)(l(t)))):e;const[s,n,o]=(0,r.parseRgb)(e),a=(0,r.normalizeAlphaComponent)(l(t));return(0,r.rgbaToString)([s,n,o,a])}function n(e,t){return s(e,o(t),!0)}function o(e){return 100*(1-e)}function l(e){if(e<0||e>100)throw new Error("invalid transparency");return 1-e/100}function a(e,t){if("transparent"===e)return e;const i=(0,r.parseRgba)(e),s=i[3];return(0,r.rgbaToString)((0,r.rgba)(i[0],i[1],i[2],l(t)*s))}function c(e){return"transparent"===e||d(e)?e:(0,r.rgbaToString)((0,r.rgba)((0,r.parseRgb)(e),(0,r.normalizeAlphaComponent)(1)))}function h(e){const t=(0,r.parseRgb)(e).map((e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)));return Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function d(e){return 0===e.indexOf("#")}function u(e){return"black"===(0,r.rgbToBlackWhiteString)((0,r.parseRgb)(e),150)?"#ffffff":"#000000"}function p(e,t,i){const[s,n,o,l]=(0,r.parseRgba)(e),[a,c,h,d]=(0,r.parseRgba)(t),u=(0,r.rgba)(Math.round(s+i*(a-s)),Math.round(n+i*(c-n)),Math.round(o+i*(h-o)),l+i*(d-l));return(0,r.rgbaToString)(u)}function _(e){return h(c(e))<.5}function g(e){const t=(e=Math.round(e))%256;e-=t;const i=(e/=256)%256;e-=i;const r=(e/=256)%256;e-=r;return`rgba(${t},${i},${r},${(e/=256)/255})`}function f(e){const t=Math.round(255*e[3]);return e[0]+256*e[1]+65536*e[2]+16777216*t}function P(e){const t=(0,r.tryParseRgba)(e);return null===t?0:f(t)}},511131:(e,t,i)=>{function r(e,t,i,r){return`${r?r+" ":""}${i?i+" ":""}${e}px ${t}`}i.d(t,{makeFont:()=>r,parseFont:()=>n});const s=/(bold )?(italic )?(\d+)(px|pt) (.*)$/;function n(e){const t=s.exec(e);return null===t?null:{family:t[5],size:parseInt(t[3])*("pt"===t[4]?.75:1),bold:Boolean(t[1]),italic:Boolean(t[2])}}},151149:(e,t,i)=>{i.d(t,{rgbaFromIntegerCached:()=>o});var r=i(448874),s=i(246733),n=i(407478);function o(e=1e3){const t=r.default.Cache;r.default.Cache=n.CircularCacheBuffer.bind(n.CircularCacheBuffer,e);const i=(0,r.default)(s.rgbaFromInteger);return r.default.Cache=t,i}},298113:(e,t,i)=>{function r(e,t){for(const i of t.keys())e.add(i)}i.d(t,{addToSet:()=>r})},847754:(e,t,i)=>{async function r(e){
(await Promise.all([i.e(72933),i.e(38501),i.e(33996),i.e(22666),i.e(62253),i.e(92108),i.e(9817),i.e(92191),i.e(32109),i.e(68992),i.e(61298),i.e(33199),i.e(6209),i.e(55242),i.e(967),i.e(73151),i.e(93139),i.e(48478),i.e(8954),i.e(50690),i.e(745),i.e(8658),i.e(22616),i.e(88954),i.e(35816),i.e(94913)]).then(i.bind(i,303700))).renderRunOrSigninWithFeatureDialog(e)}i.d(t,{createRunOrSigniWithFeatureDialog:()=>r})},397150:(e,t,i)=>{i.d(t,{showTooManyStudiesNotice:()=>l});var r=i(444372),s=i(778016),n=i(833813),o=i(779923);function l(e){"number"!=typeof e&&(e=TradingView.STUDY_COUNT_LIMIT,e=(0,s.getConfig)(n.ProductFeatures.STUDY_ON_STUDY).limit),(0,o.showWarning)({title:r.t(null,void 0,i(533603)),text:r.t(null,void 0,i(470213)).format({number:e})})}},328530:(e,t,i)=>{i.d(t,{getTwemojiUrl:()=>s,twemoji:()=>r.default});var r=i(818438);function s(e,t){let i="";return r.default.parse(e,(e=>(i=r.default.base+("svg"===t?`svg/${e}.svg`:`72x72/${e}.png`),!1))),i}r.default.base="https://cdnjs.cloudflare.com/ajax/libs/twemoji/13.0.1/"},755785:(e,t,i)=>{function r(e,t){const i=new Map;return function(...r){const s=""+(t?t.apply(null,r):r[0]);if(!i.has(s)){const t=e.apply(this,r);return i.set(s,t),t}return i.get(s)}}i.d(t,{memoize:()=>r})},162998:e=>{
e.exports=JSON.parse('{"EXTENDED_HOURS":43000502023,"PRE_MARKET":43000502023,"POST_MARKET":43000502023,"SPREAD_CHARTS":43000502298,"ALERTS":43000520149,"ALERT_ON_STRATEGY":43000481368,"ALERT_WEBHOOK":43000529348,"ALERT_DESCRIPTION_PLACEHOLDER":43000531021,"ALERT_RECEIVE_NOTIFICATIONS_OH_PHONE":43000474389,"ALERT_USE_ALTERNATIVE_EMAIL":43000474394,"VOLUME_PROFILE":43000502040,"VOLUME_PROFILE_INDICATOR":43000557450,"RENKO":43000502284,"KAGI":43000502272,"LINE_BREAK":43000502273,"PNF":43000502276,"FINANCIAL_DATA":43000543506,"BROKER_RATING":43000542490,"CRYPTO_MARKET_CAP":43000540941,"CRYPTO_PAYMENT":43000485536,"ALERT_ON_SPREAD":43000478406,"ALERT_ON_LOG_SCALE":43000690942,"ALERT_ON_CUSTOM_SCRIPT":43000478415,"ALERT_FUNCTION":43000597494,"SMS_VERIFICATION":43000553429,"MAGNET_MODE":43000537270,"PINE_CANNOT_DETERMINE":43000587849,"PRIVACY_SETTINGS":43000548335,"PUBLICATION_TYPE":43000609497,"SCRIPT_ACCESS":43000482573,"MEMORY_LIMITS_EXCEEDED":43000590233,"FREE_USER_FAQS":43000590947,"STRATEGY_UNREALISTIC_RESULTS":43000481029,"STRATEGY_FUTURE_DATA":43000614705,"STREAM_RULES":43000591348,"HOW_TO_USE_PAPER":43000516466,"HOW_TO_USE_CQG":43000516372,"HOW_TO_USE_OANDA":43000516375,"HOW_TO_USE_FOREXCOM":43000516374,"FAVORITE_IDEA":43000555216,"YOUTUBE_ERROR":43000612153,"AUTHORS_INSTRUCTIONS_PUBCLICATION":43000549951,"AUTHORS_INSTRUCTIONS_EDIT":43000614618,"SCRIPT_INSTRUCTIONS":43000482573,"BAR_REPLAY_UNAVAILABILITY":43000475470,"WHAT_IS_CBOE_BZX_EXCHANGE":43000473924,"GOPRO_UPGRADE_DESCRIPTION":43000473324,"GOPRO_DOWNGRADE_DESCRIPTION":43000485437,"FINANCIALS_OWNERSHIP":43000699479,"FINANCIALS_VALUATION_SUMMARY":43000699484,"FINANCIALS_VALUATION_RATIOS":43000699495,"FINANCIALS_GROWTH_AND_PROFITABILITY":43000699485,"FINANCIALS_REVENUE_TO_PROFIT_CONVERSION":43000699496,"FINANCIALS_REVENUE_BREAKDOWN_BY_SOURCE":43000699487,"FINANCIALS_REVENUE_BREAKDOWN_BY_COUNTRY":43000699497,"FINANCIALS_REVENUE_ESTIMATES":43000699489,"FINANCIALS_EARNINGS_ESTIMATES":43000699498,"FINANCIALS_DIVIDEND_SUMMARY":43000699500,"FINANCIALS_DIVIDEND_HISTORY":43000699501,"FINANCIALS_DEBT_LEVEL":43000699502,"FINANCIALS_POSITION":43000699503,"BROKERAGE_REVIEWS":43000591351,"CHANGE_SUBSCRIPTION":43000635806,"PINE_LIBRARY_INFO":43000638371,"HOW_TO_CREATE_A_STREAM":43000646171,"HOW_DO_I_UPDATE_DESKTOP_APP":43000647779,"TECHNICAL_RATINGS":43000614331,"BACKTESTING_WIDGET":43000562362,"BACKTESTING_NO_DATA":43000478450,"DEEP_BACKTESTING_WIDGET":43000670566,"DEEP_BACKTESTING":43000666199,"DEEP_BACKTESTING_AVAILABLE_DATA":43000668210,"BETA_BROKERS":43000673434,"VIDEO_UPLOAD_FAILED":43000666607,"VIDEO_DEVICE_ACCESS":43000677209,"PUBLIC_INVITE_ONLY_SCRIPTS":43000614617,"HOW_DOES_BRACKETS_MANAGEMENT_WORK":43000631987,"HOW_TO_SEE_THE_DEEPEST_HIST_DATA":43000687053,"I_CANT_SEE_ALL_HIST_DATA_ON_RES_LOWER_THAN_DAY":43000480679,"IDEAS_ON_CHART":43000694285,"GET_A_REFUND":43000485430,"USE_SETTLEMENT_AS_CLOSE_ON_DAILY_INTREVAL":43000685268,"ADJUST_FOR_CONTRACT_CHANGES":43000685266,"ADJUST_DATA_FOR_DIVIDENDS":43000590597,"WHY_IS_MY_ACCOUNT_BANNED":43000674726,"HOW_TO_PUBLISH_A_VIDEO_IDEA":43000476752,"WHAT_ARE_TRADINGVIEW_LIVE_STREAMS_BEST_PRACTICES":43000685377,"TELL_ME_MORE_ABOUT_THE_COMMUNITY_SCRIPTS":43000558522,"HOW_TO_POST_AWESOME_IDEAS_AND_GET_LOTS_OF_LIKES":43000603748,"ABOUT_EXPERT_PLAN":43000677382,"CONNECTIONS_LIMIT_EXCEEDED":43000693877,"ACCOUNT_RECOVERY":43000619597,"HOW_TO_SYNC_CHARTS_ON_LAYOUT":43000629992,"HOW_TO_SEE_BUILTIN_INDICATOR_SOURCE":43000481659,"HOW_CAN_I_GET_ACCESS_TO_STREAMS":43000685376,"MULTI_CHART_MODE":43000629990,"QUICK_SEARCH":43000659671,"WHATS_AN_INDICATOR":43000543626,"CHART_TYPES":43000703407,"DRAWING_TOOLS":43000703396,"CUSTOM_INTERVALS":43000543883,"CANDLESTICK_PATTERNS":43000584462,"MULTI_TIMEFRAME_CHARTS":43000502591,"BAR_REPLAY":43000691889,"PINE_SCRIPT":43000561836,"SCREENER_OVERVIEW":43000635796,"STREAMS_OBS_SETUP":43000639464,"AUTO_CHART_PATTERNS":43000690464,"HOW_TO_PROTECT_YOUR_ACCOUNT":43000582277,"PLUS_BUTTON":43000645256,"PLAN_UPGRADED_BUT_DATA_STILL_DELAYED":43000471705,"WHY_TAX_HAS_BEEN_ADDED_TO_MY_BILL":43000684741,"SAVED_CHART":43000692404,"CUSTOM_INDICATOR":43000543048,"BIST_MIXED_SUBSCRIPTION":43000609137}')
}}]);